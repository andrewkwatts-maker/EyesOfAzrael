import{ENTITY_ICONS,ENTITY_LABELS,getEntityIcon,getEntityLabel}from"./constants/entity-types.js";class EntityDisplay{static renderCard(e){const t=document.createElement("div");t.className="entity-card",t.dataset.entityId=e.id,t.dataset.entityType=e.type,t.addEventListener("click",t=>{t.target.closest(".content-filter-dropdown")||(window.location.href=`/${e.mythology}/${e.type}s/${e.id}.html`)});const n=this.getEntityIcon(e),s=this.getMythologyBadge(e);return t.innerHTML=`\n            <div class="entity-icon">${n}</div>\n            <h3 class="entity-name">${this.escapeHtml(e.name||e.title)}</h3>\n            <p class="entity-subtitle">${this.escapeHtml(e.subtitle||e.shortDescription||"")}</p>\n            ${s}\n            <div class="entity-type-badge">${this.getTypeLabel(e.type)}</div>\n        `,window.contentFilterDropdown&&setTimeout(()=>{window.contentFilterDropdown.addDropdown(t,e)},0),t}static renderDetail(e,t){t.className="entity-detail-page",t.dataset.entityId=e.id,t.dataset.entityType=e.type;const n=[];n.push(this.renderHeader(e)),n.push(this.renderDescription(e)),(e.content||e.longDescription)&&n.push(this.renderContent(e)),n.push(this.renderTypeSpecificSections(e)),n.push(this.renderMetadata(e)),e.relatedEntities&&n.push(this.renderRelatedEntities(e.relatedEntities)),e.crossReferences&&n.push(this.renderCrossReferences(e.crossReferences)),e.sources&&e.sources.length>0&&n.push(this.renderSources(e.sources)),n.push(this.renderEditButton(e)),t.innerHTML=n.filter(e=>e).join(""),window.contentFilterDropdown&&setTimeout(()=>{const n=t.querySelector(".entity-header");n&&window.contentFilterDropdown.addDropdown(n,e)},0)}static renderHeader(e){const t=this.getEntityIcon(e),n=(e.mythologies||[e.mythology]).map(e=>`<span class="mythology-tag">${this.capitalize(e)}</span>`).join("");return`\n            <header class="entity-header">\n                <div class="entity-header-icon">${t}</div>\n                <div class="entity-header-content">\n                    <h1 class="entity-title">${this.escapeHtml(e.name||e.title)}</h1>\n                    <p class="entity-subtitle">${this.escapeHtml(e.subtitle||e.shortDescription||"")}</p>\n                    <div class="entity-tags">\n                        <span class="type-tag">${this.getTypeLabel(e.type)}</span>\n                        ${n}\n                    </div>\n                </div>\n            </header>\n        `}static renderDescription(e){const t=e.description||e.shortDescription||e.longDescription||"";return t?`\n            <section class="entity-description">\n                <div class="description-content">\n                    ${this.renderMarkdown(t)}\n                </div>\n            </section>\n        `:""}static renderContent(e){const t=e.content||e.longDescription||"";return t&&t!==e.description?`\n            <section class="entity-content">\n                <h2>Detailed Information</h2>\n                <div class="content-body">\n                    ${this.renderMarkdown(t)}\n                </div>\n            </section>\n        `:""}static renderTypeSpecificSections(e){switch(e.type){case"deity":return this.renderDeitySections(e);case"hero":return this.renderHeroSections(e);case"creature":return this.renderCreatureSections(e);case"item":return this.renderItemSections(e);case"place":return this.renderPlaceSections(e);case"concept":return this.renderConceptSections(e);case"magic":return this.renderMagicSections(e);case"theory":return this.renderTheorySections(e);case"mythology":return this.renderMythologySections(e);default:return""}}static renderDeitySections(e){let t=[];return e.domains&&e.domains.length>0&&t.push(`\n                <section class="deity-domains">\n                    <h2>Domains</h2>\n                    <div class="domain-tags">\n                        ${e.domains.map(e=>`<span class="domain-tag">${this.capitalize(e)}</span>`).join("")}\n                    </div>\n                </section>\n            `),e.symbols&&e.symbols.length>0&&t.push(`\n                <section class="deity-symbols">\n                    <h2>Symbols</h2>\n                    <div class="symbol-list">\n                        ${e.symbols.map(e=>`<span class="symbol-item">‚ö° ${this.capitalize(e)}</span>`).join("")}\n                    </div>\n                </section>\n            `),e.relationships&&t.push(this.renderRelationships(e.relationships)),(e.sacredAnimals||e.sacredPlants)&&t.push(this.renderSacredItems(e)),e.epithets&&e.epithets.length>0&&t.push(`\n                <section class="deity-epithets">\n                    <h2>Epithets & Titles</h2>\n                    <ul class="epithets-list">\n                        ${e.epithets.map(e=>`<li>${this.escapeHtml(e)}</li>`).join("")}\n                    </ul>\n                </section>\n            `),e.archetypes&&e.archetypes.length>0&&t.push(this.renderArchetypes(e.archetypes)),t.join("")}static renderHeroSections(e){let t=[];return e.parentage&&t.push(`\n                <section class="hero-parentage">\n                    <h2>Parentage</h2>\n                    <div class="parentage-info">\n                        ${e.parentage.father?`<p><strong>Father:</strong> ${this.createEntityLink(e.parentage.father,"deity")}</p>`:""}\n                        ${e.parentage.mother?`<p><strong>Mother:</strong> ${this.createEntityLink(e.parentage.mother,"deity")}</p>`:""}\n                        ${e.parentage.divine?'<p class="divine-tag">‚ö° Divine Heritage</p>':""}\n                    </div>\n                </section>\n            `),e.quests&&e.quests.length>0&&t.push(`\n                <section class="hero-quests">\n                    <h2>Legendary Quests</h2>\n                    <ul class="quests-list">\n                        ${e.quests.map(e=>`<li>${this.escapeHtml(e)}</li>`).join("")}\n                    </ul>\n                </section>\n            `),e.weapons&&e.weapons.length>0&&t.push(`\n                <section class="hero-weapons">\n                    <h2>Weapons & Equipment</h2>\n                    <div class="weapons-grid">\n                        ${e.weapons.map(e=>this.createEntityCard({id:e,type:"item"})).join("")}\n                    </div>\n                </section>\n            `),e.abilities&&e.abilities.length>0&&t.push(`\n                <section class="hero-abilities">\n                    <h2>Abilities</h2>\n                    <div class="abilities-list">\n                        ${e.abilities.map(e=>`<span class="ability-tag">‚ú® ${this.escapeHtml(e)}</span>`).join("")}\n                    </div>\n                </section>\n            `),t.join("")}static renderCreatureSections(e){let t=[];return e.physicalDescription&&t.push(`\n                <section class="creature-appearance">\n                    <h2>Physical Appearance</h2>\n                    <p>${this.renderMarkdown(e.physicalDescription)}</p>\n                </section>\n            `),e.abilities&&e.abilities.length>0&&t.push(`\n                <section class="creature-abilities">\n                    <h2>Abilities</h2>\n                    <div class="abilities-grid">\n                        ${e.abilities.map(e=>`<div class="ability-card">‚ö° ${this.escapeHtml(e)}</div>`).join("")}\n                    </div>\n                </section>\n            `),e.weaknesses&&e.weaknesses.length>0&&t.push(`\n                <section class="creature-weaknesses">\n                    <h2>Weaknesses</h2>\n                    <div class="weaknesses-list">\n                        ${e.weaknesses.map(e=>`<span class="weakness-tag">üõ°Ô∏è ${this.escapeHtml(e)}</span>`).join("")}\n                    </div>\n                </section>\n            `),e.slainBy&&e.slainBy.length>0&&t.push(`\n                <section class="creature-slayers">\n                    <h2>Defeated By</h2>\n                    <div class="slayers-list">\n                        ${e.slainBy.map(e=>this.createEntityLink(e,"hero")).join(", ")}\n                    </div>\n                </section>\n            `),t.join("")}static renderItemSections(e){let t=[];return e.powers&&e.powers.length>0&&t.push(`\n                <section class="item-powers">\n                    <h2>Powers & Abilities</h2>\n                    <ul class="powers-list">\n                        ${e.powers.map(e=>`<li>‚ö° ${this.escapeHtml(e)}</li>`).join("")}\n                    </ul>\n                </section>\n            `),e.materials&&e.materials.length>0&&t.push(`\n                <section class="item-materials">\n                    <h2>Materials</h2>\n                    <div class="materials-tags">\n                        ${e.materials.map(e=>`<span class="material-tag">${this.escapeHtml(e)}</span>`).join("")}\n                    </div>\n                </section>\n            `),e.wielders&&e.wielders.length>0&&t.push(`\n                <section class="item-wielders">\n                    <h2>Notable Wielders</h2>\n                    <div class="wielders-grid">\n                        ${e.wielders.map(e=>this.createEntityLink(e,"deity")).join(", ")}\n                    </div>\n                </section>\n            `),e.createdBy&&e.createdBy.length>0&&t.push(`\n                <section class="item-creator">\n                    <h2>Created By</h2>\n                    <p>${e.createdBy.map(e=>this.createEntityLink(e,"deity")).join(", ")}</p>\n                </section>\n            `),t.join("")}static renderPlaceSections(e){let t=[];return e.geographical?.primaryLocation?.coordinates&&t.push(this.renderMap(e.geographical.primaryLocation.coordinates)),e.inhabitants&&e.inhabitants.length>0&&t.push(`\n                <section class="place-inhabitants">\n                    <h2>Inhabitants</h2>\n                    <div class="inhabitants-grid">\n                        ${e.inhabitants.map(e=>this.createEntityLink(e,"deity")).join(", ")}\n                    </div>\n                </section>\n            `),e.events&&e.events.length>0&&t.push(`\n                <section class="place-events">\n                    <h2>Major Events</h2>\n                    <ul class="events-list">\n                        ${e.events.map(e=>`<li>${this.escapeHtml(e)}</li>`).join("")}\n                    </ul>\n                </section>\n            `),t.join("")}static renderConceptSections(e){let t=[];return e.opposites&&e.opposites.length>0&&t.push(`\n                <section class="concept-opposites">\n                    <h2>Opposing Concepts</h2>\n                    <div class="opposites-list">\n                        ${e.opposites.map(e=>this.createEntityLink(e,"concept")).join(", ")}\n                    </div>\n                </section>\n            `),e.personifications&&e.personifications.length>0&&t.push(`\n                <section class="concept-personifications">\n                    <h2>Personified As</h2>\n                    <div class="personifications-grid">\n                        ${e.personifications.map(e=>this.createEntityLink(e,"deity")).join(", ")}\n                    </div>\n                </section>\n            `),t.join("")}static renderMagicSections(e){let t=[];return e.techniques&&e.techniques.length>0&&t.push(`\n                <section class="magic-techniques">\n                    <h2>Techniques & Methods</h2>\n                    <ul class="techniques-list">\n                        ${e.techniques.map(e=>`<li>${this.escapeHtml(e)}</li>`).join("")}\n                    </ul>\n                </section>\n            `),e.tools&&e.tools.length>0&&t.push(`\n                <section class="magic-tools">\n                    <h2>Tools & Materials</h2>\n                    <div class="tools-list">\n                        ${e.tools.map(e=>`<span class="tool-tag">üîÆ ${this.escapeHtml(e)}</span>`).join("")}\n                    </div>\n                </section>\n            `),e.safetyWarnings&&e.safetyWarnings.length>0&&t.push(`\n                <section class="magic-warnings">\n                    <h2>‚ö†Ô∏è Safety Warnings</h2>\n                    <div class="warnings-box">\n                        ${e.safetyWarnings.map(e=>`<p>‚ö†Ô∏è ${this.escapeHtml(e)}</p>`).join("")}\n                    </div>\n                </section>\n            `),t.join("")}static renderTheorySections(e){let t=[];return e.intellectualHonestyWarning&&t.push(`\n                <section class="theory-warning">\n                    <div class="intellectual-honesty-warning">\n                        <h3>‚ö†Ô∏è Intellectual Honesty Statement</h3>\n                        <p>${this.escapeHtml(e.intellectualHonestyWarning)}</p>\n                    </div>\n                </section>\n            `),"number"==typeof e.confidence&&t.push(`\n                <section class="theory-confidence">\n                    <h2>Confidence Score</h2>\n                    <div class="confidence-meter">\n                        <div class="confidence-bar" style="width: ${e.confidence}%">\n                            ${e.confidence}%\n                        </div>\n                    </div>\n                </section>\n            `),e.keyCorrelations&&e.keyCorrelations.length>0&&t.push(`\n                <section class="theory-correlations">\n                    <h2>Key Correlations</h2>\n                    <div class="correlations-list">\n                        ${e.keyCorrelations.map(e=>`\n                            <div class="correlation-card">\n                                <div class="correlation-row">\n                                    <span class="correlation-label">Mythological:</span>\n                                    <span>${this.escapeHtml(e.mythological||e.kabbalistic)}</span>\n                                </div>\n                                <div class="correlation-row">\n                                    <span class="correlation-label">Scientific:</span>\n                                    <span>${this.escapeHtml(e.scientific||e.physics)}</span>\n                                </div>\n                                <div class="correlation-confidence">\n                                    Confidence: ${e.confidence}%\n                                </div>\n                            </div>\n                        `).join("")}\n                    </div>\n                </section>\n            `),e.alternativeExplanations&&e.alternativeExplanations.length>0&&t.push(`\n                <section class="theory-alternatives">\n                    <h2>Alternative Explanations</h2>\n                    <ul class="alternatives-list">\n                        ${e.alternativeExplanations.map(e=>`<li>${this.escapeHtml(e)}</li>`).join("")}\n                    </ul>\n                </section>\n            `),t.join("")}static renderMythologySections(e){let t=[];return e.creationMyth&&t.push(`\n                <section class="mythology-creation">\n                    <h2>Creation Myth</h2>\n                    <p>${this.renderMarkdown(e.creationMyth)}</p>\n                </section>\n            `),e.cosmology&&t.push(`\n                <section class="mythology-cosmology">\n                    <h2>Cosmology</h2>\n                    <p>${this.renderMarkdown(e.cosmology)}</p>\n                </section>\n            `),e.majorDeities&&e.majorDeities.length>0&&t.push(`\n                <section class="mythology-deities">\n                    <h2>Major Deities</h2>\n                    <div class="deities-grid">\n                        ${e.majorDeities.map(e=>this.createEntityLink(e,"deity")).join(", ")}\n                    </div>\n                </section>\n            `),t.join("")}static renderMetadata(e){let t=[];return e.linguistic&&t.push(`\n                <div class="metadata-section linguistic-data">\n                    <h3>Linguistic Information</h3>\n                    ${e.linguistic.originalName?`<p><strong>Original Name:</strong> ${this.escapeHtml(e.linguistic.originalName)}</p>`:""}\n                    ${e.linguistic.pronunciation?`<p><strong>Pronunciation:</strong> ${this.escapeHtml(e.linguistic.pronunciation)}</p>`:""}\n                    ${e.linguistic.etymology?`<p><strong>Etymology:</strong> ${this.escapeHtml(e.linguistic.etymology.meaning||"")}</p>`:""}\n                </div>\n            `),e.geographical&&t.push(`\n                <div class="metadata-section geographical-data">\n                    <h3>Geographical Information</h3>\n                    ${e.geographical.region?`<p><strong>Region:</strong> ${this.escapeHtml(e.geographical.region)}</p>`:""}\n                    ${e.geographical.primaryLocation?.name?`<p><strong>Location:</strong> ${this.escapeHtml(e.geographical.primaryLocation.name)}</p>`:""}\n                </div>\n            `),e.temporal&&t.push(`\n                <div class="metadata-section temporal-data">\n                    <h3>Historical Information</h3>\n                    ${e.temporal.firstAttestation?.date?`<p><strong>First Attested:</strong> ${this.escapeHtml(e.temporal.firstAttestation.date)}</p>`:""}\n                    ${e.temporal.historicalPeriod?`<p><strong>Period:</strong> ${this.escapeHtml(e.temporal.historicalPeriod)}</p>`:""}\n                </div>\n            `),0===t.length?"":`\n            <aside class="entity-metadata">\n                ${t.join("")}\n            </aside>\n        `}static renderRelationships(e){return e&&0!==Object.keys(e).length?`\n            <section class="entity-relationships">\n                <h2>Family & Relationships</h2>\n                <div class="relationships-info">\n                    ${Object.entries(e).map(([e,t])=>Array.isArray(t)?`<p><strong>${this.capitalize(e)}:</strong> ${t.map(e=>this.createEntityLink(e,"deity")).join(", ")}</p>`:`<p><strong>${this.capitalize(e)}:</strong> ${this.createEntityLink(t,"deity")}</p>`).join("")}\n                </div>\n            </section>\n        `:""}static renderArchetypes(e){return e&&0!==e.length?`\n            <section class="entity-archetypes">\n                <h2>Archetypes</h2>\n                <div class="archetypes-list">\n                    ${e.sort((e,t)=>(t.score||0)-(e.score||0)).map(e=>`\n                <div class="archetype-card">\n                    <span class="archetype-name">${this.formatArchetype(e.category)}</span>\n                    <div class="archetype-score">\n                        <div class="score-bar" style="width: ${e.score}%"></div>\n                        <span class="score-text">${e.score}%</span>\n                    </div>\n                    ${e.inferred?'<span class="inferred-tag">Inferred</span>':""}\n                </div>\n            `).join("")}\n                </div>\n            </section>\n        `:""}static renderRelatedEntities(e){if(!e||0===Object.keys(e).length)return"";const t=[];return Object.entries(e).forEach(([e,n])=>{n&&n.length>0&&t.push(`\n                    <div class="related-${e}">\n                        <h3>Related ${this.capitalize(e)}</h3>\n                        <div class="related-grid">\n                            ${n.map(t=>this.createEntityLink(t,e.replace(/s$/,""))).join(", ")}\n                        </div>\n                    </div>\n                `)}),0===t.length?"":`\n            <section class="entity-related">\n                <h2>Related Entities</h2>\n                ${t.join("")}\n            </section>\n        `}static renderCrossReferences(e){return e&&0!==Object.keys(e).length?this.renderRelatedEntities(e):""}static renderSources(e){return e&&0!==e.length?`\n            <section class="entity-sources">\n                <h2>Sources</h2>\n                <div class="sources-list">\n                    ${e.map(e=>`\n            <div class="source-item">\n                <p class="source-title">${this.escapeHtml(e.title)}</p>\n                ${e.author?`<p class="source-author">${this.escapeHtml(e.author)}</p>`:""}\n                ${e.citation?`<p class="source-citation">${this.escapeHtml(e.citation)}</p>`:""}\n                ${e.url?`<a href="${this.escapeHtml(e.url)}" target="_blank" class="source-link">View Source</a>`:""}\n            </div>\n        `).join("")}\n                </div>\n            </section>\n        `:""}static renderMap(e){return`\n            <section class="place-map">\n                <h2>Location</h2>\n                <div class="map-container" data-lat="${e.latitude}" data-lng="${e.longitude}">\n                    <p>üìç ${e.latitude}, ${e.longitude}</p>\n                    <p class="map-placeholder">Map will be rendered here</p>\n                </div>\n            </section>\n        `}static renderEditButton(e){return`\n            <div class="entity-actions">\n                <button class="btn-edit" onclick="EntityDisplay.editEntity('${e.id}', '${e.type}')">\n                    ‚úèÔ∏è Edit This ${this.getTypeLabel(e.type)}\n                </button>\n            </div>\n        `}static createEntityLink(e,t){return e?`<a href="/${t}s/${e}.html" class="entity-link" data-entity-id="${e}" data-entity-type="${t}">${e}</a>`:""}static createEntityCard(e){return`\n            <div class="mini-entity-card" data-entity-id="${e.id}">\n                <span class="mini-entity-name">${e.name||e.id}</span>\n            </div>\n        `}static getEntityIcon(e){return getEntityIcon(e)}static getMythologyBadge(e){const t=e.mythologies||[e.mythology];return t&&0!==t.length?`\n            <div class="mythology-badges">\n                ${t.map(e=>`<span class="mythology-badge mythology-${e}">${this.capitalize(e)}</span>`).join("")}\n            </div>\n        `:""}static getTypeLabel(e){return getEntityLabel(e)}static formatArchetype(e){return e.split("-").map(e=>this.capitalize(e)).join(" ")}static renderMarkdown(e){return e?e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>"):""}static escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}static capitalize(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}static editEntity(e,t){window.location.href=`/edit.html?type=${t}&id=${e}`}static shouldDisplayEntity(e){if(!e)return!1;if(window.contentFilter&&!window.contentFilter.shouldShow(e))return!1;if(window.contentFilterDropdown){if(window.contentFilterDropdown.getHiddenSubmissions().includes(e.id))return!1;const t=window.contentFilterDropdown.getBlockedCategories();if(e.userId&&t.includes(e.type))return!1}return!0}static filterEntities(e){return e&&Array.isArray(e)?e.filter(e=>this.shouldDisplayEntity(e)):[]}static getEntityMetadata(e){const t=!e.userId||!0===e.official,n=window.userAuth?.getCurrentUser()?.uid;return{isOfficial:t,isOwn:e.userId&&e.userId===n,isUserGenerated:!t,author:e.userName||e.userDisplayName||"Unknown",submittedDate:e.createdAt,approvalStatus:e.approvalStatus||"pending"}}}"undefined"!=typeof module&&module.exports&&(module.exports=EntityDisplay);