class SPANavigation{constructor(e,t,n){performance.now(),this.db=e,this.auth=t,this.renderer=n,this.currentRoute=null,this.routeHistory=[],this.maxHistory=50,this.authReady=!1,this.componentCache=new Map,this.routes={home:/^#?\/?$/,mythology:/^#?\/mythology\/([^\/]+)\/?$/,entity:/^#?\/mythology\/([^\/]+)\/([^\/]+)\/([^\/]+)\/?$/,category:/^#?\/mythology\/([^\/]+)\/([^\/]+)\/?$/,search:/^#?\/search\/?$/,compare:/^#?\/compare\/?$/,dashboard:/^#?\/dashboard\/?$/,about:/^#?\/about\/?$/,privacy:/^#?\/privacy\/?$/,terms:/^#?\/terms\/?$/},performance.now();const a=firebase.auth().currentUser;performance.now(),a?(performance.now(),this.authReady=!0,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.initRouter()):this.initRouter()):this.waitForAuth().then(e=>{this.authReady=!0,this.initRouter()}).catch(e=>{})}async waitForAuth(){return new Promise((e,t)=>{const n=firebase.auth();if(!n)return void t(new Error("Firebase auth not available"));const a=n.onAuthStateChanged(t=>{a(),e(t)})})}initRouter(){window.addEventListener("hashchange",()=>this.handleRoute()),window.addEventListener("popstate",()=>this.handleRoute()),document.addEventListener("click",e=>{if(e.target.matches('a[href^="#"]')||e.target.closest('a[href^="#"]')){const t=e.target.matches("a")?e.target:e.target.closest("a");t.hash&&(e.preventDefault(),this.navigate(t.hash))}}),this.handleRoute()}navigate(e){e.startsWith("#")||(e="#"+e),window.location.hash=e}async loadComponent(e){if(this.componentCache.has(e))return this.componentCache.get(e);performance.now();try{let t;switch(e){case"SearchViewComplete":"undefined"==typeof SearchViewComplete&&await this.loadScript("js/components/search-view-complete.min.js"),t=SearchViewComplete;break;case"CompareView":"undefined"==typeof CompareView&&await this.loadScript("js/components/compare-view.min.js"),t=CompareView;break;case"UserDashboard":"undefined"==typeof UserDashboard&&await Promise.all([this.loadScript("js/components/user-dashboard.min.js"),this.loadScript("js/firebase-crud-manager.min.js")]),t=UserDashboard;break;case"EntityEditor":"undefined"==typeof EntityEditor&&await this.loadScript("js/entity-editor.min.js"),t=EntityEditor;break;case"HomeView":"undefined"==typeof HomeView&&await this.loadScript("js/views/home-view.min.js"),t=HomeView;break;default:throw new Error(`Unknown component: ${e}`)}return performance.now(),this.componentCache.set(e,t),t}catch(e){throw e}}loadScript(e){return new Promise((t,n)=>{if(document.querySelector(`script[src="${e}"]`))return void t();const a=document.createElement("script");a.src=e,a.type="module",a.onload=()=>t(),a.onerror=()=>n(new Error(`Failed to load script: ${e}`)),document.head.appendChild(a)})}async handleRoute(){const e=(window.location.hash||"#/").replace("#","");window.AnalyticsManager&&window.AnalyticsManager.trackPageView(e),this.currentRoute&&window.AnalyticsManager&&window.AnalyticsManager.trackNavigation(this.currentRoute,e);const t=document.getElementById("main-content");if(this.authReady)if(firebase.auth().currentUser){this.addToHistory(e),this.showLoading();try{if(this.routes.home.test(e))await this.renderHome();else if(this.routes.entity.test(e)){const t=e.match(this.routes.entity);await this.renderEntity(t[1],t[2],t[3])}else if(this.routes.category.test(e)){const t=e.match(this.routes.category);await this.renderCategory(t[1],t[2])}else if(this.routes.mythology.test(e)){const t=e.match(this.routes.mythology);await this.renderMythology(t[1])}else this.routes.search.test(e)?await this.renderSearch():this.routes.compare.test(e)?await this.renderCompare():this.routes.dashboard.test(e)?await this.renderDashboard():this.routes.about.test(e)?await this.renderAbout():this.routes.privacy.test(e)?await this.renderPrivacy():this.routes.terms.test(e)?await this.renderTerms():await this.render404();this.updateBreadcrumb(e),this.currentRoute=e}catch(e){this.renderError(e)}}else this.showAuthWaitingState(t);else this.showAuthWaitingState(t)}async renderHome(){const e=document.getElementById("main-content");if("undefined"!=typeof PageAssetRenderer)try{const t=new PageAssetRenderer(this.db);if(await t.loadPage("home"))return await t.renderPage("home",e),void this.emitRenderComplete("home","PageAssetRenderer")}catch(e){}try{const t=new(await this.loadComponent("HomeView"))(this.db);return await t.render(e),void this.emitRenderComplete("home","HomeView")}catch(e){}this.renderHomeFallback(e)}renderHomeFallback(e){e.innerHTML=`\n            <div class="home-container">\n                <div class="hero-section">\n                    <h1 class="hero-title">Explore World Mythologies</h1>\n                    <p class="hero-subtitle">Discover deities, heroes, creatures, and sacred texts</p>\n                    <div class="hero-search">\n                        <input type="text" id="quick-search" placeholder="Search..." class="search-input-large">\n                        <button id="search-btn" class="btn-primary btn-large">üîç Search</button>\n                    </div>\n                </div>\n                <div class="mythologies-grid">\n                    ${[{id:"greek",name:"Greek",icon:"üèõÔ∏è",color:"#4A90E2"},{id:"norse",name:"Norse",icon:"‚öîÔ∏è",color:"#7C4DFF"},{id:"egyptian",name:"Egyptian",icon:"üî∫",color:"#FFB300"},{id:"hindu",name:"Hindu",icon:"üïâÔ∏è",color:"#E91E63"},{id:"chinese",name:"Chinese",icon:"üêâ",color:"#F44336"},{id:"japanese",name:"Japanese",icon:"‚õ©Ô∏è",color:"#FF5722"},{id:"celtic",name:"Celtic",icon:"üçÄ",color:"#4CAF50"},{id:"babylonian",name:"Babylonian",icon:"üè∫",color:"#795548"},{id:"christian",name:"Christian",icon:"‚úùÔ∏è",color:"#2196F3"}].map(e=>`\n                        <a href="#/mythology/${e.id}" class="mythology-card">\n                            <div class="myth-icon" style="color: ${e.color}">${e.icon}</div>\n                            <h3 class="myth-name">${e.name}</h3>\n                        </a>\n                    `).join("")}\n                </div>\n            </div>\n        `,this.attachSearchListeners(),this.emitRenderComplete("home","inline")}attachSearchListeners(){const e=document.getElementById("search-btn"),t=document.getElementById("quick-search");e&&t&&(e.addEventListener("click",()=>{const e=t.value;e&&this.navigate(`/search?q=${encodeURIComponent(e)}`)}),t.addEventListener("keypress",t=>{"Enter"===t.key&&e.click()}))}async renderMythology(e){document.getElementById("main-content").innerHTML=`<div class="mythology-page"><h1>${e} Mythology</h1></div>`,this.emitRenderComplete("mythology")}async renderCategory(e,t){document.getElementById("main-content").innerHTML=`<div class="category-page"><h1>${t} - ${e}</h1></div>`,this.emitRenderComplete("category")}async renderEntity(e,t,n){document.getElementById("main-content").innerHTML=`<div class="entity-page"><h1>${n}</h1></div>`,this.emitRenderComplete("entity")}async renderSearch(){const e=document.getElementById("main-content");try{const t=new(await this.loadComponent("SearchViewComplete"))(this.db);window.searchViewInstance=t,await t.render(e),this.emitRenderComplete("search","SearchViewComplete")}catch(t){e.innerHTML='\n                <div class="error-page">\n                    <h1>Search Not Available</h1>\n                    <p>Please refresh the page.</p>\n                    <a href="#/" class="btn-primary">Return Home</a>\n                </div>\n            '}}async renderCompare(){const e=document.getElementById("main-content");try{const t=new(await this.loadComponent("CompareView"))(this.db);await t.render(e),this.emitRenderComplete("compare","CompareView")}catch(t){e.innerHTML='<div class="error">Compare unavailable</div>'}}async renderDashboard(){const e=document.getElementById("main-content");try{const t=new(await this.loadComponent("UserDashboard"))({crudManager:new FirebaseCRUDManager(this.db,firebase.auth()),auth:firebase.auth()}),n=await t.render();e.innerHTML=n,t.initialize(e),this.emitRenderComplete("dashboard","UserDashboard")}catch(t){e.innerHTML='<div class="error">Dashboard unavailable</div>'}}async renderAbout(){document.getElementById("main-content").innerHTML='<div class="static-page"><h1>About</h1></div>',this.emitRenderComplete("about")}async renderPrivacy(){document.getElementById("main-content").innerHTML='<div class="static-page"><h1>Privacy Policy</h1></div>',this.emitRenderComplete("privacy")}async renderTerms(){document.getElementById("main-content").innerHTML='<div class="static-page"><h1>Terms of Service</h1></div>',this.emitRenderComplete("terms")}async render404(){document.getElementById("main-content").innerHTML='\n            <div class="error-page">\n                <h1>404</h1>\n                <p>Page not found</p>\n                <a href="#/" class="btn-primary">Return Home</a>\n            </div>\n        ',this.emitRenderComplete("404")}renderError(e){document.getElementById("main-content").innerHTML=`\n            <div class="error-page">\n                <h1>Error</h1>\n                <p>${e.message}</p>\n                <a href="#/" class="btn-primary">Return Home</a>\n            </div>\n        `}showLoading(){const e=document.getElementById("main-content");e&&(e.innerHTML='\n                <div class="loading-container">\n                    <div class="spinner-container">\n                        <div class="spinner-ring"></div>\n                        <div class="spinner-ring"></div>\n                        <div class="spinner-ring"></div>\n                    </div>\n                    <p class="loading-message">Loading...</p>\n                </div>\n            ')}showAuthWaitingState(e){e||(e=document.getElementById("main-content")),e&&(e.innerHTML='\n                <div class="loading-container">\n                    <div class="spinner-container">\n                        <div class="spinner-ring"></div>\n                    </div>\n                    <p class="loading-message">Verifying authentication...</p>\n                </div>\n            ')}emitRenderComplete(e,t="default"){document.dispatchEvent(new CustomEvent("first-render-complete",{detail:{route:e,renderer:t,timestamp:Date.now()}}))}updateBreadcrumb(e){}addToHistory(e){this.routeHistory.push({path:e,timestamp:Date.now()}),this.routeHistory.length>this.maxHistory&&(this.routeHistory=this.routeHistory.slice(-this.maxHistory))}getHistory(){return this.routeHistory}goBack(){window.history.back()}}"undefined"!=typeof module&&module.exports&&(module.exports=SPANavigation);