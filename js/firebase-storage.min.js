const FirebaseStorage=function(){"use strict";const e=5242880,r=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];function t(t){return t?r.includes(t.type)?t.size>e?{valid:!1,error:`File too large. Maximum size: ${5..toFixed(1)}MB`}:{valid:!0}:{valid:!1,error:`Invalid file type. Allowed types: ${r.join(", ")}`}:{valid:!1,error:"No file provided"}}return{uploadImage:async function(e,r={}){const o=t(e);if(!o.valid)return{success:!1,error:o.error};if(!r.userId)return{success:!1,error:"User must be logged in to upload images"};if(!window.firebase||!window.firebase.storage)return{success:!1,error:"Firebase Storage not initialized. Please ensure Firebase is configured."};try{const t=(a=e.name,`${Date.now()}_${Math.random().toString(36).substring(2,15)}.${a.split(".").pop()}`),o=function(e,r,t){return`theory-images/${e}/${r||"draft"}/${t}`}(r.userId,r.theoryId,t),s=window.firebase.storage().ref().child(o).put(e,{contentType:e.type,customMetadata:{originalName:e.name,uploadedBy:r.userId,uploadedAt:(new Date).toISOString()}});return new Promise((e,a)=>{s.on("state_changed",e=>{const t=e.bytesTransferred/e.totalBytes*100;r.onProgress&&"function"==typeof r.onProgress&&r.onProgress(t)},r=>{let t="Upload failed";"storage/unauthorized"===r.code?t="You do not have permission to upload images":"storage/canceled"===r.code?t="Upload canceled":"storage/quota-exceeded"===r.code?t="Storage quota exceeded":"storage/unknown"===r.code&&(t="Network error occurred"),e({success:!1,error:t})},async()=>{try{const r=await s.snapshot.ref.getDownloadURL();e({success:!0,url:r,path:o,filename:t})}catch(r){e({success:!1,error:"Failed to get download URL"})}})})}catch(e){return{success:!1,error:e.message||"Upload failed"}}var a},deleteImage:async function(e){if(!e)return{success:!1,error:"No path or URL provided"};if(!window.firebase||!window.firebase.storage)return{success:!1,error:"Firebase Storage not initialized"};try{const r=window.firebase.storage().ref();let t;return t=e.startsWith("http")?window.firebase.storage().refFromURL(e):r.child(e),await t.delete(),{success:!0}}catch(e){let r="Delete failed";return"storage/object-not-found"===e.code?r="Image not found":"storage/unauthorized"===e.code&&(r="You do not have permission to delete this image"),{success:!1,error:r}}},getImageUrl:async function(e){if(!e)return{success:!1,error:"No path provided"};if(!window.firebase||!window.firebase.storage)return{success:!1,error:"Firebase Storage not initialized"};try{const r=window.firebase.storage().ref().child(e);return{success:!0,url:await r.getDownloadURL()}}catch(e){return{success:!1,error:"Failed to get download URL"}}},getMetadata:async function(e){if(!e)return{success:!1,error:"No path or URL provided"};if(!window.firebase||!window.firebase.storage)return{success:!1,error:"Firebase Storage not initialized"};try{const r=window.firebase.storage().ref();let t;return t=e.startsWith("http")?window.firebase.storage().refFromURL(e):r.child(e),{success:!0,metadata:await t.getMetadata()}}catch(e){return{success:!1,error:"Failed to get metadata"}}},compressImage:function(e,r={}){const t=r.maxWidth||1920,o=r.maxHeight||1080,a=r.quality||.8;return new Promise((r,s)=>{const i=new FileReader;i.onload=i=>{const n=new Image;n.onload=()=>{let i=n.width,d=n.height;i>t&&(d=d*t/i,i=t),d>o&&(i=i*o/d,d=o);const c=document.createElement("canvas");c.width=i,c.height=d,c.getContext("2d").drawImage(n,0,0,i,d),c.toBlob(e=>{e?r(e):s(new Error("Compression failed"))},e.type,a)},n.onerror=()=>s(new Error("Failed to load image")),n.src=i.target.result},i.onerror=()=>s(new Error("Failed to read file")),i.readAsDataURL(e)})},validateFile:t,MAX_FILE_SIZE:e,ALLOWED_TYPES:r}}();"undefined"!=typeof window&&(window.FirebaseStorage=FirebaseStorage);