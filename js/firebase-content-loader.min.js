class FirebaseContentLoader{constructor(e=null,t={}){this.db=e?firebase.firestore(e):null,this.currentCollection=null,this.currentData=[],this.filteredData=[],this.filters={search:"",mythology:"all",sortBy:"name"},this.options={enableCache:!1!==t.enableCache,cacheOptions:t.cacheOptions||{},bypassCache:t.bypassCache||!1,enableLogging:t.enableLogging||!1},this.cacheManager=null,this.versionTracker=null,this.options.enableCache&&"undefined"!=typeof FirebaseCacheManager&&(this.cacheManager=new FirebaseCacheManager({enableLogging:this.options.enableLogging,...this.options.cacheOptions})),e&&"undefined"!=typeof VersionTracker&&(this.versionTracker=new VersionTracker(e,{enableLogging:this.options.enableLogging,onVersionChange:e=>{this.cacheManager&&this.cacheManager.setVersion(e)}})),this.contentTypes={deities:{collection:"deities",title:"Deities",fields:["name","mythology","domain","description","attributes"],badge:"mythology"},heroes:{collection:"heroes",title:"Heroes",fields:["name","mythology","legend","description","achievements"],badge:"mythology"},creatures:{collection:"creatures",title:"Mythical Creatures",fields:["name","mythology","type","description","abilities"],badge:"type"},cosmology:{collection:"cosmology",title:"Cosmology",fields:["name","mythology","realm","description","significance"],badge:"realm"},places:{collection:"places",title:"Sacred Places",fields:["name","mythology","type","description","significance"],badge:"type"},items:{collection:"items",title:"Sacred Items",fields:["name","mythology","type","description","powers"],badge:"type"},herbs:{collection:"herbs",title:"Sacred Herbs",fields:["name","mythology","uses","description","properties"],badge:"mythology"},rituals:{collection:"rituals",title:"Rituals",fields:["name","mythology","purpose","description","steps"],badge:"purpose"},texts:{collection:"texts",title:"Sacred Texts",fields:["name","mythology","type","description","significance"],badge:"type"},myths:{collection:"myths",title:"Myths & Legends",fields:["name","mythology","summary","description","characters"],badge:"mythology"},concepts:{collection:"concepts",title:"Mystical Concepts",fields:["name","mythology","category","description","examples"],badge:"category"},symbols:{collection:"symbols",title:"Sacred Symbols",fields:["name","mythology","meaning","description","usage"],badge:"mythology"}}}initFirestore(e){this.db=firebase.firestore(e),this.versionTracker||"undefined"==typeof VersionTracker||(this.versionTracker=new VersionTracker(e,{enableLogging:this.options.enableLogging,onVersionChange:e=>{this.cacheManager&&this.cacheManager.setVersion(e)}}),this.versionTracker.initialize().then(e=>{this.cacheManager&&this.cacheManager.setVersion(e)}).catch(e=>{}))}async loadContent(e,t={}){if(!this.db)throw new Error("Firestore not initialized. Call initFirestore() first.");const n=this.contentTypes[e];if(!n)throw new Error(`Unknown content type: ${e}`);this.currentCollection=n.collection;try{let i;if(this.showLoadingState(),this.options.enableCache&&this.cacheManager&&!this.options.bypassCache&&!t.bypassCache){const a=FirebaseCacheManager.generateKey(n.collection,{mythology:t.mythology,limit:t.limit});i=await this.cacheManager.get(a,async()=>await this.executeQuery(n.collection,t),{ttl:t.cacheTTL||36e5,tags:[e,n.collection]})}else i=await this.executeQuery(n.collection,t);return this.currentData=i,this.filteredData=i,this.applyFilters(),this.filteredData}catch(e){throw this.showErrorState(e.message),e}}async executeQuery(e,t={}){let n=this.db.collection(e);t.mythology&&"all"!==t.mythology&&(n=n.where("mythology","==",t.mythology)),t.limit&&(n=n.limit(t.limit));const i=await n.get(),a=[];return i.forEach(e=>{a.push({id:e.id,...e.data()})}),a}renderContent(e,t){const n=document.getElementById(e);if(!n)return;const i=this.contentTypes[t];if(!i)return;if(n.innerHTML="",0===this.filteredData.length)return void this.showEmptyState(n);const a=document.createElement("div");a.className="content-grid",this.filteredData.forEach((e,t)=>{const n=this.createContentCard(e,i);n.style.animationDelay=.1*t+"s",a.appendChild(n)});const o=this.createAddCard(t,i);o&&a.appendChild(o),n.appendChild(a)}createContentCard(e,t){const n=document.createElement("div");n.className="content-card",n.setAttribute("data-id",e.id);const i=document.createElement("div");i.className="card-header";const a=document.createElement("h3");a.className="card-title",a.textContent=e.name||e.title||"Untitled";const o=document.createElement("span");o.className="card-badge",o.textContent=e[t.badge]||"Unknown",i.appendChild(a),i.appendChild(o);const s=document.createElement("div");s.className="card-body";const r=document.createElement("p");r.textContent=this.truncateText(e.description||e.summary||"No description available.",200),s.appendChild(r);const l=document.createElement("div");return l.className="card-footer",this.addCardTags(l,e,t),n.appendChild(i),n.appendChild(s),n.appendChild(l),n.addEventListener("click",()=>{this.onCardClick(e,t)}),n}addCardTags(e,t,n){for(["domain","type","category","realm","purpose"].forEach(n=>{if(t[n]){const i=t[n];Array.isArray(i)?i.slice(0,3).forEach(t=>{e.appendChild(this.createTag(t))}):e.appendChild(this.createTag(i))}});e.children.length>5;)e.removeChild(e.lastChild)}createTag(e){const t=document.createElement("span");return t.className="card-tag",t.textContent=e,t}createAddCard(e,t){if(!firebase.auth().currentUser)return null;const n=document.createElement("div");return n.className="content-card add-content-card",n.setAttribute("data-type","add-new"),n.innerHTML=`\n      <div class="add-card-content">\n        <div class="add-card-icon">\n          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <line x1="12" y1="5" x2="12" y2="19"></line>\n            <line x1="5" y1="12" x2="19" y2="12"></line>\n          </svg>\n        </div>\n        <div class="add-card-title">Add New ${t.title.slice(0,-1)}</div>\n        <div class="add-card-description">Submit your own ${e.slice(0,-1)} to the collection</div>\n      </div>\n    `,n.addEventListener("click",()=>{this.onAddCardClick(e,t)}),n}onAddCardClick(e,t){const n=new CustomEvent("addContentClicked",{detail:{contentType:e,config:t}});if(document.dispatchEvent(n),window.editableSystem){const n=document.createElement("div");window.editableSystem.openSubmissionModal(n,{contentType:e.slice(0,-1),collection:t.collection})}}onCardClick(e,t){const n=new CustomEvent("contentItemClicked",{detail:{item:e,config:t}});if(document.dispatchEvent(n),"undefined"!=typeof themeManager&&e.mythology&&themeManager.setThemeFromContent(e),e.detailUrl)window.location.href=e.detailUrl;else if(e.slug&&e.mythology){const n=t.collection,i=`/mythos/${e.mythology}/${n}/${e.slug}.html`;window.location.href=i}else if(e.id){const n=t.collection,i=`/mythos/${e.mythology||"greek"}/${n}/${e.id}.html`;window.location.href=i}}applyFilters(){let e=[...this.currentData];if(this.filters.search){const t=this.filters.search.toLowerCase();e=e.filter(e=>e.name&&e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.summary&&e.summary.toLowerCase().includes(t))}this.filters.mythology&&"all"!==this.filters.mythology&&(e=e.filter(e=>e.mythology===this.filters.mythology)),e.sort((e,t)=>{const n=this.filters.sortBy||"name",i=e[n]||"",a=t[n]||"";return"string"==typeof i?i.localeCompare(a):i-a}),this.filteredData=e}setSearchFilter(e){this.filters.search=e,this.applyFilters()}setMythologyFilter(e){this.filters.mythology=e,this.applyFilters()}setSortOrder(e){this.filters.sortBy=e,this.applyFilters()}showLoadingState(){document.querySelectorAll("[data-content-container]").forEach(e=>{e.innerHTML='\n        <div class="loading-container">\n          <div class="loading-spinner"></div>\n          <div class="loading-text">Loading content...</div>\n        </div>\n      '})}showErrorState(e){document.querySelectorAll("[data-content-container]").forEach(t=>{t.innerHTML=`\n        <div class="error-container">\n          <div class="error-title">Error Loading Content</div>\n          <div class="error-message">${this.escapeHtml(e)}</div>\n          <button class="glass-btn glass-btn-primary mt-3" onclick="location.reload()">\n            Retry\n          </button>\n        </div>\n      `})}showEmptyState(e){e.innerHTML='\n      <div class="empty-state">\n        <div class="empty-state-icon">ðŸ“œ</div>\n        <div class="empty-state-title">No Content Found</div>\n        <div class="empty-state-message">\n          Try adjusting your filters or search terms.\n        </div>\n      </div>\n    '}showSkeletonCards(e,t=6){e.innerHTML="";const n=document.createElement("div");n.className="content-grid";for(let e=0;e<t;e++){const e=document.createElement("div");e.className="content-card",e.innerHTML='\n        <div class="card-header">\n          <div class="skeleton skeleton-title"></div>\n        </div>\n        <div class="card-body">\n          <div class="skeleton skeleton-text"></div>\n          <div class="skeleton skeleton-text"></div>\n          <div class="skeleton skeleton-text"></div>\n        </div>\n      ',n.appendChild(e)}e.appendChild(n)}setupFilters(e={}){if(e.searchInputId){const t=document.getElementById(e.searchInputId);t&&t.addEventListener("input",t=>{this.setSearchFilter(t.target.value),this.renderContent(e.containerId,e.contentType)})}if(e.mythologySelectId){const t=document.getElementById(e.mythologySelectId);t&&t.addEventListener("change",t=>{this.setMythologyFilter(t.target.value),this.renderContent(e.containerId,e.contentType)})}if(e.sortSelectId){const t=document.getElementById(e.sortSelectId);t&&t.addEventListener("change",t=>{this.setSortOrder(t.target.value),this.renderContent(e.containerId,e.contentType)})}}createFilterControls(e){const t=document.createElement("div");t.className="controls-bar";const n=document.createElement("div");n.className="filter-group",n.innerHTML=`\n      <label class="filter-label" for="search-input">Search:</label>\n      <input\n        type="text"\n        id="search-input"\n        class="glass-input"\n        placeholder="Search ${this.contentTypes[e]?.title||"content"}..."\n      />\n    `;const i=document.createElement("div");i.className="filter-group",i.innerHTML='\n      <label class="filter-label" for="mythology-select">Mythology:</label>\n      <select id="mythology-select" class="glass-select">\n        <option value="all">All Mythologies</option>\n        <option value="greek">Greek</option>\n        <option value="egyptian">Egyptian</option>\n        <option value="norse">Norse</option>\n        <option value="hindu">Hindu</option>\n        <option value="buddhist">Buddhist</option>\n        <option value="christian">Christian</option>\n        <option value="islamic">Islamic</option>\n        <option value="celtic">Celtic</option>\n      </select>\n    ';const a=document.createElement("div");return a.className="filter-group",a.innerHTML='\n      <label class="filter-label" for="sort-select">Sort By:</label>\n      <select id="sort-select" class="glass-select">\n        <option value="name">Name</option>\n        <option value="mythology">Mythology</option>\n      </select>\n    ',t.appendChild(n),t.appendChild(i),t.appendChild(a),t}truncateText(e,t){return!e||e.length<=t?e:e.substring(0,t)+"..."}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}getData(){return this.filteredData}getCount(){return{total:this.currentData.length,filtered:this.filteredData.length}}clear(){this.currentData=[],this.filteredData=[],this.filters={search:"",mythology:"all",sortBy:"name"}}setBypassCache(e=!0){this.options.bypassCache=e}getCacheStats(){return this.cacheManager?this.cacheManager.getStats():null}getCacheEntries(){return this.cacheManager?this.cacheManager.getCacheEntries():null}clearCache(e=null){this.cacheManager&&(e?this.cacheManager.invalidateByTag(e):this.cacheManager.invalidateAll())}async getVersionInfo(){return this.versionTracker?await this.versionTracker.getStats():null}async checkVersion(){return!!this.versionTracker&&await this.versionTracker.checkForUpdates()}async incrementVersion(e={}){if(!this.versionTracker)throw new Error("Version tracker not available");return await this.versionTracker.incrementVersion(e)}}"undefined"!=typeof module&&module.exports&&(module.exports=FirebaseContentLoader),"undefined"!=typeof window&&(window.FirebaseContentLoader=FirebaseContentLoader);export{FirebaseContentLoader};