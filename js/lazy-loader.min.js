class ProgressiveLazyLoader{constructor(){this.loadStartTime=performance.now(),this.phases={critical:!1,auth:!1,structure:!1,data:!1,enhanced:!1},this.metrics={},this.observers=new Map}async start(){this.markPhaseComplete("critical"),await this.loadAuthUI(),await this.loadStructure(),await this.loadData(),this.loadEnhancements(),this.reportMetrics()}async loadAuthUI(){const e=performance.now();try{if("undefined"!=typeof firebase&&firebase.auth){const e=firebase.auth().onAuthStateChanged(t=>{this.updateUserUI(t),e()},e=>{})}this.markPhaseComplete("auth",e)}catch(t){this.markPhaseComplete("auth",e)}}async loadStructure(){const e=performance.now();try{const t=document.getElementById("main-content");if(!t)return;t.innerHTML=this.getSkeletonHTML(),t.classList.add("content-loading"),this.markPhaseComplete("structure",e)}catch(t){this.markPhaseComplete("structure",e)}}async loadData(){const e=performance.now();try{await this.waitForApp();const t=new CustomEvent("lazy-load-data");document.dispatchEvent(t),await this.replaceSkeletonWithContent(),this.markPhaseComplete("data",e)}catch(t){this.markPhaseComplete("data",e)}}loadEnhancements(){const e=performance.now();setTimeout(()=>{this.loadShaders()},1e3),this.setupImageLazyLoading(),setTimeout(()=>{this.loadAnalytics()},2e3),setTimeout(()=>{this.loadNonEssentialScripts()},1500),this.markPhaseComplete("enhanced",e)}async loadShaders(){try{if("undefined"!=typeof ShaderThemeManager){window.EyesOfAzrael=window.EyesOfAzrael||{},window.EyesOfAzrael.shaders=new ShaderThemeManager({quality:"auto",targetFPS:60});const e=(new Date).getHours(),t=e>=6&&e<18?"day":"night";window.EyesOfAzrael.shaders.activate(t)}}catch(e){}}setupImageLazyLoading(){const e=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const s=t.target;s.dataset.src&&(s.src=s.dataset.src,s.removeAttribute("data-src")),s.dataset.srcset&&(s.srcset=s.dataset.srcset,s.removeAttribute("data-srcset")),s.classList.add("lazy-loaded"),e.unobserve(s)}})},{rootMargin:"50px"});document.querySelectorAll("img[data-src]").forEach(t=>e.observe(t)),this.observers.set("images",e)}loadAnalytics(){localStorage.getItem("analytics-consent")}loadNonEssentialScripts(){[].forEach(e=>{const t=document.createElement("script");t.src=e,t.async=!0,t.defer=!0,document.body.appendChild(t)})}getSkeletonHTML(){return`\n            <div class="skeleton-mythology-grid">\n                \x3c!-- Skeleton Hero --\x3e\n                <div class="skeleton-hero">\n                    <div class="skeleton skeleton-hero-icon"></div>\n                    <div class="skeleton skeleton-hero-title"></div>\n                    <div class="skeleton skeleton-hero-subtitle"></div>\n                    <div class="skeleton skeleton-hero-description"></div>\n                    <div class="skeleton skeleton-hero-description-2"></div>\n                    <div class="skeleton-hero-actions">\n                        <div class="skeleton skeleton-btn"></div>\n                        <div class="skeleton skeleton-btn"></div>\n                    </div>\n                </div>\n\n                \x3c!-- Skeleton Section Title --\x3e\n                <div class="skeleton skeleton-section-title"></div>\n\n                \x3c!-- Skeleton Grid --\x3e\n                <div class="skeleton-grid">\n                    ${this.getSkeletonCards(12)}\n                </div>\n\n                \x3c!-- Skeleton Features --\x3e\n                <div style="margin-top: 4rem;">\n                    <div class="skeleton skeleton-section-title"></div>\n                    <div class="skeleton-features-grid">\n                        ${this.getSkeletonFeatureCards(4)}\n                    </div>\n                </div>\n            </div>\n        `}getSkeletonCards(e=12){return Array.from({length:e},(e,t)=>`\n            <div class="skeleton-mythology-card" style="--item-index: ${t}">\n                <div class="skeleton skeleton-card-icon"></div>\n                <div class="skeleton skeleton-card-title"></div>\n                <div class="skeleton skeleton-card-description"></div>\n                <div class="skeleton skeleton-card-description-2"></div>\n                <div class="skeleton skeleton-card-arrow"></div>\n            </div>\n        `).join("")}getSkeletonFeatureCards(e=4){return Array.from({length:e},(e,t)=>`\n            <div class="skeleton-feature-card" style="--item-index: ${t}">\n                <div class="skeleton skeleton-feature-icon"></div>\n                <div class="skeleton skeleton-feature-title"></div>\n                <div class="skeleton skeleton-feature-description"></div>\n                <div class="skeleton skeleton-feature-description-2"></div>\n            </div>\n        `).join("")}async replaceSkeletonWithContent(){const e=document.getElementById("main-content");e&&(e.classList.add("content-loaded"),await new Promise(t=>{const s=setInterval(()=>{e.querySelector(".home-view")&&(clearInterval(s),t())},50);setTimeout(()=>{clearInterval(s),t()},3e3)}))}updateUserUI(e){const t=document.getElementById("userInfo"),s=document.getElementById("userName"),a=document.getElementById("userAvatar");t&&(e?(t.style.display="flex",s&&(s.textContent=e.displayName||e.email),a&&e.photoURL&&(a.src=e.photoURL)):t.style.display="none")}async waitForApp(){return new Promise(e=>{window.EyesOfAzrael&&window.EyesOfAzrael.navigation?e():(document.addEventListener("app-initialized",()=>e(),{once:!0}),setTimeout(()=>e(),5e3))})}markPhaseComplete(e,t=null){if(this.phases[e]=!0,t){const s=performance.now()-t;this.metrics[e]={duration:Math.round(s),timestamp:Math.round(performance.now()-this.loadStartTime)}}}reportMetrics(){const e=performance.now()-this.loadStartTime;document.dispatchEvent(new CustomEvent("lazy-load-complete",{detail:{totalTime:Math.round(e),phases:this.phases,metrics:this.metrics}}))}destroy(){this.observers.forEach(e=>e.disconnect()),this.observers.clear()}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.lazyLoader=new ProgressiveLazyLoader,window.lazyLoader.start()}):(window.lazyLoader=new ProgressiveLazyLoader,window.lazyLoader.start()),window.debugLazyLoader=()=>window.lazyLoader?{phases:window.lazyLoader.phases,metrics:window.lazyLoader.metrics,observers:window.lazyLoader.observers.size}:null;