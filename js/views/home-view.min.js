class HomeView{constructor(n){this.db=n,this.cache=window.cacheManager||new FirebaseCacheManager({db:n}),this.mythologies=[],this.loadingTimeout=null,this.loadingStartTime=null,this.minLoadingTime=300,this.maxLoadingTime=5e3}async render(n){this.loadingStartTime=Date.now(),n.innerHTML=`\n            <div class="loading-container" role="status" aria-live="polite" aria-label="Loading mythologies">\n                <div class="spinner-container" aria-hidden="true">\n                    <div class="spinner-ring"></div>\n                    <div class="spinner-ring"></div>\n                    <div class="spinner-ring"></div>\n                </div>\n                <p class="loading-message">Loading mythologies...</p>\n                <p class="loading-submessage">Fetching from Firebase...</p>\n\n                \x3c!-- Skeleton cards for better perceived performance --\x3e\n                <div class="skeleton-grid" style="\n                    display: grid;\n                    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n                    gap: 1.5rem;\n                    margin-top: 2rem;\n                    max-width: 1200px;\n                    width: 100%;\n                    padding: 0 1rem;\n                ">\n                    ${Array(6).fill(0).map(()=>'\n                        <div class="skeleton-card" style="\n                            height: 200px;\n                            background: linear-gradient(90deg,\n                                rgba(var(--color-bg-card-rgb, 30, 30, 40), 0.5) 0%,\n                                rgba(var(--color-bg-card-rgb, 30, 30, 40), 0.8) 50%,\n                                rgba(var(--color-bg-card-rgb, 30, 30, 40), 0.5) 100%);\n                            background-size: 200% 100%;\n                            animation: skeleton-loading 1.5s ease-in-out infinite;\n                            border-radius: 16px;\n                            border: 1px solid rgba(var(--color-border-primary-rgb, 139, 127, 255), 0.3);\n                        "></div>\n                    ').join("")}\n                </div>\n\n                <style>\n                    @keyframes skeleton-loading {\n                        0% { background-position: 200% 0; }\n                        100% { background-position: -200% 0; }\n                    }\n\n                    .loading-container {\n                        display: flex;\n                        flex-direction: column;\n                        align-items: center;\n                        justify-content: center;\n                        min-height: 400px;\n                        padding: 2rem;\n                    }\n\n                    .loading-message {\n                        font-size: 1.2rem;\n                        margin-top: 1rem;\n                        color: var(--color-text-primary);\n                    }\n\n                    .loading-submessage {\n                        font-size: 0.9rem;\n                        color: var(--color-text-secondary);\n                        margin-top: 0.5rem;\n                        opacity: 0.7;\n                    }\n                </style>\n            </div>\n        `,this.loadingTimeout=setTimeout(()=>{this.handleLoadingTimeout(n)},this.maxLoadingTime);try{await this.loadMythologies(),clearTimeout(this.loadingTimeout);const e=Date.now()-this.loadingStartTime;window.AnalyticsManager&&window.AnalyticsManager.trackTiming("render","home_view",e);const o=Date.now()-this.loadingStartTime;o<this.minLoadingTime&&await this.delay(this.minLoadingTime-o),await this.transitionToContent(n)}catch(e){clearTimeout(this.loadingTimeout),this.showError(n,e)}}async transitionToContent(n){performance.now();const e=n.querySelector(".loading-container");e&&(e.classList.add("loading-fade-out"),await this.delay(300));performance.now();n.innerHTML=this.getHomeHTML(),performance.now();const o=n.querySelector(".home-view");o&&o.classList.add("loading-fade-in");performance.now();this.activateShaderBackground(),performance.now();performance.now();this.attachEventListeners(),performance.now(),this.saveMythologiesCache(this.mythologies),performance.now(),performance.now(),this.loadingStartTime}handleLoadingTimeout(n){if(this.mythologies.length>0)return void this.transitionToContent(n);n.innerHTML='\n            <div class="loading-container">\n                <div class="timeout-warning" style="\n                    text-align: center;\n                    padding: 2rem;\n                    background: rgba(255, 193, 7, 0.1);\n                    border: 2px solid rgba(255, 193, 7, 0.4);\n                    border-radius: 16px;\n                    margin-bottom: 2rem;\n                    max-width: 600px;\n                    margin-left: auto;\n                    margin-right: auto;\n                ">\n                    <div class="warning-icon" style="font-size: 4rem; margin-bottom: 1rem;">‚è±Ô∏è</div>\n                    <h2 style="color: #ffc107; margin-bottom: 1rem;">Loading is taking longer than expected</h2>\n                    <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 1.5rem;">\n                        This could be due to a slow connection or Firebase issues.\n                    </p>\n                    <div class="timeout-actions" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">\n                        <button class="btn-primary" onclick="location.reload()">\n                            üîÑ Retry Loading\n                        </button>\n                        <button class="btn-secondary" id="useCachedDataBtn">\n                            üíæ Use Cached Data\n                        </button>\n                    </div>\n                </div>\n                <div class="spinner-container" aria-hidden="true" style="--spinner-size: 60px;">\n                    <div class="spinner-ring"></div>\n                    <div class="spinner-ring"></div>\n                    <div class="spinner-ring"></div>\n                </div>\n                <p class="loading-message">Still trying to connect...</p>\n            </div>\n        ';const e=n.querySelector("#useCachedDataBtn");e&&e.addEventListener("click",()=>{this.useFallbackData(),this.transitionToContent(n)})}activateShaderBackground(){if(window.EyesOfAzrael&&window.EyesOfAzrael.shaders){const n=window.EyesOfAzrael.shaders,e=(new Date).getHours();let o;o=e>=5&&e<12?"day":e>=12&&e<17?"light":e>=17&&e<20?"fire":"night",n.activate(o),setTimeout(()=>{const e=n.getStatus();e.enabled&&e.theme||n.activate(o)},500)}}async loadMythologies(){performance.now();try{performance.now();const n=this.loadFromCache();performance.now(),n&&(this.mythologies=n);performance.now();const e=await this.cache.getList("mythologies",{},{ttl:this.cache.defaultTTL.mythologies,orderBy:"order asc",limit:50});performance.now(),e&&e.length>0?(this.mythologies=e,performance.now(),this.loadCountsInBackground()):this.useFallbackData()}catch(n){performance.now(),this.useFallbackData()}}async loadCountsInBackground(){try{const n=await this.cache.getMetadata("mythology_counts");n&&n.length>0&&(this.mythologies.forEach(e=>{const o=n.find(n=>n.mythology===e.id);o&&(e.counts=o.counts||{deities:0,heroes:0,creatures:0,total:0})}),this.saveMythologiesCache(this.mythologies))}catch(n){}}useFallbackData(){const n=this.loadFromCache();n&&n.length>0?this.mythologies=n:this.mythologies=this.getFallbackMythologies()}saveMythologiesCache(n){if(n&&0!==n.length)try{localStorage.setItem("mythologies_cache",JSON.stringify({data:n,timestamp:Date.now()}))}catch(n){}}loadFromCache(){try{const n=localStorage.getItem("mythologies_cache");if(!n)return null;const e=JSON.parse(n),o=Date.now()-e.timestamp;return o<36e5&&e.data&&e.data.length>0?(Math.round(o/1e3),e.data):null}catch(n){return null}}getFallbackMythologies(){return[{id:"greek",name:"Greek Mythology",icon:"üèõÔ∏è",description:"Gods of Olympus and heroes of ancient Greece",color:"var(--color-primary, #8b7fff)",order:1},{id:"norse",name:"Norse Mythology",icon:"‚öîÔ∏è",description:"Warriors of Asgard and the Nine Realms",color:"#4a9eff",order:2},{id:"egyptian",name:"Egyptian Mythology",icon:"ìÇÄ",description:"Keepers of the Nile and guardians of Ma'at",color:"#ffd93d",order:3},{id:"hindu",name:"Hindu Mythology",icon:"üïâÔ∏è",description:"The Trimurti and cosmic cycles of creation",color:"#ff7eb6",order:4},{id:"buddhist",name:"Buddhist Tradition",icon:"‚ò∏Ô∏è",description:"Bodhisattvas and the path to enlightenment",color:"#51cf66",order:5},{id:"chinese",name:"Chinese Mythology",icon:"üêâ",description:"Dragons, immortals, and celestial bureaucracy",color:"#f85a8f",order:6},{id:"japanese",name:"Japanese Mythology",icon:"‚õ©Ô∏è",description:"Kami spirits and the creation of Japan",color:"#fb9f7f",order:7},{id:"celtic",name:"Celtic Mythology",icon:"üçÄ",description:"Druids, faeries, and the Tuatha D√© Danann",color:"#7fd9d3",order:8},{id:"babylonian",name:"Babylonian Mythology",icon:"üèõÔ∏è",description:"The Enuma Elish and gods of Mesopotamia",color:"#b965e6",order:9},{id:"persian",name:"Persian Mythology",icon:"üî•",description:"Zoroastrian wisdom and the eternal flame",color:"#7fb0f9",order:10},{id:"christian",name:"Christian Tradition",icon:"‚úü",description:"Angels, saints, and biblical narratives",color:"#a8edea",order:11},{id:"islamic",name:"Islamic Tradition",icon:"‚ò™Ô∏è",description:"Prophets, angels, and divine revelation",color:"#fed6e3",order:12}]}getHomeHTML(){return`\n            <div class="home-view">\n                \x3c!-- Hero Section --\x3e\n                <section class="hero-section">\n                    <div class="hero-content">\n                        <h1 class="hero-title">\n                            <span class="hero-icon">üëÅÔ∏è</span>\n                            Eyes of Azrael\n                        </h1>\n                        <p class="hero-subtitle">\n                            Explore World Mythologies\n                        </p>\n                        <p class="hero-description">\n                            Journey through 6000+ years of human mythology, from ancient Sumer to modern traditions.\n                            Discover deities, heroes, creatures, and sacred texts from cultures across the globe.\n                        </p>\n                        <div class="hero-actions">\n                            <a href="#/search" class="btn-primary">\n                                üîç Search Database\n                            </a>\n                            <a href="#/compare" class="btn-secondary">\n                                ‚öñÔ∏è Compare Traditions\n                            </a>\n                        </div>\n                    </div>\n                </section>\n\n                \x3c!-- Mythology Cards Grid --\x3e\n                <section class="mythology-grid-section">\n                    <h2 class="section-title">Explore Mythologies</h2>\n                    <div class="mythology-grid">\n                        ${this.mythologies.map(n=>this.getMythologyCardHTML(n)).join("")}\n                    </div>\n                </section>\n\n                \x3c!-- Features Section --\x3e\n                <section class="features-section">\n                    <h2 class="section-title">Database Features</h2>\n                    <div class="features-grid">\n                        <div class="feature-card">\n                            <div class="feature-icon">üìö</div>\n                            <h3>Comprehensive Database</h3>\n                            <p>Thousands of entities across 12+ mythological traditions</p>\n                        </div>\n                        <div class="feature-card">\n                            <div class="feature-icon">üîó</div>\n                            <h3>Cross-Cultural Links</h3>\n                            <p>Discover connections between different traditions</p>\n                        </div>\n                        <div class="feature-card">\n                            <div class="feature-icon">üåø</div>\n                            <h3>Sacred Herbalism</h3>\n                            <p>Explore plants, rituals, and traditional practices</p>\n                        </div>\n                        <div class="feature-card">\n                            <div class="feature-icon">‚ú®</div>\n                            <h3>Magic Systems</h3>\n                            <p>Study mystical practices and esoteric traditions</p>\n                        </div>\n                    </div>\n                </section>\n            </div>\n        `}getMythologyCardHTML(n){const e=n.color||"var(--color-primary, #8b7fff)";return`\n            <a href="#/mythology/${n.id}" class="mythology-card" data-mythology="${n.id}">\n                <div class="mythology-card-icon" style="color: ${e};">\n                    ${n.icon||"üìñ"}\n                </div>\n                <h3 class="mythology-card-title">${n.name}</h3>\n                <p class="mythology-card-description">${n.description}</p>\n                <div class="mythology-card-arrow" style="color: ${e};">‚Üí</div>\n            </a>\n        `}showError(n,e){const o=e.message?.includes("network")||e.message?.includes("fetch"),t=e.message?.includes("Firebase")||e.message?.includes("firestore");n.innerHTML=`\n            <div class="error-container" style="\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                min-height: 400px;\n                padding: 3rem;\n                text-align: center;\n            ">\n                <div class="error-icon" style="font-size: 4rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>\n\n                <h2 style="color: var(--color-text-primary); margin-bottom: 1rem; font-size: 2rem;">\n                    Failed to Load Mythologies\n                </h2>\n\n                <p style="color: var(--color-text-secondary); margin-bottom: 0.5rem; font-size: 1.1rem;">\n                    ${e.message||"Unknown error occurred"}\n                </p>\n\n                <p style="color: var(--color-text-secondary); margin-bottom: 2rem; font-size: 0.9rem; max-width: 500px;">\n                    ${o?"Please check your internet connection and try again.":t?"There may be an issue connecting to Firebase. Try reloading.":"This could be due to network issues or Firebase connectivity problems."}\n                </p>\n\n                \x3c!-- Error details for debugging --\x3e\n                <details style="margin-bottom: 2rem; max-width: 600px; width: 100%;">\n                    <summary style="\n                        cursor: pointer;\n                        color: var(--color-text-secondary);\n                        font-size: 0.9rem;\n                        padding: 0.5rem;\n                        border-radius: 8px;\n                        background: rgba(255, 193, 7, 0.1);\n                    ">\n                        üîç View Error Details\n                    </summary>\n                    <pre style="\n                        text-align: left;\n                        background: rgba(0, 0, 0, 0.3);\n                        padding: 1rem;\n                        border-radius: 8px;\n                        margin-top: 1rem;\n                        overflow-x: auto;\n                        font-size: 0.85rem;\n                        color: var(--color-text-secondary);\n                    ">${e.stack||e.message||"No additional details available"}</pre>\n                </details>\n\n                \x3c!-- Action buttons --\x3e\n                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">\n                    <button onclick="location.reload()" style="\n                        padding: 0.75rem 1.5rem;\n                        background: var(--color-primary, #8b7fff);\n                        color: white;\n                        border: none;\n                        border-radius: 8px;\n                        cursor: pointer;\n                        font-size: 1rem;\n                        transition: all 0.3s ease;\n                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(139, 127, 255, 0.4)'"\n                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">\n                        üîÑ Retry Loading\n                    </button>\n\n                    <button id="useFallbackBtn" style="\n                        padding: 0.75rem 1.5rem;\n                        background: rgba(var(--color-bg-card-rgb, 30, 30, 40), 1);\n                        color: var(--color-text-primary);\n                        border: 1px solid var(--color-border-primary, #8b7fff);\n                        border-radius: 8px;\n                        cursor: pointer;\n                        font-size: 1rem;\n                        transition: all 0.3s ease;\n                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='var(--color-accent, #00d4ff)'"\n                       onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='var(--color-border-primary, #8b7fff)'">\n                        üíæ Use Cached Data\n                    </button>\n                </div>\n\n                \x3c!-- Help text --\x3e\n                <p style="\n                    margin-top: 2rem;\n                    color: var(--color-text-secondary);\n                    font-size: 0.85rem;\n                    opacity: 0.7;\n                ">\n                    Need help? Check the browser console for more details (F12).\n                </p>\n            </div>\n        `;const a=n.querySelector("#useFallbackBtn");a&&a.addEventListener("click",()=>{this.useFallbackData(),this.transitionToContent(n)})}delay(n){return new Promise(e=>setTimeout(e,n))}attachEventListeners(){document.querySelectorAll(".mythology-card").forEach(n=>{n.addEventListener("mouseenter",()=>{})})}}export{HomeView};"undefined"!=typeof window&&(window.HomeView=HomeView);