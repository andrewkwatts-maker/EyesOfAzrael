!function(){"use strict";const i={deity:{icon:"üëë",label:"Deity",plural:"Deities",collection:"deities",primaryFields:["domains","symbols","element"]},hero:{icon:"ü¶∏",label:"Hero",plural:"Heroes",collection:"heroes",primaryFields:["feats","weapons","legacy"]},creature:{icon:"üêâ",label:"Creature",plural:"Creatures",collection:"creatures",primaryFields:["abilities","habitat","type"]},cosmology:{icon:"üåå",label:"Cosmology",plural:"Cosmology",collection:"cosmology",primaryFields:["realm","structure","inhabitants"]},ritual:{icon:"üïØÔ∏è",label:"Ritual",plural:"Rituals",collection:"rituals",primaryFields:["purpose","participants","timing"]},herb:{icon:"üåø",label:"Herb",plural:"Herbs",collection:"herbs",primaryFields:["uses","properties","preparation"]},concept:{icon:"üí≠",label:"Concept",plural:"Concepts",collection:"concepts",primaryFields:["philosophy","principles","applications"]},symbol:{icon:"‚ö°",label:"Symbol",plural:"Symbols",collection:"symbols",primaryFields:["meaning","usage","associations"]},text:{icon:"üìú",label:"Text",plural:"Texts",collection:"texts",primaryFields:["author","period","significance"]},item:{icon:"‚öîÔ∏è",label:"Item",plural:"Items",collection:"items",primaryFields:["type","powers","wielder"]},place:{icon:"üèõÔ∏è",label:"Place",plural:"Places",collection:"places",primaryFields:["location","significance","inhabitants"]},magic:{icon:"‚ú®",label:"Magic",plural:"Magic",collection:"magic",primaryFields:["type","effects","practitioners"]}};window.UniversalEntityRenderer=class{constructor(t={}){this.db=t.db||window.firebase&&window.firebase.firestore(),this.container=t.container,this.entityType=t.entityType||"deity",this.displayMode=t.displayMode||"grid",this.theme=t.theme||"auto",this.entities=[],this.config=i[this.entityType]||i.deity,this.sortField=t.sortField||"name",this.sortDirection=t.sortDirection||"asc",this.filters=t.filters||{},this.pageSize=t.pageSize||50,this.currentPage=1,this.onEntityClick=t.onEntityClick||null,this.onRenderComplete=t.onRenderComplete||null}async render(){if(this.container){this.showLoading();try{0===this.entities.length&&await this.loadEntities();const i=this.processEntities(this.entities);switch(this.displayMode){case"grid":default:this.renderGrid(i);break;case"list":this.renderList(i);break;case"table":this.renderTable(i);break;case"panel":this.renderPanel(i);break;case"inline":this.renderInline(i)}this.attachEventListeners(),this.onRenderComplete&&this.onRenderComplete(i)}catch(i){this.showError(i)}}}async loadEntities(){if(!this.db)throw new Error("Firebase Firestore not initialized");let i=this.db.collection(this.config.collection);Object.entries(this.filters).forEach(([t,e])=>{null!=e&&(i=Array.isArray(e)?i.where(t,"array-contains-any",e):i.where(t,"==",e))});const t=await i.get();return this.entities=t.docs.map(i=>({id:i.id,...i.data()})),this.entities}processEntities(i){let t=[...i];t.sort((i,t)=>{const e=this.getNestedValue(i,this.sortField),n=this.getNestedValue(t,this.sortField);if(e===n)return 0;const s=e<n?-1:1;return"asc"===this.sortDirection?s:-s});const e=(this.currentPage-1)*this.pageSize,n=e+this.pageSize;return t=t.slice(e,n),t}renderGrid(i){const t="string"==typeof this.container?document.querySelector(this.container):this.container;if(!t)return;const e=`\n                <div class="universal-grid" data-entity-type="${this.entityType}">\n                    ${i.map(i=>this.renderGridCard(i)).join("")}\n                </div>\n            `;t.innerHTML=e,t.classList.add("universal-renderer-container")}renderGridCard(i){const t=(i.colors||{}).primary||"#667eea",e=i.mythology||i.primaryMythology||"unknown";return`\n                <div class="universal-grid-card"\n                     data-entity-id="${i.id}"\n                     data-entity-type="${this.entityType}"\n                     style="--entity-color: ${t}">\n\n                    <div class="grid-card-header">\n                        ${i.icon?`<div class="grid-card-icon">${i.icon}</div>`:`<div class="grid-card-icon">${this.config.icon}</div>`}\n                    </div>\n\n                    <div class="grid-card-body">\n                        <h3 class="grid-card-title">\n                            <a href="${this.getEntityUrl(i)}">${this.escapeHtml(i.name||i.title)}</a>\n                        </h3>\n\n                        <div class="grid-card-meta">\n                            <span class="entity-type-badge">${this.config.label}</span>\n                            <span class="mythology-badge">${this.capitalize(e)}</span>\n                        </div>\n\n                        ${i.shortDescription?`\n                            <p class="grid-card-description">${this.escapeHtml(i.shortDescription)}</p>\n                        `:""}\n\n                        ${this.renderGridCardFields(i)}\n                    </div>\n\n                    <div class="grid-card-footer">\n                        <a href="${this.getEntityUrl(i)}" class="btn-view-details">View Details</a>\n                    </div>\n                </div>\n            `}renderGridCardFields(i){const t=this.config.primaryFields||[];let e='<div class="grid-card-fields">';return t.forEach(t=>{const n=this.getNestedValue(i,t);if(n){const i=Array.isArray(n)?n.slice(0,3).join(", "):n;e+=`\n                        <div class="field-item">\n                            <span class="field-label">${this.capitalize(t)}:</span>\n                            <span class="field-value">${this.escapeHtml(i)}</span>\n                        </div>\n                    `}}),e+="</div>",e}renderList(i){const t="string"==typeof this.container?document.querySelector(this.container):this.container;if(!t)return;const e=`\n                <div class="universal-list" data-entity-type="${this.entityType}">\n                    ${i.map(i=>this.renderListItem(i)).join("")}\n                </div>\n            `;t.innerHTML=e,t.classList.add("universal-renderer-container")}renderListItem(i){const t=i.mythology||i.primaryMythology||"unknown";return`\n                <div class="universal-list-item"\n                     data-entity-id="${i.id}"\n                     data-entity-type="${this.entityType}">\n\n                    <div class="list-item-icon">\n                        ${i.icon||this.config.icon}\n                    </div>\n\n                    <div class="list-item-content">\n                        <div class="list-item-header">\n                            <h3 class="list-item-title">\n                                <a href="${this.getEntityUrl(i)}">${this.escapeHtml(i.name||i.title)}</a>\n                            </h3>\n                            <div class="list-item-badges">\n                                <span class="entity-type-badge">${this.config.label}</span>\n                                <span class="mythology-badge">${this.capitalize(t)}</span>\n                            </div>\n                        </div>\n\n                        ${i.shortDescription?`\n                            <p class="list-item-description">${this.escapeHtml(i.shortDescription)}</p>\n                        `:""}\n\n                        ${this.renderListItemFields(i)}\n                    </div>\n\n                    <div class="list-item-actions">\n                        <a href="${this.getEntityUrl(i)}" class="btn-view-details">View</a>\n                    </div>\n                </div>\n            `}renderListItemFields(i){const t=this.config.primaryFields||[];let e='<div class="list-item-fields">';return t.forEach(t=>{const n=this.getNestedValue(i,t);if(n){const i=Array.isArray(n)?n.join(", "):n;e+=`<span class="field-tag"><strong>${this.capitalize(t)}:</strong> ${this.escapeHtml(i)}</span>`}}),e+="</div>",e}renderTable(i){const t="string"==typeof this.container?document.querySelector(this.container):this.container;if(!t)return;const e=this.getTableColumns(),n=`\n                <div class="universal-table-container">\n                    <table class="universal-table" data-entity-type="${this.entityType}">\n                        <thead>\n                            <tr>\n                                ${e.map(i=>`\n                                    <th class="sortable" data-field="${i.field}" data-sort="${this.sortField===i.field?this.sortDirection:"none"}">\n                                        ${i.label}\n                                        <span class="sort-indicator"></span>\n                                    </th>\n                                `).join("")}\n                                <th class="actions-column">Actions</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${i.map(i=>this.renderTableRow(i,e)).join("")}\n                        </tbody>\n                    </table>\n                </div>\n            `;t.innerHTML=n,t.classList.add("universal-renderer-container")}getTableColumns(){return[{field:"name",label:"Name"},{field:"mythology",label:"Mythology"},...this.config.primaryFields.map(i=>({field:i,label:this.capitalize(i)}))]}renderTableRow(i,t){return`\n                <tr data-entity-id="${i.id}" data-entity-type="${this.entityType}">\n                    ${t.map(t=>{const e=this.getNestedValue(i,t.field),n=Array.isArray(e)?e.join(", "):e||"-";return"name"===t.field?`<td class="name-cell"><a href="${this.getEntityUrl(i)}">${this.escapeHtml(i.name||i.title)}</a></td>`:`<td>${this.escapeHtml(n)}</td>`}).join("")}\n                    <td class="actions-cell">\n                        <a href="${this.getEntityUrl(i)}" class="btn-table-action">View</a>\n                    </td>\n                </tr>\n            `}renderPanel(i){const t="string"==typeof this.container?document.querySelector(this.container):this.container;if(!t)return;const e=`\n                <div class="universal-panel-container" data-entity-type="${this.entityType}">\n                    ${i.map(i=>this.renderPanelCard(i)).join("")}\n                </div>\n            `;t.innerHTML=e,t.classList.add("universal-renderer-container")}renderPanelCard(i){const t=i.colors||{},e=t.primary||"#667eea",n=t.secondary||"#764ba2";return`\n                <div class="universal-panel-card glass-card"\n                     data-entity-id="${i.id}"\n                     data-entity-type="${this.entityType}"\n                     style="--entity-primary: ${e}; --entity-secondary: ${n}">\n\n                    <div class="panel-hero" style="background: linear-gradient(135deg, ${e}, ${n})">\n                        ${i.icon?`<div class="panel-icon">${i.icon}</div>`:`<div class="panel-icon">${this.config.icon}</div>`}\n                        <h2 class="panel-title">${this.escapeHtml(i.name||i.title)}</h2>\n                        ${i.linguistic?.originalName?`\n                            <div class="panel-subtitle">${i.linguistic.originalName}</div>\n                        `:""}\n                    </div>\n\n                    <div class="panel-content">\n                        <div class="panel-meta">\n                            <span class="entity-type-badge">${this.config.label}</span>\n                            <span class="mythology-badge">${this.capitalize(i.mythology||i.primaryMythology||"unknown")}</span>\n                        </div>\n\n                        ${i.shortDescription||i.fullDescription?`\n                            <div class="panel-description">\n                                ${this.escapeHtml(i.shortDescription||i.fullDescription?.substring(0,200)+"...")}\n                            </div>\n                        `:""}\n\n                        ${this.renderPanelFields(i)}\n\n                        <div class="panel-actions">\n                            <a href="${this.getEntityUrl(i)}" class="btn-primary">Full Details</a>\n                            <button class="btn-secondary panel-expand" data-entity-id="${i.id}">Expand</button>\n                        </div>\n                    </div>\n                </div>\n            `}renderPanelFields(i){const t=this.config.primaryFields||[];let e='<div class="panel-fields">';return t.forEach(t=>{const n=this.getNestedValue(i,t);n&&(e+=`\n                        <div class="panel-field">\n                            <div class="panel-field-label">${this.capitalize(t)}</div>\n                            <div class="panel-field-value">\n                                ${Array.isArray(n)?n.map(i=>`<span class="field-tag">${this.escapeHtml(i)}</span>`).join(""):this.escapeHtml(n)}\n                            </div>\n                        </div>\n                    `)}),e+="</div>",e}renderInline(i){const t="string"==typeof this.container?document.querySelector(this.container):this.container;if(!t)return;const e=`\n                <span class="universal-inline" data-entity-type="${this.entityType}">\n                    ${i.map(i=>this.renderInlineItem(i)).join(", ")}\n                </span>\n            `;t.innerHTML=e,t.classList.add("universal-renderer-container")}renderInlineItem(i){return`\n                <a href="${this.getEntityUrl(i)}"\n                   class="inline-entity-link"\n                   data-entity-id="${i.id}"\n                   data-entity-type="${this.entityType}"\n                   title="${this.escapeHtml(i.shortDescription||i.name)}">\n                    ${i.icon?`<span class="inline-icon">${i.icon}</span>`:""}\n                    ${this.escapeHtml(i.name||i.title)}\n                </a>\n            `}showLoading(){const i="string"==typeof this.container?document.querySelector(this.container):this.container;i&&(i.innerHTML=`\n                    <div class="universal-loading">\n                        <div class="spinner-container">\n                            <div class="spinner-ring"></div>\n                            <div class="spinner-ring"></div>\n                            <div class="spinner-ring"></div>\n                        </div>\n                        <p>Loading ${this.config.plural.toLowerCase()}...</p>\n                    </div>\n                `)}showError(i){const t="string"==typeof this.container?document.querySelector(this.container):this.container;t&&(t.innerHTML=`\n                    <div class="universal-error">\n                        <div class="error-icon">‚ö†Ô∏è</div>\n                        <h3>Error Loading ${this.config.plural}</h3>\n                        <p>${this.escapeHtml(i.message)}</p>\n                        <button class="btn-retry" onclick="location.reload()">Retry</button>\n                    </div>\n                `)}attachEventListeners(){const i="string"==typeof this.container?document.querySelector(this.container):this.container;i&&(i.querySelectorAll(".sortable").forEach(i=>{i.addEventListener("click",()=>{const t=i.dataset.field;this.sortField===t?this.sortDirection="asc"===this.sortDirection?"desc":"asc":(this.sortField=t,this.sortDirection="asc"),this.render()})}),i.querySelectorAll(".panel-expand").forEach(i=>{i.addEventListener("click",t=>{t.preventDefault(),i.closest(".universal-panel-card").classList.toggle("expanded")})}),this.onEntityClick&&i.querySelectorAll("[data-entity-id]").forEach(i=>{i.addEventListener("click",t=>{if(!t.target.closest("a, button")){const e=i.dataset.entityId,n=this.entities.find(i=>i.id===e);n&&this.onEntityClick(n,t)}})}))}getEntityUrl(i){return i.url?i.url:`/mythos/${i.mythology||i.primaryMythology||"shared"}/${this.config.collection}/${i.id}.html`}getNestedValue(i,t){return t.split(".").reduce((i,t)=>i?.[t],i)}capitalize(i){return i?i.charAt(0).toUpperCase()+i.slice(1):""}escapeHtml(i){if(!i)return"";const t=document.createElement("div");return t.textContent=i,t.innerHTML}setDisplayMode(i){this.displayMode=i,this.render()}async setEntityType(t){this.entityType=t,this.config=i[t]||i.deity,this.entities=[],await this.render()}async setFilters(i){this.filters=i,this.entities=[],await this.render()}async refresh(){this.entities=[],await this.render()}},window.ENTITY_TYPE_CONFIG=i}();