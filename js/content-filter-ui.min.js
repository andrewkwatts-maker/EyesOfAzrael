class ContentFilterUI{constructor(){this.init()}init(){window.addEventListener("contentFilterChanged",()=>{this.refreshVisibleContent()})}addFilterControls(t,e){if(!e||!window.contentFilter)return;const n=window.userAuth?.getCurrentUser()?.uid,i=e.userId&&e.userId===n;if(!e.userId||!0===e.official||i)return;const o=this.renderFilterControls(e),s=t.querySelector(".filter-controls");s&&s.remove(),t.insertAdjacentHTML("afterbegin",o),this.attachControlListeners(t,e)}renderFilterControls(t){const e=window.contentFilter.isUserHidden(t.userId),n=t.userTopic&&window.contentFilter.isTopicHidden(t.userTopic),i=t.userSubtopic&&window.contentFilter.isSubtopicHidden(t.userSubtopic);return`\n            <div class="filter-controls">\n                <div class="filter-controls-dropdown">\n                    <button class="filter-controls-btn" type="button" aria-label="Filter options">\n                        <span class="filter-controls-icon">â‹®</span>\n                    </button>\n                    <div class="filter-controls-menu">\n                        <div class="filter-menu-header">Filter Options</div>\n\n                        ${t.userId?`\n                            <button class="filter-menu-item"\n                                    data-action="toggle-user"\n                                    data-user-id="${this.escapeHtml(t.userId)}">\n                                ${e?"ğŸ‘ï¸ Unhide":"ğŸš« Hide"} this user\n                            </button>\n                        `:""}\n\n                        ${t.userTopic?`\n                            <button class="filter-menu-item"\n                                    data-action="toggle-topic"\n                                    data-topic-id="${this.escapeHtml(t.userTopic)}">\n                                ${n?"ğŸ‘ï¸ Unhide":"ğŸš« Hide"} topic: ${this.escapeHtml(t.userTopic)}\n                            </button>\n                        `:""}\n\n                        ${t.userSubtopic?`\n                            <button class="filter-menu-item"\n                                    data-action="toggle-subtopic"\n                                    data-subtopic-id="${this.escapeHtml(t.userSubtopic)}">\n                                ${i?"ğŸ‘ï¸ Unhide":"ğŸš« Hide"} subtopic: ${this.escapeHtml(t.userSubtopic)}\n                            </button>\n                        `:""}\n                    </div>\n                </div>\n            </div>\n        `}attachControlListeners(t,e){const n=t.querySelector(".filter-controls-btn"),i=t.querySelector(".filter-controls-menu");n&&i&&(n.addEventListener("click",t=>{t.stopPropagation(),t.preventDefault(),i.classList.toggle("show")}),document.addEventListener("click",e=>{t.contains(e.target)||i.classList.remove("show")})),t.querySelectorAll(".filter-menu-item").forEach(t=>{t.addEventListener("click",e=>{switch(e.stopPropagation(),e.preventDefault(),t.dataset.action){case"toggle-user":const e=t.dataset.userId;window.contentFilter.isUserHidden(e)?window.contentFilter.unhideUser(e):window.contentFilter.hideUser(e);break;case"toggle-topic":const n=t.dataset.topicId;window.contentFilter.isTopicHidden(n)?window.contentFilter.unhideTopic(n):window.contentFilter.hideTopic(n);break;case"toggle-subtopic":const i=t.dataset.subtopicId;window.contentFilter.isSubtopicHidden(i)?window.contentFilter.unhideSubtopic(i):window.contentFilter.hideSubtopic(i)}i.classList.remove("show")})})}shouldShowElement(t,e){return!window.contentFilter||!e||window.contentFilter.shouldShow(e)}applyFilterToElement(t,e){this.shouldShowElement(t,e)?(t.style.display="",t.classList.remove("filtered-hidden")):(t.style.display="none",t.classList.add("filtered-hidden"))}refreshVisibleContent(){document.querySelectorAll("[data-theory-id]").forEach(t=>{const e=t.dataset.theoryData;if(e)try{const n=JSON.parse(e);this.applyFilterToElement(t,n)}catch(t){}}),window.dispatchEvent(new CustomEvent("contentFiltered",{detail:{timestamp:Date.now()}}))}initializeForTheories(t,e){const n=document.querySelector(e);n&&setTimeout(()=>{t.forEach((t,e)=>{const i=n.querySelector(`[data-theory-id="${t.id}"]`);i&&(i.dataset.theoryData=JSON.stringify(t),this.addFilterControls(i,t),this.applyFilterToElement(i,t))})},100)}filterTheories(t){return window.contentFilter?t.filter(t=>window.contentFilter.shouldShow(t)):t}getFilterSummary(t,e){if(!window.contentFilter||t===e)return"";const n=t-e;return`\n            <div class="filter-summary">\n                <div class="filter-summary-icon">ğŸ›ï¸</div>\n                <div class="filter-summary-text">\n                    <strong>Content Filter Active:</strong> ${window.contentFilter.getModeLabel()}<br>\n                    Showing ${e} of ${t} items (${n} hidden)\n                </div>\n                <button class="btn-adjust-filter" onclick="window.filterSettingsModal?.open()">\n                    Adjust Filters\n                </button>\n            </div>\n        `}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}window.contentFilterUI=new ContentFilterUI;