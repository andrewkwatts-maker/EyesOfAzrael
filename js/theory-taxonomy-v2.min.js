class TheoryTaxonomyV2{constructor(){this.pageTaxonomy=null,this.customUserTopics=this.loadCustomUserTopics(),this.init()}async init(){try{const t=await fetch("/data/page-taxonomy.json");this.pageTaxonomy=await t.json()}catch(t){this.pageTaxonomy={}}}getCategories(){return this.pageTaxonomy?Object.entries(this.pageTaxonomy).map(([t,e])=>({id:t,name:e.name,path:e.path})):[]}getSections(t){if(!this.pageTaxonomy||!this.pageTaxonomy[t])return[];const e=this.pageTaxonomy[t];return Object.entries(e.sections||{}).map(([t,e])=>({id:t,name:e.name,path:e.path}))}getTopics(t,e=null){if(!this.pageTaxonomy||!this.pageTaxonomy[t])return[];const s=this.pageTaxonomy[t];if(e&&s.sections&&s.sections[e]){const t=s.sections[e];return Object.entries(t.topics||{}).map(([t,e])=>({id:t,name:e.name,path:e.path}))}return e?[]:Object.entries(s.topics||{}).map(([t,e])=>({id:t,name:e.name,path:e.path}))}getLocationPath(t,e=null,s=null){if(!this.pageTaxonomy||!this.pageTaxonomy[t])return"Unknown Location";const o=[this.pageTaxonomy[t].name];return e&&this.pageTaxonomy[t].sections[e]?(o.push(this.pageTaxonomy[t].sections[e].name),s&&this.pageTaxonomy[t].sections[e].topics[s]&&o.push(this.pageTaxonomy[t].sections[e].topics[s].name)):s&&this.pageTaxonomy[t].topics&&this.pageTaxonomy[t].topics[s]&&o.push(this.pageTaxonomy[t].topics[s].name),o.join(" â†’ ")}getLocationUrl(t,e=null,s=null){if(!this.pageTaxonomy||!this.pageTaxonomy[t])return null;const o=this.pageTaxonomy[t];if(s){if(e&&o.sections[e]?.topics[s])return o.sections[e].topics[s].path;if(o.topics&&o.topics[s])return o.topics[s].path}else if(e&&o.sections[e])return o.sections[e].path;return o.path}loadCustomUserTopics(){try{const t=localStorage.getItem("customUserTopics");return t?JSON.parse(t):{}}catch(t){return{}}}saveCustomUserTopics(){try{localStorage.setItem("customUserTopics",JSON.stringify(this.customUserTopics))}catch(t){}}addCustomUserTopic(t){const e=this.sanitizeId(t);return this.customUserTopics[e]||(this.customUserTopics[e]={name:t,created:(new Date).toISOString(),useCount:0},this.saveCustomUserTopics()),e}getCustomUserTopics(){return Object.entries(this.customUserTopics).map(([t,e])=>({id:t,...e})).sort((t,e)=>e.useCount-t.useCount)}useCustomUserTopic(t){this.customUserTopics[t]&&(this.customUserTopics[t].useCount++,this.saveCustomUserTopics())}sanitizeId(t){return t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}buildQueryFilters(t){const e=[];return t.page&&e.push({field:"page",operator:"==",value:t.page}),t.section&&e.push({field:"section",operator:"==",value:t.section}),t.topic&&e.push({field:"topic",operator:"==",value:t.topic}),t.userTopic&&e.push({field:"userTopic",operator:"==",value:t.userTopic}),t.userSubtopic&&e.push({field:"userSubtopic",operator:"==",value:t.userSubtopic}),e}getTheoriesLinkForLocation(t,e=null,s=null){const o=new URLSearchParams;return o.set("page",t),e&&o.set("section",e),s&&o.set("topic",s),`/theories/user-submissions/browse.html?${o.toString()}`}generateTheoriesLinkHTML(t,e=null,s=null){return`\n            <a href="${this.getTheoriesLinkForLocation(t,e,s)}" class="user-theories-link"\n               title="View user-submitted theories about ${this.getLocationPath(t,e,s)}">\n                <span class="icon">ðŸ’­</span>\n                <span class="text">User Theories</span>\n            </a>\n        `}}window.theoryTaxonomy=new TheoryTaxonomyV2,window.taxonomyV2=window.theoryTaxonomy;