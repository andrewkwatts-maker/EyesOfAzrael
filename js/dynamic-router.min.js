class DynamicRouter{constructor(e={}){this.viewContainer=e.viewContainer||document.getElementById("main-content"),this.breadcrumbContainer=e.breadcrumbContainer||document.getElementById("breadcrumb-nav"),this.currentRoute=null,this.previousRoute=null,this.scrollPositions={},this.cachedViews=new Map,this.cacheTimeout=e.cacheTimeout||3e5,this.components={home:null,"mythology-overview":null,"entity-type-browser":null,"entity-detail-viewer":null,search:null,compare:null},this.init()}init(){window.addEventListener("hashchange",()=>this.handleHashChange()),window.addEventListener("DOMContentLoaded",()=>{this.handleInitialLoad()}),document.addEventListener("click",e=>this.handleLinkClick(e))}handleInitialLoad(){const e=this.detectStaticPath();if(e){const t=this.convertStaticToHash(e);return void(window.location.hash=t)}const t=window.location.hash||"#/";this.navigate(t,{replace:!0})}detectStaticPath(){const e=window.location.pathname;return e.includes("/mythos/")&&"/"!==e||e.match(/\/(theories|herbalism|spiritual-items|spiritual-places)\//)?e:null}convertStaticToHash(e){const t=(e=e.replace(/^\//,"").replace(/\/index\.html$/,"").replace(/\.html$/,"")).split("/");if("mythos"===t[0]&&t.length>=2){const e=t[1];if(2===t.length)return`#/mythology/${e}`;if(3===t.length)return`#/mythology/${e}/${t[2]}`;if(4===t.length)return`#/mythology/${e}/${this.pluralToSingular(t[2])}/${t[3]}`}return"#/"}pluralToSingular(e){return{deities:"deity",heroes:"hero",creatures:"creature",cosmology:"cosmology",rituals:"ritual",herbs:"herb",texts:"text",symbols:"symbol",concepts:"concept",figures:"figure",beings:"being",items:"item",places:"place",magic:"magic"}[e]||e}handleHashChange(){const e=window.location.hash||"#/";this.navigate(e,{fromHashChange:!0})}handleLinkClick(e){const t=e.target.closest('a[href^="#/"]');if(!t)return;e.preventDefault();const i=t.getAttribute("href");this.navigate(i)}async navigate(e,t={}){this.currentRoute&&(this.scrollPositions[this.currentRoute.hash]=window.scrollY);const i=this.parseRoute(e);if(!t.fromHashChange){if(!t.replace)return void(window.location.hash=e);window.history.replaceState(null,"",e)}this.previousRoute=this.currentRoute,this.currentRoute=i,this.updateBreadcrumbs(i),await this.renderView(i),t.fromHashChange&&void 0!==this.scrollPositions[e]?setTimeout(()=>window.scrollTo(0,this.scrollPositions[e]),0):window.scrollTo(0,0)}parseRoute(e){const t=e.replace(/^#\/?/,"").replace(/\/$/,""),[i,n]=t.split("?"),a=i?i.split("/"):[],s={};if(n&&n.split("&").forEach(e=>{const[t,i]=e.split("=");s[decodeURIComponent(t)]=decodeURIComponent(i||"")}),0===a.length)return{hash:e,type:"home",queryParams:s};if("mythology"===a[0]){if(2===a.length)return{hash:e,type:"mythology-overview",mythology:a[1],queryParams:s};if(3===a.length)return{hash:e,type:"entity-type-browser",mythology:a[1],entityType:this.pluralToSingular(a[2]),entityTypePlural:a[2],queryParams:s};if(4===a.length)return{hash:e,type:"entity-detail-viewer",mythology:a[1],entityType:a[2],entityId:a[3],queryParams:s}}return"search"===a[0]?{hash:e,type:"search",queryParams:s}:"compare"===a[0]?{hash:e,type:"compare",queryParams:s}:{hash:"#/",type:"home",queryParams:{}}}async renderView(e){if(this.viewContainer){this.showLoading();try{const t=this.components[e.type];if(!t)throw new Error(`No component registered for route type: ${e.type}`);const i=this.getCacheKey(e),n=this.cachedViews.get(i);if(n&&Date.now()-n.timestamp<this.cacheTimeout)return void this.displayView(n.html);const a=await t.render(e);this.cachedViews.set(i,{html:a,timestamp:Date.now()}),this.displayView(a)}catch(e){this.showError(e)}}}getCacheKey(e){const t=[e.type];e.mythology&&t.push(e.mythology),e.entityType&&t.push(e.entityType),e.entityId&&t.push(e.entityId);const i=Object.keys(e.queryParams).sort().map(t=>`${t}=${e.queryParams[t]}`).join("&");return i&&t.push(i),t.join(":")}displayView(e){this.viewContainer.classList.add("view-transition-out"),setTimeout(()=>{this.viewContainer.innerHTML=e,this.viewContainer.classList.remove("view-transition-out","view-loading","view-error"),this.viewContainer.classList.add("view-transition-in"),setTimeout(()=>{this.viewContainer.classList.remove("view-transition-in")},300)},150)}showLoading(){this.viewContainer.classList.add("view-loading"),this.viewContainer.innerHTML='\n            <div class="loading-container">\n                <div class="spinner"></div>\n                <p>Loading...</p>\n            </div>\n        '}showError(e){this.viewContainer.classList.add("view-error"),this.viewContainer.innerHTML=`\n            <div class="error-container">\n                <h2>⚠️ Error Loading Content</h2>\n                <p>${e.message||"An unknown error occurred"}</p>\n                <button onclick="window.location.reload()">Reload Page</button>\n                <button onclick="window.location.hash = '#/'">Go Home</button>\n            </div>\n        `}updateBreadcrumbs(e){if(!this.breadcrumbContainer)return;const t=this.generateBreadcrumbs(e),i=t.map((e,i)=>i===t.length-1?`<span class="breadcrumb-current">${e.label}</span>`:`<a href="${e.hash}" class="breadcrumb-link">${e.label}</a>`).join(' <span class="breadcrumb-separator">›</span> ');this.breadcrumbContainer.innerHTML=i}generateBreadcrumbs(e){const t=[{label:"Home",hash:"#/"}];return"home"===e.type||(e.mythology&&t.push({label:this.capitalize(e.mythology)+" Mythology",hash:`#/mythology/${e.mythology}`}),e.entityTypePlural&&t.push({label:this.capitalize(e.entityTypePlural),hash:`#/mythology/${e.mythology}/${e.entityTypePlural}`}),e.entityId&&t.push({label:this.capitalize(e.entityId),hash:e.hash}),"search"===e.type&&t.push({label:"Search",hash:"#/search"}),"compare"===e.type&&t.push({label:"Compare",hash:"#/compare"})),t}registerComponent(e,t){this.components[e]=t}clearCache(){this.cachedViews.clear()}invalidateCache(e){if("string"==typeof e)this.cachedViews.delete(e);else{const t=this.getCacheKey(e);this.cachedViews.delete(t)}}navigateTo(e){this.navigate(e)}back(){window.history.back()}forward(){window.history.forward()}capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.DynamicRouter=DynamicRouter;