class UserAuth{constructor(){this.currentUser=null,this.users=this.loadUsers(),this.init()}init(){const e=localStorage.getItem("currentUser");e&&(this.currentUser=JSON.parse(e),this.updateUIForLoggedInUser()),window.addEventListener("storage",e=>{"currentUser"===e.key&&(e.newValue?(this.currentUser=JSON.parse(e.newValue),this.updateUIForLoggedInUser()):(this.currentUser=null,this.updateUIForLoggedOutUser()))})}loadUsers(){const e=localStorage.getItem("users");return e?JSON.parse(e):{}}saveUsers(){localStorage.setItem("users",JSON.stringify(this.users))}signup(e,t,s){return!e||e.length<3?{success:!1,error:"Username must be at least 3 characters"}:this.validateEmail(t)?!s||s.length<6?{success:!1,error:"Password must be at least 6 characters"}:this.users[e]?{success:!1,error:"Username already taken"}:Object.values(this.users).some(e=>e.email===t)?{success:!1,error:"Email already registered"}:(this.users[e]={username:e,email:t,password:this.hashPassword(s),createdAt:(new Date).toISOString(),theories:[],votes:{},bio:"",avatar:this.generateAvatar(e)},this.saveUsers(),{success:!0,message:"Account created successfully!"}):{success:!1,error:"Please enter a valid email address"}}login(e,t){const s=this.users[e];return s?s.password!==this.hashPassword(t)?{success:!1,error:"Invalid username or password"}:(this.currentUser={username:s.username,email:s.email,createdAt:s.createdAt,bio:s.bio,avatar:s.avatar},localStorage.setItem("currentUser",JSON.stringify(this.currentUser)),this.updateUIForLoggedInUser(),{success:!0,message:"Logged in successfully!"}):{success:!1,error:"Invalid username or password"}}logout(){this.currentUser=null,localStorage.removeItem("currentUser"),this.updateUIForLoggedOutUser(),window.dispatchEvent(new CustomEvent("userLogout"))}isLoggedIn(){return null!==this.currentUser}getCurrentUser(){return this.currentUser}updateProfile(e,t){if(!this.isLoggedIn())return{success:!1,error:"Not logged in"};const s=this.users[this.currentUser.username];return void 0!==e&&(s.bio=e),void 0!==t&&(s.avatar=t),this.saveUsers(),this.currentUser.bio=s.bio,this.currentUser.avatar=s.avatar,localStorage.setItem("currentUser",JSON.stringify(this.currentUser)),{success:!0,message:"Profile updated!"}}validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}hashPassword(e){let t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t&=t;return t.toString(36)}generateAvatar(e){return`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(e)}`}updateUIForLoggedInUser(){document.querySelectorAll('[data-auth-show="loggedOut"]').forEach(e=>{e.style.display="none"}),document.querySelectorAll('[data-auth-show="loggedIn"]').forEach(e=>{e.style.display=""}),document.querySelectorAll("[data-auth-username]").forEach(e=>{e.textContent=this.currentUser.username}),document.querySelectorAll("[data-auth-avatar]").forEach(e=>{e.src=this.currentUser.avatar}),window.dispatchEvent(new CustomEvent("userLogin",{detail:this.currentUser}))}updateUIForLoggedOutUser(){document.querySelectorAll('[data-auth-show="loggedIn"]').forEach(e=>{e.style.display="none"}),document.querySelectorAll('[data-auth-show="loggedOut"]').forEach(e=>{e.style.display=""}),window.dispatchEvent(new CustomEvent("userLogout"))}showLoginModal(){const e=document.getElementById("auth-modal");e&&(e.style.display="flex",this.switchAuthMode("login"))}showSignupModal(){const e=document.getElementById("auth-modal");e&&(e.style.display="flex",this.switchAuthMode("signup"))}hideAuthModal(){const e=document.getElementById("auth-modal");e&&(e.style.display="none",this.clearAuthForms())}switchAuthMode(e){const t=document.getElementById("login-form"),s=document.getElementById("signup-form"),r=document.getElementById("auth-modal-title");"login"===e?(t&&(t.style.display="block"),s&&(s.style.display="none"),r&&(r.textContent="Login to Your Account")):(t&&(t.style.display="none"),s&&(s.style.display="block"),r&&(r.textContent="Create New Account"))}clearAuthForms(){document.querySelectorAll("#login-form input, #signup-form input").forEach(e=>{e.value=""}),this.clearAuthMessages()}showAuthMessage(e,t="error"){const s=document.getElementById("auth-message");s&&(s.textContent=e,s.className=`auth-message auth-message-${t}`,s.style.display="block")}clearAuthMessages(){const e=document.getElementById("auth-message");e&&(e.style.display="none")}}window.userAuth=new UserAuth,"undefined"!=typeof module&&module.exports&&(module.exports=UserAuth);