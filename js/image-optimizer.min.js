class ImageOptimizer{constructor(e={}){this.options={rootMargin:"50px",threshold:.01,placeholderColor:"#1a1a2e",enableWebP:!0,...e},this.supportsWebP=!1,this.observer=null,this.init()}async init(){this.supportsWebP=await this.checkWebPSupport(),this.setupLazyLoading(),this.processImages()}async checkWebPSupport(){if(!self.createImageBitmap)return!1;try{const e=await fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then(e=>e.blob());return await createImageBitmap(e).then(()=>!0,()=>!1)}catch{return!1}}setupLazyLoading(){const e={rootMargin:this.options.rootMargin,threshold:this.options.threshold};this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(this.loadImage(e.target),this.observer.unobserve(e.target))})},e)}processImages(){document.querySelectorAll('img[data-src], img[loading="lazy"]').forEach(e=>this.observeImage(e))}observeImage(e){e.src||e.style.backgroundColor||(e.style.backgroundColor=this.options.placeholderColor),e.classList.add("lazy-loading"),this.observer?this.observer.observe(e):this.loadImage(e)}loadImage(e){const t=e.dataset.src||e.src,s=e.dataset.srcset;if(!t)return;const a=new Image;a.onload=()=>{this.applyImage(e,a)},a.onerror=()=>{this.handleImageError(e)};const o=this.getBestImageSrc(t);s&&(a.srcset=s),a.src=o}getBestImageSrc(e){if(!this.options.enableWebP||!this.supportsWebP)return e;const t=e.split(".").pop().toLowerCase();return["jpg","jpeg","png"].includes(t)?e.replace(/\.(jpg|jpeg|png)$/i,".webp"):e}applyImage(e,t){e.style.opacity="0",e.style.transition="opacity 0.3s ease-in-out",e.src=t.src,t.srcset&&(e.srcset=t.srcset),e.classList.remove("lazy-loading"),e.classList.add("lazy-loaded"),requestAnimationFrame(()=>{e.style.opacity="1"}),setTimeout(()=>{e.style.backgroundColor=""},300),e.dispatchEvent(new CustomEvent("lazyloaded",{bubbles:!0}))}handleImageError(e){e.classList.remove("lazy-loading"),e.classList.add("lazy-error"),e.alt=e.alt||"Image failed to load",e.style.backgroundColor="#2a2a3e";const t=document.createElement("div");t.className="image-error-text",t.textContent="âš  Image unavailable",t.style.cssText="\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            color: #888;\n            font-size: 0.9rem;\n            text-align: center;\n        ";const s=e.parentElement;s&&"absolute"!==s.style.position&&"relative"!==s.style.position&&(s.style.position="relative"),s.appendChild(t),e.dispatchEvent(new CustomEvent("lazyerror",{bubbles:!0}))}createResponsiveImage(e){const{src:t,alt:s="",sizes:a="100vw",widths:o=[320,640,960,1280,1920],className:r="",lazy:i=!0}=e,n=document.createElement("img");if(n.alt=s,n.className=r,i){n.dataset.src=t,n.loading="lazy";const e=o.map(e=>`${this.getResizedImageUrl(t,e)} ${e}w`).join(", ");n.dataset.srcset=e,n.sizes=a,this.observeImage(n)}else n.src=t;return n}getResizedImageUrl(e,t){return e}preloadImages(e){e.forEach(e=>{const t=document.createElement("link");t.rel="preload",t.as="image",t.href=e,document.head.appendChild(t)})}addImages(e){document.querySelectorAll(e).forEach(e=>this.observeImage(e))}destroy(){this.observer&&this.observer.disconnect()}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.imageOptimizer=new ImageOptimizer}):window.imageOptimizer=new ImageOptimizer,"undefined"!=typeof module&&module.exports&&(module.exports=ImageOptimizer);