class PageAssetRenderer{constructor(n){this.db=n,this.cache=new Map,this.collectionCache=new Map}async renderPage(n,t){t.innerHTML=this.getLoadingHTML();try{const e=await this.loadPage(n);if(!e)return void(t.innerHTML=this.getNotFoundHTML(n));t.innerHTML=await this.getPageHTML(e),this.attachEventListeners(t,e)}catch(n){t.innerHTML=this.getErrorHTML(n)}}async loadPage(n){if(this.cache.has(n))return this.cache.get(n);try{const t=await this.db.collection("pages").doc(n).get();if(!t.exists)return null;const e={id:t.id,...t.data()};for(const n of e.sections||[])n.collection&&(n.cards=await this.loadSectionCards(n));return this.cache.set(n,e),e}catch(n){throw n}}async loadSectionCards(n){const{collection:t,displayCount:e=0,sortBy:s="order",filters:i={}}=n,a=`${t}-${e}-${s}`;if(this.collectionCache.has(a))return this.collectionCache.get(a);try{let n=this.db.collection(t);Object.entries(i).forEach(([t,e])=>{n=n.where(t,"==",e)}),s&&(n=n.orderBy(s)),e>0&&(n=n.limit(e));const c=(await n.get()).docs.map(n=>({id:n.id,...n.data()}));return this.collectionCache.set(a,c),c}catch(n){return[]}}async getPageHTML(n){const{hero:t,sections:e=[]}=n;let s="";t&&(s+=this.getHeroHTML(t));for(const n of e)s+=this.getSectionHTML(n);return s}getHeroHTML(n){const{title:t,subtitle:e,cta:s=[]}=n;return`\n            <div class="hero-section">\n                <h1 class="hero-title">${t}</h1>\n                ${e?`<p class="hero-subtitle">${e}</p>`:""}\n                ${s.length>0?`\n                    <div class="hero-cta">\n                        ${s.map(n=>`\n                            <a href="${n.link}"\n                               class="btn ${n.primary?"btn-primary":"btn-secondary"}">\n                                ${n.icon} ${n.text}\n                            </a>\n                        `).join("")}\n                    </div>\n                `:""}\n            </div>\n        `}getSectionHTML(n){const{title:t,description:e,cards:s=[],icon:i="ðŸ“„"}=n;return`\n            <div class="page-section" data-section="${n.id}">\n                <div class="section-header">\n                    <h2 class="section-title">\n                        ${i} ${t}\n                    </h2>\n                    ${e?`<p class="section-description">${e}</p>`:""}\n                    ${n.link?`\n                        <a href="${n.link}" class="section-link">View All â†’</a>\n                    `:""}\n                </div>\n                <div class="section-content">\n                    ${this.getCardsHTML(s,n)}\n                </div>\n            </div>\n        `}getCardsHTML(n,t){return n&&0!==n.length?`\n            <div class="card-grid">\n                ${n.map(n=>this.getCardHTML(n,t)).join("")}\n            </div>\n        `:`<p class="no-content">No ${t.collection} available yet.</p>`}getCardHTML(n,t){const e=this.getCardLink(n,t),s=n.icon||t.icon||"ðŸ“„",i=n.name||n.title||"Untitled",a=n.description||"";return`\n            <a href="${e}" class="panel-card" data-card-id="${n.id}">\n                <div class="card-icon">${s}</div>\n                <h3 class="card-title">${i}</h3>\n                ${a?`<p class="card-description">${a}</p>`:""}\n                ${n.metadata?.status?`\n                    <span class="card-status">${n.metadata.status}</span>\n                `:""}\n            </a>\n        `}getCardLink(n,t){const e=t.collection;switch(e){case"mythologies":return`#/mythology/${n.id}`;case"places":return`#/place/${n.id}`;case"items":return`#/item/${n.id}`;case"archetypes":return`#/archetype/${n.id}`;case"theories":return`#/theory/${n.id}`;case"submissions":return`#/submission/${n.id}`;default:return`#/${e}/${n.id}`}}attachEventListeners(n,t){n.querySelectorAll(".panel-card").forEach(n=>{n.addEventListener("click",n=>{})})}getLoadingHTML(){return'\n            <div class="loading-container">\n                <div class="spinner-container">\n                    <div class="spinner-ring"></div>\n                    <div class="spinner-ring"></div>\n                    <div class="spinner-ring"></div>\n                </div>\n                <p class="loading-message">Loading page...</p>\n            </div>\n        '}getNotFoundHTML(n){return`\n            <div class="error-container">\n                <h1>Page Not Found</h1>\n                <p>The page "${n}" could not be found.</p>\n                <a href="#/" class="btn btn-primary">Return Home</a>\n            </div>\n        `}getErrorHTML(n){return`\n            <div class="error-container">\n                <h1>Error Loading Page</h1>\n                <p>${n.message}</p>\n                <button onclick="location.reload()" class="btn btn-primary">Retry</button>\n            </div>\n        `}clearCache(){this.cache.clear(),this.collectionCache.clear()}}window.PageAssetRenderer=PageAssetRenderer;