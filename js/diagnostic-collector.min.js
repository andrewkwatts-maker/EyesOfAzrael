class DiagnosticCollector{constructor(){this.diagnostics={firebase:{status:"unknown",initialized:!1,config:null,error:null,timestamp:null},auth:{status:"unknown",currentUser:null,ready:!1,error:null,timestamp:null},navigation:{status:"unknown",currentRoute:null,history:[],ready:!1,error:null,timestamp:null},dom:{status:"unknown",readyState:null,criticalElements:{},error:null,timestamp:null},network:{status:"unknown",requests:[],errors:[],timestamp:null},performance:{status:"unknown",timing:{},memory:null,error:null,timestamp:null},console:{logs:[],errors:[],warnings:[],maxLogs:50}},this.startTime=Date.now(),this.initialized=!1}init(){this.initialized||(this.interceptConsole(),this.monitorNetwork(),this.monitorDOM(),this.startPeriodicCollection(),this.initialized=!0)}interceptConsole(){const t=this,s=console.log,i=console.error,e=console.warn;console.log=function(...i){t.addLog("log",i),s.apply(console,i)},console.error=function(...s){t.addLog("error",s),i.apply(console,s)},console.warn=function(...s){t.addLog("warning",s),e.apply(console,s)}}addLog(t,s){const i={level:t,message:s.map(t=>{if("object"==typeof t)try{return JSON.stringify(t,null,2)}catch(s){return String(t)}return String(t)}).join(" "),timestamp:Date.now(),elapsed:Date.now()-this.startTime};"error"===t?this.diagnostics.console.errors.push(i):"warning"===t&&this.diagnostics.console.warnings.push(i),this.diagnostics.console.logs.push(i);const e=this.diagnostics.console.maxLogs;this.diagnostics.console.logs.length>e&&(this.diagnostics.console.logs=this.diagnostics.console.logs.slice(-e))}monitorNetwork(){const t=this,s=window.fetch;window.fetch=function(...i){const e=i[0],o=Date.now();return s.apply(this,i).then(s=>(t.addNetworkRequest({type:"fetch",url:e,status:s.status,duration:Date.now()-o,timestamp:Date.now()}),s)).catch(s=>{throw t.addNetworkError({type:"fetch",url:e,error:s.message,duration:Date.now()-o,timestamp:Date.now()}),s})};const i=XMLHttpRequest.prototype.open,e=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(t,s){return this._diagnosticUrl=s,this._diagnosticMethod=t,this._diagnosticStartTime=Date.now(),i.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){const s=this;return s.addEventListener("load",function(){t.addNetworkRequest({type:"xhr",method:s._diagnosticMethod,url:s._diagnosticUrl,status:s.status,duration:Date.now()-s._diagnosticStartTime,timestamp:Date.now()})}),s.addEventListener("error",function(){t.addNetworkError({type:"xhr",method:s._diagnosticMethod,url:s._diagnosticUrl,error:"Network error",duration:Date.now()-s._diagnosticStartTime,timestamp:Date.now()})}),e.apply(this,arguments)}}addNetworkRequest(t){this.diagnostics.network.requests.push(t),this.diagnostics.network.requests.length>50&&(this.diagnostics.network.requests=this.diagnostics.network.requests.slice(-50)),this.diagnostics.network.timestamp=Date.now()}addNetworkError(t){this.diagnostics.network.errors.push(t),this.diagnostics.network.errors.length>20&&(this.diagnostics.network.errors=this.diagnostics.network.errors.slice(-20)),this.diagnostics.network.timestamp=Date.now()}monitorDOM(){const t=this;document.addEventListener("readystatechange",()=>{t.collectDOMState()}),"undefined"!=typeof MutationObserver&&new MutationObserver(()=>{t.collectDOMState()}).observe(document.body,{childList:!0,subtree:!0})}startPeriodicCollection(){setInterval(()=>{this.collectAll()},1e3)}collectAll(){this.collectFirebaseState(),this.collectAuthState(),this.collectNavigationState(),this.collectDOMState(),this.collectPerformance(),this.collectNetworkState()}collectFirebaseState(){try{if("undefined"==typeof firebase)this.diagnostics.firebase.status="error",this.diagnostics.firebase.error="Firebase SDK not loaded";else{const t=firebase.apps;0===t.length?(this.diagnostics.firebase.status="warning",this.diagnostics.firebase.initialized=!1,this.diagnostics.firebase.error="Firebase not initialized"):(this.diagnostics.firebase.status="ok",this.diagnostics.firebase.initialized=!0,this.diagnostics.firebase.config={projectId:t[0].options.projectId,appId:t[0].options.appId},this.diagnostics.firebase.error=null)}}catch(t){this.diagnostics.firebase.status="error",this.diagnostics.firebase.error=t.message}this.diagnostics.firebase.timestamp=Date.now()}collectAuthState(){try{if("undefined"!=typeof firebase&&firebase.auth){const t=firebase.auth().currentUser;t?(this.diagnostics.auth.status="ok",this.diagnostics.auth.ready=!0,this.diagnostics.auth.currentUser={uid:t.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL},this.diagnostics.auth.error=null):(this.diagnostics.auth.status="warning",this.diagnostics.auth.ready=!0,this.diagnostics.auth.currentUser=null,this.diagnostics.auth.error="No user signed in")}else this.diagnostics.auth.status="error",this.diagnostics.auth.error="Firebase Auth not available"}catch(t){this.diagnostics.auth.status="error",this.diagnostics.auth.error=t.message}this.diagnostics.auth.timestamp=Date.now()}collectNavigationState(){try{const t=window.EyesOfAzrael?.navigation;t?(this.diagnostics.navigation.status="ok",this.diagnostics.navigation.ready=!0,this.diagnostics.navigation.currentRoute=t.currentRoute||window.location.hash,this.diagnostics.navigation.history=t.routeHistory||[],this.diagnostics.navigation.error=null):(this.diagnostics.navigation.status="warning",this.diagnostics.navigation.error="Navigation not initialized")}catch(t){this.diagnostics.navigation.status="error",this.diagnostics.navigation.error=t.message}this.diagnostics.navigation.timestamp=Date.now()}collectDOMState(){try{this.diagnostics.dom.readyState=document.readyState;const t={mainContent:document.getElementById("main-content"),header:document.querySelector(".site-header"),shaderCanvas:document.getElementById("shader-canvas"),breadcrumb:document.getElementById("breadcrumb-nav")};this.diagnostics.dom.criticalElements={};for(const[s,i]of Object.entries(t))this.diagnostics.dom.criticalElements[s]={exists:!!i,visible:!!i&&null!==i.offsetParent,innerHTML:i?i.innerHTML.length:0};const s=Object.values(this.diagnostics.dom.criticalElements).some(t=>!t.exists);this.diagnostics.dom.status=s?"warning":"ok",this.diagnostics.dom.error=s?"Missing critical elements":null}catch(t){this.diagnostics.dom.status="error",this.diagnostics.dom.error=t.message}this.diagnostics.dom.timestamp=Date.now()}collectNetworkState(){try{const t=this.diagnostics.network.errors.length>0;this.diagnostics.network.status=t?"warning":"ok"}catch(t){this.diagnostics.network.status="error"}}collectPerformance(){try{if(performance&&performance.timing){const t=performance.timing,s=Date.now();this.diagnostics.performance.timing={domReady:t.domContentLoadedEventEnd-t.navigationStart,pageLoad:t.loadEventEnd-t.navigationStart,domInteractive:t.domInteractive-t.navigationStart,firstPaint:t.responseStart-t.navigationStart,uptime:s-this.startTime}}performance.memory&&(this.diagnostics.performance.memory={usedJSHeapSize:Math.round(performance.memory.usedJSHeapSize/1048576),totalJSHeapSize:Math.round(performance.memory.totalJSHeapSize/1048576),jsHeapSizeLimit:Math.round(performance.memory.jsHeapSizeLimit/1048576)}),this.diagnostics.performance.status="ok",this.diagnostics.performance.error=null}catch(t){this.diagnostics.performance.status="error",this.diagnostics.performance.error=t.message}this.diagnostics.performance.timestamp=Date.now()}getDiagnostics(){return this.diagnostics}getSystemStatus(){const t=[this.diagnostics.firebase.status,this.diagnostics.auth.status,this.diagnostics.navigation.status,this.diagnostics.dom.status,this.diagnostics.network.status,this.diagnostics.performance.status];return t.includes("error")?"error":t.includes("warning")?"warning":"ok"}getFailurePoint(){const t=[{name:"Firebase SDK",status:this.diagnostics.firebase.status,error:this.diagnostics.firebase.error},{name:"Firebase Auth",status:this.diagnostics.auth.status,error:this.diagnostics.auth.error},{name:"Navigation",status:this.diagnostics.navigation.status,error:this.diagnostics.navigation.error},{name:"DOM Elements",status:this.diagnostics.dom.status,error:this.diagnostics.dom.error},{name:"Network",status:this.diagnostics.network.status,error:this.diagnostics.network.error}];for(const s of t)if("error"===s.status)return{component:s.name,error:s.error};return null}exportJSON(){return JSON.stringify(this.diagnostics,null,2)}clearLogs(){this.diagnostics.console.logs=[],this.diagnostics.console.errors=[],this.diagnostics.console.warnings=[]}}window.location.pathname.includes("debug-dashboard")||(window.diagnosticCollector=new DiagnosticCollector,window.diagnosticCollector.init()),"undefined"!=typeof module&&module.exports&&(module.exports=DiagnosticCollector);