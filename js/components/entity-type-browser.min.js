class EntityTypeBrowser{constructor(e={}){this.db=e.db||window.firebase&&window.firebase.firestore(),this.router=e.router,this.displayMode="grid",this.sortField="name",this.sortDirection="asc",this.currentPage=1,this.pageSize=50}async render(e){try{const{mythology:t,entityType:i,entityTypePlural:n,queryParams:s}=e;this.displayMode=s.view||"grid",this.sortField=s.sort||"name",this.sortDirection=s.dir||"asc",this.currentPage=parseInt(s.page)||1;const l=await this.loadEntities(t,i);return l&&0!==l.length?this.generateHTML(t,i,n,l):this.renderEmpty(t,i,n)}catch(e){throw e}}async loadEntities(e,t){if(!this.db)throw new Error("Firebase Firestore not initialized");const i=this.getCollectionName(t);let n=this.db.collection(i).where("mythology","==",e);return n=n.orderBy(this.sortField,this.sortDirection),(await n.get()).docs.map(e=>({id:e.id,...e.data()}))}getCollectionName(e){return{deity:"deities",hero:"heroes",creature:"creatures",cosmology:"cosmology",ritual:"rituals",herb:"herbs",text:"texts",symbol:"symbols",item:"items",place:"places",magic:"magic",concept:"concepts",figure:"figures",being:"beings"}[e]||e+"s"}generateHTML(e,t,i,n){const s=this.getEntityTypeConfig(t);return`\n            <div class="entity-type-browser" data-mythology="${e}" data-entity-type="${t}">\n                \x3c!-- Header --\x3e\n                <div class="browser-header">\n                    <div class="browser-title-section">\n                        <h1 class="browser-title">\n                            ${s.icon} ${this.capitalize(e)} ${this.capitalize(i)}\n                        </h1>\n                        <p class="browser-subtitle">${n.length} ${1===n.length?s.label:s.plural} found</p>\n                    </div>\n\n                    \x3c!-- View Mode Switcher --\x3e\n                    <div class="view-mode-switcher">\n                        <button class="view-mode-btn ${"grid"===this.displayMode?"active":""}"\n                                onclick="window.location.hash += '?view=grid'"\n                                title="Grid View">\n                            ‚ñ¶\n                        </button>\n                        <button class="view-mode-btn ${"list"===this.displayMode?"active":""}"\n                                onclick="window.location.hash += '?view=list'"\n                                title="List View">\n                            ‚ò∞\n                        </button>\n                        <button class="view-mode-btn ${"table"===this.displayMode?"active":""}"\n                                onclick="window.location.hash += '?view=table'"\n                                title="Table View">\n                            ‚ñ§\n                        </button>\n                    </div>\n                </div>\n\n                \x3c!-- Sort Controls --\x3e\n                <div class="browser-controls">\n                    <div class="sort-controls">\n                        <label for="sort-field">Sort by:</label>\n                        <select id="sort-field" onchange="window.location.hash += '?sort=' + this.value">\n                            <option value="name" ${"name"===this.sortField?"selected":""}>Name</option>\n                            ${s.sortFields.map(e=>`\n                                <option value="${e.value}" ${this.sortField===e.value?"selected":""}>\n                                    ${e.label}\n                                </option>\n                            `).join("")}\n                        </select>\n\n                        <button class="sort-direction-btn"\n                                onclick="window.location.hash += '?dir=${"asc"===this.sortDirection?"desc":"asc"}'"\n                                title="${"asc"===this.sortDirection?"Ascending":"Descending"}">\n                            ${"asc"===this.sortDirection?"‚Üë":"‚Üì"}\n                        </button>\n                    </div>\n\n                    <div class="entity-count-badge">\n                        ${n.length} ${1===n.length?s.label:s.plural}\n                    </div>\n                </div>\n\n                \x3c!-- Entity Grid/List --\x3e\n                <div id="entity-container" class="entity-container">\n                    ${this.renderEntities(e,t,n)}\n                </div>\n            </div>\n        `}renderEntities(e,t,i){const n="entity-renderer-"+Date.now();return setTimeout(()=>{const e=document.getElementById("entity-container");if(e&&window.UniversalEntityRenderer){const n=new window.UniversalEntityRenderer({container:e,entityType:t,displayMode:this.displayMode,db:this.db});n.entities=i,n.render()}},100),`<div id="${n}" class="renderer-loading">Loading entities...</div>`}renderEmpty(e,t,i){const n=this.getEntityTypeConfig(t);return`\n            <div class="entity-type-browser empty-browser">\n                <div class="browser-header">\n                    <h1 class="browser-title">\n                        ${n.icon} ${this.capitalize(e)} ${this.capitalize(i)}\n                    </h1>\n                </div>\n\n                <div class="empty-container">\n                    <div class="empty-icon">${n.icon}</div>\n                    <h2>No ${this.capitalize(i)} Found</h2>\n                    <p class="empty-message">\n                        There are no ${i} in the ${e} mythology yet.\n                    </p>\n                    <div class="empty-actions">\n                        <a href="#/mythology/${e}" class="btn-primary">\n                            Back to ${this.capitalize(e)}\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `}getEntityTypeConfig(e){return{deity:{icon:"üëë",label:"Deity",plural:"Deities",sortFields:[{value:"domains",label:"Domains"},{value:"element",label:"Element"}]},hero:{icon:"ü¶∏",label:"Hero",plural:"Heroes",sortFields:[{value:"feats",label:"Feats"},{value:"legacy",label:"Legacy"}]},creature:{icon:"üêâ",label:"Creature",plural:"Creatures",sortFields:[{value:"type",label:"Type"},{value:"habitat",label:"Habitat"}]},cosmology:{icon:"üåå",label:"Cosmology",plural:"Cosmology",sortFields:[{value:"realm",label:"Realm"}]},ritual:{icon:"üïØÔ∏è",label:"Ritual",plural:"Rituals",sortFields:[{value:"purpose",label:"Purpose"},{value:"timing",label:"Timing"}]},herb:{icon:"üåø",label:"Herb",plural:"Herbs",sortFields:[{value:"uses",label:"Uses"}]},text:{icon:"üìú",label:"Text",plural:"Texts",sortFields:[{value:"author",label:"Author"},{value:"period",label:"Period"}]},symbol:{icon:"‚ö°",label:"Symbol",plural:"Symbols",sortFields:[{value:"meaning",label:"Meaning"}]}}[e]||{icon:"üìÑ",label:this.capitalize(e),plural:this.capitalize(e)+"s",sortFields:[]}}capitalize(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}}window.EntityTypeBrowser=EntityTypeBrowser;