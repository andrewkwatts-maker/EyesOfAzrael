class UserDashboard{constructor(t){this.crudManager=t.crudManager,this.auth=t.auth,this.entities=[],this.filter={collection:"all",status:"active",search:""}}getDefaultAvatar(){return`data:image/svg+xml,${encodeURIComponent('\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">\n                <circle cx="50" cy="50" r="50" fill="#4a5568"/>\n                <circle cx="50" cy="38" r="18" fill="#e2e8f0"/>\n                <ellipse cx="50" cy="78" rx="24" ry="16" fill="#e2e8f0"/>\n            </svg>\n        '.trim())}`}async render(){const t=this.auth.currentUser;return t?(await this.loadUserEntities(),`\n            <div class="user-dashboard">\n                <div class="dashboard-header">\n                    <div class="dashboard-user-info">\n                        <img src="${t.photoURL||this.getDefaultAvatar()}" alt="${t.displayName}" class="dashboard-avatar">\n                        <div>\n                            <h1>My Contributions</h1>\n                            <p class="dashboard-user-name">${t.displayName||t.email}</p>\n                        </div>\n                    </div>\n\n                    <div class="dashboard-stats">\n                        ${this.renderStats()}\n                    </div>\n                </div>\n\n                <div class="dashboard-controls">\n                    <div class="dashboard-filters">\n                        <select id="collectionFilter" class="filter-select">\n                            <option value="all">All Types</option>\n                            <option value="deities">Deities</option>\n                            <option value="creatures">Creatures</option>\n                            <option value="heroes">Heroes</option>\n                            <option value="items">Items</option>\n                            <option value="places">Places</option>\n                            <option value="herbs">Herbs</option>\n                            <option value="rituals">Rituals</option>\n                            <option value="symbols">Symbols</option>\n                            <option value="concepts">Concepts</option>\n                            <option value="texts">Texts</option>\n                        </select>\n\n                        <select id="statusFilter" class="filter-select">\n                            <option value="active">Active</option>\n                            <option value="deleted">Deleted</option>\n                            <option value="all">All Status</option>\n                        </select>\n\n                        <input\n                            type="search"\n                            id="searchInput"\n                            placeholder="Search your entities..."\n                            class="search-input"\n                        />\n                    </div>\n\n                    <button id="createNewBtn" class="btn-primary">\n                        <span>+ Create New Entity</span>\n                    </button>\n                </div>\n\n                <div id="entitiesList" class="entities-list">\n                    ${this.renderEntitiesList()}\n                </div>\n\n                <div id="formContainer"></div>\n            </div>\n        `):this.renderNotAuthenticated()}renderNotAuthenticated(){return'\n            <div class="empty-container">\n                <div class="empty-icon">üîí</div>\n                <h2>Authentication Required</h2>\n                <p class="empty-message">Please sign in to manage your entities</p>\n                <button id="signInBtn" class="btn-primary">Sign In with Google</button>\n            </div>\n        '}renderStats(){const t=this.calculateStats();return`\n            <div class="stat-card">\n                <div class="stat-value">${t.total}</div>\n                <div class="stat-label">Total Entities</div>\n            </div>\n            <div class="stat-card">\n                <div class="stat-value">${t.active}</div>\n                <div class="stat-label">Active</div>\n            </div>\n            <div class="stat-card">\n                <div class="stat-value">${t.mythologies}</div>\n                <div class="stat-label">Mythologies</div>\n            </div>\n        `}calculateStats(){const t=this.entities.filter(t=>"active"===t.status).length,e=new Set(this.entities.map(t=>t.mythology)).size;return{total:this.entities.length,active:t,mythologies:e}}renderEntitiesList(){const t=this.filterEntities();return 0===t.length?'\n                <div class="empty-state">\n                    <p>No entities found matching your filters.</p>\n                    <button class="btn-secondary" onclick="this.closest(\'.user-dashboard\').querySelector(\'#createNewBtn\').click()">\n                        Create Your First Entity\n                    </button>\n                </div>\n            ':`\n            <div class="entity-grid">\n                ${t.map(t=>this.renderEntityCard(t)).join("")}\n            </div>\n        `}renderEntityCard(t){const e="deleted"===t.status;return`\n            <div class="entity-panel ${e?"deleted":""}" data-mythology="${t.mythology||"unknown"}">\n                ${e?'<div class="deleted-badge">Deleted</div>':""}\n\n                <div class="entity-icon">${t.icon||"üìÑ"}</div>\n\n                <h3 class="entity-name">${t.name||"Untitled"}</h3>\n\n                <div class="entity-meta">\n                    <span class="entity-tag">${t.mythology||"Unknown"}</span>\n                    <span class="entity-tag">${t.type||"Unknown"}</span>\n                </div>\n\n                ${t.description?`\n                    <p class="entity-description">${this.truncate(t.description,120)}</p>\n                `:""}\n\n                <div class="entity-dates">\n                    <small>Created: ${this.formatDate(t.createdAt)}</small>\n                    ${t.updatedAt?`<small>Updated: ${this.formatDate(t.updatedAt)}</small>`:""}\n                </div>\n\n                <div class="panel-actions">\n                    <button class="panel-action-btn" data-action="view" data-collection="${t.collection}" data-id="${t.id}">\n                        üëÅÔ∏è View\n                    </button>\n                    <button class="panel-action-btn" data-action="edit" data-collection="${t.collection}" data-id="${t.id}">\n                        ‚úèÔ∏è Edit\n                    </button>\n                    ${e?`\n                        <button class="panel-action-btn" data-action="restore" data-collection="${t.collection}" data-id="${t.id}">\n                            ‚ôªÔ∏è Restore\n                        </button>\n                    `:`\n                        <button class="panel-action-btn danger" data-action="delete" data-collection="${t.collection}" data-id="${t.id}">\n                            üóëÔ∏è Delete\n                        </button>\n                    `}\n                </div>\n            </div>\n        `}async loadUserEntities(){const t=["deities","creatures","heroes","items","places","herbs","rituals","symbols","concepts","texts","events"];this.entities=[];for(const e of t){const t=await this.crudManager.getUserEntities(e);t.success&&t.data&&t.data.forEach(t=>{this.entities.push({...t,collection:e})})}this.entities.sort((t,e)=>{const n=t.createdAt?.toDate?.()||new Date(0);return(e.createdAt?.toDate?.()||new Date(0))-n})}filterEntities(){return this.entities.filter(t=>{if("all"!==this.filter.collection&&t.collection!==this.filter.collection)return!1;if("all"!==this.filter.status&&t.status!==this.filter.status)return!1;if(this.filter.search){const e=this.filter.search.toLowerCase();if(!`${t.name} ${t.description} ${t.mythology} ${t.type}`.toLowerCase().includes(e))return!1}return!0})}initialize(t){this.container=t;const e=t.querySelector("#collectionFilter");e&&(e.value=this.filter.collection,e.addEventListener("change",t=>{this.filter.collection=t.target.value,this.refresh()}));const n=t.querySelector("#statusFilter");n&&(n.value=this.filter.status,n.addEventListener("change",t=>{this.filter.status=t.target.value,this.refresh()}));const s=t.querySelector("#searchInput");s&&(s.value=this.filter.search,s.addEventListener("input",t=>{this.filter.search=t.target.value,this.refresh()}));const i=t.querySelector("#createNewBtn");i&&i.addEventListener("click",()=>this.handleCreateNew());const a=t.querySelector("#signInBtn");a&&a.addEventListener("click",()=>this.handleSignIn()),t.addEventListener("click",t=>{const e=t.target.closest("[data-action]");if(!e)return;const n=e.dataset.action,s=e.dataset.collection,i=e.dataset.id;switch(n){case"view":this.handleView(s,i);break;case"edit":this.handleEdit(s,i);break;case"delete":this.handleDelete(s,i);break;case"restore":this.handleRestore(s,i)}})}async refresh(){const t=this.container.querySelector("#entitiesList");t&&(t.innerHTML='<div class="loading">Loading...</div>',await this.loadUserEntities(),t.innerHTML=this.renderEntitiesList())}async handleCreateNew(){const t={1:"deities",2:"creatures",3:"heroes",4:"items",5:"places",6:"herbs",7:"rituals",8:"symbols",9:"concepts",10:"texts"}[prompt("Select entity type:\n\n1. Deity\n2. Creature\n3. Hero\n4. Item\n5. Place\n6. Herb\n7. Ritual\n8. Symbol\n9. Concept\n10. Text\n\nEnter number (1-10):")];t&&this.showForm(t)}async handleSignIn(){const t=new firebase.auth.GoogleAuthProvider;try{await this.auth.signInWithPopup(t),window.location.reload()}catch(t){alert("Failed to sign in: "+t.message)}}handleView(t,e){if(window.EyesOfAzrael&&window.EyesOfAzrael.navigation){const n=t.slice(0,-1);window.EyesOfAzrael.navigation.navigate(`#/mythology/user/${n}/${e}`)}}handleEdit(t,e){this.showForm(t,e)}async handleDelete(t,e){if(!confirm("Are you sure you want to delete this entity? You can restore it later."))return;const n=await this.crudManager.delete(t,e,!1);n.success?(this.showToast("Entity deleted successfully","success"),await this.refresh()):this.showToast(`Failed to delete: ${n.error}`,"error")}async handleRestore(t,e){const n=await this.crudManager.restore(t,e);n.success?(this.showToast("Entity restored successfully","success"),await this.refresh()):this.showToast(`Failed to restore: ${n.error}`,"error")}showForm(t,e=null){const n=this.container.querySelector("#formContainer"),s=new EntityForm({crudManager:this.crudManager,collection:t,entityId:e,onSuccess:async()=>{n.innerHTML="",this.showToast(e?"Entity updated!":"Entity created!","success"),await this.refresh()},onCancel:()=>{n.innerHTML=""}});s.render().then(t=>{n.innerHTML=`<div class="form-overlay">${t}</div>`;const e=n.querySelector(".entity-form-container");s.initialize(e)})}showToast(t,e){window.toast?window.toast[e](t):alert(t)}formatDate(t){if(!t)return"Unknown";let e;e=t.toDate?t.toDate():new Date(t);const n=new Date-e,s=Math.floor(n/864e5);return 0===s?"Today":1===s?"Yesterday":s<7?`${s} days ago`:s<30?`${Math.floor(s/7)} weeks ago`:s<365?`${Math.floor(s/30)} months ago`:e.toLocaleDateString()}truncate(t,e){return!t||t.length<=e?t:t.substring(0,e)+"..."}}export{UserDashboard};"undefined"!=typeof window&&(window.UserDashboard=UserDashboard);