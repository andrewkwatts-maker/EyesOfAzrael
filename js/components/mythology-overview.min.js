class MythologyOverview{constructor(t={}){this.db=t.db||window.firebase&&window.firebase.firestore(),this.router=t.router}async render(t){try{const{mythology:n}=t,e=await this.loadMythology(n);if(!e)return this.renderNotFound(n);const i=await this.loadEntityCounts(n);return this.generateHTML(e,i)}catch(t){throw t}}async loadMythology(t){if(!this.db)throw new Error("Firebase Firestore not initialized");const n=await this.db.collection("mythologies").doc(t).get();return n.exists?{id:n.id,...n.data()}:null}async loadEntityCounts(t){const n=[{collection:"deities",singular:"deity",plural:"deities",icon:"üëë"},{collection:"heroes",singular:"hero",plural:"heroes",icon:"ü¶∏"},{collection:"creatures",singular:"creature",plural:"creatures",icon:"üêâ"},{collection:"cosmology",singular:"cosmology",plural:"cosmology",icon:"üåå"},{collection:"rituals",singular:"ritual",plural:"rituals",icon:"üïØÔ∏è"},{collection:"herbs",singular:"herb",plural:"herbs",icon:"üåø"},{collection:"texts",singular:"text",plural:"texts",icon:"üìú"},{collection:"symbols",singular:"symbol",plural:"symbols",icon:"‚ö°"},{collection:"items",singular:"item",plural:"items",icon:"‚öîÔ∏è"},{collection:"places",singular:"place",plural:"places",icon:"üèõÔ∏è"},{collection:"magic",singular:"magic",plural:"magic",icon:"‚ú®"}],e={};for(const i of n)try{const n=await this.db.collection(i.collection).where("mythology","==",t).get();e[i.collection]={count:n.size,...i}}catch(t){e[i.collection]={count:0,...i}}return e}generateHTML(t,n){const e=t.colors||{},i=e.primary||"#667eea",s=e.secondary||"#764ba2";return`\n            <div class="mythology-overview" data-mythology="${t.id}">\n                \x3c!-- Hero Section --\x3e\n                <div class="mythology-hero" style="--primary-color: ${i}; --secondary-color: ${s};">\n                    <div class="mythology-hero-background"></div>\n                    <div class="mythology-hero-content">\n                        <div class="mythology-icon-large">${t.icon||"üìö"}</div>\n                        <h1 class="mythology-title">${this.escapeHtml(t.name)} Mythology</h1>\n                        ${t.description?`\n                            <p class="mythology-description">${this.escapeHtml(t.description)}</p>\n                        `:""}\n\n                        <div class="mythology-meta-info">\n                            ${t.region?`\n                                <div class="meta-item">\n                                    <span class="meta-label">Region:</span>\n                                    <span class="meta-value">${this.escapeHtml(t.region)}</span>\n                                </div>\n                            `:""}\n                            ${t.period?`\n                                <div class="meta-item">\n                                    <span class="meta-label">Period:</span>\n                                    <span class="meta-value">${this.escapeHtml(t.period)}</span>\n                                </div>\n                            `:""}\n                            ${t.language?`\n                                <div class="meta-item">\n                                    <span class="meta-label">Language:</span>\n                                    <span class="meta-value">${this.escapeHtml(t.language)}</span>\n                                </div>\n                            `:""}\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Stats Dashboard --\x3e\n                <div class="entity-stats-dashboard">\n                    <h2 class="section-title">Content Statistics</h2>\n                    <div class="stats-grid">\n                        ${this.renderStatCards(n)}\n                    </div>\n                </div>\n\n                \x3c!-- Entity Type Grid --\x3e\n                <div class="entity-types-section">\n                    <h2 class="section-title">Explore by Category</h2>\n                    <div class="entity-types-grid">\n                        ${this.renderEntityTypeCards(t.id,n)}\n                    </div>\n                </div>\n\n                ${t.fullDescription?`\n                    <div class="mythology-details-section">\n                        <h2 class="section-title">About ${this.escapeHtml(t.name)} Mythology</h2>\n                        <div class="mythology-full-description">\n                            ${this.escapeHtml(t.fullDescription)}\n                        </div>\n                    </div>\n                `:""}\n            </div>\n        `}renderStatCards(t){return`\n            <div class="stat-card">\n                <div class="stat-number">${Object.values(t).reduce((t,n)=>t+n.count,0)}</div>\n                <div class="stat-label">Total Entities</div>\n            </div>\n            ${["deities","heroes","creatures"].map(n=>t[n]).filter(t=>t&&t.count>0).map(t=>`\n                <div class="stat-card">\n                    <div class="stat-icon">${t.icon}</div>\n                    <div class="stat-number">${t.count}</div>\n                    <div class="stat-label">${this.capitalize(t.plural)}</div>\n                </div>\n            `).join("")}\n        `}renderEntityTypeCards(t,n){const e=Object.values(n).filter(t=>t.count>0).sort((t,n)=>n.count-t.count);return 0===e.length?'\n                <div class="empty-state">\n                    <p>No entities available for this mythology yet.</p>\n                </div>\n            ':e.map(n=>`\n            <a href="#/mythology/${t}/${n.plural}" class="entity-type-card">\n                <div class="entity-type-icon">${n.icon}</div>\n                <div class="entity-type-name">${this.capitalize(n.plural)}</div>\n                <div class="entity-type-count">${n.count} ${1===n.count?n.singular:n.plural}</div>\n                <div class="entity-type-arrow">‚Üí</div>\n            </a>\n        `).join("")}renderNotFound(t){return`\n            <div class="error-container">\n                <div class="error-icon">üîç</div>\n                <h2>Mythology Not Found</h2>\n                <p class="error-message">\n                    The mythology "${this.escapeHtml(t)}" could not be found.\n                </p>\n                <div class="error-actions">\n                    <a href="#/" class="btn-primary">Browse Mythologies</a>\n                </div>\n            </div>\n        `}capitalize(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}escapeHtml(t){if(!t)return"";const n=document.createElement("div");return n.textContent=t,n.innerHTML}}window.MythologyOverview=MythologyOverview;