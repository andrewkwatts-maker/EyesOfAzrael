class SearchUI{constructor(e,t,n={}){this.corpusSearch=e,this.renderer=t,this.options={containerId:"search-container",resultsContainerId:"search-results",defaultDisplayMode:"grid",enableVoiceSearch:!1,showSuggestions:!0,...n},this.currentResults=[],this.currentQuery="",this.currentFilters={},this.displayMode=this.options.defaultDisplayMode}init(){this.renderSearchInterface(),this.attachEventListeners()}renderSearchInterface(){const e=document.getElementById(this.options.containerId);e&&(e.innerHTML=`\n            <div class="search-ui">\n                \x3c!-- Search Bar --\x3e\n                <div class="search-bar">\n                    <div class="search-input-wrapper">\n                        <input type="text"\n                               id="search-input"\n                               class="search-input"\n                               placeholder="Search entities, terms, languages, sources..."\n                               autocomplete="off"\n                               aria-label="Search"\n                               aria-describedby="search-suggestions">\n\n                        <button id="search-mode-toggle"\n                                class="search-mode-btn"\n                                title="Search Mode: Generic">\n                            <span class="mode-icon">üîç</span>\n                        </button>\n\n                        <button id="search-submit"\n                                class="search-submit-btn"\n                                aria-label="Search">\n                            Search\n                        </button>\n\n                        <button id="clear-search"\n                                class="clear-btn"\n                                aria-label="Clear search"\n                                style="display: none;">\n                            ‚úï\n                        </button>\n                    </div>\n\n                    \x3c!-- Suggestions Dropdown --\x3e\n                    <div id="search-suggestions"\n                         class="search-suggestions"\n                         role="listbox"\n                         style="display: none;">\n                    </div>\n                </div>\n\n                \x3c!-- Search Mode Selector --\x3e\n                <div id="search-mode-panel" class="search-mode-panel" style="display: none;">\n                    <label>\n                        <input type="radio" name="search-mode" value="generic" checked>\n                        <span>Generic - Search all fields</span>\n                    </label>\n                    <label>\n                        <input type="radio" name="search-mode" value="term">\n                        <span>Corpus Terms - Epithets, domains, symbols</span>\n                    </label>\n                    <label>\n                        <input type="radio" name="search-mode" value="language">\n                        <span>Language - Original scripts, transliterations</span>\n                    </label>\n                    <label>\n                        <input type="radio" name="search-mode" value="source">\n                        <span>Sources - Texts, citations, archaeology</span>\n                    </label>\n                    <label>\n                        <input type="radio" name="search-mode" value="advanced">\n                        <span>Advanced - Multiple criteria</span>\n                    </label>\n                </div>\n\n                \x3c!-- Filter Panel --\x3e\n                <div class="search-filters">\n                    <button id="toggle-filters" class="filter-toggle-btn">\n                        <span>Filters</span>\n                        <span class="filter-count" style="display: none;"></span>\n                    </button>\n\n                    <div id="filter-panel" class="filter-panel" style="display: none;">\n                        \x3c!-- Mythology Filter --\x3e\n                        <div class="filter-group">\n                            <label>Mythology</label>\n                            <select id="filter-mythology" multiple>\n                                <option value="">All</option>\n                                <option value="greek">Greek</option>\n                                <option value="roman">Roman</option>\n                                <option value="norse">Norse</option>\n                                <option value="egyptian">Egyptian</option>\n                                <option value="hindu">Hindu</option>\n                                <option value="buddhist">Buddhist</option>\n                                <option value="christian">Christian</option>\n                                <option value="islamic">Islamic</option>\n                                <option value="chinese">Chinese</option>\n                                <option value="japanese">Japanese</option>\n                                <option value="celtic">Celtic</option>\n                                <option value="babylonian">Babylonian</option>\n                                <option value="sumerian">Sumerian</option>\n                                <option value="persian">Persian</option>\n                                <option value="aztec">Aztec</option>\n                                <option value="mayan">Mayan</option>\n                                <option value="yoruba">Yoruba</option>\n                            </select>\n                        </div>\n\n                        \x3c!-- Entity Type Filter --\x3e\n                        <div class="filter-group">\n                            <label>Entity Type</label>\n                            <select id="filter-entity-type">\n                                <option value="">All</option>\n                                <option value="deities">Deities</option>\n                                <option value="heroes">Heroes</option>\n                                <option value="creatures">Creatures</option>\n                                <option value="cosmology">Cosmology</option>\n                                <option value="texts">Texts</option>\n                                <option value="rituals">Rituals</option>\n                                <option value="herbs">Herbs</option>\n                                <option value="symbols">Symbols</option>\n                                <option value="places">Places</option>\n                            </select>\n                        </div>\n\n                        \x3c!-- Importance Range --\x3e\n                        <div class="filter-group">\n                            <label>Importance (0-100)</label>\n                            <div class="range-inputs">\n                                <input type="number" id="filter-importance-min" min="0" max="100" value="0" placeholder="Min">\n                                <span>to</span>\n                                <input type="number" id="filter-importance-max" min="0" max="100" value="100" placeholder="Max">\n                            </div>\n                        </div>\n\n                        \x3c!-- Has Image Filter --\x3e\n                        <div class="filter-group">\n                            <label>\n                                <input type="checkbox" id="filter-has-image">\n                                Has Image\n                            </label>\n                        </div>\n\n                        <div class="filter-actions">\n                            <button id="apply-filters" class="btn-primary">Apply Filters</button>\n                            <button id="clear-filters" class="btn-secondary">Clear</button>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Results Controls --\x3e\n                <div class="results-controls" style="display: none;">\n                    <div class="results-info">\n                        <span id="results-count">0 results</span>\n                    </div>\n\n                    <div class="display-mode-switcher">\n                        <button class="display-mode-btn active" data-mode="grid" title="Grid View">\n                            <span>‚äû</span>\n                        </button>\n                        <button class="display-mode-btn" data-mode="list" title="List View">\n                            <span>‚ò∞</span>\n                        </button>\n                        <button class="display-mode-btn" data-mode="table" title="Table View">\n                            <span>‚äü</span>\n                        </button>\n                        <button class="display-mode-btn" data-mode="panel" title="Panel View">\n                            <span>‚ñ≠</span>\n                        </button>\n                    </div>\n\n                    <div class="sort-controls">\n                        <label for="sort-by">Sort:</label>\n                        <select id="sort-by">\n                            <option value="relevance">Relevance</option>\n                            <option value="name">Name (A-Z)</option>\n                            <option value="importance">Importance</option>\n                            <option value="popularity">Popularity</option>\n                        </select>\n                    </div>\n                </div>\n\n                \x3c!-- Results Container --\x3e\n                <div id="${this.options.resultsContainerId}" class="search-results">\n                    <div class="search-placeholder">\n                        <div class="placeholder-icon">üîç</div>\n                        <p>Enter a search query to find entities</p>\n                        <div class="search-examples">\n                            <p>Try searching for:</p>\n                            <button class="example-query" data-query="thunder">thunder</button>\n                            <button class="example-query" data-query="Zeus">Zeus</button>\n                            <button class="example-query" data-query="creation myth">creation myth</button>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Pagination --\x3e\n                <div id="pagination" class="pagination" style="display: none;">\n                </div>\n            </div>\n        `)}attachEventListeners(){const e=document.getElementById("search-input");e&&(e.addEventListener("input",this.handleSearchInput.bind(this)),e.addEventListener("keypress",e=>{"Enter"===e.key&&this.performSearch()}));const t=document.getElementById("search-submit");t&&t.addEventListener("click",()=>this.performSearch());const n=document.getElementById("clear-search");n&&n.addEventListener("click",()=>this.clearSearch());const s=document.getElementById("search-mode-toggle"),i=document.getElementById("search-mode-panel");s&&i&&s.addEventListener("click",()=>{i.style.display="none"===i.style.display?"block":"none"}),document.querySelectorAll('input[name="search-mode"]').forEach(e=>{e.addEventListener("change",e=>{this.currentFilters.mode=e.target.value,s.querySelector(".mode-icon").textContent={generic:"üîç",term:"üè∑Ô∏è",language:"üåê",source:"üìö",advanced:"‚öôÔ∏è"}[e.target.value]||"üîç",s.title=`Search Mode: ${e.target.value}`,i.style.display="none"})});const a=document.getElementById("toggle-filters"),o=document.getElementById("filter-panel");a&&o&&a.addEventListener("click",()=>{o.style.display="none"===o.style.display?"block":"none"});const l=document.getElementById("apply-filters");l&&l.addEventListener("click",()=>this.applyFilters());const r=document.getElementById("clear-filters");r&&r.addEventListener("click",()=>this.clearFilters());const c=document.querySelectorAll(".display-mode-btn");c.forEach(e=>{e.addEventListener("click",t=>{c.forEach(e=>e.classList.remove("active")),e.classList.add("active"),this.displayMode=e.dataset.mode,this.renderResults()})});const d=document.getElementById("sort-by");d&&d.addEventListener("change",e=>{this.currentFilters.sortBy=e.target.value,this.performSearch()}),document.querySelectorAll(".example-query").forEach(t=>{t.addEventListener("click",()=>{e.value=t.dataset.query,this.performSearch()})})}async handleSearchInput(e){const t=e.target.value,n=document.getElementById("clear-search");if(n&&(n.style.display=t?"block":"none"),!this.options.showSuggestions||t.length<2)return void this.hideSuggestions();const s=await this.corpusSearch.getSuggestions(t);this.showSuggestions(s)}showSuggestions(e){const t=document.getElementById("search-suggestions");t&&(0!==e.length?(t.innerHTML=e.map(e=>`\n            <div class="suggestion-item" role="option" tabindex="0">\n                ${this.highlightMatch(e,this.currentQuery)}\n            </div>\n        `).join(""),t.style.display="block",t.querySelectorAll(".suggestion-item").forEach(e=>{e.addEventListener("click",()=>{document.getElementById("search-input").value=e.textContent,this.hideSuggestions(),this.performSearch()})})):this.hideSuggestions())}hideSuggestions(){const e=document.getElementById("search-suggestions");e&&(e.style.display="none")}async performSearch(){const e=document.getElementById("search-input").value.trim();if(e){this.currentQuery=e,this.hideSuggestions(),this.showLoading();try{const t=await this.corpusSearch.search(e,{mode:this.currentFilters.mode||"generic",mythology:this.currentFilters.mythology||null,entityType:this.currentFilters.entityType||null,sortBy:this.currentFilters.sortBy||"relevance",limit:100});this.currentResults=t.items,this.renderResults(),this.updateResultsCount(t.total),document.querySelector(".results-controls").style.display="flex"}catch(e){this.showError("Search failed. Please try again.")}}}applyFilters(){const e=document.getElementById("filter-mythology").value,t=document.getElementById("filter-entity-type").value,n=parseInt(document.getElementById("filter-importance-min").value)||0,s=parseInt(document.getElementById("filter-importance-max").value)||100,i=document.getElementById("filter-has-image").checked;this.currentFilters={...this.currentFilters,mythology:e||null,entityType:t||null,importance:{min:n,max:s},hasImage:!!i||null},this.updateFilterCount(),this.performSearch()}clearFilters(){document.getElementById("filter-mythology").value="",document.getElementById("filter-entity-type").value="",document.getElementById("filter-importance-min").value="0",document.getElementById("filter-importance-max").value="100",document.getElementById("filter-has-image").checked=!1,this.currentFilters={mode:this.currentFilters.mode||"generic"},this.updateFilterCount(),this.performSearch()}updateFilterCount(){const e=Object.keys(this.currentFilters).filter(e=>"mode"!==e&&"sortBy"!==e).length,t=document.querySelector(".filter-count");t&&(e>0?(t.textContent=e,t.style.display="inline"):t.style.display="none")}renderResults(){const e=document.getElementById(this.options.resultsContainerId);if(!e)return;if(0===this.currentResults.length)return void(e.innerHTML=`\n                <div class="no-results">\n                    <div class="no-results-icon">üîç</div>\n                    <p>No results found for "${this.currentQuery}"</p>\n                    <p class="no-results-hint">Try different keywords or adjust your filters</p>\n                </div>\n            `);const t=this.renderer.render(this.currentResults,this.displayMode);e.innerHTML=t,this.attachResultClickHandlers()}attachResultClickHandlers(){document.querySelectorAll(".entity-link, .hoverable-term").forEach(e=>{e.addEventListener("click",e=>{})})}updateResultsCount(e){const t=document.getElementById("results-count");t&&(t.textContent=`${e} result${1!==e?"s":""}`)}showLoading(){const e=document.getElementById(this.options.resultsContainerId);e&&(e.innerHTML='\n                <div class="search-loading">\n                    <div class="spinner"></div>\n                    <p>Searching...</p>\n                </div>\n            ')}showError(e){const t=document.getElementById(this.options.resultsContainerId);t&&(t.innerHTML=`\n                <div class="search-error">\n                    <div class="error-icon">‚ö†Ô∏è</div>\n                    <p>${e}</p>\n                </div>\n            `)}clearSearch(){document.getElementById("search-input").value="",document.getElementById("clear-search").style.display="none",this.currentQuery="",this.currentResults=[],this.hideSuggestions();const e=document.getElementById(this.options.resultsContainerId);e&&(e.innerHTML='\n                <div class="search-placeholder">\n                    <div class="placeholder-icon">üîç</div>\n                    <p>Enter a search query to find entities</p>\n                </div>\n            '),document.querySelector(".results-controls").style.display="none"}highlightMatch(e,t){if(!t)return e;const n=new RegExp(`(${t})`,"gi");return e.replace(n,"<strong>$1</strong>")}}"undefined"!=typeof module&&module.exports&&(module.exports=SearchUI);