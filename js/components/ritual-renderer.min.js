class RitualRenderer{constructor(){this.db=firebase.firestore(),this.auth=firebase.auth(),this.cache=new Map}init(){document.querySelectorAll("[data-ritual-content]").forEach(e=>{const t=e.dataset.mythology,i=e.dataset.entity,s="true"===e.dataset.allowEdit;this.renderRitual(e,t,i,s)})}async fetchRitual(e,t){const i=`${e}/${t}`;if(this.cache.has(i))return this.cache.get(i);try{const s=this.db.collection("entities").doc(e).collection("ritual").doc(t),r=await s.get();if(!r.exists)return null;const n=r.data();return this.cache.set(i,n),n}catch(e){return null}}async renderRitual(e,t,i,s=!1){e.innerHTML='<div class="loading-spinner">Loading ritual data...</div>';const r=await this.fetchRitual(t,i);if(!r)return void(e.innerHTML='<div class="error-message">Ritual data not found. Content will load from HTML.</div>');let n="";n+=this.renderHeader(r),(r.purpose||r.significance)&&(n+=this.renderPurpose(r.purpose||r.significance)),r.timing&&(n+=this.renderTiming(r.timing)),r.procedure&&(n+=this.renderProcedure(r.procedure)),r.procedure&&r.procedure.participants&&r.procedure.participants.length>0&&(n+=this.renderParticipants(r.procedure.participants)),r.procedure&&r.procedure.materials&&r.procedure.materials.length>0&&(n+=this.renderMaterials(r.procedure.materials)),r.symbolism&&(n+=this.renderSymbolism(r.symbolism)),r.sections&&r.sections.length>0&&(n+=this.renderSections(r.sections)),r.sources&&r.sources.length>0&&(n+=this.renderSources(r.sources)),s&&(n+=this.renderEditButton(t,i)),e.innerHTML=n}renderHeader(e){return`\n            <div class="ritual-header">\n                <h1>${e.icon||"ğŸ­"} ${e.name}</h1>\n                ${e.subtitle?`<p class="subtitle">${e.subtitle}</p>`:""}\n                ${e.shortDescription?`<p class="short-description">${e.shortDescription}</p>`:""}\n                ${e.ritualType?`<span class="ritual-type-badge">${e.ritualType}</span>`:""}\n            </div>\n        `}renderPurpose(e){let t='<section class="ritual-purpose"><h2>ğŸ¯ Purpose & Significance</h2>';return t+=this.renderContent(e),t+="</section>",t}renderTiming(e){let t='<section class="ritual-timing"><h2>ğŸ“… Timing</h2>';return e.occasions&&e.occasions.length>0&&(t+='<div class="timing-card"><h3>Occasions</h3><ul>',e.occasions.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></div>"),e.frequency&&(t+=`<div class="timing-card"><h3>Frequency</h3><p>${e.frequency}</p></div>`),e.seasonalTiming&&(t+=`<div class="timing-card"><h3>Seasonal Timing</h3><p>${e.seasonalTiming}</p></div>`),e.duration&&(t+=`<div class="timing-card"><h3>Duration</h3><p>${e.duration}</p></div>`),t+="</section>",t}renderProcedure(e){if(!e.steps||0===e.steps.length)return"";let t='<section class="ritual-procedure"><h2>ğŸ“‹ Ritual Procedure</h2>';return t+='<div class="procedure-steps">',[...e.steps].sort((e,t)=>(e.step||0)-(t.step||0)).forEach((e,i)=>{t+=`\n                <div class="procedure-step">\n                    <div class="step-number">${e.step||i+1}</div>\n                    <div class="step-content">\n                        <h3>${e.instruction||e.title||`Step ${i+1}`}</h3>\n                        ${e.details?`<p>${e.details}</p>`:""}\n                        ${e.description?`<p>${e.description}</p>`:""}\n                    </div>\n                </div>\n            `}),t+="</div></section>",t}renderParticipants(e){let t='<section class="ritual-participants"><h2>ğŸ‘¥ Participants & Roles</h2>';return t+='<div class="participants-grid">',e.forEach(e=>{"string"==typeof e?t+=`<div class="participant-card"><p>${e}</p></div>`:e.role&&(t+=`\n                    <div class="participant-card">\n                        <h3>${e.role}</h3>\n                        ${e.description?`<p>${e.description}</p>`:""}\n                    </div>\n                `)}),t+="</div></section>",t}renderMaterials(e){let t='<section class="ritual-materials"><h2>ğŸ Required Materials & Offerings</h2>';return t+='<ul class="materials-list">',e.forEach(e=>{"string"==typeof e?t+=`<li>${e}</li>`:e.item&&(t+=`<li><strong>${e.item}</strong>`,e.purpose&&(t+=` - ${e.purpose}`),t+="</li>")}),t+="</ul></section>",t}renderSymbolism(e){let t='<section class="ritual-symbolism"><h2>ğŸ”® Symbolism</h2>';return"string"==typeof e?t+=`<p>${e}</p>`:"object"==typeof e&&(e.meaning&&(t+=`<div class="symbolism-card"><h3>Meaning</h3><p>${e.meaning}</p></div>`),e.elements&&e.elements.length>0&&(t+='<div class="symbolism-card"><h3>Symbolic Elements</h3><ul>',e.elements.forEach(e=>{"string"==typeof e?t+=`<li>${e}</li>`:e.element&&e.symbolism&&(t+=`<li><strong>${e.element}:</strong> ${e.symbolism}</li>`)}),t+="</ul></div>")),t+="</section>",t}renderSections(e){let t="";return e.forEach(e=>{t+='<section class="content-section">',t+=`<h2>${e.title}</h2>`,t+=this.renderContent(e.content),t+="</section>"}),t}renderContent(e){return Array.isArray(e)?e.map(e=>`<p>${e}</p>`).join(""):"string"==typeof e?`<p>${e}</p>`:""}renderSources(e){let t='<section class="sources-section"><h2>ğŸ“š Sources</h2><ul class="sources-list">';return e.forEach(e=>{"string"==typeof e?t+=`<li>${e}</li>`:e.title&&(t+=`<li><strong>${e.title}</strong>`,e.author&&(t+=` by ${e.author}`),e.date&&(t+=` (${e.date})`),t+="</li>")}),t+="</ul></section>",t}renderEditButton(e,t){return`\n            <div class="edit-controls">\n                <button class="btn-edit" onclick="window.location.href='/admin/edit-ritual.html?mythology=${e}&id=${t}'">\n                    âœï¸ Edit Ritual\n                </button>\n            </div>\n        `}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{(new RitualRenderer).init()}):(new RitualRenderer).init(),window.RitualRenderer=RitualRenderer;