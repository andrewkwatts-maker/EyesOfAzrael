!function(){"use strict";class t{constructor(t){this.cardElement=t.cardElement,this.entityId=t.entityId,this.entityType=t.entityType||"entity",this.createdBy=t.createdBy,this.mythology=t.mythology||null,this.redirectUrl=t.redirectUrl||"/theories/user-submissions/edit.html",this.icon=t.icon||"✏️",this.position=t.position||"top-right",this.size=t.size||"medium",this.showTooltip=!1!==t.showTooltip,this.currentUser=null,this.iconElement=null}async init(){try{await this.waitForAuth(),window.firebaseAuth&&window.firebaseAuth.onAuthStateChanged(t=>{this.currentUser=t,this.updateVisibility()}),this.render()}catch(t){}}async waitForAuth(){return new Promise(t=>{if(window.firebaseAuth&&window.firebaseAuth.auth)t();else{const e=setInterval(()=>{window.firebaseAuth&&window.firebaseAuth.auth&&(clearInterval(e),t())},100);setTimeout(()=>{clearInterval(e),t()},5e3)}})}isOwner(){return!(!this.currentUser||!this.createdBy)&&this.currentUser.uid===this.createdBy}render(){this.cardElement&&(this.iconElement=document.createElement("button"),this.iconElement.className=`edit-icon edit-icon--${this.position} edit-icon--${this.size}`,this.iconElement.setAttribute("type","button"),this.iconElement.setAttribute("aria-label","Edit entity"),this.showTooltip&&this.iconElement.setAttribute("title","Edit this entity"),this.iconElement.innerHTML=`\n                <span class="edit-icon__symbol">${this.icon}</span>\n            `,this.iconElement.addEventListener("click",t=>this.handleClick(t)),"static"===window.getComputedStyle(this.cardElement).position&&(this.cardElement.style.position="relative"),this.cardElement.appendChild(this.iconElement),this.updateVisibility())}handleClick(t){t.stopPropagation(),t.preventDefault();const e=this.buildEditUrl();window.location.href=e}buildEditUrl(){const t=new URLSearchParams;return t.set("action","edit"),t.set("id",this.entityId),t.set("type",this.entityType),this.mythology&&t.set("mythology",this.mythology),`${this.redirectUrl}?${t.toString()}`}updateVisibility(){this.iconElement&&(this.isOwner()?(this.iconElement.style.display="",this.iconElement.classList.add("edit-icon--visible")):(this.iconElement.style.display="none",this.iconElement.classList.remove("edit-icon--visible")))}destroy(){this.iconElement&&this.iconElement.parentNode&&this.iconElement.parentNode.removeChild(this.iconElement),this.iconElement=null}}window.renderEditIcon=function(e){const i=new t(e);return i.init(),i},document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-edit-icon]").forEach(t=>{const e={cardElement:t,entityId:t.getAttribute("data-entity-id"),entityType:t.getAttribute("data-entity-type")||"entity",createdBy:t.getAttribute("data-created-by"),mythology:t.getAttribute("data-mythology")||null,redirectUrl:t.getAttribute("data-edit-url")||void 0,icon:t.getAttribute("data-edit-icon-symbol")||void 0,position:t.getAttribute("data-edit-position")||void 0,size:t.getAttribute("data-edit-size")||void 0};window.renderEditIcon(e)})}),window.renderEditIconsOnCards=function(t,e={}){if(!t||0===t.length)return[];const i=[];return t.forEach(t=>{const n="string"==typeof t.element?document.querySelector(t.element):t.element;if(!n)return;const o={cardElement:n,entityId:t.entityId||n.getAttribute("data-entity-id"),entityType:t.entityType||n.getAttribute("data-entity-type")||e.entityType,createdBy:t.createdBy||n.getAttribute("data-created-by"),mythology:t.mythology||n.getAttribute("data-mythology")||e.mythology,redirectUrl:e.redirectUrl,icon:e.icon,position:e.position,size:e.size},s=window.renderEditIcon(o);i.push(s)}),i},"undefined"!=typeof module&&module.exports&&(module.exports=t),window.EditIcon=t}();