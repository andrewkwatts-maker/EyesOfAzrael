class ImageUploader{constructor(e,t={}){this.container=e,this.options={multiple:!1!==t.multiple,maxImages:t.maxImages||10,onAdd:t.onAdd||null,onRemove:t.onRemove||null},this.images=[],this.init()}init(){this.render(),this.attachEventListeners()}render(){this.container.innerHTML='\n            <div class="image-uploader">\n                <div class="image-url-input-section">\n                    <div class="url-input-header">\n                        <span class="input-icon">üñºÔ∏è</span>\n                        <span class="input-label">Add Images by URL</span>\n                    </div>\n                    <div class="url-input-fields">\n                        <input type="url"\n                               class="url-input"\n                               placeholder="Paste image URL (e.g., https://i.imgur.com/example.jpg)"\n                               data-url-input>\n                        <button type="button"\n                                class="url-add-btn"\n                                data-add-url>\n                            Add Image\n                        </button>\n                    </div>\n                    <div class="url-input-hints">\n                        <p class="hint-title">Supported image hosts:</p>\n                        <ul class="hint-list">\n                            <li><strong>Imgur:</strong> imgur.com (free, no account needed)</li>\n                            <li><strong>GitHub:</strong> raw.githubusercontent.com</li>\n                            <li><strong>Wikimedia:</strong> upload.wikimedia.org</li>\n                            <li><strong>Direct URLs:</strong> Any public image URL ending in .jpg, .png, .gif, .webp</li>\n                        </ul>\n                        <p class="hint-tip">üí° <strong>Tip:</strong> Upload to <a href="https://imgur.com/upload" target="_blank">Imgur</a> first, then paste the direct image link here</p>\n                    </div>\n                </div>\n\n                <div class="image-uploader-previews" data-previews></div>\n            </div>\n        '}attachEventListeners(){const e=this.container.querySelector("[data-url-input]");this.container.querySelector("[data-add-url]").addEventListener("click",()=>{this.addImageByUrl(e.value.trim())}),e.addEventListener("keypress",t=>{"Enter"===t.key&&(t.preventDefault(),this.addImageByUrl(e.value.trim()))})}async addImageByUrl(e){const t=this.container.querySelector("[data-url-input]");if(!e)return void this.showError("Please enter an image URL");if(this.images.length>=this.options.maxImages)return void this.showError(`Maximum ${this.options.maxImages} images allowed`);if(!this.isValidUrl(e))return void this.showError("Invalid URL format");if(!this.looksLikeImageUrl(e))return void this.showError("URL must point to an image file (.jpg, .png, .gif, .webp)");if(this.images.some(t=>t.url===e))return void this.showError("This image has already been added");const i=`image_${Date.now()}_${Math.random().toString(36).substring(2,9)}`;this.createLoadingPreview(i,e),await this.testImageUrl(e)?(this.images.push({id:i,url:e,caption:"",alt:""}),this.updatePreviewToLoaded(i,e),t.value="",this.options.onAdd&&this.options.onAdd({id:i,url:e})):this.showErrorInPreview(i,"Failed to load image. Check the URL and try again.")}isValidUrl(e){try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}}looksLikeImageUrl(e){const t=e.toLowerCase();return!![".jpg",".jpeg",".png",".gif",".webp",".svg"].some(e=>t.endsWith(e))||[/imgur\.com\/\w+/i,/i\.imgur\.com/i,/raw\.githubusercontent\.com/i,/upload\.wikimedia\.org/i,/github\.com.*\.(jpg|jpeg|png|gif|webp)/i].some(t=>t.test(e))}testImageUrl(e){return new Promise(t=>{const i=new Image;i.onload=()=>t(!0),i.onerror=()=>t(!1),i.src=e,setTimeout(()=>t(!1),1e4)})}createLoadingPreview(e,t){const i=this.container.querySelector("[data-previews]"),n=`\n            <div class="image-preview loading" data-image-id="${e}">\n                <div class="preview-image-container">\n                    <div class="preview-loading">\n                        <div class="loading-spinner"></div>\n                        <div class="loading-text">Loading image...</div>\n                    </div>\n                </div>\n                <div class="preview-url">${this.escapeHtml(this.truncateUrl(t))}</div>\n            </div>\n        `;i.insertAdjacentHTML("beforeend",n)}updatePreviewToLoaded(e,t){const i=this.container.querySelector(`[data-image-id="${e}"]`);if(!i)return;i.classList.remove("loading"),i.innerHTML=`\n            <div class="preview-image-container">\n                <img src="${this.escapeHtml(t)}" alt="Preview" class="preview-image">\n            </div>\n            <div class="preview-fields">\n                <input type="text"\n                       class="preview-input"\n                       placeholder="Caption (optional)"\n                       data-field="caption"\n                       data-image-id="${e}">\n                <input type="text"\n                       class="preview-input"\n                       placeholder="Alt text for accessibility"\n                       data-field="alt"\n                       data-image-id="${e}">\n                <div class="preview-url">${this.escapeHtml(this.truncateUrl(t))}</div>\n                <button type="button"\n                        class="preview-remove-btn"\n                        data-remove="${e}">\n                    Remove\n                </button>\n            </div>\n        `,i.addEventListener("input",t=>{if(t.target.dataset.field){const i=t.target.dataset.field,n=this.images.find(t=>t.id===e);n&&(n[i]=t.target.value)}});const n=i.querySelector("[data-remove]");n&&n.addEventListener("click",()=>{this.removeImage(e)})}showErrorInPreview(e,t){const i=this.container.querySelector(`[data-image-id="${e}"]`);if(!i)return;i.classList.remove("loading"),i.classList.add("error"),i.innerHTML=`\n            <div class="preview-error">\n                <div class="error-icon">‚ö†Ô∏è</div>\n                <div class="error-text">${this.escapeHtml(t)}</div>\n                <button type="button" class="error-close-btn" data-close-error="${e}">\n                    Remove\n                </button>\n            </div>\n        `;const n=i.querySelector("[data-close-error]");n&&n.addEventListener("click",()=>{i.remove()})}removeImage(e){if(!this.images.find(t=>t.id===e))return;this.images=this.images.filter(t=>t.id!==e);const t=this.container.querySelector(`[data-image-id="${e}"]`);t&&t.remove(),this.options.onRemove&&this.options.onRemove(e)}showError(e){const t=`\n            <div class="uploader-error" data-error>\n                <span class="error-icon">‚ö†Ô∏è</span>\n                <span class="error-message">${this.escapeHtml(e)}</span>\n                <button type="button" class="error-close" data-close-error>√ó</button>\n            </div>\n        `;this.container.insertAdjacentHTML("afterbegin",t);const i=this.container.querySelector("[data-error]"),n=i?.querySelector("[data-close-error]");n&&n.addEventListener("click",()=>{i.remove()}),setTimeout(()=>{i&&i.parentNode&&i.remove()},5e3)}truncateUrl(e,t=50){return e.length<=t?e:e.substring(0,t-3)+"..."}getImages(){return this.images.map(e=>({url:e.url,caption:e.caption,alt:e.alt}))}reset(){this.images=[];const e=this.container.querySelector("[data-previews]");e&&(e.innerHTML="")}loadExistingImages(e){Array.isArray(e)&&e.forEach((e,t)=>{const i=`existing_${t}`;this.images.push({id:i,url:e.url,caption:e.caption||"",alt:e.alt||""});const n=this.container.querySelector("[data-previews]"),a=`\n                <div class="image-preview" data-image-id="${i}">\n                    <div class="preview-image-container">\n                        <img src="${this.escapeHtml(e.url)}" alt="${this.escapeHtml(e.alt||"")}" class="preview-image">\n                    </div>\n                    <div class="preview-fields">\n                        <input type="text"\n                               class="preview-input"\n                               placeholder="Caption (optional)"\n                               value="${this.escapeHtml(e.caption||"")}"\n                               data-field="caption"\n                               data-image-id="${i}">\n                        <input type="text"\n                               class="preview-input"\n                               placeholder="Alt text for accessibility"\n                               value="${this.escapeHtml(e.alt||"")}"\n                               data-field="alt"\n                               data-image-id="${i}">\n                        <div class="preview-url">${this.escapeHtml(this.truncateUrl(e.url))}</div>\n                        <button type="button"\n                                class="preview-remove-btn"\n                                data-remove="${i}">\n                            Remove\n                        </button>\n                    </div>\n                </div>\n            `;n.insertAdjacentHTML("beforeend",a);const r=n.querySelector(`[data-image-id="${i}"]`);if(r){r.addEventListener("input",e=>{if(e.target.dataset.field){const t=e.target.dataset.field,n=this.images.find(e=>e.id===i);n&&(n[t]=e.target.value)}});const e=r.querySelector("[data-remove]");e&&e.addEventListener("click",()=>{this.removeImage(i)})}})}escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-image-uploader]").forEach(e=>{const t="false"!==e.dataset.multiple,i=parseInt(e.dataset.maxImages)||10;new ImageUploader(e,{multiple:t,maxImages:i})})}),"undefined"!=typeof module&&module.exports&&(module.exports=ImageUploader);