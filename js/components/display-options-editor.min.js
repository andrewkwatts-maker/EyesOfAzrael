class DisplayOptionsEditor{constructor(e,t=null){this.container=e,this.data=t||{displayOptions:{}},this.relationshipTypes=[{key:"relatedDeities",label:"Related Deities",icon:"‚ö°"},{key:"relatedHeroes",label:"Related Heroes",icon:"üó°Ô∏è"},{key:"relatedCreatures",label:"Related Creatures",icon:"üêâ"},{key:"relatedMyths",label:"Related Myths",icon:"üìú"},{key:"relatedPlaces",label:"Related Places",icon:"üèõÔ∏è"},{key:"relatedItems",label:"Related Items",icon:"‚öîÔ∏è"},{key:"relatedTexts",label:"Related Texts",icon:"üìñ"},{key:"relatedConcepts",label:"Related Concepts",icon:"üí≠"},{key:"family",label:"Family Relationships",icon:"üë•"},{key:"allies",label:"Allies & Associates",icon:"ü§ù"},{key:"enemies",label:"Enemies & Rivals",icon:"‚öîÔ∏è"}],this.displayModes=["grid","list","table","panel"],this.currentEditingType=null,this.previewTimeout=null,this.init()}init(){this.render(),this.attachEventListeners()}render(){this.container.innerHTML=`\n            <div class="display-options-editor">\n                <div class="editor-header">\n                    <h3>Related Entities Display Options</h3>\n                    <p class="editor-description">\n                        Configure how different types of related entities will be displayed on your page.\n                        Choose from grid layouts, lists, tables, or detailed panels.\n                    </p>\n                </div>\n\n                <div class="relationship-type-selector">\n                    <h4>Select Relationship Type to Configure</h4>\n                    <div class="type-buttons">\n                        ${this.renderRelationshipTypeButtons()}\n                    </div>\n                </div>\n\n                <div id="display-mode-configurator" class="display-mode-configurator" style="display: none;">\n                    \x3c!-- Dynamically populated based on selected relationship type --\x3e\n                </div>\n\n                <div class="configured-options-summary">\n                    <h4>Configured Display Options</h4>\n                    ${this.renderConfiguredSummary()}\n                </div>\n\n                <div class="editor-actions">\n                    <button type="button" class="btn-reset-all" data-action="reset-all">\n                        Reset All to Defaults\n                    </button>\n                    <button type="button" class="btn-preview-layout" data-action="preview">\n                        Preview Layout\n                    </button>\n                </div>\n\n                <div id="layout-preview-modal" class="layout-preview-modal" style="display: none;">\n                    <div class="modal-overlay" data-action="close-preview"></div>\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h3>Layout Preview</h3>\n                            <button type="button" class="btn-close" data-action="close-preview">√ó</button>\n                        </div>\n                        <div class="modal-body" id="preview-container">\n                            \x3c!-- Preview rendered here --\x3e\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}renderRelationshipTypeButtons(){return this.relationshipTypes.map(e=>{const t=this.data.displayOptions[e.key];return`\n                <button type="button"\n                        class="type-button ${this.currentEditingType===e.key?"active":""} ${t?"configured":""}"\n                        data-action="select-type"\n                        data-type="${e.key}">\n                    <span class="type-icon">${e.icon}</span>\n                    <span class="type-label">${e.label}</span>\n                    ${t?'<span class="configured-badge">‚úì</span>':""}\n                </button>\n            `}).join("")}renderModeConfigurator(e){const t=this.data.displayOptions[e]||this.getDefaultConfig(),n=this.relationshipTypes.find(t=>t.key===e);return`\n            <div class="configurator-content">\n                <div class="configurator-header">\n                    <h4>${n.icon} ${n.label}</h4>\n                    <button type="button"\n                            class="btn-remove-config"\n                            data-action="remove-config"\n                            data-type="${e}">\n                        Remove Configuration\n                    </button>\n                </div>\n\n                <div class="mode-selector">\n                    <label>Display Mode:</label>\n                    <div class="mode-options">\n                        ${this.renderModeOptions(e,t.mode)}\n                    </div>\n                </div>\n\n                <div class="mode-settings">\n                    ${this.renderModeSettings(e,t)}\n                </div>\n\n                <div class="live-preview">\n                    <h5>Live Preview</h5>\n                    <div class="preview-box" id="live-preview-${e}">\n                        ${this.renderModePreview(t)}\n                    </div>\n                </div>\n            </div>\n        `}renderModeOptions(e,t){return[{value:"grid",label:"Grid",icon:"‚ñ¶",description:"Cards in a responsive grid"},{value:"list",label:"List",icon:"‚â°",description:"Vertical list with optional grouping"},{value:"table",label:"Table",icon:"‚äû",description:"Tabular data with sortable columns"},{value:"panel",label:"Panel",icon:"‚ñ≠",description:"Detailed cards with full information"}].map(n=>`\n            <div class="mode-option ${t===n.value?"selected":""}"\n                 data-action="select-mode"\n                 data-type="${e}"\n                 data-mode="${n.value}">\n                <div class="mode-icon">${n.icon}</div>\n                <div class="mode-info">\n                    <div class="mode-name">${n.label}</div>\n                    <div class="mode-desc">${n.description}</div>\n                </div>\n            </div>\n        `).join("")}renderModeSettings(e,t){switch(t.mode||"grid"){case"grid":return this.renderGridSettings(e,t);case"list":return this.renderListSettings(e,t);case"table":return this.renderTableSettings(e,t);case"panel":return this.renderPanelSettings(e,t);default:return""}}renderGridSettings(e,t){const n=t.columns||4,i=t.sort||"name",a=!1!==t.showIcons,s=t.cardStyle||"compact";return`\n            <div class="settings-group grid-settings">\n                <div class="setting-item">\n                    <label for="grid-columns-${e}">Number of Columns</label>\n                    <div class="column-selector">\n                        ${[1,2,3,4,6].map(t=>`\n                            <button type="button"\n                                    class="column-btn ${n===t?"active":""}"\n                                    data-action="set-columns"\n                                    data-type="${e}"\n                                    data-value="${t}">\n                                ${t}\n                            </button>\n                        `).join("")}\n                    </div>\n                    <input type="range"\n                           id="grid-columns-${e}"\n                           class="column-slider"\n                           min="1"\n                           max="6"\n                           value="${n}"\n                           data-field="columns"\n                           data-type="${e}">\n                    <small class="form-hint">Controls how many items appear per row</small>\n                </div>\n\n                <div class="setting-item">\n                    <label for="grid-sort-${e}">Sort By</label>\n                    <select id="grid-sort-${e}"\n                            data-field="sort"\n                            data-type="${e}">\n                        <option value="name" ${"name"===i?"selected":""}>Name (A-Z)</option>\n                        <option value="name-desc" ${"name-desc"===i?"selected":""}>Name (Z-A)</option>\n                        <option value="importance" ${"importance"===i?"selected":""}>Importance</option>\n                        <option value="date" ${"date"===i?"selected":""}>Date</option>\n                        <option value="custom" ${"custom"===i?"selected":""}>Custom Order</option>\n                    </select>\n                </div>\n\n                <div class="setting-item">\n                    <label for="grid-card-style-${e}">Card Style</label>\n                    <select id="grid-card-style-${e}"\n                            data-field="cardStyle"\n                            data-type="${e}">\n                        <option value="compact" ${"compact"===s?"selected":""}>Compact</option>\n                        <option value="detailed" ${"detailed"===s?"selected":""}>Detailed</option>\n                        <option value="minimal" ${"minimal"===s?"selected":""}>Minimal</option>\n                    </select>\n                </div>\n\n                <div class="setting-item">\n                    <label class="checkbox-label">\n                        <input type="checkbox"\n                               id="grid-show-icons-${e}"\n                               ${a?"checked":""}\n                               data-field="showIcons"\n                               data-type="${e}">\n                        Show Icons\n                    </label>\n                </div>\n            </div>\n        `}renderListSettings(e,t){const n=t.categorize||"none",i=t.sort||"name";return`\n            <div class="settings-group list-settings">\n                <div class="setting-item">\n                    <label for="list-categorize-${e}">Group By</label>\n                    <select id="list-categorize-${e}"\n                            data-field="categorize"\n                            data-type="${e}">\n                        <option value="none" ${"none"===n?"selected":""}>No Grouping</option>\n                        <option value="by_domain" ${"by_domain"===n?"selected":""}>Domain/Type</option>\n                        <option value="by_mythology" ${"by_mythology"===n?"selected":""}>Mythology</option>\n                        <option value="by_importance" ${"by_importance"===n?"selected":""}>Importance</option>\n                        <option value="alphabetical" ${"alphabetical"===n?"selected":""}>Alphabetical (A-D, E-H, etc.)</option>\n                    </select>\n                    <small class="form-hint">Organize items into categories</small>\n                </div>\n\n                <div class="setting-item">\n                    <label for="list-sort-${e}">Sort By</label>\n                    <select id="list-sort-${e}"\n                            data-field="sort"\n                            data-type="${e}">\n                        <option value="name" ${"name"===i?"selected":""}>Name (A-Z)</option>\n                        <option value="name-desc" ${"name-desc"===i?"selected":""}>Name (Z-A)</option>\n                        <option value="importance" ${"importance"===i?"selected":""}>Importance</option>\n                        <option value="date" ${"date"===i?"selected":""}>Date</option>\n                    </select>\n                </div>\n\n                <div class="setting-item">\n                    <label class="checkbox-label">\n                        <input type="checkbox"\n                               id="list-show-icons-${e}"\n                               ${!1!==t.showIcons?"checked":""}\n                               data-field="showIcons"\n                               data-type="${e}">\n                        Show Icons\n                    </label>\n                </div>\n\n                <div class="setting-item">\n                    <label class="checkbox-label">\n                        <input type="checkbox"\n                               id="list-compact-${e}"\n                               ${t.compact?"checked":""}\n                               data-field="compact"\n                               data-type="${e}">\n                        Compact Mode\n                    </label>\n                    <small class="form-hint">Reduces spacing and shows minimal details</small>\n                </div>\n            </div>\n        `}renderTableSettings(e,t){const n=t.columns||["name","description","mythology"],i=!1!==t.sortable,a=t.filterable||!1,s=t.pagination||"none";return`\n            <div class="settings-group table-settings">\n                <div class="setting-item">\n                    <label>Columns to Display</label>\n                    <div class="column-checkboxes">\n                        ${[{value:"name",label:"Name"},{value:"description",label:"Description"},{value:"mythology",label:"Mythology"},{value:"domain",label:"Domain/Type"},{value:"symbols",label:"Symbols"},{value:"titles",label:"Titles"},{value:"relationship",label:"Relationship"},{value:"source",label:"Source"},{value:"theme",label:"Theme"}].map(t=>`\n                            <label class="checkbox-label column-checkbox">\n                                <input type="checkbox"\n                                       value="${t.value}"\n                                       ${n.includes(t.value)?"checked":""}\n                                       data-field="columns"\n                                       data-type="${e}"\n                                       data-column="${t.value}">\n                                ${t.label}\n                            </label>\n                        `).join("")}\n                    </div>\n                    <small class="form-hint">Select which columns to show in the table</small>\n                </div>\n\n                <div class="setting-item">\n                    <label class="checkbox-label">\n                        <input type="checkbox"\n                               id="table-sortable-${e}"\n                               ${i?"checked":""}\n                               data-field="sortable"\n                               data-type="${e}">\n                        Enable Column Sorting\n                    </label>\n                    <small class="form-hint">Allow users to sort by clicking column headers</small>\n                </div>\n\n                <div class="setting-item">\n                    <label class="checkbox-label">\n                        <input type="checkbox"\n                               id="table-filterable-${e}"\n                               ${a?"checked":""}\n                               data-field="filterable"\n                               data-type="${e}">\n                        Enable Filtering\n                    </label>\n                    <small class="form-hint">Add search/filter controls to the table</small>\n                </div>\n\n                <div class="setting-item">\n                    <label for="table-pagination-${e}">Pagination</label>\n                    <select id="table-pagination-${e}"\n                            data-field="pagination"\n                            data-type="${e}">\n                        <option value="none" ${"none"===s?"selected":""}>No Pagination</option>\n                        <option value="10" ${"10"===s?"selected":""}>10 per page</option>\n                        <option value="25" ${"25"===s?"selected":""}>25 per page</option>\n                        <option value="50" ${"50"===s?"selected":""}>50 per page</option>\n                    </select>\n                </div>\n            </div>\n        `}renderPanelSettings(e,t){const n=t.layout||"stacked";return`\n            <div class="settings-group panel-settings">\n                <div class="setting-item">\n                    <label for="panel-layout-${e}">Panel Layout</label>\n                    <select id="panel-layout-${e}"\n                            data-field="layout"\n                            data-type="${e}">\n                        <option value="stacked" ${"stacked"===n?"selected":""}>Stacked (vertical)</option>\n                        <option value="accordion" ${"accordion"===n?"selected":""}>Accordion</option>\n                        <option value="tabs" ${"tabs"===n?"selected":""}>Tabs</option>\n                    </select>\n                </div>\n\n                <div class="setting-item">\n                    <label class="checkbox-label">\n                        <input type="checkbox"\n                               id="panel-show-all-${e}"\n                               ${!1!==t.showAllDetails?"checked":""}\n                               data-field="showAllDetails"\n                               data-type="${e}">\n                        Show All Details\n                    </label>\n                    <small class="form-hint">Display comprehensive information in each panel</small>\n                </div>\n\n                <div class="setting-item">\n                    <label class="checkbox-label">\n                        <input type="checkbox"\n                               id="panel-expandable-${e}"\n                               ${t.expandable?"checked":""}\n                               data-field="expandable"\n                               data-type="${e}">\n                        Make Panels Expandable\n                    </label>\n                    <small class="form-hint">Allow users to expand/collapse individual panels</small>\n                </div>\n            </div>\n        `}renderModePreview(e){const t=[{name:"Zeus",description:"King of the gods",mythology:"Greek",icon:"‚ö°"},{name:"Hera",description:"Queen of the gods",mythology:"Greek",icon:"üëë"},{name:"Apollo",description:"God of light and music",mythology:"Greek",icon:"‚òÄÔ∏è"},{name:"Artemis",description:"Goddess of the hunt",mythology:"Greek",icon:"üèπ"}];switch(e.mode||"grid"){case"grid":return this.renderGridPreview(t,e);case"list":return this.renderListPreview(t,e);case"table":return this.renderTablePreview(t,e);case"panel":return this.renderPanelPreview(t,e);default:return"<p>Select a display mode to see preview</p>"}}renderGridPreview(e,t){const n=t.columns||4,i=!1!==t.showIcons;return`\n            <div class="preview-grid" style="grid-template-columns: repeat(${n}, 1fr);">\n                ${e.map(e=>`\n                    <div class="preview-card">\n                        ${i?`<div class="preview-icon">${e.icon}</div>`:""}\n                        <div class="preview-name">${e.name}</div>\n                        ${"minimal"!==t.cardStyle?`<div class="preview-desc">${e.description}</div>`:""}\n                    </div>\n                `).join("")}\n            </div>\n        `}renderListPreview(e,t){const n=!1!==t.showIcons,i=t.compact||!1;return`\n            <div class="preview-list ${i?"compact":""}">\n                ${e.map(e=>`\n                    <div class="preview-list-item">\n                        ${n?`<span class="preview-icon">${e.icon}</span>`:""}\n                        <span class="preview-name">${e.name}</span>\n                        ${i?"":`<span class="preview-desc">${e.description}</span>`}\n                    </div>\n                `).join("")}\n            </div>\n        `}renderTablePreview(e,t){const n=t.columns||["name","description","mythology"];return`\n            <table class="preview-table">\n                <thead>\n                    <tr>\n                        ${n.map(e=>`<th>${this.capitalize(e)}</th>`).join("")}\n                    </tr>\n                </thead>\n                <tbody>\n                    ${e.map(e=>`\n                        <tr>\n                            ${n.map(t=>`<td>${e[t]||"-"}</td>`).join("")}\n                        </tr>\n                    `).join("")}\n                </tbody>\n            </table>\n        `}renderPanelPreview(e,t){const n=!1!==t.showAllDetails;return`\n            <div class="preview-panels">\n                ${e.slice(0,2).map(e=>`\n                    <div class="preview-panel">\n                        <h5>${e.icon} ${e.name}</h5>\n                        <p>${e.description}</p>\n                        ${n?`<small>Mythology: ${e.mythology}</small>`:""}\n                    </div>\n                `).join("")}\n            </div>\n        `}renderConfiguredSummary(){const e=Object.keys(this.data.displayOptions);return 0===e.length?'<p class="no-config">No custom display options configured. Default settings will be used.</p>':`\n            <div class="summary-list">\n                ${e.map(e=>{const t=this.data.displayOptions[e],n=this.relationshipTypes.find(t=>t.key===e);return n?`\n                        <div class="summary-item">\n                            <span class="summary-icon">${n.icon}</span>\n                            <span class="summary-label">${n.label}:</span>\n                            <span class="summary-mode">${this.capitalize(t.mode)}</span>\n                            <span class="summary-details">${this.getConfigSummary(t)}</span>\n                            <button type="button"\n                                    class="btn-edit-summary"\n                                    data-action="select-type"\n                                    data-type="${e}">\n                                Edit\n                            </button>\n                        </div>\n                    `:""}).join("")}\n            </div>\n        `}getConfigSummary(e){const t=[];return"grid"===e.mode&&e.columns&&t.push(`${e.columns} columns`),"list"===e.mode&&e.categorize&&"none"!==e.categorize&&t.push(`grouped ${e.categorize.replace("by_","by ")}`),"table"===e.mode&&e.columns&&t.push(`${e.columns.length} columns`),e.sort&&"name"!==e.sort&&t.push(`sorted by ${e.sort}`),t.length>0?`(${t.join(", ")})`:""}attachEventListeners(){this.container.addEventListener("click",this.handleClick.bind(this)),this.container.addEventListener("change",this.handleChange.bind(this)),this.container.addEventListener("input",this.handleInput.bind(this))}handleClick(e){const t=e.target.dataset.action||e.target.closest("[data-action]")?.dataset.action;if(!t)return;const n=e.target.closest("[data-action]");switch(t){case"select-type":this.selectType(n.dataset.type);break;case"select-mode":this.selectMode(n.dataset.type,n.dataset.mode);break;case"set-columns":this.setColumns(n.dataset.type,parseInt(n.dataset.value));break;case"remove-config":this.removeConfig(n.dataset.type);break;case"reset-all":this.resetAll();break;case"preview":this.showPreview();break;case"close-preview":this.closePreview()}}handleChange(e){const t=e.target.dataset.field,n=e.target.dataset.type;t&&n&&("columns"===t&&"checkbox"===e.target.type?this.updateTableColumns(n,e.target.dataset.column,e.target.checked):"checkbox"===e.target.type?this.updateField(n,t,e.target.checked):this.updateField(n,t,e.target.value))}handleInput(e){const t=e.target.dataset.field,n=e.target.dataset.type;t&&n&&"range"===e.target.type&&this.updateField(n,t,parseInt(e.target.value))}selectType(e){this.currentEditingType=e,this.data.displayOptions[e]||(this.data.displayOptions[e]=this.getDefaultConfig());const t=this.container.querySelector("#display-mode-configurator");t.innerHTML=this.renderModeConfigurator(e),t.style.display="block",this.container.querySelectorAll(".type-button").forEach(t=>{t.classList.toggle("active",t.dataset.type===e)}),t.scrollIntoView({behavior:"smooth",block:"nearest"})}selectMode(e,t){this.data.displayOptions[e]||(this.data.displayOptions[e]={}),this.data.displayOptions[e].mode=t;const n=this.getModeDefaults(t);Object.assign(this.data.displayOptions[e],n),this.refreshConfigurator(e),this.updatePreview(e)}setColumns(e,t){this.data.displayOptions[e]||(this.data.displayOptions[e]=this.getDefaultConfig()),this.data.displayOptions[e].columns=t,this.refreshConfigurator(e),this.updatePreview(e)}updateField(e,t,n){this.data.displayOptions[e]||(this.data.displayOptions[e]=this.getDefaultConfig()),this.data.displayOptions[e][t]=n,this.updatePreview(e)}updateTableColumns(e,t,n){this.data.displayOptions[e]||(this.data.displayOptions[e]=this.getDefaultConfig()),this.data.displayOptions[e].columns||(this.data.displayOptions[e].columns=[]);const i=this.data.displayOptions[e].columns;if(n&&!i.includes(t))i.push(t);else if(!n){const e=i.indexOf(t);e>-1&&i.splice(e,1)}this.updatePreview(e)}removeConfig(e){confirm(`Remove custom display configuration for ${this.relationshipTypes.find(t=>t.key===e)?.label}?`)&&(delete this.data.displayOptions[e],this.currentEditingType=null,this.render())}resetAll(){confirm("Reset all display options to defaults?")&&(this.data.displayOptions={},this.currentEditingType=null,this.render())}refreshConfigurator(e){const t=this.container.querySelector("#display-mode-configurator");t&&this.currentEditingType===e&&(t.innerHTML=this.renderModeConfigurator(e));const n=this.container.querySelector(".configured-options-summary");n&&(n.querySelector("h4").insertAdjacentHTML("afterend",this.renderConfiguredSummary()),n.querySelector(".summary-list, .no-config")?.remove())}updatePreview(e){clearTimeout(this.previewTimeout),this.previewTimeout=setTimeout(()=>{const t=this.container.querySelector(`#live-preview-${e}`);if(t){const n=this.data.displayOptions[e];t.innerHTML=this.renderModePreview(n)}},300)}showPreview(){const e=this.container.querySelector("#layout-preview-modal"),t=this.container.querySelector("#preview-container"),n=Object.keys(this.data.displayOptions);0===n.length?t.innerHTML="<p>No display options configured yet.</p>":t.innerHTML=n.map(e=>{const t=this.data.displayOptions[e],n=this.relationshipTypes.find(t=>t.key===e);return`\n                    <div class="preview-section">\n                        <h4>${n.icon} ${n.label}</h4>\n                        <div class="preview-content">\n                            ${this.renderModePreview(t)}\n                        </div>\n                    </div>\n                `}).join(""),e.style.display="flex",document.body.style.overflow="hidden"}closePreview(){this.container.querySelector("#layout-preview-modal").style.display="none",document.body.style.overflow=""}getDefaultConfig(){return{mode:"grid",columns:4,sort:"name",showIcons:!0}}getModeDefaults(e){return{mode:e,...{grid:{columns:4,sort:"name",showIcons:!0,cardStyle:"compact"},list:{categorize:"none",sort:"name",showIcons:!0,compact:!1},table:{columns:["name","description","mythology"],sortable:!0,filterable:!1,pagination:"none"},panel:{layout:"stacked",showAllDetails:!0,expandable:!1}}[e]}}getData(){return this.data}setData(e){this.data=e||{displayOptions:{}},this.render()}capitalize(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}}window.DisplayOptionsEditor=DisplayOptionsEditor;