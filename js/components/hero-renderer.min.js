class HeroRenderer{constructor(){this.db=firebase.firestore(),this.auth=firebase.auth(),this.cache=new Map}init(){document.querySelectorAll("[data-hero-content]").forEach(e=>{const t=e.dataset.mythology,r=e.dataset.entity,n="true"===e.dataset.allowEdit;this.renderHero(e,t,r,n)})}async fetchHero(e,t){const r=`${e}/${t}`;if(this.cache.has(r))return this.cache.get(r);try{const n=this.db.collection("entities").doc(e).collection("hero").doc(t),i=await n.get();if(!i.exists)return null;const s=i.data();return this.cache.set(r,s),s}catch(e){return null}}async renderHero(e,t,r,n=!1){e.innerHTML='<div class="loading-spinner">Loading hero data...</div>';const i=await this.fetchHero(t,r);if(!i)return void(e.innerHTML='<div class="error-message">Hero data not found. Content will load from HTML.</div>');let s="";s+=this.renderHeader(i),i.biography&&(s+=this.renderBiography(i.biography)),i.deeds&&i.deeds.length>0&&(s+=this.renderDeeds(i.deeds)),i.divineConnections&&(s+=this.renderDivineConnections(i.divineConnections)),i.worship&&(s+=this.renderWorship(i.worship)),i.legacy&&(s+=this.renderLegacy(i.legacy)),i.sections&&i.sections.length>0&&(s+=this.renderSections(i.sections)),i.sources&&i.sources.length>0&&(s+=this.renderSources(i.sources)),n&&(s+=this.renderEditButton(t,r)),e.innerHTML=s}renderHeader(e){return`\n            <div class="hero-header">\n                <h1>${e.icon||"â­"} ${e.name}</h1>\n                ${e.subtitle?`<p class="subtitle">${e.subtitle}</p>`:""}\n                ${e.shortDescription?`<p class="short-description">${e.shortDescription}</p>`:""}\n            </div>\n        `}renderBiography(e){let t='<section class="hero-biography"><h2>ğŸ“– Biography</h2>';return e.birth&&(t+=`<div class="biography-section"><h3>Birth & Origins</h3>${this.renderContent(e.birth)}</div>`),e.earlyLife&&(t+=`<div class="biography-section"><h3>Early Life</h3>${this.renderContent(e.earlyLife)}</div>`),e.majorEvents&&e.majorEvents.length>0&&(t+='<div class="biography-section"><h3>Major Life Events</h3><ul>',e.majorEvents.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></div>"),e.death&&(t+=`<div class="biography-section"><h3>Death & Apotheosis</h3>${this.renderContent(e.death)}</div>`),e.legacy&&(t+=`<div class="biography-section"><h3>Legacy</h3>${this.renderContent(e.legacy)}</div>`),t+="</section>",t}renderDeeds(e){let t='<section class="hero-deeds"><h2>âš”ï¸ Heroic Deeds</h2>';const r=[...e].sort((e,t)=>(e.order||0)-(t.order||0));return t+='<div class="deeds-timeline">',r.forEach((e,r)=>{t+=`\n                <div class="deed-card">\n                    <div class="deed-number">${e.order||r+1}</div>\n                    <h3>${e.title}</h3>\n                    ${this.renderContent(e.description)}\n                    ${e.outcome?`<p class="deed-outcome"><strong>Outcome:</strong> ${e.outcome}</p>`:""}\n                </div>\n            `}),t+="</div></section>",t}renderDivineConnections(e){let t='<section class="divine-connections"><h2>âœ¨ Divine Connections</h2>';return e.parentDivine&&(t+=`<div class="connection-card"><h3>Divine Parent</h3><p>${e.parentDivine}</p></div>`),e.parentMortal&&(t+=`<div class="connection-card"><h3>Mortal Parent</h3><p>${e.parentMortal}</p></div>`),e.patron&&(t+=`<div class="connection-card"><h3>Divine Patron</h3><p>${e.patron}</p></div>`),e.adversaries&&e.adversaries.length>0&&(t+='<div class="connection-card"><h3>Divine Adversaries</h3><ul>',e.adversaries.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></div>"),t+="</section>",t}renderWorship(e){let t='<section class="hero-worship"><h2>ğŸ™ Worship & Veneration</h2>';return e.cultCenters&&e.cultCenters.length>0&&(t+='<div class="worship-card"><h3>Cult Centers</h3><ul>',e.cultCenters.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></div>"),e.festivals&&e.festivals.length>0&&(t+='<div class="worship-card"><h3>Festivals</h3><ul>',e.festivals.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></div>"),e.offerings&&e.offerings.length>0&&(t+='<div class="worship-card"><h3>Ritual Offerings</h3><ul>',e.offerings.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></div>"),t+="</section>",t}renderLegacy(e){let t='<section class="hero-legacy"><h2>ğŸ“œ Legacy</h2>';return e.culturalImpact&&(t+=`<div class="legacy-card"><h3>Cultural Impact</h3>${this.renderContent(e.culturalImpact)}</div>`),e.modernReferences&&e.modernReferences.length>0&&(t+='<div class="legacy-card"><h3>Modern References</h3><ul>',e.modernReferences.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></div>"),t+="</section>",t}renderSections(e){let t="";return e.forEach(e=>{t+='<section class="content-section">',t+=`<h2>${e.title}</h2>`,t+=this.renderContent(e.content),t+="</section>"}),t}renderContent(e){return Array.isArray(e)?e.map(e=>`<p>${e}</p>`).join(""):"string"==typeof e?`<p>${e}</p>`:""}renderSources(e){let t='<section class="sources-section"><h2>ğŸ“š Sources</h2><ul class="sources-list">';return e.forEach(e=>{"string"==typeof e?t+=`<li>${e}</li>`:e.title&&(t+=`<li><strong>${e.title}</strong>`,e.author&&(t+=` by ${e.author}`),e.date&&(t+=` (${e.date})`),t+="</li>")}),t+="</ul></section>",t}renderEditButton(e,t){return`\n            <div class="edit-controls">\n                <button class="btn-edit" onclick="window.location.href='/admin/edit-hero.html?mythology=${e}&id=${t}'">\n                    âœï¸ Edit Hero\n                </button>\n            </div>\n        `}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{(new HeroRenderer).init()}):(new HeroRenderer).init(),window.HeroRenderer=HeroRenderer;