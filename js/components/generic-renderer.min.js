class GenericRenderer{constructor(){this.db=firebase.firestore(),this.auth=firebase.auth(),this.cache=new Map}init(){document.querySelectorAll("[data-content]").forEach(e=>{const t=e.dataset.type,n=e.dataset.mythology,r=e.dataset.entity,s="true"===e.dataset.allowEdit;this.renderContent(e,t,n,r,s)})}async fetchContent(e,t,n){const r=`${e}/${t}/${n}`;if(this.cache.has(r))return this.cache.get(r);try{const s=this.db.collection("entities").doc(t).collection(e).doc(n),i=await s.get();if(!i.exists)return null;const o=i.data();return this.cache.set(r,o),o}catch(e){return null}}async renderContent(e,t,n,r,s=!1){e.innerHTML='<div class="loading-spinner">Loading content...</div>';const i=await this.fetchContent(t,n,r);if(!i)return void(e.innerHTML='<div class="error-message">Content not found. Will load from HTML.</div>');let o="";o+=this.renderHeader(i,t),o+=this.renderTypeSpecific(i,t),i.sections&&i.sections.length>0&&(o+=this.renderSections(i.sections)),i.sources&&i.sources.length>0&&(o+=this.renderSources(i.sources)),s&&(o+=this.renderEditButton(t,n,r)),e.innerHTML=o}renderHeader(e,t){return`\n            <div class="content-header">\n                <h1>${e.icon||{herb:"ğŸŒ¿",symbol:"âš›ï¸",concept:"ğŸ’¡",figure:"ğŸ‘¤",text:"ğŸ“œ",location:"ğŸ“",magic:"âœ¨",path:"ğŸ›¤ï¸"}[t]||"â­"} ${e.name}</h1>\n                ${e.subtitle?`<p class="subtitle">${e.subtitle}</p>`:""}\n                ${e.shortDescription?`<p class="short-description">${e.shortDescription}</p>`:""}\n                <span class="entity-type-badge">${t}</span>\n            </div>\n        `}renderTypeSpecific(e,t){switch(t){case"herb":return this.renderHerb(e);case"symbol":return this.renderSymbol(e);case"concept":return this.renderConcept(e);case"figure":return this.renderFigure(e);case"text":return this.renderText(e);case"location":return this.renderLocation(e);case"magic":return this.renderMagic(e);default:return""}}renderHerb(e){let t="";return e.uses&&e.uses.length>0&&(t+='<section class="herb-uses"><h2>ğŸ¯ Uses & Applications</h2><ul>',e.uses.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></section>"),e.properties&&e.properties.length>0&&(t+='<section class="herb-properties"><h2>âš—ï¸ Properties</h2><ul>',e.properties.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></section>"),e.preparation&&e.preparation.length>0&&(t+='<section class="herb-preparation"><h2>ğŸ“‹ Preparation</h2><ul>',e.preparation.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></section>"),t}renderSymbol(e){let t="";return e.meanings&&e.meanings.length>0&&(t+='<section class="symbol-meanings"><h2>ğŸ”® Meanings</h2><ul>',e.meanings.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></section>"),t}renderConcept(e){let t="";return e.principles&&e.principles.length>0&&(t+='<section class="concept-principles"><h2>ğŸ“– Key Principles</h2><ul>',e.principles.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></section>"),e.applications&&e.applications.length>0&&(t+='<section class="concept-applications"><h2>ğŸ¯ Applications</h2><ul>',e.applications.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></section>"),t}renderFigure(e){let t="";return e.achievements&&e.achievements.length>0&&(t+='<section class="figure-achievements"><h2>ğŸ† Achievements</h2><ul>',e.achievements.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></section>"),t}renderText(e){let t="";return e.themes&&e.themes.length>0&&(t+='<section class="text-themes"><h2>ğŸ“š Themes</h2><ul>',e.themes.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></section>"),t}renderLocation(e){let t="";return e.coordinates&&(t+='<section class="location-coords"><h2>ğŸ“ Coordinates</h2>',t+=`<p>Lat: ${e.coordinates.lat}, Long: ${e.coordinates.lng}</p>`,t+="</section>"),t}renderMagic(e){let t="";return e.components&&e.components.length>0&&(t+='<section class="magic-components"><h2>ğŸ§ª Components</h2><ul>',e.components.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></section>"),t}renderSections(e){let t="";return e.forEach(e=>{t+='<section class="content-section">',t+=`<h2>${e.title}</h2>`,t+=this.renderContent(e.content),t+="</section>"}),t}renderContent(e){return Array.isArray(e)?e.map(e=>`<p>${e}</p>`).join(""):"string"==typeof e?`<p>${e}</p>`:""}renderSources(e){let t='<section class="sources-section"><h2>ğŸ“š Sources</h2><ul class="sources-list">';return e.forEach(e=>{"string"==typeof e?t+=`<li>${e}</li>`:e.title&&(t+=`<li><strong>${e.title}</strong>`,e.author&&(t+=` by ${e.author}`),e.date&&(t+=` (${e.date})`),t+="</li>")}),t+="</ul></section>",t}renderEditButton(e,t,n){return`\n            <div class="edit-controls">\n                <button class="btn-edit" onclick="window.location.href='/admin/edit-content.html?type=${e}&mythology=${t}&id=${n}'">\n                    âœï¸ Edit Content\n                </button>\n            </div>\n        `}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{(new GenericRenderer).init()}):(new GenericRenderer).init(),window.GenericRenderer=GenericRenderer;