class TheoryEditor{constructor(e,t=null,a={}){this.container=e,this.data=t||{title:"",panels:[],images:[],links:[],corpusSearches:[]},this.options={userId:a.userId||null,theoryId:a.theoryId||null,useImageUploader:!1!==a.useImageUploader},this.imageUploader=null,this.init()}init(){this.render(),this.attachEventListeners(),this.initializeImageUploader()}render(){this.container.innerHTML=`\n            <div class="theory-editor">\n                \x3c!-- Title Section --\x3e\n                <div class="editor-section">\n                    <label class="editor-label">Theory Title *</label>\n                    <input type="text"\n                           class="editor-title-input"\n                           placeholder="Enter a descriptive title"\n                           value="${this.escapeHtml(this.data.title)}"\n                           required>\n                </div>\n\n                \x3c!-- Panels Section --\x3e\n                <div class="editor-section">\n                    <div class="editor-section-header">\n                        <label class="editor-label">Content Panels</label>\n                        <button type="button" class="editor-add-btn" data-add="panel">\n                            + Add Panel\n                        </button>\n                    </div>\n                    <div class="editor-panels-container">\n                        ${this.renderPanels()}\n                    </div>\n                </div>\n\n                \x3c!-- Images Section --\x3e\n                <div class="editor-section">\n                    <div class="editor-section-header">\n                        <label class="editor-label">Images</label>\n                        ${this.options.useImageUploader?"":'<button type="button" class="editor-add-btn" data-add="image">+ Add Image</button>'}\n                    </div>\n                    <div class="editor-images-container">\n                        ${this.options.useImageUploader?'<div id="theory-image-uploader"></div>':this.renderImages()}\n                    </div>\n                </div>\n\n                \x3c!-- Links Section --\x3e\n                <div class="editor-section">\n                    <div class="editor-section-header">\n                        <label class="editor-label">External Links</label>\n                        <button type="button" class="editor-add-btn" data-add="link">\n                            + Add Link\n                        </button>\n                    </div>\n                    <div class="editor-links-container">\n                        ${this.renderLinks()}\n                    </div>\n                </div>\n\n                \x3c!-- Corpus Searches Section --\x3e\n                <div class="editor-section">\n                    <div class="editor-section-header">\n                        <label class="editor-label">Corpus Searches</label>\n                        <button type="button" class="editor-add-btn" data-add="corpus">\n                            + Add Search\n                        </button>\n                    </div>\n                    <div class="editor-corpus-container">\n                        ${this.renderCorpusSearches()}\n                    </div>\n                    <small class="editor-hint">Add references to texts in the Eyes of Azrael corpus</small>\n                </div>\n            </div>\n        `}renderPanels(){return 0===this.data.panels.length?'<p class="editor-empty">No panels yet. Click "Add Panel" to start.</p>':this.data.panels.map((e,t)=>`\n            <div class="editor-panel" data-index="${t}">\n                <div class="editor-panel-header">\n                    <span class="editor-panel-number">#${t+1}</span>\n                    <input type="text"\n                           class="editor-panel-title"\n                           placeholder="Panel title (optional)"\n                           value="${this.escapeHtml(e.title||"")}"\n                           data-field="title"\n                           data-index="${t}">\n                    <button type="button" class="editor-remove-btn" data-remove="panel" data-index="${t}">\n                        Ã—\n                    </button>\n                </div>\n                <textarea class="editor-panel-content"\n                          placeholder="Panel content..."\n                          data-field="content"\n                          data-index="${t}"\n                          rows="6">${this.escapeHtml(e.content||"")}</textarea>\n            </div>\n        `).join("")}renderImages(){return 0===this.data.images.length?'<p class="editor-empty">No images yet. Click "Add Image" to upload or link.</p>':this.data.images.map((e,t)=>`\n            <div class="editor-image-item" data-index="${t}">\n                <div class="editor-image-preview">\n                    ${e.url?`<img src="${this.escapeHtml(e.url)}" alt="${this.escapeHtml(e.caption||"")}">`:'<div class="editor-image-placeholder">No URL</div>'}\n                </div>\n                <div class="editor-image-fields">\n                    <input type="text"\n                           class="editor-input"\n                           placeholder="Image URL"\n                           value="${this.escapeHtml(e.url||"")}"\n                           data-field="url"\n                           data-index="${t}"\n                           data-type="image">\n                    <input type="text"\n                           class="editor-input"\n                           placeholder="Caption (optional)"\n                           value="${this.escapeHtml(e.caption||"")}"\n                           data-field="caption"\n                           data-index="${t}"\n                           data-type="image">\n                    <input type="text"\n                           class="editor-input"\n                           placeholder="Alt text for accessibility"\n                           value="${this.escapeHtml(e.alt||"")}"\n                           data-field="alt"\n                           data-index="${t}"\n                           data-type="image">\n                    <button type="button" class="editor-remove-btn" data-remove="image" data-index="${t}">\n                        Remove\n                    </button>\n                </div>\n            </div>\n        `).join("")}renderLinks(){return 0===this.data.links.length?'<p class="editor-empty">No links yet. Click "Add Link" to reference external sources.</p>':this.data.links.map((e,t)=>`\n            <div class="editor-link-item" data-index="${t}">\n                <input type="text"\n                       class="editor-input"\n                       placeholder="Link title"\n                       value="${this.escapeHtml(e.title||"")}"\n                       data-field="title"\n                       data-index="${t}"\n                       data-type="link">\n                <input type="url"\n                       class="editor-input"\n                       placeholder="https://..."\n                       value="${this.escapeHtml(e.url||"")}"\n                       data-field="url"\n                       data-index="${t}"\n                       data-type="link">\n                <textarea class="editor-input"\n                          placeholder="Description (optional)"\n                          rows="2"\n                          data-field="description"\n                          data-index="${t}"\n                          data-type="link">${this.escapeHtml(e.description||"")}</textarea>\n                <button type="button" class="editor-remove-btn" data-remove="link" data-index="${t}">\n                    Remove\n                </button>\n            </div>\n        `).join("")}renderCorpusSearches(){return 0===this.data.corpusSearches.length?'<p class="editor-empty">No corpus searches yet. Click "Add Search" to reference texts.</p>':this.data.corpusSearches.map((e,t)=>`\n            <div class="editor-corpus-item" data-index="${t}">\n                <input type="text"\n                       class="editor-input"\n                       placeholder="Search query (e.g., 'flood mythology')"\n                       value="${this.escapeHtml(e.query||"")}"\n                       data-field="query"\n                       data-index="${t}"\n                       data-type="corpus">\n                <select class="editor-input"\n                        data-field="corpus"\n                        data-index="${t}"\n                        data-type="corpus">\n                    <option value="">All Corpora</option>\n                    <option value="greek" ${"greek"===e.corpus?"selected":""}>Greek Texts</option>\n                    <option value="norse" ${"norse"===e.corpus?"selected":""}>Norse Texts</option>\n                    <option value="egyptian" ${"egyptian"===e.corpus?"selected":""}>Egyptian Texts</option>\n                    <option value="hindu" ${"hindu"===e.corpus?"selected":""}>Hindu Texts</option>\n                    <option value="christian" ${"christian"===e.corpus?"selected":""}>Christian Texts</option>\n                    <option value="jewish" ${"jewish"===e.corpus?"selected":""}>Jewish Texts</option>\n                </select>\n                <input type="text"\n                       class="editor-input"\n                       placeholder="Description"\n                       value="${this.escapeHtml(e.description||"")}"\n                       data-field="description"\n                       data-index="${t}"\n                       data-type="corpus">\n                <button type="button" class="editor-remove-btn" data-remove="corpus" data-index="${t}">\n                    Remove\n                </button>\n            </div>\n        `).join("")}initializeImageUploader(){if(!this.options.useImageUploader)return;const e=this.container.querySelector("#theory-image-uploader");e&&window.ImageUploader&&(this.imageUploader=new ImageUploader(e,{userId:this.options.userId,theoryId:this.options.theoryId,multiple:!0,maxFiles:10,compress:!0,onUploadComplete:e=>{},onUploadError:e=>{}}),this.data.images&&this.data.images.length>0&&this.imageUploader.loadExistingImages(this.data.images))}attachEventListeners(){this.container.querySelector(".editor-title-input")?.addEventListener("input",e=>{this.data.title=e.target.value}),this.container.addEventListener("click",e=>{const t=e.target.closest("[data-add]");if(t){const e=t.dataset.add;this.addItem(e)}const a=e.target.closest("[data-remove]");if(a){const e=a.dataset.remove,t=parseInt(a.dataset.index);this.removeItem(e,t)}}),this.container.addEventListener("input",e=>{const t=e.target.dataset.field,a=parseInt(e.target.dataset.index),n=e.target.dataset.type;t&&!isNaN(a)&&("image"!==n||this.options.useImageUploader?"link"===n?this.data.links[a][t]=e.target.value:"corpus"===n&&(this.data.corpusSearches[a][t]=e.target.value):(this.data.images[a][t]=e.target.value,"url"===t&&this.render()))}),this.container.addEventListener("input",e=>{if(e.target.classList.contains("editor-panel-title")){const t=parseInt(e.target.dataset.index);this.data.panels[t].title=e.target.value}else if(e.target.classList.contains("editor-panel-content")){const t=parseInt(e.target.dataset.index);this.data.panels[t].content=e.target.value}})}addItem(e){switch(e){case"panel":this.data.panels.push({title:"",content:""});break;case"image":this.data.images.push({url:"",caption:"",alt:""});break;case"link":this.data.links.push({title:"",url:"",description:""});break;case"corpus":this.data.corpusSearches.push({query:"",corpus:"",description:""})}this.render()}removeItem(e,t){switch(e){case"panel":this.data.panels.splice(t,1);break;case"image":this.data.images.splice(t,1);break;case"link":this.data.links.splice(t,1);break;case"corpus":this.data.corpusSearches.splice(t,1)}this.render()}getData(){let e;return e=this.options.useImageUploader&&this.imageUploader?this.imageUploader.getImages():this.data.images.filter(e=>e.url.trim()),{title:this.data.title,panels:this.data.panels.filter(e=>e.content.trim()),images:e,links:this.data.links.filter(e=>e.url.trim()&&e.title.trim()),corpusSearches:this.data.corpusSearches.filter(e=>e.query.trim())}}hasPendingUploads(){return!(!this.options.useImageUploader||!this.imageUploader)&&this.imageUploader.hasPendingUploads()}async waitForUploads(){return this.options.useImageUploader&&this.imageUploader?await this.imageUploader.waitForUploads():Promise.resolve()}validate(){const e=this.getData();return e.title.trim()?0===e.panels.length?{valid:!1,error:"At least one content panel is required"}:{valid:!0}:{valid:!1,error:"Title is required"}}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}"undefined"!=typeof module&&module.exports&&(module.exports=TheoryEditor);