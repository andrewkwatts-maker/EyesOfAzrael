!function(){"use strict";class t{constructor(t){this.entityId=t.entityId,this.entityType=t.entityType,this.displayMode=t.displayMode||"compact",this.container=t.container,this.mythology=t.mythology||null,this.data=null,this.loader=t.loader||window.entityLoader,this.onLoad=t.onLoad||null,this.interactive=!1!==t.interactive}async render(){try{this.data=await this.loader.loadEntity(this.entityId,this.entityType);let t="";switch(this.displayMode){case"mini":t=this.renderMini();break;case"compact":default:t=this.renderCompact();break;case"full":t=this.renderFull()}if("string"==typeof this.container){const e=document.getElementById(this.container)||document.querySelector(this.container);e&&(e.innerHTML=t,this.container=e)}else this.container.innerHTML=t;return this.interactive&&this.attachEventListeners(),this.onLoad&&this.onLoad(this.data),!0}catch(t){return this.renderError(t),!1}}renderMini(){const t=this.getEntityUrl();return`\n                <span class="entity-card entity-card-mini"\n                      data-entity-id="${this.entityId}"\n                      data-entity-type="${this.entityType}">\n                    <a href="${t}" class="entity-mini-link" title="${this.escapeHtml(this.data.shortDescription||this.data.name)}">\n                        ${this.data.icon?`<span class="entity-icon">${this.data.icon}</span>`:""}\n                        <span class="entity-name">${this.escapeHtml(this.data.name)}</span>\n                    </a>\n                </span>\n            `}renderCompact(){const t=(this.data.colors||{}).primary||"#667eea",e=this.data.mythologies||[];return`\n                <div class="entity-card entity-card-compact glass-card"\n                     data-entity-id="${this.entityId}"\n                     data-entity-type="${this.entityType}"\n                     style="--entity-primary-color: ${t};">\n\n                    <div class="entity-card-header">\n                        ${this.data.icon?`<div class="entity-icon-large">${this.data.icon}</div>`:""}\n                        <div class="entity-info">\n                            <h3>\n                                <a href="${this.getEntityUrl()}">${this.escapeHtml(this.data.name)}</a>\n                            </h3>\n                            ${this.renderTypeBadge()}\n                            ${e.length>0?this.renderMythologyBadges(e):""}\n                        </div>\n                    </div>\n\n                    ${this.data.shortDescription?`\n                        <p class="entity-short-desc">${this.escapeHtml(this.data.shortDescription)}</p>\n                    `:""}\n\n                    ${this.renderCompactMetadata()}\n\n                    <div class="entity-card-footer">\n                        <a href="${this.getEntityUrl()}" class="btn-primary">View Details</a>\n                        ${this.interactive?`<button class="btn-secondary entity-expand" data-id="${this.entityId}" data-type="${this.entityType}">Expand</button>`:""}\n                    </div>\n                </div>\n            `}renderFull(){const t=this.data.colors||{},e=t.primary||"#667eea",n=t.secondary||"#764ba2";return`\n                <div class="entity-card entity-card-full glass-card"\n                     data-entity-id="${this.entityId}"\n                     data-entity-type="${this.entityType}">\n\n                    \x3c!-- Hero Section --\x3e\n                    <div class="entity-hero" style="background: linear-gradient(135deg, ${e}, ${n});">\n                        ${this.data.icon?`<div class="entity-icon-hero">${this.data.icon}</div>`:""}\n                        <h1 class="entity-title">${this.escapeHtml(this.data.name)}</h1>\n                        ${this.data.linguistic?.originalName?`\n                            <div class="entity-original-name">${this.data.linguistic.originalName}</div>\n                        `:""}\n                        ${this.data.shortDescription?`\n                            <p class="entity-subtitle">${this.escapeHtml(this.data.shortDescription)}</p>\n                        `:""}\n                        ${this.renderMythologyBadges(this.data.mythologies||[])}\n                    </div>\n\n                    \x3c!-- Main Content --\x3e\n                    <div class="entity-content">\n                        ${this.renderFullDescription()}\n                        ${this.renderLinguisticData()}\n                        ${this.renderTypeSpecificContent()}\n                        ${this.renderMetaphysicalProperties()}\n                        ${this.renderGeographicalData()}\n                        ${this.renderTemporalData()}\n                        ${this.renderRelatedEntities()}\n                        ${this.renderSources()}\n                        ${this.renderArchetypes()}\n                    </div>\n\n                    \x3c!-- Footer Actions --\x3e\n                    <div class="entity-card-footer">\n                        <a href="${this.getEntityUrl()}" class="btn-primary">Full Page</a>\n                        <button class="btn-secondary corpus-search" data-term="${this.escapeHtml(this.data.name)}">\n                            üìú Search Texts\n                        </button>\n                        <button class="btn-secondary share-entity" data-id="${this.entityId}">\n                            üîó Share\n                        </button>\n                    </div>\n                </div>\n            `}renderTypeBadge(){const t={deity:"üëë",item:"‚öîÔ∏è",place:"üèõÔ∏è",concept:"üí≠",magic:"‚ú®",creature:"üêâ",hero:"ü¶∏",archetype:"üé≠"}[this.entityType]||"üìå",e=this.capitalize(this.entityType);return`<span class="entity-type-badge" data-type="${this.entityType}">${t} ${e}</span>`}renderMythologyBadges(t){return t&&0!==t.length?`\n                <div class="entity-mythology-badges">\n                    ${t.map(t=>`\n                        <span class="mythology-badge" data-mythology="${t}">\n                            ${this.capitalize(t)}\n                        </span>\n                    `).join("")}\n                </div>\n            `:""}renderCompactMetadata(){const t=[];this.data.category&&t.push(`<strong>Category:</strong> ${this.capitalize(this.data.category.replace(/-/g," "))}`);const e=this.data.element||this.data.metaphysicalProperties?.primaryElement;if(e&&t.push(`<strong>Element:</strong> ${this.capitalize(e)}`),this.data.relatedCount){const e=Object.values(this.data.relatedCount).reduce((t,e)=>t+e,0);e>0&&t.push(`<strong>Connections:</strong> ${e}`)}return 0===t.length?"":`\n                <div class="entity-metadata-compact">\n                    ${t.map(t=>`<div class="metadata-item">${t}</div>`).join("")}\n                </div>\n            `}renderFullDescription(){const t=this.data.fullDescription||this.data.longDescription;return t?`\n                <div class="entity-section">\n                    <h2>Description</h2>\n                    <div class="entity-description">${this.renderMarkdown(t)}</div>\n                </div>\n            `:""}renderLinguisticData(){const t=this.data.linguistic;return t?`\n                <div class="entity-section linguistic-section">\n                    <h2>Linguistic Information</h2>\n                    <div class="property-grid">\n                        ${t.originalName?`\n                            <div class="property-card">\n                                <div class="property-label">Original Name</div>\n                                <div class="property-value">${t.originalName}</div>\n                            </div>\n                        `:""}\n                        ${t.transliteration?`\n                            <div class="property-card">\n                                <div class="property-label">Transliteration</div>\n                                <div class="property-value">${t.transliteration}</div>\n                            </div>\n                        `:""}\n                        ${t.pronunciation?`\n                            <div class="property-card">\n                                <div class="property-label">Pronunciation</div>\n                                <div class="property-value"><code>${t.pronunciation}</code></div>\n                            </div>\n                        `:""}\n                        ${t.etymology?.meaning?`\n                            <div class="property-card">\n                                <div class="property-label">Etymology</div>\n                                <div class="property-value">${this.escapeHtml(t.etymology.meaning)}</div>\n                            </div>\n                        `:""}\n                    </div>\n                </div>\n            `:""}renderTypeSpecificContent(){switch(this.entityType){case"item":return this.renderItemProperties();case"place":return this.renderPlaceProperties();case"deity":return this.renderDeityProperties();case"concept":return this.renderConceptProperties();case"magic":return this.renderMagicProperties();default:return""}}renderItemProperties(){return this.data.properties||this.data.uses?`\n                <div class="entity-section">\n                    <h2>Properties</h2>\n                    ${this.data.properties?`\n                        <div class="property-grid">\n                            ${this.data.properties.map(t=>`\n                                <div class="property-card">\n                                    <div class="property-label">${this.escapeHtml(t.name)}</div>\n                                    <div class="property-value">${this.escapeHtml(t.value)}</div>\n                                </div>\n                            `).join("")}\n                        </div>\n                    `:""}\n                    ${this.data.uses&&this.data.uses.length>0?`\n                        <div class="uses-section">\n                            <h3>Uses</h3>\n                            <div class="tag-list">\n                                ${this.data.uses.map(t=>`<span class="tag">${this.escapeHtml(t)}</span>`).join("")}\n                            </div>\n                        </div>\n                    `:""}\n                </div>\n            `:""}renderPlaceProperties(){const t=this.data.geography||this.data.geographical;return t?`\n                <div class="entity-section">\n                    <h2>Location Details</h2>\n                    <div class="property-grid">\n                        ${t.realm?`\n                            <div class="property-card">\n                                <div class="property-label">Realm</div>\n                                <div class="property-value">${this.escapeHtml(t.realm)}</div>\n                            </div>\n                        `:""}\n                        ${t.region?`\n                            <div class="property-card">\n                                <div class="property-label">Region</div>\n                                <div class="property-value">${this.escapeHtml(t.region)}</div>\n                            </div>\n                        `:""}\n                    </div>\n                </div>\n            `:""}renderDeityProperties(){return`\n                <div class="entity-section">\n                    <h2>Divine Attributes</h2>\n                    ${this.data.domains?`\n                        <div class="attribute-block">\n                            <h3>Domains</h3>\n                            <div class="tag-list">\n                                ${this.data.domains.map(t=>`<span class="tag">${this.escapeHtml(t)}</span>`).join("")}\n                            </div>\n                        </div>\n                    `:""}\n                    ${this.data.symbols?`\n                        <div class="attribute-block">\n                            <h3>Symbols</h3>\n                            <div class="tag-list">\n                                ${this.data.symbols.map(t=>`<span class="tag">${this.escapeHtml(t)}</span>`).join("")}\n                            </div>\n                        </div>\n                    `:""}\n                </div>\n            `}renderConceptProperties(){return""}renderMagicProperties(){return""}renderMetaphysicalProperties(){const t=this.data.metaphysicalProperties;return t&&0!==Object.keys(t).length?`\n                <div class="entity-section metaphysical-section">\n                    <h2>Metaphysical Properties</h2>\n                    <div class="property-grid">\n                        ${t.primaryElement?`\n                            <div class="property-card">\n                                <div class="property-label">Element</div>\n                                <div class="property-value">${this.capitalize(t.primaryElement)}</div>\n                            </div>\n                        `:""}\n                        ${t.planet?`\n                            <div class="property-card">\n                                <div class="property-label">Planet</div>\n                                <div class="property-value">${t.planet}</div>\n                            </div>\n                        `:""}\n                        ${t.sefirot&&t.sefirot.length>0?`\n                            <div class="property-card">\n                                <div class="property-label">Sefirot</div>\n                                <div class="property-value">${t.sefirot.map(t=>this.capitalize(t)).join(", ")}</div>\n                            </div>\n                        `:""}\n                        ${t.chakras&&t.chakras.length>0?`\n                            <div class="property-card">\n                                <div class="property-label">Chakras</div>\n                                <div class="property-value">${t.chakras.map(t=>this.capitalize(t)).join(", ")}</div>\n                            </div>\n                        `:""}\n                    </div>\n                </div>\n            `:""}renderGeographicalData(){const t=this.data.geographical;return t?`\n                <div class="entity-section geographical-section">\n                    <h2>Geography</h2>\n                    ${t.region?`<p><strong>Region:</strong> ${this.escapeHtml(t.region)}</p>`:""}\n                    ${t.modernCountries&&t.modernCountries.length>0?`\n                        <p><strong>Modern Countries:</strong> ${t.modernCountries.join(", ")}</p>\n                    `:""}\n                </div>\n            `:""}renderTemporalData(){const t=this.data.temporal;return t?`\n                <div class="entity-section temporal-section">\n                    <h2>Historical Context</h2>\n                    ${t.culturalPeriod?`<p><strong>Period:</strong> ${this.escapeHtml(t.culturalPeriod)}</p>`:""}\n                    ${t.historicalDate?.display?`<p><strong>Date:</strong> ${this.escapeHtml(t.historicalDate.display)}</p>`:""}\n                </div>\n            `:""}renderRelatedEntities(){const t=this.data.relatedEntities;return t&&Object.values(t).some(t=>t&&t.length>0)?`\n                <div class="entity-section related-entities-section">\n                    <h2>Related Entities</h2>\n                    ${Object.entries(t).map(([t,e])=>e&&0!==e.length?`\n                            <div class="related-category">\n                                <h3>${this.capitalize(t)}</h3>\n                                <div class="entity-grid">\n                                    ${e.map(t=>this.renderMiniEntityCard(t)).join("")}\n                                </div>\n                            </div>\n                        `:"").join("")}\n                </div>\n            `:""}renderMiniEntityCard(t){return`\n                <a href="${t.url||""}" class="entity-mini-card">\n                    ${t.icon?`<span class="entity-icon">${t.icon}</span>`:""}\n                    <span class="entity-name">${this.escapeHtml(t.name)}</span>\n                </a>\n            `}renderSources(){const t=this.data.sources;return t&&0!==t.length?`\n                <div class="entity-section sources-section">\n                    <h2>Ancient Sources</h2>\n                    <ul class="sources-list">\n                        ${t.map(t=>`\n                            <li>\n                                ${t.author?`<strong>${this.escapeHtml(t.author)}</strong>, `:""}\n                                <em>${this.escapeHtml(t.text||t.title)}</em>\n                                ${t.passage?`, ${this.escapeHtml(t.passage)}`:""}\n                                ${t.corpusUrl?`<a href="${t.corpusUrl}" class="corpus-link">üìú View</a>`:""}\n                            </li>\n                        `).join("")}\n                    </ul>\n                </div>\n            `:""}renderArchetypes(){const t=this.data.archetypes;return t&&0!==t.length?`\n                <div class="entity-section archetypes-section">\n                    <h2>Archetypes</h2>\n                    <div class="archetype-grid">\n                        ${t.map(t=>`\n                            <div class="archetype-card">\n                                <h3>${this.escapeHtml(t.name||t.category)}</h3>\n                                ${void 0!==t.score?`\n                                    <div class="archetype-score">\n                                        <div class="score-bar">\n                                            <div class="score-fill" style="width: ${t.score}%"></div>\n                                        </div>\n                                        <span class="score-value">${t.score}%</span>\n                                    </div>\n                                `:""}\n                                ${t.context?`<p>${this.escapeHtml(t.context)}</p>`:""}\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n            `:""}renderError(t){if("string"==typeof this.container){const t=document.getElementById(this.container)||document.querySelector(this.container);t&&(this.container=t)}this.container&&(this.container.innerHTML=`\n                    <div class="entity-card entity-card-error">\n                        <div class="error-icon">‚ö†Ô∏è</div>\n                        <p>Failed to load entity: ${this.entityId}</p>\n                        <p class="error-detail">${this.escapeHtml(t.message)}</p>\n                    </div>\n                `)}getEntityUrl(){return this.data&&this.data.url?this.data.url:`/mythos/${this.data?.primaryMythology||"shared"}/${this.entityType+"s"}/${this.entityId}.html`}attachEventListeners(){const t=this.container.querySelector(".entity-expand");t&&t.addEventListener("click",()=>{this.displayMode="full",this.render()});const e=this.container.querySelector(".corpus-search");e&&e.addEventListener("click",()=>{const t=e.dataset.term;window.location.href=`/corpus-search.html?term=${encodeURIComponent(t)}`});const n=this.container.querySelector(".share-entity");n&&n.addEventListener("click",()=>{this.shareEntity()})}async shareEntity(){const t=window.location.origin+this.getEntityUrl();try{navigator.share?await navigator.share({title:this.data.name,text:this.data.shortDescription,url:t}):navigator.clipboard&&(await navigator.clipboard.writeText(t),alert("Link copied to clipboard!"))}catch(t){}}renderMarkdown(t){return t?t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>"):""}capitalize(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}escapeHtml(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}}document.addEventListener("DOMContentLoaded",async()=>{window.entityLoader||(window.entityLoader=new EntityLoader,await window.entityLoader.initialize()),document.querySelectorAll("[data-entity-card]").forEach(e=>{new t({entityId:e.dataset.entityId,entityType:e.dataset.entityType,displayMode:e.dataset.displayMode||"compact",container:e,mythology:e.dataset.mythology||null}).render().catch(console.error)})}),window.EntityCard=t}();