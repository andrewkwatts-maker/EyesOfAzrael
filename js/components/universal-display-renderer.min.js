class UniversalDisplayRenderer{constructor(e={}){this.options={defaultDisplayMode:"grid",enableHover:!0,enableExpand:!0,enableCorpusLinks:!0,theme:"auto",...e}}render(e,n="grid",t=null){Array.isArray(e)||(e=[e]);const i={grid:this.renderGrid.bind(this),table:this.renderTable.bind(this),list:this.renderList.bind(this),panel:this.renderPanel.bind(this),inline:this.renderInline.bind(this)},a=(i[n]||i.grid)(e);return t&&("string"==typeof t?document.getElementById(t).innerHTML=a:t.innerHTML=a),a}renderGrid(e){const n=e.map(e=>this.renderGridCard(e)).join("");return`\n            <div class="entity-grid universal-grid"\n                 data-display-mode="grid"\n                 data-entity-count="${e.length}">\n                ${n}\n            </div>\n        `}renderGridCard(e){const n=e.gridDisplay||this.generateGridDisplay(e),t=this.options.enableHover?this.renderHoverInfo(e):"",i=this.renderEditIcon(e);return`\n            <div class="entity-card grid-card"\n                 data-entity-id="${e.id}"\n                 data-mythology="${e.mythology}"\n                 data-entity-type="${e.entityType}"\n                 data-importance="${e.importance||50}"\n                 data-created-by="${e.createdBy||""}">\n\n                ${i}\n\n                ${n.badge?`<div class="card-badge">${n.badge}</div>`:""}\n\n                <div class="card-icon">\n                    ${e.icon||"✨"}\n                </div>\n\n                <h3 class="card-title">\n                    <a href="#/mythology/${e.mythology}/${e.entityType}/${e.id}"\n                       class="entity-link">\n                        ${n.title||e.name}\n                    </a>\n                </h3>\n\n                ${n.subtitle?`<p class="card-subtitle">${n.subtitle}</p>`:""}\n\n                ${n.stats?this.renderStats(n.stats):""}\n\n                ${t}\n            </div>\n        `}renderStats(e){return`\n            <div class="card-stats">\n                ${e.map(e=>`\n                    <div class="stat-item">\n                        <span class="stat-label">${e.label}:</span>\n                        <span class="stat-value">${e.value}</span>\n                    </div>\n                `).join("")}\n            </div>\n        `}renderHoverInfo(e){const n=e.gridDisplay?.hoverInfo||e.hoverInfo;return n?`\n            <div class="hover-info">\n                ${n.quick?`<p class="hover-quick">${n.quick}</p>`:""}\n                ${n.domains?`\n                    <div class="hover-domains">\n                        ${n.domains.map(n=>this.renderHoverableTerm(n,"domain",e)).join(" ")}\n                    </div>\n                `:""}\n            </div>\n        `:""}renderHoverableTerm(e,n,t){return this.options.enableCorpusLinks?`\n            <a href="/search?term=${encodeURIComponent(e)}&mythology=${t.mythology}"\n               class="hoverable-term ${n}-term"\n               data-term="${e}"\n               data-type="${n}"\n               title="Search corpus for '${e}'">\n                ${e}\n            </a>\n        `:`<span class="term-badge">${e}</span>`}renderTable(e){if(0===e.length)return"<p>No entities to display</p>";const n=e[0],t=n.tableDisplay||this.generateTableDisplay(n),i=Object.entries(t.columns).map(([e,n])=>`\n            <th class="${n.sortable?"sortable":""}"\n                data-field="${e}"\n                data-sort-type="${n.type||"string"}">\n                ${n.label}\n                ${n.sortable?'<span class="sort-indicator"></span>':""}\n            </th>\n        `).join(""),a=e.map(e=>this.renderTableRow(e,t)).join("");return`\n            <div class="entity-table-container">\n                <table class="entity-table"\n                       data-display-mode="table"\n                       data-default-sort="${t.defaultSort||"name"}"\n                       data-default-order="${t.defaultOrder||"asc"}">\n                    <thead>\n                        <tr>${i}</tr>\n                    </thead>\n                    <tbody>\n                        ${a}\n                    </tbody>\n                </table>\n            </div>\n        `}renderTableRow(e,n){const t=Object.keys(n.columns).map(n=>{const t=this.getNestedValue(e,n);return`<td data-field="${n}">${this.formatTableCell(t,n,e)}</td>`}).join("");return`\n            <tr class="entity-row"\n                data-entity-id="${e.id}"\n                data-mythology="${e.mythology}">\n                ${t}\n            </tr>\n        `}formatTableCell(e,n,t){return Array.isArray(e)?e.slice(0,3).join(", ")+(e.length>3?"...":""):"name"===n?`<a href="#/mythology/${t.mythology}/${t.entityType}/${t.id}">${e}</a>`:"object"==typeof e&&null!==e?JSON.stringify(e):e||"—"}renderList(e){return`\n            <ul class="entity-list universal-list"\n                data-display-mode="list">\n                ${e.map(e=>this.renderListItem(e)).join("")}\n            </ul>\n        `}renderListItem(e){const n=e.listDisplay||this.generateListDisplay(e),t=this.options.enableExpand&&n.expandable;return`\n            <li class="entity-list-item ${t?"expandable":""}"\n                data-entity-id="${e.id}"\n                data-mythology="${e.mythology}">\n\n                <div class="list-item-main" ${t?"onclick=\"this.parentElement.classList.toggle('expanded')\"":""}>\n                    <span class="list-icon">${n.icon||e.icon||"•"}</span>\n                    <div class="list-content">\n                        <div class="list-primary">${n.primary||e.name}</div>\n                        ${n.secondary?`<div class="list-secondary">${n.secondary}</div>`:""}\n                        ${n.meta?`<div class="list-meta">${n.meta}</div>`:""}\n                    </div>\n                    ${t?'<span class="expand-indicator">▼</span>':""}\n                </div>\n\n                ${t&&n.expandedContent?`\n                    <div class="list-item-expanded">\n                        ${n.expandedContent}\n                    </div>\n                `:""}\n            </li>\n        `}renderPanel(e){return`\n            <div class="entity-panels"\n                 data-display-mode="panel">\n                ${e.map(e=>this.renderPanelCard(e)).join("")}\n            </div>\n        `}renderPanelCard(e){const n=e.panelDisplay||this.generatePanelDisplay(e),t=n.layout||"standard",i=(n.sections||[]).map(n=>this.renderPanelSection(n,e)).join("");return`\n            <article class="entity-panel panel-${t}"\n                     data-entity-id="${e.id}"\n                     data-mythology="${e.mythology}">\n\n                <header class="panel-header">\n                    <div class="panel-icon">${e.icon||"✨"}</div>\n                    <h2 class="panel-title">${e.name}</h2>\n                    ${e.subtitle?`<p class="panel-subtitle">${e.subtitle}</p>`:""}\n                </header>\n\n                <div class="panel-body">\n                    ${i}\n                </div>\n\n                ${e.relatedIds?.length>0?`\n                    <footer class="panel-footer">\n                        <h4>Related</h4>\n                        <div class="related-entities">\n                            ${e.relatedIds.slice(0,5).map(e=>`<a href="#/${e}" class="related-link">${e.split("_")[1]}</a>`).join("")}\n                        </div>\n                    </footer>\n                `:""}\n            </article>\n        `}renderPanelSection(e,n){const t={attributes:this.renderAttributesSection.bind(this),text:this.renderTextSection.bind(this),list:this.renderListSection.bind(this),grid:this.renderGridSection.bind(this)};return(t[e.type]||t.text)(e,n)}renderAttributesSection(e,n){return`\n            <section class="panel-section attributes-section">\n                <h3 class="section-title">${e.title}</h3>\n                <div class="attributes-grid">\n                    ${Object.entries(e.data||{}).map(([e,t])=>`\n                        <div class="attribute-item">\n                            <span class="attribute-label">${this.formatLabel(e)}:</span>\n                            <span class="attribute-value">\n                                ${Array.isArray(t)?t.map(t=>this.renderHoverableTerm(t,e,n)).join(", "):t}\n                            </span>\n                        </div>\n                    `).join("")}\n                </div>\n            </section>\n        `}renderTextSection(e,n){return`\n            <section class="panel-section text-section">\n                <h3 class="section-title">${e.title}</h3>\n                <div class="section-content">\n                    ${e.content}\n                </div>\n            </section>\n        `}renderListSection(e,n){return`\n            <section class="panel-section list-section">\n                <h3 class="section-title">${e.title}</h3>\n                <ul class="section-list">\n                    ${(e.items||[]).map(e=>`<li>${e}</li>`).join("")}\n                </ul>\n            </section>\n        `}renderGridSection(e,n){return`\n            <section class="panel-section grid-section">\n                <h3 class="section-title">${e.title}</h3>\n                <div class="section-grid">\n                    ${(e.items||[]).map(e=>`\n                        <div class="grid-item">${e}</div>\n                    `).join("")}\n                </div>\n            </section>\n        `}renderInline(e){return e.map(e=>`\n            <a href="#/mythology/${e.mythology}/${e.entityType}/${e.id}"\n               class="entity-inline"\n               data-entity-id="${e.id}"\n               title="${e.description}">\n                <span class="inline-icon">${e.icon}</span>\n                <span class="inline-name">${e.name}</span>\n            </a>\n        `).join(" ")}generateGridDisplay(e){return{title:e.name,subtitle:e.subtitle||"",image:e.image||null,badge:e.importance>80?"Major":null,stats:[{label:"Type",value:e.entityType},{label:"Mythology",value:e.mythology}],hoverInfo:{quick:e.description?.substring(0,100)+"...",domains:e.domains||e.corpusSearch?.domains||[]}}}generateTableDisplay(e){return{columns:{name:{label:"Name",sortable:!0},mythology:{label:"Mythology",sortable:!0},entityType:{label:"Type",sortable:!0},importance:{label:"Importance",sortable:!0,type:"number"}},defaultSort:"importance",defaultOrder:"desc"}}generateListDisplay(e){return{icon:e.icon||"•",primary:`${e.name} - ${e.subtitle||e.entityType}`,secondary:e.description?.substring(0,150),meta:e.mythology,expandable:!!e.longDescription,expandedContent:e.longDescription||e.description}}generatePanelDisplay(e){return{layout:"standard",sections:[{type:"text",title:"Description",content:e.description||e.longDescription},e.domains||e.symbols?{type:"attributes",title:"Attributes",data:{domains:e.domains,symbols:e.symbols}}:null].filter(Boolean)}}renderEditIcon(e){if(!this.canUserEdit(e))return"";const n=e.collection||this.inferCollection(e.entityType);return`\n            <button class="edit-icon-btn"\n                    data-entity-id="${e.id}"\n                    data-collection="${n}"\n                    aria-label="Edit ${e.name}"\n                    title="Edit this entity">\n                ✏️\n            </button>\n        `}canUserEdit(e){if("undefined"==typeof firebase||!firebase.auth)return!1;const n=firebase.auth().currentUser;return!!n&&e.createdBy===n.uid}inferCollection(e){return{deity:"deities",hero:"heroes",creature:"creatures",item:"items",place:"places",concept:"concepts",magic:"magic",ritual:"rituals",herb:"herbs",symbol:"symbols",text:"texts"}[e]||e+"s"}getNestedValue(e,n){return n.split(".").reduce((e,n)=>e?.[n],e)}formatLabel(e){return e.replace(/([A-Z])/g," $1").replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}}"undefined"!=typeof module&&module.exports&&(module.exports=UniversalDisplayRenderer);