class CosmologyRenderer{constructor(){this.db=firebase.firestore(),this.auth=firebase.auth()}async initializeAll(){const e=document.querySelectorAll("[data-cosmology-content]");for(const t of e)await this.initialize(t)}async initialize(e){const t=e.getAttribute("data-mythology"),i=e.getAttribute("data-entity"),n="true"===e.getAttribute("data-allow-edit");if(t&&i)try{e.innerHTML='<div class="loading-spinner">Loading cosmology data from Firebase...</div>';const s=await this.fetchCosmology(t,i);if(!s)return void(e.innerHTML='<div class="error-message">Cosmology data not found</div>');e.innerHTML=this.renderCosmology(s,n,t,i),n&&this.auth.currentUser&&this.attachEditListeners(e,t,i)}catch(t){e.innerHTML=`<div class="error-message">Error loading cosmology: ${t.message}</div>`}}async fetchCosmology(e,t){const i=this.db.collection("entities").doc(e).collection("cosmology").doc(t),n=await i.get();return n.exists?n.data():null}renderCosmology(e,t,i,n){let s="";return e.timeline&&e.timeline.length>0&&(s+=this.renderTimeline(e.timeline)),e.structure&&Object.keys(e.structure).length>0&&(s+=this.renderStructure(e.structure)),e.principles&&e.principles.length>0&&(s+=this.renderPrinciples(e.principles)),e.sections&&e.sections.length>0&&(s+=this.renderSections(e.sections)),t&&this.auth.currentUser&&(s+=`\n                <div class="edit-actions">\n                    <button class="btn-edit-cosmology" data-mythology="${i}" data-entity="${n}">\n                        ✏️ Suggest Edit\n                    </button>\n                </div>\n            `),s}renderTimeline(e){let t='<div class="cosmology-timeline">';return e.forEach((e,i)=>{t+=`\n                <div class="timeline-stage" data-stage="${i}">\n                    <div class="timeline-marker">${i+1}</div>\n                    <div class="timeline-content">\n                        <h3>${this.escapeHtml(e.title)}</h3>\n                        ${this.renderContent(e.description)}\n                    </div>\n                </div>\n            `}),t+="</div>",t}renderStructure(e){let t='<div class="cosmology-structure">';return e.realms&&e.realms.length>0&&(t+='<div class="structure-section"><h3>Realms</h3>',t+='<div class="realms-grid">',e.realms.forEach(e=>{t+=`\n                    <div class="realm-card">\n                        <h4>${this.escapeHtml(e.name)}</h4>\n                        <p>${this.escapeHtml(e.description)}</p>\n                        ${e.ruler?`<div class="realm-ruler">Ruled by: ${this.escapeHtml(e.ruler)}</div>`:""}\n                    </div>\n                `}),t+="</div></div>"),e.layers&&e.layers.length>0&&(t+='<div class="structure-section"><h3>Cosmic Layers</h3>',e.layers.forEach(e=>{t+=`\n                    <div class="layer-item">\n                        <strong>${this.escapeHtml(e.name)}</strong>: ${this.escapeHtml(e.description)}\n                    </div>\n                `}),t+="</div>"),t+="</div>",t}renderPrinciples(e){let t='<div class="cosmology-principles">';return e.forEach(e=>{t+=`\n                <div class="principle-card">\n                    <h4>${this.escapeHtml(e.name)}</h4>\n                    ${this.renderContent(e.description)}\n                </div>\n            `}),t+="</div>",t}renderSections(e){let t='<div class="cosmology-sections">';return e.forEach(e=>{t+=`\n                <div class="cosmology-section" data-section-id="${e.id}">\n                    <h3>${this.escapeHtml(e.title)}</h3>\n                    ${this.renderContent(e.content)}\n                </div>\n            `}),t+="</div>",t}renderContent(e){if(!e)return"";if("string"==typeof e)return`<p>${this.escapeHtml(e)}</p>`;if(Array.isArray(e)){let t="";return e.forEach(e=>{"paragraph"===e.type?t+=`<p>${this.escapeHtml(e.text)}</p>`:"list"===e.type?(t+="<ul>",e.items.forEach(e=>{t+=`<li>${this.escapeHtml(e)}</li>`}),t+="</ul>"):"heading"===e.type&&(t+=`<h${e.level}>${this.escapeHtml(e.text)}</h${e.level}>`)}),t}return""}attachEditListeners(e,t,i){const n=e.querySelector(".btn-edit-cosmology");n&&n.addEventListener("click",()=>{this.showEditModal(t,i)})}async showEditModal(e,t){if("undefined"==typeof EditEntityModal)return void alert("Edit functionality not available. Please ensure all scripts are loaded.");if(!window.EyesOfAzrael||!window.EyesOfAzrael.crudManager)return void alert("Edit functionality not available. Please ensure the app is properly initialized.");const i=new EditEntityModal(window.EyesOfAzrael.crudManager);await i.open(t,"cosmology")}escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}}document.addEventListener("DOMContentLoaded",async()=>{if("undefined"!=typeof firebase&&firebase.apps.length>0){const e=new CosmologyRenderer;await e.initializeAll()}}),"undefined"!=typeof module&&module.exports&&(module.exports=CosmologyRenderer);