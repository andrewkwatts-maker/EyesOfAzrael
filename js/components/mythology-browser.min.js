class MythologyBrowser{constructor(s={}){this.db=s.db||window.firebase&&window.firebase.firestore(),this.router=s.router,this.cache=null,this.cacheTimestamp=null,this.cacheTimeout=3e5}async render(s){try{const s=await this.loadMythologies();return s&&0!==s.length?this.generateHTML(s):this.renderEmpty()}catch(s){throw s}}async loadMythologies(){if(this.cache&&this.cacheTimestamp&&Date.now()-this.cacheTimestamp<this.cacheTimeout)return this.cache;if(!this.db)throw new Error("Firebase Firestore not initialized");const s=await this.db.collection("mythologies").orderBy("name","asc").get(),t=["comparative","herbalism","themes","freemasons","tarot"],e=[];for(const a of s.docs)if(!t.includes(a.id)){const s=a.data(),t=await this.getEntityCounts(a.id);e.push({id:a.id,...s,stats:t})}return this.cache=e,this.cacheTimestamp=Date.now(),e}async getEntityCounts(s){try{const[t,e,a]=await Promise.all([this.db.collection("deities").where("mythology","==",s).get(),this.db.collection("heroes").where("mythology","==",s).get(),this.db.collection("creatures").where("mythology","==",s).get()]);return{deities:t.size,heroes:e.size,creatures:a.size,total:t.size+e.size+a.size}}catch(s){return{deities:0,heroes:0,creatures:0,total:0}}}generateHTML(s){const t=this.sortMythologies(s);return`\n            <div class="mythology-browser">\n                <div class="browser-header">\n                    <h1 class="browser-title">Explore World Mythologies</h1>\n                    <p class="browser-description">\n                        Journey through ${s.length} mythological traditions spanning thousands of years\n                    </p>\n                </div>\n\n                <div class="mythology-stats-bar">\n                    <div class="stat-item">\n                        <span class="stat-number">${s.length}</span>\n                        <span class="stat-label">Mythologies</span>\n                    </div>\n                    <div class="stat-item">\n                        <span class="stat-number">${this.getTotalEntities(s)}</span>\n                        <span class="stat-label">Total Entities</span>\n                    </div>\n                    <div class="stat-item">\n                        <span class="stat-number">${this.getTotalDeities(s)}</span>\n                        <span class="stat-label">Deities</span>\n                    </div>\n                </div>\n\n                <div class="universal-grid mythology-grid">\n                    ${t.map(s=>this.renderMythologyCard(s)).join("")}\n                </div>\n            </div>\n        `}renderMythologyCard(s){const t=s.colors||{},e=t.primary||"#667eea",a=t.secondary||"#764ba2";return`\n            <div class="universal-grid-card mythology-card"\n                 data-mythology-id="${s.id}"\n                 style="--entity-color: ${e}; --entity-secondary: ${a}">\n\n                <div class="grid-card-header">\n                    <div class="grid-card-icon">${s.icon||"üìö"}</div>\n                </div>\n\n                <div class="grid-card-body">\n                    <h3 class="grid-card-title">\n                        <a href="#/mythology/${s.id}">${this.escapeHtml(s.name)}</a>\n                    </h3>\n\n                    <div class="grid-card-meta">\n                        ${s.region?`<span class="mythology-badge">${this.escapeHtml(s.region)}</span>`:""}\n                        ${s.period?`<span class="entity-type-badge">${this.escapeHtml(s.period)}</span>`:""}\n                    </div>\n\n                    ${s.description?`\n                        <p class="grid-card-description">${this.escapeHtml(s.description)}</p>\n                    `:""}\n\n                    <div class="mythology-stats">\n                        ${s.stats.deities>0?`\n                            <div class="stat-badge">\n                                <span class="stat-icon">üëë</span>\n                                <span class="stat-value">${s.stats.deities}</span>\n                                <span class="stat-name">Deities</span>\n                            </div>\n                        `:""}\n                        ${s.stats.heroes>0?`\n                            <div class="stat-badge">\n                                <span class="stat-icon">ü¶∏</span>\n                                <span class="stat-value">${s.stats.heroes}</span>\n                                <span class="stat-name">Heroes</span>\n                            </div>\n                        `:""}\n                        ${s.stats.creatures>0?`\n                            <div class="stat-badge">\n                                <span class="stat-icon">üêâ</span>\n                                <span class="stat-value">${s.stats.creatures}</span>\n                                <span class="stat-name">Creatures</span>\n                            </div>\n                        `:""}\n                    </div>\n                </div>\n\n                <div class="grid-card-footer">\n                    <a href="#/mythology/${s.id}" class="btn-view-details">\n                        Explore ${this.escapeHtml(s.name)}\n                    </a>\n                </div>\n            </div>\n        `}renderEmpty(){return'\n            <div class="empty-container">\n                <div class="empty-icon">üìö</div>\n                <h2>No Mythologies Available</h2>\n                <p class="empty-message">\n                    Mythology data is being loaded. Please check back soon.\n                </p>\n                <button class="btn-primary" onclick="window.location.reload()">\n                    Refresh\n                </button>\n            </div>\n        '}sortMythologies(s){return[...s].sort((s,t)=>s.name.localeCompare(t.name))}getTotalEntities(s){return s.reduce((s,t)=>s+(t.stats?.total||0),0)}getTotalDeities(s){return s.reduce((s,t)=>s+(t.stats?.deities||0),0)}escapeHtml(s){if(!s)return"";const t=document.createElement("div");return t.textContent=s,t.innerHTML}clearCache(){this.cache=null,this.cacheTimestamp=null}}window.MythologyBrowser=MythologyBrowser;