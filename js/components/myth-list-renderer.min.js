class MythListRenderer{constructor(){this.db=firebase.firestore(),this.auth=firebase.auth()}init(){document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-myth-list]").forEach(t=>this.renderList(t))})}async renderList(t){const e=t.getAttribute("data-mythology"),n=t.getAttribute("data-entity"),r="true"===t.getAttribute("data-allow-submissions"),i=t.getAttribute("data-section-title")||"Key Myths";if(e&&n)try{t.innerHTML=this.getLoadingHTML();const o=await this.fetchMyths(e,n);t.innerHTML=this.renderListHTML(o,r,i,e,n),r&&this.attachSubmissionListener(t,e,n)}catch(e){t.innerHTML=this.getErrorHTML(e.message)}}async fetchMyths(t,e){const n=this.db.collection("deities").doc(t).collection("entities").doc(e),r=await n.get();if(!r.exists)throw new Error(`Entity not found: ${t}/${e}`);return r.data().myths||[]}renderListHTML(t,e,n,r,i){const o=t.map(t=>this.renderMythHTML(t)).join("");return`\n            <div class="myth-list-container" data-mythology="${r}" data-entity="${i}">\n                <h3 style="color: var(--color-text-primary); margin-top: 1.5rem;">${n}:</h3>\n                ${t.length>0?`\n                    <ul style="margin: 1rem 0 0 2rem; line-height: 1.8;">\n                        ${o}\n                    </ul>\n                `:`\n                    <p style="color: var(--color-text-secondary); font-style: italic;">\n                        No myths have been added yet.\n                        ${e?"Be the first to contribute!":""}\n                    </p>\n                `}\n                ${e?this.getSubmissionButtonHTML():""}\n            </div>\n        `}renderMythHTML(t){const e=t.source?`\n            <div class="myth-source" style="font-size: 0.9rem; color: var(--color-text-secondary); margin-top: 0.5rem;">\n                <em>Source: ${t.source}</em>\n            </div>\n        `:"",n=t.submittedBy?`\n            <div class="myth-contributor" style="font-size: 0.85rem; color: var(--color-text-secondary); opacity: 0.7; margin-top: 0.25rem;">\n                Contributed by: ${t.submittedBy}\n            </div>\n        `:"";return`\n            <li class="myth-item" data-myth-id="${t.id||""}">\n                <strong>${t.title}:</strong> ${t.content}\n                ${e}\n                ${n}\n            </li>\n        `}getSubmissionButtonHTML(){return'\n            <div style="margin-top: 1.5rem; text-align: center;">\n                <button class="submit-myth-btn"\n                        style="background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));\n                               color: white;\n                               border: none;\n                               padding: 0.75rem 1.5rem;\n                               border-radius: var(--radius-md);\n                               cursor: pointer;\n                               font-weight: 600;\n                               transition: transform 0.2s;">\n                    âž• Submit a New Myth\n                </button>\n            </div>\n        '}getLoadingHTML(){return'\n            <div class="spinner-container" style="text-align: center; padding: 2rem;">\n                <div class="spinner-ring"></div>\n                <div class="spinner-ring"></div>\n                <div class="spinner-ring"></div>\n                <p style="margin-top: 1rem; color: var(--color-text-secondary);">Loading myths...</p>\n            </div>\n        '}getErrorHTML(t){return`\n            <div style="padding: 2rem; text-align: center; color: var(--color-error);">\n                <p><strong>Error loading myths:</strong></p>\n                <p>${t}</p>\n                <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: var(--color-primary); color: white; border: none; border-radius: var(--radius-md); cursor: pointer;">\n                    Retry\n                </button>\n            </div>\n        `}attachSubmissionListener(t,e,n){const r=t.querySelector(".submit-myth-btn");r&&r.addEventListener("click",()=>{this.showSubmissionModal(e,n)})}async showSubmissionModal(t,e){const n=this.auth.currentUser;if(!n)return void alert("Please sign in to submit content");const r=prompt('Myth title (e.g., "The Titanomachy"):');if(!r)return;const i=prompt("Myth content:");if(!i)return;const o=prompt('Source (optional, e.g., "Homer\'s Iliad"):')||"";await this.submitMyth(t,e,{title:r,content:i,source:o,submittedBy:n.displayName||n.email})}async submitMyth(t,e,n){const r=this.auth.currentUser;if(!r)throw new Error("User must be authenticated");try{await this.db.collection("submissions").add({type:"myth_submission",mythology:t,entityId:e,section:"myths",data:n,userId:r.uid,userName:r.displayName||r.email,status:"pending_review",timestamp:firebase.firestore.FieldValue.serverTimestamp()}),alert("Your myth has been submitted for review. Thank you for contributing!");const i=document.querySelector(`[data-myth-list][data-mythology="${t}"][data-entity="${e}"]`);i&&this.renderList(i)}catch(t){alert("Error submitting myth. Please try again.")}}}"undefined"!=typeof firebase&&(new MythListRenderer).init();