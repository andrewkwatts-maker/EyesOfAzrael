class IconPicker{constructor(e={}){this.onSelect=e.onSelect||(()=>{}),this.currentIcon=e.currentIcon||"",this.allowCustomClass=!1!==e.allowCustomClass,this.categories={symbols:{name:"Symbols",emojis:["âš¡","ğŸŒŸ","âœ¨","ğŸ’«","â­","ğŸ”¥","ğŸ’","ğŸ‘ï¸","â˜€ï¸","ğŸŒ™","âš”ï¸","ğŸ›¡ï¸","âœï¸","â˜ªï¸","ğŸ•‰ï¸","â˜¸ï¸","âœ¡ï¸","ğŸ”¯","â˜¦ï¸","â›©ï¸","ğŸ•","â˜¯ï¸","â˜®ï¸","ğŸª¬","ğŸ§¿","ğŸ“¿","âš›ï¸","ğŸ”±","âšœï¸","ã€½ï¸","âœ´ï¸","â‡ï¸","ğŸ’ ","ğŸ”°","â­•","ğŸš«","âŒ","â­•","ğŸ’¯","ğŸ†•","ğŸ”±"]},nature:{name:"Nature",emojis:["ğŸŒŠ","ğŸŒ²","ğŸŒº","ğŸ¦…","ğŸ‰","ğŸ¦","ğŸ","ğŸŒ¸","ğŸƒ","ğŸŒ¾","ğŸŒ³","ğŸŒ´","ğŸŒµ","ğŸŒ¿","ğŸ€","ğŸŒ¹","ğŸŒ·","ğŸŒ»","ğŸ¦‹","ğŸ","ğŸ¦š","ğŸ¦¢","ğŸ¦‰","ğŸ•Šï¸","ğŸº","ğŸ…","ğŸ†","ğŸ¦Œ","ğŸ˜","ğŸª","ğŸ¦’","ğŸ¦™","ğŸ›","ğŸ¦‚","ğŸ•·ï¸","ğŸš","ğŸª¶","ğŸ¦´"]},objects:{name:"Objects",emojis:["ğŸ“–","ğŸ“œ","ğŸº","âš±ï¸","ğŸ—¿","ğŸ›ï¸","â›©ï¸","ğŸ•¯ï¸","ğŸ”®","ğŸ“¿","ğŸ­","ğŸ—ï¸","âš™ï¸","ğŸ”¨","âš’ï¸","ğŸ› ï¸","â›ï¸","ğŸª“","ğŸ—¡ï¸","ğŸ¹","ğŸ›¡ï¸","ğŸ‘‘","ğŸ’","ğŸ“¯","ğŸº","ğŸª•","ğŸ¥","ğŸª˜","ğŸ¨","ğŸ–¼ï¸","ğŸ—ºï¸","ğŸ§­","âš–ï¸","âš—ï¸","ğŸ”¬","ğŸ”­","ğŸ“¡","ğŸ’Š","ğŸ§ª"]},activities:{name:"Activities",emojis:["ğŸ™","ğŸ§˜","âš–ï¸","ğŸ­","ğŸ¨","ğŸµ","ğŸ¶","ğŸ’ƒ","ğŸ•º","ğŸ¤","ğŸ¤²","ğŸ‘","ğŸ™Œ","ğŸ‘","âœŠ","âœ‹","ğŸ–ï¸","â˜ï¸","ğŸ‘†","ğŸ‘‡","ğŸ‘ˆ","ğŸ‘‰","ğŸ¤˜","âœŒï¸","ğŸ¤","ğŸ«¶","ğŸ’ª","ğŸ¦¾"]},celestial:{name:"Celestial",emojis:["â˜€ï¸","ğŸŒ","ğŸŒ","ğŸŒ›","ğŸŒœ","ğŸŒš","ğŸŒ•","ğŸŒ–","ğŸŒ—","ğŸŒ˜","ğŸŒ‘","ğŸŒ’","ğŸŒ“","ğŸŒ”","ğŸŒ™","â­","ğŸŒŸ","âœ¨","ğŸ’«","â˜„ï¸","ğŸŒ ","ğŸŒŒ","ğŸŒƒ","ğŸŒ†","ğŸŒ‡","ğŸŒ‰","âš¡","ğŸ”¥","ğŸ’¥","âœ´ï¸","ğŸŒˆ"]},mythical:{name:"Mythical",emojis:["ğŸ‰","ğŸ²","ğŸ¦„","ğŸ¦…","ğŸ¦‰","ğŸ¦š","ğŸ¦¢","ğŸ•Šï¸","ğŸ¦‡","ğŸ‘¼","ğŸ˜‡","ğŸ‘¹","ğŸ‘º","ğŸ’€","â˜ ï¸","ğŸ‘»","ğŸ‘½","ğŸ›¸","ğŸ”±","âš¡","ğŸ”¥","ğŸ’","ğŸ‘‘","ğŸ—¿","ğŸ›ï¸","â›©ï¸"]}},this.recentEmojis=this.loadRecentEmojis(),this.auth=null,this.db=null,this.initializeFirebase(),this.geminiGenerator=null,this.initializeGemini(),this.userIcons=[],this.createModal()}initializeFirebase(){"undefined"!=typeof firebase&&firebase.auth&&(this.auth=firebase.auth()),"undefined"!=typeof firebase&&firebase.firestore&&(this.db=firebase.firestore())}initializeGemini(){window.GeminiSVGGenerator&&(this.geminiGenerator=new window.GeminiSVGGenerator)}createModal(){this.modal=document.createElement("div"),this.modal.className="icon-picker-modal",this.modal.innerHTML=`\n            <div class="icon-picker-overlay"></div>\n            <div class="icon-picker-content">\n                <div class="icon-picker-header">\n                    <h3 class="icon-picker-title">Choose Icon</h3>\n                    <button type="button" class="icon-picker-close" aria-label="Close">&times;</button>\n                </div>\n\n                <div class="icon-picker-search">\n                    <input type="text"\n                           class="icon-picker-search-input"\n                           placeholder="Search emojis..."\n                           aria-label="Search emojis">\n                </div>\n\n                <div class="icon-picker-tabs">\n                    ${this.recentEmojis.length>0?'<button type="button" class="icon-picker-tab active" data-category="recent">Recent</button>':""}\n                    ${Object.keys(this.categories).map((e,t)=>`<button type="button" class="icon-picker-tab ${0===this.recentEmojis.length&&0===t?"active":""}" data-category="${e}">${this.categories[e].name}</button>`).join("")}\n                    <button type="button" class="icon-picker-tab" data-category="my-icons">âœ¨ My Icons</button>\n                    <button type="button" class="icon-picker-tab" data-category="ai-generate">ğŸ¤– AI Generate</button>\n                    ${this.allowCustomClass?'<button type="button" class="icon-picker-tab" data-category="custom">Custom Class</button>':""}\n                </div>\n\n                <div class="icon-picker-body">\n                    ${this.renderCategoryContent()}\n                </div>\n\n                <div class="icon-picker-footer">\n                    <div class="icon-picker-preview">\n                        <span class="icon-picker-preview-label">Selected:</span>\n                        <span class="icon-picker-preview-icon">${this.currentIcon||"None"}</span>\n                    </div>\n                    <div class="icon-picker-actions">\n                        <button type="button" class="icon-picker-btn icon-picker-btn-clear">Clear</button>\n                        <button type="button" class="icon-picker-btn icon-picker-btn-primary">Select</button>\n                    </div>\n                </div>\n            </div>\n        `,document.body.appendChild(this.modal),this.attachEventListeners()}renderCategoryContent(){let e="";return this.recentEmojis.length>0&&(e+=`\n                <div class="icon-picker-category active" data-category="recent">\n                    <div class="icon-picker-grid">\n                        ${this.recentEmojis.map(e=>`<button type="button" class="icon-picker-emoji ${e===this.currentIcon?"selected":""}" data-emoji="${e}">${e}</button>`).join("")}\n                    </div>\n                </div>\n            `),Object.keys(this.categories).forEach((t,n)=>{const i=this.categories[t],o=0===this.recentEmojis.length&&0===n;e+=`\n                <div class="icon-picker-category ${o?"active":""}" data-category="${t}">\n                    <div class="icon-picker-grid">\n                        ${i.emojis.map(e=>`<button type="button" class="icon-picker-emoji ${e===this.currentIcon?"selected":""}" data-emoji="${e}">${e}</button>`).join("")}\n                    </div>\n                </div>\n            `}),e+='\n            <div class="icon-picker-category" data-category="my-icons">\n                <div class="icon-picker-my-icons" id="icon-picker-my-icons-content">\n                    <p class="icon-picker-loading">Loading your icons...</p>\n                </div>\n            </div>\n        ',e+=`\n            <div class="icon-picker-category" data-category="ai-generate">\n                <div class="icon-picker-ai-generate" id="icon-picker-ai-content">\n                    ${this.renderAIGenerateContent()}\n                </div>\n            </div>\n        `,this.allowCustomClass&&(e+=`\n                <div class="icon-picker-category" data-category="custom">\n                    <div class="icon-picker-custom">\n                        <label class="icon-picker-custom-label">\n                            Enter custom icon class (e.g., "fas fa-star"):\n                        </label>\n                        <input type="text"\n                               class="icon-picker-custom-input"\n                               placeholder="fas fa-star"\n                               value="${this.currentIcon&&!this.isEmoji(this.currentIcon)?this.currentIcon:""}">\n                        <small class="icon-picker-custom-hint">\n                            Supports Font Awesome, Material Icons, or any custom icon font classes\n                        </small>\n                    </div>\n                </div>\n            `),e}renderAIGenerateContent(){return this.auth&&this.auth.currentUser?'\n            <div class="icon-picker-ai-form">\n                <div class="icon-form-group">\n                    <label>Describe the icon you want:</label>\n                    <input type="text"\n                           class="icon-prompt-input"\n                           id="icon-prompt-input"\n                           placeholder="e.g., golden trident of Poseidon, eye of Horus, Celtic knot">\n                    <small class="icon-form-hint">Describe a symbol, object, or concept for your icon</small>\n                </div>\n\n                <div class="icon-form-row">\n                    <div class="icon-form-group">\n                        <label>Style:</label>\n                        <select class="icon-select" id="icon-style-select">\n                            <option value="emoji">Emoji Style</option>\n                            <option value="simple">Simple Icon</option>\n                            <option value="detailed">Detailed Symbol</option>\n                        </select>\n                    </div>\n\n                    <div class="icon-form-group">\n                        <label>Colors:</label>\n                        <select class="icon-select" id="icon-color-select">\n                            <option value="colorful">Colorful</option>\n                            <option value="monochrome">Monochrome</option>\n                            <option value="gold">Gold</option>\n                            <option value="purple">Purple</option>\n                        </select>\n                    </div>\n                </div>\n\n                <button type="button" class="icon-generate-btn" id="icon-generate-btn">\n                    <span id="icon-generate-text">âœ¨ Generate Icon</span>\n                    <span id="icon-generate-spinner" class="icon-loading-spinner" style="display: none;"></span>\n                </button>\n\n                <div id="icon-ai-messages"></div>\n\n                <div class="icon-preview-area" id="icon-generated-preview" style="display: none;">\n                    <h4>Generated Icon:</h4>\n                    <div class="icon-generated-display" id="icon-generated-display"></div>\n                    <button type="button" class="icon-use-btn" id="icon-use-generated">Use This Icon</button>\n                </div>\n            </div>\n        ':'\n                <div class="icon-picker-signin-required">\n                    <h4>Sign In Required</h4>\n                    <p>Sign in with Google to generate custom icons using AI.</p>\n                    <p class="icon-picker-hint">Your Google OAuth token will be used to access the Gemini API for icon generation.</p>\n                </div>\n            '}async loadUserIcons(){if(!this.db||!this.auth||!this.auth.currentUser){const e=document.getElementById("icon-picker-my-icons-content");return void(e&&(e.innerHTML='\n                    <div class="icon-picker-signin-required">\n                        <p>Sign in to view your custom icons</p>\n                    </div>\n                '))}try{const e=this.auth.currentUser.uid,t=this.db.collection("userIcons").where("userId","==",e).orderBy("createdAt","desc").limit(50),n=await t.get();this.userIcons=n.docs.map(e=>({id:e.id,...e.data()})),this.renderUserIcons()}catch(e){const t=document.getElementById("icon-picker-my-icons-content");t&&(t.innerHTML=`<p class="icon-picker-error">Error loading icons: ${e.message}</p>`)}}renderUserIcons(){const e=document.getElementById("icon-picker-my-icons-content");e&&(0!==this.userIcons.length?(e.innerHTML=`\n            <div class="icon-picker-grid">\n                ${this.userIcons.map(e=>`\n                    <button type="button"\n                            class="icon-picker-emoji icon-picker-svg-icon ${e.svgCode===this.currentIcon?"selected":""}"\n                            data-icon-id="${e.id}"\n                            data-svg="${this.escapeHtml(e.svgCode)}"\n                            title="${this.escapeHtml(e.prompt)}">\n                        ${e.svgCode}\n                    </button>\n                `).join("")}\n            </div>\n        `,e.querySelectorAll(".icon-picker-svg-icon").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.dataset.svg;this.selectEmoji(t)})})):e.innerHTML='\n                <div class="icon-picker-empty">\n                    <p>You haven\'t generated any custom icons yet.</p>\n                    <p>Try the <strong>AI Generate</strong> tab to create your first custom icon!</p>\n                </div>\n            ')}attachEventListeners(){this.modal.querySelector(".icon-picker-close").addEventListener("click",()=>this.hide()),this.modal.querySelector(".icon-picker-overlay").addEventListener("click",()=>this.hide()),this.modal.querySelectorAll(".icon-picker-tab").forEach(e=>{e.addEventListener("click",e=>this.switchTab(e.target.dataset.category))}),this.modal.querySelectorAll(".icon-picker-emoji").forEach(e=>{e.addEventListener("click",e=>this.selectEmoji(e.target.dataset.emoji))}),this.modal.querySelector(".icon-picker-search-input").addEventListener("input",e=>this.handleSearch(e.target.value));const e=this.modal.querySelector(".icon-picker-custom-input");e&&e.addEventListener("input",e=>{this.currentIcon=e.target.value.trim(),this.updatePreview()}),this.modal.querySelector(".icon-picker-btn-clear").addEventListener("click",()=>{this.currentIcon="",this.updatePreview(),this.modal.querySelectorAll(".icon-picker-emoji").forEach(e=>e.classList.remove("selected"))}),this.modal.querySelector(".icon-picker-btn-primary").addEventListener("click",()=>{this.currentIcon&&this.addToRecent(this.currentIcon),this.onSelect(this.currentIcon),this.hide()}),this.modal.addEventListener("keydown",e=>this.handleKeyboard(e))}switchTab(e){this.modal.querySelectorAll(".icon-picker-tab").forEach(t=>{t.classList.toggle("active",t.dataset.category===e)}),this.modal.querySelectorAll(".icon-picker-category").forEach(t=>{t.classList.toggle("active",t.dataset.category===e)}),"my-icons"===e&&this.loadUserIcons(),"ai-generate"===e&&this.attachAIGenerationHandlers()}attachAIGenerationHandlers(){const e=document.getElementById("icon-generate-btn");e&&!e.dataset.handlerAttached&&(e.dataset.handlerAttached="true",e.addEventListener("click",()=>this.generateAIIcon()));const t=document.getElementById("icon-use-generated");t&&!t.dataset.handlerAttached&&(t.dataset.handlerAttached="true",t.addEventListener("click",()=>{const e=document.getElementById("icon-generated-display");e&&e.dataset.svgCode&&this.selectEmoji(e.dataset.svgCode)}))}async generateAIIcon(){const e=document.getElementById("icon-prompt-input"),t=document.getElementById("icon-style-select"),n=document.getElementById("icon-color-select"),i=document.getElementById("icon-generate-btn"),o=document.getElementById("icon-generate-text"),s=document.getElementById("icon-generate-spinner"),c=document.getElementById("icon-ai-messages"),a=document.getElementById("icon-generated-preview"),r=document.getElementById("icon-generated-display"),l=e.value.trim();if(l){i.disabled=!0,o.style.display="none",s.style.display="inline-block",c.innerHTML="",a.style.display="none";try{const e=t.value,i=n.value,o=`Create a small icon (32x32 or 64x64) in SVG format for: ${l}.\nStyle: ${e}. Colors: ${i}.\nRequirements:\n- Very simple and clean design suitable for use as an icon\n- ViewBox should be 0 0 64 64 or similar small size\n- Use inline styles only\n- ${"monochrome"===i?"Single color design":"Use vibrant colors"}\n- No text unless absolutely necessary\n- Optimized for small size display\n- Return ONLY the SVG code`,s=await this.geminiGenerator.generateSVG(o,{});s.success?(r.innerHTML=s.svgCode,r.dataset.svgCode=s.svgCode,a.style.display="block",await this.saveUserIcon(l,s.svgCode,{style:e,color:i}),this.showAIMessage("Icon generated successfully!","success")):this.showAIMessage(`Error: ${s.error}`,"error")}catch(e){this.showAIMessage(`Error generating icon: ${e.message}`,"error")}finally{i.disabled=!1,o.style.display="inline",s.style.display="none"}}else this.showAIMessage("Please describe the icon you want to generate","error")}async saveUserIcon(e,t,n){if(this.db&&this.auth&&this.auth.currentUser)try{const i=this.auth.currentUser.uid;await this.db.collection("userIcons").add({userId:i,prompt:e,svgCode:t,style:n.style||"simple",color:n.color||"colorful",createdAt:firebase.firestore.FieldValue.serverTimestamp(),usageCount:0})}catch(e){}}showAIMessage(e,t="info"){const n=document.getElementById("icon-ai-messages");if(!n)return;const i="error"===t?"icon-message-error":"success"===t?"icon-message-success":"icon-message-info";n.innerHTML=`<div class="${i}">${this.escapeHtml(e)}</div>`}selectEmoji(e){this.currentIcon=e,this.updatePreview(),this.modal.querySelectorAll(".icon-picker-emoji").forEach(t=>{t.classList.toggle("selected",t.dataset.emoji===e)})}handleSearch(e){e.toLowerCase().trim(),this.modal.querySelectorAll(".icon-picker-emoji").forEach(e=>{e.style.display=""})}updatePreview(){const e=this.modal.querySelector(".icon-picker-preview-icon");this.currentIcon?this.isEmoji(this.currentIcon)?(e.textContent=this.currentIcon,e.innerHTML=this.currentIcon):(e.textContent="",e.innerHTML=`<i class="${this.currentIcon}"></i> ${this.currentIcon}`):e.textContent="None"}handleKeyboard(e){"Escape"===e.key&&this.hide()}isEmoji(e){return e.length<=4&&!e.match(/^(fa|fas|far|fal|fab|material-icons|mdi|ion|icon)/)}loadRecentEmojis(){try{const e=localStorage.getItem("iconPicker_recent");return e?JSON.parse(e):[]}catch(e){return[]}}addToRecent(e){if(!this.isEmoji(e))return;let t=this.loadRecentEmojis();t=t.filter(t=>t!==e),t.unshift(e),t=t.slice(0,20);try{localStorage.setItem("iconPicker_recent",JSON.stringify(t))}catch(e){}this.recentEmojis=t}show(){this.modal.classList.add("active"),document.body.style.overflow="hidden";const e=this.modal.querySelector(".icon-picker-search-input");e&&setTimeout(()=>e.focus(),100)}hide(){this.modal.classList.remove("active"),document.body.style.overflow=""}destroy(){this.modal&&this.modal.parentNode&&this.modal.parentNode.removeChild(this.modal)}}window.IconPicker=IconPicker;