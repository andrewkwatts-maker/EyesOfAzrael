class SecurityHelpers{static escapeHtml(e){if(!e||"string"!=typeof e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}static sanitizeHtml(e){return e&&"string"==typeof e?e=(e=(e=(e=(e=(e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")).replace(/\son\w+\s*=\s*["'][^"']*["']/gi,"")).replace(/\son\w+\s*=\s*[^\s>]*/gi,"")).replace(/href\s*=\s*["']javascript:[^"']*["']/gi,"")).replace(/src\s*=\s*["']javascript:[^"']*["']/gi,"")).replace(/src\s*=\s*["']data:text\/javascript[^"']*["']/gi,""):""}static sanitizeFileName(e){return e&&"string"==typeof e?((e=(e=(e=e.replace(/\.\./g,"")).replace(/[/\\]/g,"")).replace(/[^a-zA-Z0-9._-]/g,"_")).startsWith(".")&&(e=e.substring(1)),e):""}static isValidEmail(e){return!(!e||"string"!=typeof e)&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static isValidUrl(e,t=!1){if(!e||"string"!=typeof e)return!1;if(!t&&e.toLowerCase().startsWith("javascript:"))return!1;if(e.toLowerCase().startsWith("data:text/javascript"))return!1;try{const t=new URL(e);return["http:","https:","data:","blob:"].includes(t.protocol)}catch{return!1}}static isValidEntityId(e){return!(!e||"string"!=typeof e)&&(/^[a-zA-Z0-9_-]+$/.test(e)&&e.length<=100)}static isValidCollection(e){return["deities","heroes","creatures","items","places","concepts","rituals","herbs","texts","symbols","magic","user_theories","users","mythologies"].includes(e)}static sanitizeSearchQuery(e){return e&&"string"==typeof e?e=(e=(e=e.replace(/\$/g,"")).substring(0,200)).trim():""}static generateCsrfToken(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}static validateCsrfToken(e,t){if(!e||!t)return!1;if("string"!=typeof e||"string"!=typeof t)return!1;if(e.length!==t.length)return!1;let r=0;for(let s=0;s<e.length;s++)r|=e.charCodeAt(s)^t.charCodeAt(s);return 0===r}static validateFileUpload(e,t={}){const{maxSize:r=5242880,allowedTypes:s=["image/jpeg","image/png","image/webp"],allowedExtensions:i=["jpg","jpeg","png","webp"]}=t;if(!e)return{valid:!1,error:"No file provided"};if(e.size>r)return{valid:!1,error:`File too large. Maximum size: ${(r/1048576).toFixed(1)}MB`};if(!s.includes(e.type))return{valid:!1,error:`Invalid file type. Allowed: ${s.join(", ")}`};const a=e.name.split(".").pop().toLowerCase();if(!i.includes(a))return{valid:!1,error:`Invalid file extension. Allowed: ${i.join(", ")}`};const n=e.name.split(".");if(n.length>2){const e=["php","exe","sh","bat","cmd"];for(let t=1;t<n.length-1;t++)if(e.includes(n[t].toLowerCase()))return{valid:!1,error:"Suspicious file extension detected"}}return{valid:!0}}static escapeRegex(e){return e&&"string"==typeof e?e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):""}static isAllowedOrigin(e,t=[]){return!!e&&["https://eyesofazrael.com","https://www.eyesofazrael.com","http://localhost:3000","http://localhost:5000",...t].includes(e)}static checkRateLimit(e,t=5,r=3e5,s=new Map){const i=Date.now(),a=s.get(e)||{attempts:[],firstAttempt:i};if(a.attempts=a.attempts.filter(e=>i-e<r),a.attempts.length>=t){const e=Math.min(...a.attempts)+r;return{allowed:!1,remaining:0,resetAt:e,retryAfter:Math.ceil((e-i)/1e3)}}return a.attempts.push(i),s.set(e,a),{allowed:!0,remaining:t-a.attempts.length,resetAt:i+r}}static async hashData(e){if(!e||"string"!=typeof e)return"";const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(r)).map(e=>e.toString(16).padStart(2,"0")).join("")}static anonymizeUserData(e){if(!e||"object"!=typeof e)return{};const t={...e};if(["email","password","token","apiKey","secret"].forEach(e=>{e in t&&delete t[e]}),t.userId&&"string"==typeof t.userId){const e=t.userId.substring(0,4)+"***";t.userId=e}if(t.ipAddress&&"string"==typeof t.ipAddress){const e=t.ipAddress.split(".");4===e.length&&(t.ipAddress=`${e[0]}.${e[1]}.***.**`)}return t}static sanitizeErrorMessage(e){let t=e instanceof Error?e.message:String(e);return t=t.replace(/\d+\.\d+\.\d+\.\d+/g,"[IP]"),t=t.replace(/[A-Za-z]:\\[^:\n]+/g,"[PATH]"),t=t.replace(/\/[^\s:]+/g,"[PATH]"),t=t.replace(/password[=:]\s*[^\s]+/gi,"password=***"),t=t.replace(/token[=:]\s*[^\s]+/gi,"token=***"),t=t.replace(/key[=:]\s*[^\s]+/gi,"key=***"),t=t.replace(/[^\s@]+@[^\s@]+\.[^\s@]+/g,"[EMAIL]"),t}static isDNTEnabled(){return"1"===navigator.doNotTrack||"yes"===navigator.doNotTrack||"1"===window.doNotTrack}static validateContentLength(e,t=1e4){return e&&"string"==typeof e?e.length>t?{valid:!1,error:`Content too long. Maximum ${t} characters, got ${e.length}`}:{valid:!0}:{valid:!1,error:"Content is required"}}static getCSPHeader(){return["default-src 'self'","script-src 'self' https://www.gstatic.com https://www.google.com https://cdnjs.cloudflare.com","style-src 'self' 'unsafe-inline' https://fonts.googleapis.com","font-src 'self' https://fonts.gstatic.com","img-src 'self' data: https: blob:","connect-src 'self' https://*.googleapis.com https://*.firebaseio.com https://*.cloudfunctions.net","frame-src 'self' https://www.google.com","object-src 'none'","base-uri 'self'","form-action 'self'","frame-ancestors 'none'","upgrade-insecure-requests"].join("; ")}}"undefined"!=typeof module&&module.exports&&(module.exports=SecurityHelpers),"undefined"!=typeof window&&(window.SecurityHelpers=SecurityHelpers);