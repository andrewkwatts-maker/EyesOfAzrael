class MythologyComparisons{constructor(){this.db=firebase.firestore(),this.cache=new Map,this.archetypes={"sky-father":{name:"Sky Father",description:"Supreme male deity associated with sky, thunder, and kingship",attributes:["sky","thunder","lightning","king","father","ruler","supreme"],domains:["sky","weather","leadership","justice"],symbols:["lightning bolt","eagle","oak","throne"],examples:{greek:"zeus",norse:"odin",roman:"jupiter",hindu:"indra",egyptian:"amon-ra"}},"earth-mother":{name:"Earth Mother",description:"Primordial female deity associated with earth, fertility, and creation",attributes:["earth","mother","fertility","nature","creation","life","nurture"],domains:["earth","fertility","agriculture","motherhood"],symbols:["cornucopia","grain","serpent","cave"],examples:{greek:"gaia",norse:"frigg",roman:"terra",hindu:"prithvi",egyptian:"nut"}},trickster:{name:"Trickster",description:"Cunning deity or spirit who breaks rules and conventions",attributes:["cunning","mischief","clever","shapeshifter","deceit","wit","chaos"],domains:["trickery","cunning","transformation","chaos"],symbols:["mask","staff","fox","raven"],examples:{norse:"loki",greek:"hermes",celtic:"anansi",native_american:"coyote",egyptian:"set"}},"war-god":{name:"War God",description:"Deity of battle, conflict, and martial prowess",attributes:["war","battle","warrior","strength","combat","violence","courage"],domains:["war","battle","combat","strategy"],symbols:["sword","spear","shield","helmet"],examples:{greek:"ares",roman:"mars",norse:"tyr",aztec:"huitzilopochtli",hindu:"kartikeya"}},"underworld-ruler":{name:"Underworld Ruler",description:"Lord or lady of the dead and the afterlife",attributes:["death","underworld","afterlife","dead","souls","judgment","darkness"],domains:["death","underworld","afterlife","judgment"],symbols:["skull","gate","river","dog"],examples:{greek:"hades",egyptian:"osiris",norse:"hel",hindu:"yama",aztec:"mictlantecuhtli"}},"love-goddess":{name:"Love Goddess",description:"Deity of love, beauty, and desire",attributes:["love","beauty","desire","passion","romance","attraction","pleasure"],domains:["love","beauty","desire","sexuality"],symbols:["rose","dove","mirror","shell"],examples:{greek:"aphrodite",roman:"venus",norse:"freyja",hindu:"rati",mesopotamian:"ishtar"}},"sun-deity":{name:"Sun Deity",description:"God or goddess of the sun and solar power",attributes:["sun","light","day","solar","radiance","illumination","heat"],domains:["sun","light","day","time"],symbols:["sun disk","chariot","rays","gold"],examples:{greek:"helios",egyptian:"ra",norse:"sol",hindu:"surya",aztec:"tonatiuh"}},"wisdom-deity":{name:"Wisdom Deity",description:"God or goddess of wisdom, knowledge, and learning",attributes:["wisdom","knowledge","learning","intelligence","craft","strategy","skill"],domains:["wisdom","knowledge","crafts","strategy"],symbols:["owl","book","staff","serpent"],examples:{greek:"athena",norse:"odin",egyptian:"thoth",hindu:"saraswati",mesopotamian:"nabu"}},"hero-journey":{name:"Hero's Journey",description:"Mortal or demigod who undergoes transformative quest",attributes:["hero","quest","journey","trial","transformation","courage","destiny"],domains:["heroism","adventure","trial","destiny"],symbols:["sword","path","mountain","treasure"],examples:{greek:"heracles",mesopotamian:"gilgamesh",celtic:"cu-chulainn",hindu:"rama",norse:"sigurd"}}},this.symbols={lightning:{symbolism:"Divine power, authority, sudden illumination",cultures:{greek:{deity:"zeus",meaning:"Supreme authority"},norse:{deity:"thor",meaning:"Protection and strength"},hindu:{deity:"indra",meaning:"Warrior power"},roman:{deity:"jupiter",meaning:"Imperial authority"}}},serpent:{symbolism:"Wisdom, rebirth, danger, transformation",cultures:{greek:{deity:"asclepius",meaning:"Healing and medicine"},egyptian:{deity:"wadjet",meaning:"Protection and royalty"},hindu:{deity:"shiva",meaning:"Cosmic power"},aztec:{deity:"quetzalcoatl",meaning:"Divine wisdom"},norse:{deity:"jormungandr",meaning:"Cosmic threat"}}},"sacred-tree":{symbolism:"Cosmic axis, life, connection between realms",cultures:{norse:{name:"yggdrasil",meaning:"World tree connecting nine realms"},christian:{name:"tree-of-knowledge",meaning:"Knowledge and temptation"},hindu:{name:"kalpavriksha",meaning:"Wish-fulfilling divine tree"},celtic:{name:"bile",meaning:"Sacred connection to ancestors"}}},"sacred-waters":{symbolism:"Primordial chaos, life source, purification",cultures:{mesopotamian:{name:"abzu",meaning:"Primordial fresh waters"},hindu:{name:"ganges",meaning:"Sacred purification"},egyptian:{name:"nun",meaning:"Primordial waters of creation"},greek:{name:"styx",meaning:"Boundary between worlds"}}},eagle:{symbolism:"Divine messenger, sky power, vision",cultures:{greek:{deity:"zeus",meaning:"Divine messenger and authority"},aztec:{deity:"huitzilopochtli",meaning:"Solar warrior power"},native_american:{meaning:"Great Spirit connection"},roman:{meaning:"Imperial power"}}}},this.etymologyConnections={dyeus:{meaning:"Sky father",derivatives:{greek:"zeus",latin:"jupiter",sanskrit:"dyaus-pita",norse:"tyr"}},mater:{meaning:"Mother",derivatives:{latin:"mater",greek:"meter",sanskrit:"matr",old_english:"modor"}}}}async compareEntities(e){if(e.length<2||e.length>4)throw new Error("Can compare 2-4 entities at a time");const t=[];for(const i of e){const e=await this.fetchEntity(i);e&&t.push(e)}if(t.length<2)throw new Error("At least 2 valid entities required for comparison");return{entities:t,fields:this.compareFields(t),similarities:this.findSimilarities(t),differences:this.findDifferences(t),culturalContext:this.analyzeCulturalContext(t),archetypes:this.identifySharedArchetypes(t),symbols:this.compareSymbols(t),relationships:await this.findRelationships(t)}}async fetchEntity(e){if(this.cache.has(e))return this.cache.get(e);const t=["deities","heroes","creatures","places","concepts"];for(const i of t)try{const t=await this.db.collection(i).doc(e).get();if(t.exists){const r={id:t.id,collection:i,...t.data()};return this.cache.set(e,r),r}}catch(e){}return null}compareFields(e){const t={},i=new Set;return e.forEach(e=>{Object.keys(e).forEach(e=>i.add(e))}),i.forEach(i=>{"id"!==i&&"collection"!==i&&(t[i]={values:e.map(e=>e[i]),aligned:this.areValuesComparable(e.map(e=>e[i]))})}),t}areValuesComparable(e){const t=e.map(e=>typeof e);return 1===[...new Set(t)].length}findSimilarities(e){const t=[],i=this.findSharedArray(e,"domains");i.length>0&&t.push({type:"domains",values:i,description:"Shared areas of divine influence"});const r=this.findSharedArray(e,"attributes");r.length>0&&t.push({type:"attributes",values:r,description:"Common characteristics"});const n=this.findSharedArray(e,"symbols");n.length>0&&t.push({type:"symbols",values:n,description:"Shared sacred symbols"});const s=e.map(e=>e.role).filter(Boolean);return s.length>1&&s.every(e=>e===s[0])&&t.push({type:"role",values:[s[0]],description:"Same mythological role"}),t}findSharedArray(e,t){const i=e.map(e=>e[t]).filter(e=>Array.isArray(e));return i.length<2?[]:i.reduce((e,t)=>e.filter(e=>t.includes(e)))}findDifferences(e){const t=[],i=[...new Set(e.map(e=>e.mythology))];return i.length>1&&t.push({type:"mythology",values:i,description:"Different cultural traditions"}),e.forEach((i,r)=>{const n=e.filter((e,t)=>t!==r),s=(i.attributes||[]).filter(e=>!n.some(t=>(t.attributes||[]).includes(e)));s.length>0&&t.push({type:"unique_attributes",entity:i.name,values:s,description:`Unique to ${i.name}`})}),t}analyzeCulturalContext(e){const t=e.map(e=>({entity:e.name,mythology:e.mythology,culture:e.culture||e.mythology,period:e.period||e.historicalPeriod,geography:e.geography||e.region,sources:e.sources||[]}));return{contexts:t,timeSpan:this.analyzeTimePeriod(t),geographicSpread:this.analyzeGeography(t),culturalConnections:this.findCulturalConnections(t)}}analyzeTimePeriod(e){const t=e.map(e=>e.period).filter(Boolean);return{periods:[...new Set(t)],span:t.length>1?"Multiple time periods":"Same period"}}analyzeGeography(e){const t=e.map(e=>e.geography).filter(Boolean);return{regions:[...new Set(t)],spread:t.length>1?"Wide geographic distribution":"Same region"}}findCulturalConnections(e){const t=[],i=["greek","roman","norse","hindu","celtic"],r=e.map(e=>e.mythology);r.filter(e=>i.includes(e)).length>1&&t.push({type:"Indo-European",description:"Shared Indo-European cultural heritage",mythologies:r.filter(e=>i.includes(e))});const n=["greek","roman","egyptian"];return r.filter(e=>n.includes(e)).length>1&&t.push({type:"Mediterranean",description:"Mediterranean cultural exchange",mythologies:r.filter(e=>n.includes(e))}),t}identifySharedArchetypes(e){const t=[];for(const[i,r]of Object.entries(this.archetypes)){const n=e.filter(e=>this.matchesArchetype(e,r));n.length>1&&t.push({archetype:r.name,id:i,description:r.description,matchingEntities:n.map(e=>e.name),score:this.calculateArchetypeScore(n,r)})}return t.sort((e,t)=>t.score-e.score)}matchesArchetype(e,t){const i=[e.name,e.title,e.description,...e.domains||[],...e.attributes||[],...e.symbols||[]].join(" ").toLowerCase();return[...t.attributes,...t.domains,...t.symbols].filter(e=>i.includes(e.toLowerCase())).length>=3}calculateArchetypeScore(e,t){let i=0;return e.forEach(e=>{const r=[e.name,e.title,e.description,...e.domains||[],...e.attributes||[],...e.symbols||[]].join(" ").toLowerCase(),n=[...t.attributes,...t.domains,...t.symbols].filter(e=>r.includes(e.toLowerCase()));i+=n.length}),i/e.length}compareSymbols(e){const t=[];return e.forEach(e=>{(e.symbols||[]).forEach(i=>{const r=i.toLowerCase().replace(/\s+/g,"-"),n=this.symbols[r];n&&t.push({symbol:i,entity:e.name,mythology:e.mythology,symbolism:n.symbolism,crossCulturalMeaning:n.cultures[e.mythology]})})}),t}async findRelationships(e){const t=[];for(let i=0;i<e.length;i++)for(let r=i+1;r<e.length;r++){const n=e[i],s=e[r];n.relatedEntities&&n.relatedEntities.includes(s.id)&&t.push({from:n.name,to:s.name,type:"direct",description:"Directly cross-referenced"});const a=await this.findSharedRelationships(n,s);a.length>0&&t.push({from:n.name,to:s.name,type:"shared",description:`Share ${a.length} related entities`,shared:a})}return t}async findSharedRelationships(e,t){const i=e.relatedEntities||[],r=t.relatedEntities||[];return i.filter(e=>r.includes(e))}async findEntitiesByArchetype(e){const t=this.archetypes[e];if(!t)throw new Error("Unknown archetype");const i=[],r=["deities","heroes","creatures"];for(const e of r)try{(await this.db.collection(e).get()).docs.forEach(r=>{const n={id:r.id,collection:e,...r.data()};this.matchesArchetype(n,t)&&i.push({...n,archetypeScore:this.calculateArchetypeScore([n],t)})})}catch(e){}return i.sort((e,t)=>t.archetypeScore-e.archetypeScore)}async findParallelEntities(e){const t=await this.fetchEntity(e);if(!t)throw new Error("Entity not found");const i=[];for(const[e,r]of Object.entries(this.archetypes))this.matchesArchetype(t,r)&&i.push(e);if(0===i.length)return[];const r=[];for(const e of i){const i=(await this.findEntitiesByArchetype(e)).filter(e=>e.mythology!==t.mythology&&e.id!==t.id);r.push(...i)}return Array.from(new Map(r.map(e=>[e.id,e])).values()).slice(0,10)}analyzeSymbol(e){const t=this.symbols[e];return t?{symbol:e,symbolism:t.symbolism,cultures:t.cultures,universalMeaning:this.extractUniversalMeaning(t)}:null}extractUniversalMeaning(e){const t=Object.values(e.cultures).map(e=>e.meaning);return{commonThemes:this.findCommonWords(t),interpretation:e.symbolism}}findCommonWords(e){const t={},i=["the","and","of","in","to","a","is"];return e.forEach(e=>{e.toLowerCase().split(/\s+/).forEach(e=>{!i.includes(e)&&e.length>3&&(t[e]=(t[e]||0)+1)})}),Object.entries(t).filter(([e,t])=>t>1).map(([e])=>e)}async trackCulturalDiffusion(e){const t={mythology:e,tradeRoutes:[],linguisticConnections:[],historicalExchanges:[]};return"greek"===e&&(t.tradeRoutes.push("Mediterranean Sea trade"),t.historicalExchanges.push({target:"roman",period:"200 BCE - 400 CE",mechanism:"Cultural adoption and syncretism"})),["greek","roman","norse","hindu","celtic"].includes(e)&&t.linguisticConnections.push({family:"Indo-European",evidence:"Shared root words and deity names",examples:this.etymologyConnections}),t}getArchetypes(){return this.archetypes}getSymbols(){return this.symbols}clearCache(){this.cache.clear()}}"undefined"!=typeof module&&module.exports&&(module.exports=MythologyComparisons);