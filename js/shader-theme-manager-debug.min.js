class ShaderThemeManager{constructor(t={}){this.enabled=!0,this.intensity=t.intensity||1,this.canvas=null,this.gl=null,this.program=null,this.currentTheme=null,this.animationId=null,this.startTime=Date.now(),this.shaderCache=new Map,this.themeShaders={water:"water-shader.glsl",ocean:"water-shader.glsl",sea:"water-shader.glsl",fire:"fire-shader.glsl",flame:"fire-shader.glsl",night:"night-shader.glsl",sky:"night-shader.glsl",stars:"night-shader.glsl",earth:"earth-shader.glsl",forest:"earth-shader.glsl",nature:"earth-shader.glsl",meadow:"earth-shader.glsl",light:"light-shader.glsl",day:"day-shader.glsl",daylight:"day-shader.glsl",sunshine:"day-shader.glsl",dark:"dark-shader.glsl",shadow:"dark-shader.glsl",air:"air-shader.glsl",wind:"air-shader.glsl",chaos:"chaos-shader.glsl",void:"chaos-shader.glsl",abyss:"chaos-shader.glsl",order:"order-shader.glsl",divine:"order-shader.glsl",sacred:"order-shader.glsl",angelic:"order-shader.glsl",heaven:"order-shader.glsl"},this.settings={targetFPS:60,quality:t.quality||"high",adaptiveQuality:!1!==t.adaptiveQuality},this.fpsCounter={frames:0,lastTime:Date.now(),fps:60},this.webglSupported=this.checkWebGLSupport(),this.webglSupported&&this.init()}checkWebGLSupport(){try{const t=document.createElement("canvas");return!!(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}init(){this.canvas=document.createElement("canvas"),this.canvas.id="shader-background",this.canvas.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            z-index: -1;\n            pointer-events: none;\n        ",this.gl=this.canvas.getContext("webgl",{alpha:!0,antialias:!1,depth:!1,stencil:!1,premultipliedAlpha:!0})||this.canvas.getContext("experimental-webgl"),this.gl?(this.handleResize=this.handleResize.bind(this),window.addEventListener("resize",this.handleResize),this.handleResize(),document.addEventListener("visibilitychange",()=>{document.hidden?this.pause():this.enabled&&this.resume()})):this.webglSupported=!1}handleResize(){if(!this.canvas||!this.gl)return;const t=this.getDevicePixelRatio(),e=window.innerWidth,s=window.innerHeight;this.canvas.width=e*t,this.canvas.height=s*t,this.canvas.style.width=e+"px",this.canvas.style.height=s+"px",this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}getDevicePixelRatio(){const t=window.devicePixelRatio||1;switch(this.settings.quality){case"low":return Math.min(t,1);case"medium":return Math.min(t,1.5);default:return Math.min(t,2)}}async loadShaderSource(t){if(this.shaderCache.has(t))return this.shaderCache.get(t);try{const e=`/js/shaders/${t}`,s=await fetch(e);if(!s.ok)throw new Error(`Failed to load shader: ${t} (${s.status})`);const i=await s.text();return this.shaderCache.set(t,i),i}catch(t){return null}}compileShader(t,e){this.gl.VERTEX_SHADER;const s=this.gl.createShader(e);return this.gl.shaderSource(s,t),this.gl.compileShader(s),this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)?s:(this.gl.getShaderInfoLog(s),this.gl.deleteShader(s),null)}createProgram(t,e){const s=this.compileShader(t,this.gl.VERTEX_SHADER),i=this.compileShader(e,this.gl.FRAGMENT_SHADER);if(!s||!i)return null;const a=this.gl.createProgram();return this.gl.attachShader(a,s),this.gl.attachShader(a,i),this.gl.linkProgram(a),this.gl.getProgramParameter(a,this.gl.LINK_STATUS)?a:(this.gl.getProgramInfoLog(a),this.gl.deleteProgram(a),null)}setupVertexBuffer(t){const e=new Float32Array([-1,-1,1,-1,-1,1,1,1]),s=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW);const i=this.gl.getAttribLocation(t,"a_position");this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,0,0)}async loadTheme(t){if(!this.webglSupported)return!1;const e=this.themeShaders[t.toLowerCase()];if(!e)return!1;const s=await this.loadShaderSource(e);if(!s)return!1;const i=this.createProgram("\n            attribute vec2 a_position;\n            void main() {\n                gl_Position = vec4(a_position, 0.0, 1.0);\n            }\n        ",s);return!!i&&(this.program&&this.gl.deleteProgram(this.program),this.program=i,this.currentTheme=t,this.gl.useProgram(i),this.setupVertexBuffer(i),this.uniforms={resolution:this.gl.getUniformLocation(i,"u_resolution"),time:this.gl.getUniformLocation(i,"u_time"),intensity:this.gl.getUniformLocation(i,"u_intensity")},!0)}activate(t){this.webglSupported&&(this.canvas.parentElement||document.body.insertBefore(this.canvas,document.body.firstChild),this.loadTheme(t).then(t=>{t&&(this.enabled=!0,this.resume())}))}deactivate(){this.pause(),this.canvas&&this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas),this.enabled=!1}render(){if(!this.enabled||!this.program||!this.gl)return;const t=Date.now(),e=(t-this.startTime)/1e3;this.fpsCounter.frames++,t-this.fpsCounter.lastTime>=1e3&&(this.fpsCounter.fps=this.fpsCounter.frames,this.fpsCounter.frames=0,this.fpsCounter.lastTime=t,this.settings.adaptiveQuality&&this.adjustQuality()),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.uniform2f(this.uniforms.resolution,this.canvas.width,this.canvas.height),this.gl.uniform1f(this.uniforms.time,e),this.gl.uniform1f(this.uniforms.intensity,this.intensity),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.animationId=requestAnimationFrame(()=>this.render())}adjustQuality(){this.fpsCounter.fps<30&&"low"!==this.settings.quality?(this.settings.quality="low",this.handleResize()):this.fpsCounter.fps>55&&"low"===this.settings.quality&&(this.settings.quality="medium",this.handleResize())}pause(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}resume(){!this.animationId&&this.enabled&&this.render()}setIntensity(t){this.intensity=Math.max(0,Math.min(1,t))}toggle(){return this.enabled=!this.enabled,this.enabled?this.resume():this.pause(),this.enabled}destroy(){this.pause(),this.canvas&&this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas),this.gl&&this.program&&this.gl.deleteProgram(this.program),window.removeEventListener("resize",this.handleResize),this.canvas=null,this.gl=null,this.program=null,this.shaderCache.clear()}getStatus(){return{enabled:this.enabled,supported:this.webglSupported,theme:this.currentTheme,fps:this.fpsCounter.fps,quality:this.settings.quality,intensity:this.intensity}}}"undefined"!=typeof window&&(window.ShaderThemeManager=ShaderThemeManager);