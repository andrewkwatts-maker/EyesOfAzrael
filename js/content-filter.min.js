class ContentFilter{constructor(){this.db="undefined"!=typeof firebase&&firebase.firestore?firebase.firestore():null,this.auth="undefined"!=typeof firebase&&firebase.auth?firebase.auth():null,this.defaultSettings={mode:"defaults-self",hiddenUsers:[],hiddenTopics:[],hiddenSubtopics:[]},this.settings=this.loadSettings(),this.init()}init(){this.auth&&this.auth.onAuthStateChanged(t=>{t&&this.loadUserSettings()}),this.dispatchFilterChangeEvent()}loadSettings(){try{const t=localStorage.getItem("contentFilterSettings");if(t){const s=JSON.parse(t);return{...this.defaultSettings,...s}}}catch(t){}return{...this.defaultSettings}}saveSettings(){try{localStorage.setItem("contentFilterSettings",JSON.stringify(this.settings)),this.dispatchFilterChangeEvent()}catch(t){}}async loadUserSettings(){if(this.db&&this.auth&&this.auth.currentUser)try{const t=this.auth.currentUser.uid,s=await this.db.collection("userSettings").doc(t).get();if(s.exists){const t=s.data().contentFilter;t&&(this.settings={...this.defaultSettings,...t},this.saveSettings())}}catch(t){}}async saveUserSettings(){if(this.db&&this.auth&&this.auth.currentUser)try{const t=this.auth.currentUser.uid;await this.db.collection("userSettings").doc(t).set({contentFilter:this.settings,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})}catch(t){}}getMode(){return this.settings.mode}setMode(t){["defaults-only","defaults-self","everyone"].includes(t)&&(this.settings.mode=t,this.saveSettings(),this.saveUserSettings())}shouldShow(t){if(!t)return!1;const s=this.auth?.currentUser?.uid,e=!t.userId||!0===t.official,i=t.userId&&t.userId===s;if(t.userId&&this.settings.hiddenUsers.includes(t.userId))return!1;if(t.userTopic&&this.settings.hiddenTopics.includes(t.userTopic))return!1;if(t.userSubtopic&&this.settings.hiddenSubtopics.includes(t.userSubtopic))return!1;switch(this.settings.mode){case"defaults-only":return e;case"defaults-self":return e||i;default:return!0}}hideUser(t){t&&(this.settings.hiddenUsers.includes(t)||(this.settings.hiddenUsers.push(t),this.saveSettings(),this.saveUserSettings()))}unhideUser(t){if(!t)return;const s=this.settings.hiddenUsers.indexOf(t);s>-1&&(this.settings.hiddenUsers.splice(s,1),this.saveSettings(),this.saveUserSettings())}isUserHidden(t){return this.settings.hiddenUsers.includes(t)}hideTopic(t){t&&(this.settings.hiddenTopics.includes(t)||(this.settings.hiddenTopics.push(t),this.saveSettings(),this.saveUserSettings()))}unhideTopic(t){if(!t)return;const s=this.settings.hiddenTopics.indexOf(t);s>-1&&(this.settings.hiddenTopics.splice(s,1),this.saveSettings(),this.saveUserSettings())}isTopicHidden(t){return this.settings.hiddenTopics.includes(t)}hideSubtopic(t){t&&(this.settings.hiddenSubtopics.includes(t)||(this.settings.hiddenSubtopics.push(t),this.saveSettings(),this.saveUserSettings()))}unhideSubtopic(t){if(!t)return;const s=this.settings.hiddenSubtopics.indexOf(t);s>-1&&(this.settings.hiddenSubtopics.splice(s,1),this.saveSettings(),this.saveUserSettings())}isSubtopicHidden(t){return this.settings.hiddenSubtopics.includes(t)}getHiddenUsers(){return[...this.settings.hiddenUsers]}getHiddenTopics(){return[...this.settings.hiddenTopics]}getHiddenSubtopics(){return[...this.settings.hiddenSubtopics]}clearAllHidden(){this.settings.hiddenUsers=[],this.settings.hiddenTopics=[],this.settings.hiddenSubtopics=[],this.saveSettings(),this.saveUserSettings()}getStats(){return{mode:this.settings.mode,hiddenUsersCount:this.settings.hiddenUsers.length,hiddenTopicsCount:this.settings.hiddenTopics.length,hiddenSubtopicsCount:this.settings.hiddenSubtopics.length}}dispatchFilterChangeEvent(){const t=new CustomEvent("contentFilterChanged",{detail:{mode:this.settings.mode,stats:this.getStats()}});window.dispatchEvent(t)}getModeLabel(t=this.settings.mode){return{"defaults-only":"ğŸ›ï¸ Official Content Only","defaults-self":"ğŸ›ï¸ + ğŸ‘¤ Official + My Content",everyone:"ğŸŒ Everyone's Content"}[t]||t}getModeDescription(t=this.settings.mode){return{"defaults-only":"Show only official Eyes of Azrael content. User submissions are hidden.","defaults-self":"Show official content plus your own submissions. Other users' content is hidden.",everyone:"Show all content from all users. Full wiki experience."}[t]||""}}window.contentFilter=new ContentFilter;