<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migration Progress Dashboard - Eyes of Azrael</title>
    <link rel="stylesheet" href="css/spinner.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .dashboard-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .dashboard-header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: #ddd;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-card .subtext {
            font-size: 0.9rem;
            color: #ccc;
        }

        .progress-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .progress-section h2 {
            margin-bottom: 20px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar-container {
            margin-bottom: 30px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .progress-label .name {
            font-weight: 600;
            color: #fff;
        }

        .progress-label .percentage {
            color: #667eea;
            font-weight: bold;
        }

        .progress-bar {
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .stage-progress {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stage-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .stage-card.active {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .stage-card.complete {
            border-color: #28a745;
            background: #e8f5e9;
        }

        .stage-card .stage-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .stage-card .stage-name {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #fff;
        }

        .stage-card .stage-count {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }

        .mythology-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .mythology-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #667eea;
        }

        .mythology-card .myth-name {
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: capitalize;
            color: #fff;
        }

        .mythology-card .myth-stats {
            font-size: 0.9rem;
            color: #ccc;
        }

        .mythology-card .mini-progress {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }

        .mythology-card .mini-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .activity-log {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 12px;
            border-left: 3px solid #667eea;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .activity-item .timestamp {
            font-size: 0.85rem;
            color: #999;
            margin-bottom: 4px;
        }

        .activity-item .message {
            color: #fff;
        }

        .issues-list {
            margin-top: 15px;
        }

        .issue-item {
            padding: 12px;
            background: rgba(255, 243, 205, 0.3);
            backdrop-filter: blur(10px);
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .issue-item.error {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .issue-item .issue-file {
            font-weight: 600;
            margin-bottom: 4px;
            color: #fff;
        }

        .issue-item .issue-message {
            font-size: 0.9rem;
            color: #ddd;
        }

        .refresh-btn {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 20px;
        }

        .refresh-btn:hover {
            transform: scale(1.05);
        }

        .last-updated {
            text-align: center;
            color: white;
            margin-top: 20px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .eta-section {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
        }

        .eta-section h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .eta-section .eta-time {
            font-size: 2rem;
            font-weight: bold;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1><span class="live-indicator"></span>Migration Progress Dashboard</h1>
            <p class="subtitle">Eyes of Azrael - Firebase Migration</p>
        </div>

        <button class="refresh-btn" onclick="loadTrackerData()">üîÑ Refresh Data</button>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Files</h3>
                <div class="value" id="totalFiles">0</div>
                <div class="subtext">To migrate</div>
            </div>
            <div class="stat-card">
                <h3>Overall Progress</h3>
                <div class="value" id="overallProgress">0%</div>
                <div class="subtext" id="completedFiles">0 completed</div>
            </div>
            <div class="stat-card">
                <h3>Mythologies</h3>
                <div class="value" id="mythologyCount">0</div>
                <div class="subtext">Active mythologies</div>
            </div>
            <div class="stat-card">
                <h3>Entity Types</h3>
                <div class="value" id="entityTypeCount">0</div>
                <div class="subtext">Different types</div>
            </div>
        </div>

        <div class="eta-section">
            <h3>Estimated Completion Time</h3>
            <div class="eta-time" id="etaTime">Calculating...</div>
        </div>

        <div class="progress-section">
            <h2>üìä Overall Progress</h2>
            <div class="progress-bar-container">
                <div class="progress-label">
                    <span class="name">Total Migration Progress</span>
                    <span class="percentage" id="totalPercentage">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="totalProgressFill" style="width: 0%">
                        <span id="totalProgressText">0 / 0</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="progress-section">
            <h2>üéØ Stage Progress</h2>
            <div class="stage-progress" id="stageProgress">
                <!-- Populated by JS -->
            </div>
        </div>

        <div class="progress-section">
            <h2>üó∫Ô∏è Progress by Mythology</h2>
            <div class="mythology-grid" id="mythologyGrid">
                <!-- Populated by JS -->
            </div>
        </div>

        <div class="progress-section">
            <h2>üìù Recent Activity</h2>
            <div class="activity-log" id="activityLog">
                <div class="activity-item">
                    <div class="timestamp">Just now</div>
                    <div class="message">Dashboard initialized. Waiting for migration data...</div>
                </div>
            </div>
        </div>

        <div class="progress-section">
            <h2>‚ö†Ô∏è Issues & Blockers</h2>
            <div class="issues-list" id="issuesList">
                <p style="color: #28a745; text-align: center; padding: 20px;">No issues reported yet ‚úì</p>
            </div>
        </div>

        <div class="last-updated">
            Last updated: <span id="lastUpdated">Never</span>
        </div>
    </div>

    <script>
        let trackerData = null;

        async function loadTrackerData() {
            try {
                const response = await fetch('./MIGRATION_TRACKER.json');
                trackerData = await response.json();
                updateDashboard();
            } catch (error) {
                console.error('Error loading tracker data:', error);
                alert('Could not load migration tracker. Make sure MIGRATION_TRACKER.json exists.');
            }
        }

        function updateDashboard() {
            if (!trackerData) return;

            // Update stats
            document.getElementById('totalFiles').textContent = trackerData.totalFiles;
            document.getElementById('mythologyCount').textContent = Object.keys(trackerData.byMythology).length;
            document.getElementById('entityTypeCount').textContent = Object.keys(trackerData.byEntityType).length;

            // Calculate overall progress
            const totalStages = trackerData.totalFiles * 6; // 6 stages per file
            const completedStages = Object.values(trackerData.stages).reduce((a, b) => a + b, 0);
            const overallPercentage = totalStages > 0 ? Math.round((completedStages / totalStages) * 100) : 0;

            document.getElementById('overallProgress').textContent = overallPercentage + '%';
            document.getElementById('completedFiles').textContent = trackerData.stages.deployed + ' fully deployed';
            document.getElementById('totalPercentage').textContent = overallPercentage + '%';
            document.getElementById('totalProgressFill').style.width = overallPercentage + '%';
            document.getElementById('totalProgressText').textContent = `${completedStages} / ${totalStages} stages`;

            // Update stage progress
            const stages = [
                { name: 'Extracted', key: 'extracted', icon: 'üìÑ' },
                { name: 'Validated', key: 'validated', icon: '‚úÖ' },
                { name: 'Uploaded', key: 'uploaded', icon: '‚òÅÔ∏è' },
                { name: 'Converted', key: 'converted', icon: 'üîÑ' },
                { name: 'Tested', key: 'tested', icon: 'üß™' },
                { name: 'Deployed', key: 'deployed', icon: 'üöÄ' }
            ];

            const stageHTML = stages.map(stage => {
                const count = trackerData.stages[stage.key];
                const percentage = Math.round((count / trackerData.totalFiles) * 100);
                const isComplete = count === trackerData.totalFiles;
                const isActive = count > 0 && !isComplete;

                return `
                    <div class="stage-card ${isComplete ? 'complete' : isActive ? 'active' : ''}">
                        <div class="stage-icon">${stage.icon}</div>
                        <div class="stage-name">${stage.name}</div>
                        <div class="stage-count">${count} / ${trackerData.totalFiles}</div>
                        <div style="font-size: 0.85rem; color: #666;">${percentage}%</div>
                    </div>
                `;
            }).join('');
            document.getElementById('stageProgress').innerHTML = stageHTML;

            // Update mythology breakdown
            const mythologyHTML = Object.entries(trackerData.byMythology)
                .sort((a, b) => b[1].total - a[1].total)
                .map(([myth, stats]) => {
                    const deployed = stats.deployed || 0;
                    const percentage = Math.round((deployed / stats.total) * 100);

                    return `
                        <div class="mythology-card">
                            <div class="myth-name">${myth}</div>
                            <div class="myth-stats">
                                ${deployed} / ${stats.total} deployed (${percentage}%)
                            </div>
                            <div class="mini-progress">
                                <div class="mini-progress-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');
            document.getElementById('mythologyGrid').innerHTML = mythologyHTML;

            // Collect issues
            const issues = trackerData.files
                .filter(file => file.issues && file.issues.length > 0)
                .flatMap(file => file.issues.map(issue => ({ ...issue, file: file.path })));

            if (issues.length > 0) {
                const issuesHTML = issues.map(issue => `
                    <div class="issue-item ${issue.severity === 'error' ? 'error' : ''}">
                        <div class="issue-file">${issue.file}</div>
                        <div class="issue-message">${issue.message}</div>
                    </div>
                `).join('');
                document.getElementById('issuesList').innerHTML = issuesHTML;
            }

            // Calculate ETA
            const completedFiles = trackerData.stages.deployed;
            const remainingFiles = trackerData.totalFiles - completedFiles;
            const estimatedHoursPerFile = 0.05; // 3 minutes per file
            const estimatedHours = remainingFiles * estimatedHoursPerFile;

            let etaText;
            if (remainingFiles === 0) {
                etaText = 'Complete! üéâ';
            } else if (estimatedHours < 1) {
                etaText = `${Math.round(estimatedHours * 60)} minutes`;
            } else if (estimatedHours < 24) {
                etaText = `${Math.round(estimatedHours * 10) / 10} hours`;
            } else {
                etaText = `${Math.round(estimatedHours / 24 * 10) / 10} days`;
            }
            document.getElementById('etaTime').textContent = etaText;

            // Update timestamp
            const lastUpdate = new Date(trackerData.lastUpdate);
            document.getElementById('lastUpdated').textContent = lastUpdate.toLocaleString();
        }

        // Auto-refresh every 30 seconds
        setInterval(loadTrackerData, 30000);

        // Initial load
        loadTrackerData();
    </script>
</body>
</html>
