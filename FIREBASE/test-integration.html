<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Integration Test - Eyes of Azrael</title>

    <!-- Theme System CSS -->
    <link rel="stylesheet" href="css/firebase-themes.css">

    <style>
        body {
            margin: 0;
            padding: 2rem;
            min-height: 100vh;
        }

        .test-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--theme-primary);
        }

        .theme-selector {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .theme-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--theme-primary);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .theme-btn:hover {
            background: var(--theme-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--theme-shadow);
        }

        .theme-btn.active {
            background: var(--theme-primary);
            font-weight: bold;
        }

        .content-filters {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: rgba(255, 255, 255, 0.15);
            color: var(--theme-primary);
            border-color: var(--theme-primary);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--theme-primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
    </style>
</head>
<body data-theme="greek">
    <div class="test-container">
        <h1>üî• Firebase Integration Test</h1>

        <!-- Theme Selector -->
        <div class="theme-selector">
            <button class="theme-btn active" data-theme="greek">üèõÔ∏è Greek</button>
            <button class="theme-btn" data-theme="egyptian">üè∫ Egyptian</button>
            <button class="theme-btn" data-theme="norse">‚öîÔ∏è Norse</button>
            <button class="theme-btn" data-theme="hindu">üïâÔ∏è Hindu</button>
            <button class="theme-btn" data-theme="buddhist">üôè Buddhist</button>
            <button class="theme-btn" data-theme="christian">‚úùÔ∏è Christian</button>
            <button class="theme-btn" data-theme="islamic">‚ò™Ô∏è Islamic</button>
            <button class="theme-btn" data-theme="celtic">üçÄ Celtic</button>
        </div>

        <!-- Firebase Stats -->
        <div class="stats" id="firebase-stats">
            <div class="stat-card">
                <div class="stat-value" id="deities-count">-</div>
                <div class="stat-label">Deities</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="heroes-count">-</div>
                <div class="stat-label">Heroes</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="creatures-count">-</div>
                <div class="stat-label">Creatures</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="cosmology-count">-</div>
                <div class="stat-label">Cosmology</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-count">-</div>
                <div class="stat-label">Total Documents</div>
            </div>
        </div>

        <!-- Content Type Filters -->
        <div class="content-filters">
            <button class="filter-btn active" data-type="all">All Content</button>
            <button class="filter-btn" data-type="deities">Deities</button>
            <button class="filter-btn" data-type="heroes">Heroes</button>
            <button class="filter-btn" data-type="creatures">Creatures</button>
            <button class="filter-btn" data-type="cosmology">Cosmology</button>
            <button class="filter-btn" data-type="texts">Texts</button>
        </div>

        <!-- Content Grid -->
        <div id="content-container" class="glass-grid">
            <div class="loading-container">
                <div class="loading-spinner"></div>
                <p>Loading content from Firebase...</p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Firebase Configuration -->
    <script src="../firebase-config.js"></script>

    <!-- Theme Manager -->
    <script src="js/theme-manager.js"></script>

    <!-- Firebase Content Loader -->
    <script type="module">
        import { FirebaseContentLoader } from './js/firebase-content-loader.js';

        // Use globally initialized Firebase (from firebase-config.js)
        const db = window.firebaseDb;

        // Initialize theme manager
        const themeManager = new ThemeManager();
        themeManager.init();

        // Theme selector buttons
        document.querySelectorAll('.theme-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const theme = btn.dataset.theme;
                themeManager.setTheme(theme);

                // Update active state
                document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // Load Firebase stats
        async function loadStats() {
            const collections = ['deities', 'heroes', 'creatures', 'cosmology'];
            let total = 0;

            for (const collection of collections) {
                try {
                    const snapshot = await db.collection(collection).get();
                    const count = snapshot.size;
                    total += count;

                    const countEl = document.getElementById(`${collection}-count`);
                    if (countEl) {
                        countEl.textContent = count;
                        countEl.style.animation = 'fadeInUp 0.6s ease';
                    }
                } catch (error) {
                    console.error(`Error loading ${collection}:`, error);
                    const countEl = document.getElementById(`${collection}-count`);
                    if (countEl) countEl.textContent = 'Error';
                }
            }

            const totalEl = document.getElementById('total-count');
            if (totalEl) {
                totalEl.textContent = total;
                totalEl.style.animation = 'fadeInUp 0.8s ease';
            }
        }

        // Load content
        const loader = new FirebaseContentLoader();
        let currentType = 'all';

        async function loadContent(type = 'all') {
            currentType = type;
            const container = document.getElementById('content-container');
            container.innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <p>Loading ${type}...</p>
                </div>
            `;

            try {
                if (type === 'all') {
                    // Load all content types
                    const types = ['deities', 'heroes', 'creatures', 'cosmology', 'texts'];
                    const promises = types.map(t =>
                        loader.loadContent(t, { limit: 10 })
                    );
                    await Promise.all(promises);

                    // Combine all loaded items
                    const allItems = [];
                    types.forEach(t => {
                        const items = loader.getItems();
                        allItems.push(...items.slice(0, 10));
                    });

                    loader.items = allItems;
                } else {
                    await loader.loadContent(type, { limit: 50 });
                }

                loader.renderContent('content-container', type === 'all' ? 'mixed' : type);
            } catch (error) {
                console.error('Error loading content:', error);
                container.innerHTML = `
                    <div class="glass-card" style="text-align: center; padding: 3rem;">
                        <h2>‚ö†Ô∏è Error Loading Content</h2>
                        <p>${error.message}</p>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">
                            Make sure Firebase is configured correctly in firebase-config.js
                        </p>
                    </div>
                `;
            }
        }

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const type = btn.dataset.type;
                loadContent(type);

                // Update active state
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // Initialize
        loadStats();
        loadContent('all');
    </script>

    <style>
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</body>
</html>
