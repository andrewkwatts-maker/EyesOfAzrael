<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submission Link Component Test</title>
    <link rel="stylesheet" href="css/submission-link.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #e5e7eb;
            padding: 2rem;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #8B7FFF;
        }

        h2 {
            font-size: 1.5rem;
            margin: 2rem 0 1rem;
            color: #FF7EB6;
        }

        .test-section {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(139, 127, 255, 0.3);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .test-item {
            background: rgba(30, 41, 59, 0.8);
            padding: 1rem;
            border-radius: 0.375rem;
            border: 1px solid rgba(139, 127, 255, 0.2);
        }

        .test-item h3 {
            font-size: 1rem;
            color: #8B7FFF;
            margin-bottom: 0.5rem;
        }

        .dropdown-demo {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(139, 127, 255, 0.3);
            border-radius: 0.5rem;
            padding: 0.5rem;
            max-width: 300px;
        }

        .status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .status--pass {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
        }

        .status--fail {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        code {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875em;
            color: #FF7EB6;
        }

        .notice {
            background: rgba(255, 126, 182, 0.1);
            border: 1px solid rgba(255, 126, 182, 0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 2rem;
        }

        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Submission Link Component Test</h1>
        <div class="notice">
            <p><strong>âœ“ FAB Auto-Injected!</strong> Check the bottom-right corner for the floating action button.</p>
        </div>

        <div id="test-results"></div>

        <h2>1. Context Detection Tests</h2>
        <div class="test-section">
            <p>Testing automatic context detection from URL patterns:</p>
            <div id="context-tests"></div>
        </div>

        <h2>2. Button Style Tests</h2>

        <div class="test-section">
            <h3>FAB Style</h3>
            <p>FAB has been auto-injected in bottom-right corner.</p>
            <span class="status status--pass" id="fab-status">Checking...</span>
        </div>

        <div class="test-section">
            <h3>Inline Style</h3>
            <div class="button-container" id="inline-buttons"></div>
        </div>

        <div class="test-section">
            <h3>Dropdown Style</h3>
            <div class="dropdown-demo" id="dropdown-menu"></div>
        </div>

        <div class="test-section">
            <h3>Card Style</h3>
            <div class="test-grid" id="card-grid"></div>
        </div>

        <h2>3. API Method Tests</h2>
        <div class="test-section" id="api-tests"></div>

        <h2>4. Custom Configuration Tests</h2>
        <div class="test-section">
            <h3>Custom Label & Icon</h3>
            <div class="button-container" id="custom-buttons"></div>
        </div>

        <div class="test-section">
            <h3>Additional Classes</h3>
            <div class="button-container" id="class-buttons"></div>
        </div>

        <h2>Test Summary</h2>
        <div class="test-section" id="summary"></div>
    </div>

    <script src="js/components/submission-link.js"></script>
    <script>
        // Test results tracking
        const results = {
            passed: 0,
            failed: 0,
            tests: []
        };

        function addTest(name, passed, message = '') {
            results.tests.push({ name, passed, message });
            if (passed) {
                results.passed++;
            } else {
                results.failed++;
            }
        }

        function updateSummary() {
            const summaryEl = document.getElementById('summary');
            const total = results.passed + results.failed;
            const percentage = total > 0 ? Math.round((results.passed / total) * 100) : 0;

            summaryEl.innerHTML = `
                <h3>Results: ${results.passed}/${total} tests passed (${percentage}%)</h3>
                <div style="margin-top: 1rem;">
                    ${results.tests.map(test => `
                        <div style="margin-bottom: 0.5rem;">
                            <span class="status ${test.passed ? 'status--pass' : 'status--fail'}">
                                ${test.passed ? 'âœ“' : 'âœ—'} ${test.name}
                            </span>
                            ${test.message ? `<p style="margin-left: 1rem; margin-top: 0.25rem; font-size: 0.875rem; color: #9ca3af;">${test.message}</p>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Test 1: Context Detection
        console.log('Test 1: Context Detection');
        const contextTestsEl = document.getElementById('context-tests');
        const testContexts = [
            { url: '/mythos/christian/deities/', expected: 'deity', expectedLabel: 'Add Deity' },
            { url: '/mythos/greek/heroes/', expected: 'hero', expectedLabel: 'Add Hero' },
            { url: '/mythos/norse/creatures/', expected: 'creature', expectedLabel: 'Add Creature' },
            { url: '/theories/', expected: 'theory', expectedLabel: 'Submit Theory' }
        ];

        testContexts.forEach(test => {
            const detected = SubmissionLink.CONTEXT_PATTERNS.find(p => p.pattern.test(test.url));
            const passed = detected && detected.context === test.expected && detected.label === test.expectedLabel;
            addTest(
                `Context detection for ${test.url}`,
                passed,
                passed ? `Correctly detected: ${detected.label}` : `Failed to detect correctly`
            );
        });

        // Test 2: FAB Auto-Injection
        console.log('Test 2: FAB Auto-Injection');
        SubmissionLink.autoInject();
        setTimeout(() => {
            const fab = document.querySelector('.submission-link--fab');
            const fabStatus = document.getElementById('fab-status');
            if (fab) {
                fabStatus.textContent = 'âœ“ FAB injected successfully';
                fabStatus.className = 'status status--pass';
                addTest('FAB auto-injection', true, 'FAB found in DOM');
            } else {
                fabStatus.textContent = 'âœ— FAB not found';
                fabStatus.className = 'status status--fail';
                addTest('FAB auto-injection', false, 'FAB not found in DOM');
            }
            updateSummary();
        }, 100);

        // Test 3: Inline Buttons
        console.log('Test 3: Inline Buttons');
        const inlineContainer = document.getElementById('inline-buttons');
        try {
            const inline1 = SubmissionLink.createInline({ label: 'Test Inline 1' });
            const inline2 = SubmissionLink.createInline({ label: 'Test Inline 2', icon: 'ðŸŽ¯' });
            inlineContainer.appendChild(inline1);
            inlineContainer.appendChild(inline2);
            addTest('Inline button creation', true, 'Created 2 inline buttons');
        } catch (e) {
            addTest('Inline button creation', false, e.message);
        }

        // Test 4: Dropdown Items
        console.log('Test 4: Dropdown Items');
        const dropdownContainer = document.getElementById('dropdown-menu');
        try {
            ['Add Deity', 'Add Hero', 'Add Creature', 'Submit Theory'].forEach(label => {
                const item = SubmissionLink.createDropdownItem({ label });
                dropdownContainer.appendChild(item);
            });
            addTest('Dropdown item creation', true, 'Created 4 dropdown items');
        } catch (e) {
            addTest('Dropdown item creation', false, e.message);
        }

        // Test 5: Card Buttons
        console.log('Test 5: Card Buttons');
        const cardGrid = document.getElementById('card-grid');
        try {
            const cardConfigs = [
                { label: 'Add Deity', icon: 'âž•' },
                { label: 'Add Hero', icon: 'âž•' },
                { label: 'Submit Theory', icon: 'ðŸ“' }
            ];
            cardConfigs.forEach(config => {
                const card = SubmissionLink.createCardButton(config);
                const wrapper = document.createElement('div');
                wrapper.className = 'test-item';
                wrapper.innerHTML = `<h3>${config.label}</h3>`;
                wrapper.appendChild(card);
                cardGrid.appendChild(wrapper);
            });
            addTest('Card button creation', true, 'Created 3 card buttons');
        } catch (e) {
            addTest('Card button creation', false, e.message);
        }

        // Test 6: API Methods
        console.log('Test 6: API Methods');
        const apiTestsEl = document.getElementById('api-tests');
        const apiTests = [
            {
                name: 'SubmissionLink.render()',
                test: () => {
                    const html = SubmissionLink.render({ style: 'inline' });
                    return typeof html === 'string' && html.includes('submission-link');
                }
            },
            {
                name: 'SubmissionLink.isSubmissionPage()',
                test: () => {
                    const result = SubmissionLink.isSubmissionPage();
                    return typeof result === 'boolean';
                }
            },
            {
                name: 'new SubmissionLink() constructor',
                test: () => {
                    const link = new SubmissionLink({ style: 'inline' });
                    return link && link.element && link.element.classList.contains('submission-link');
                }
            }
        ];

        apiTests.forEach(({ name, test }) => {
            try {
                const passed = test();
                addTest(name, passed, passed ? 'Method works correctly' : 'Method returned unexpected result');
            } catch (e) {
                addTest(name, false, `Error: ${e.message}`);
            }
        });

        // Test 7: Custom Configuration
        console.log('Test 7: Custom Configuration');
        const customButtons = document.getElementById('custom-buttons');
        try {
            const custom1 = SubmissionLink.createInline({
                label: 'Custom Label',
                icon: 'ðŸ”¥'
            });
            const custom2 = SubmissionLink.createInline({
                label: 'Another Custom',
                icon: 'â­'
            });
            customButtons.appendChild(custom1);
            customButtons.appendChild(custom2);
            addTest('Custom label and icon', true, 'Custom configurations applied');
        } catch (e) {
            addTest('Custom label and icon', false, e.message);
        }

        // Test 8: Additional Classes
        console.log('Test 8: Additional Classes');
        const classButtons = document.getElementById('class-buttons');
        try {
            const withClass = new SubmissionLink({
                style: 'inline',
                className: 'custom-test-class another-class'
            });
            classButtons.appendChild(withClass.element);
            const hasClasses = withClass.element.classList.contains('custom-test-class') &&
                              withClass.element.classList.contains('another-class');
            addTest('Additional CSS classes', hasClasses, hasClasses ? 'Classes applied correctly' : 'Classes not applied');
        } catch (e) {
            addTest('Additional CSS classes', false, e.message);
        }

        // Test 9: Element Structure
        console.log('Test 9: Element Structure');
        try {
            const link = new SubmissionLink({ style: 'inline', label: 'Test', icon: 'âœ“' });
            const hasIcon = link.element.querySelector('.submission-link__icon');
            const hasText = link.element.querySelector('.submission-link__text');
            const passed = hasIcon && hasText;
            addTest('Element structure', passed, passed ? 'Icon and text elements present' : 'Missing required elements');
        } catch (e) {
            addTest('Element structure', false, e.message);
        }

        // Test 10: URL Calculation
        console.log('Test 10: URL Calculation');
        try {
            const link = new SubmissionLink({ style: 'inline' });
            const url = link.getSubmissionUrl();
            const hasUrl = typeof url === 'string' && url.includes('submit.html');
            addTest('URL calculation', hasUrl, hasUrl ? `URL: ${url}` : 'Invalid URL');
        } catch (e) {
            addTest('URL calculation', false, e.message);
        }

        // Update summary
        setTimeout(() => {
            updateSummary();
        }, 200);

        // Console output
        console.log('All tests completed. Check the page for results.');
    </script>
</body>
</html>
