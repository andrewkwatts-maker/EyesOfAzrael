<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparative Mythology - World Mythos Explorer</title>

    <!-- Base Theme System -->
    <link rel="stylesheet" href="../../themes/theme-base.css">
    <link rel="stylesheet" href="../../styles.css">
    <link rel="stylesheet" href="../../themes/corpus-links.css">
    <link rel="stylesheet" href="../../themes/smart-links.css">

    <!-- Firebase Theme System -->
    <link rel="stylesheet" href="/css/firebase-themes.css">

    <!-- Theme Scripts -->
    <script defer src="../../themes/theme-picker.js"></script>
    <script defer src="../../themes/theme-animations.js"></script>
    <script defer src="../../themes/smart-links.js"></script>

    <!-- Submission Link System -->
    <script src="../../js/submission-context.js"></script>
    <script src="../../js/components/submission-link.js"></script>
    <link rel="stylesheet" href="../../css/submission-link.css">

    <!-- Firebase Auth System -->
    <link rel="stylesheet" href="../../css/user-auth.css">
    <script src="../../js/firebase-auth.js"></script>
    <script src="../../js/auth-guard.js"></script>
    <script src="../../js/components/google-signin-button.js"></script>

    <style>
        /* ============================================
           FIREBASE-ENHANCED MYTHOLOGY INDEX TEMPLATE
           Combines existing styles with Firebase integration
           ============================================ */

        /* Breadcrumb - Full-width bar attached below header */
        .breadcrumb {
            position: sticky;
            top: 60px;
            left: 0;
            width: 100%;
            z-index: 999;
            background: rgba(var(--color-surface-rgb), 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: var(--spacing-xs) var(--spacing-lg);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            border-bottom: 1px solid rgba(var(--color-primary-rgb), 0.15);
        }

        .breadcrumb a {
            color: var(--color-primary);
            text-decoration: none;
            transition: all var(--transition-fast);
        }

        .breadcrumb a:hover {
            color: var(--color-secondary);
            text-decoration: underline;
        }

        /* Hero Section - Modern Glass Styling */
        .hero-section {
            background: linear-gradient(135deg,
                rgba(var(--color-primary-rgb), 0.8),
                rgba(var(--color-secondary-rgb), 0.8));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid var(--color-primary);
            color: var(--color-text-primary);
            padding: 3rem 2rem;
            text-align: center;
            border-radius: var(--radius-xl);
            margin-bottom: 2rem;
            box-shadow: var(--shadow-xl);
        }

        .hero-icon-display {
            font-size: 5rem;
            margin-bottom: var(--spacing-md);
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .hero-description {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 1rem auto;
            line-height: 1.7;
        }

        /* Glass Card - With Hover Animation */
        .glass-card {
            background: rgba(var(--color-surface-rgb), 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(var(--color-primary-rgb), 0.2);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin: 2rem 0;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-base, 0.3s ease);
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl), 0 0 20px rgba(var(--color-primary-rgb), 0.15);
            border-color: rgba(var(--color-primary-rgb), 0.4);
        }

        /* Firebase Content Sections */
        .firebase-section {
            margin: 3rem 0;
        }

        .section-header {
            color: var(--color-primary);
            margin-bottom: var(--spacing-lg);
            font-size: 2rem;
            font-weight: 700;
        }

        /* Grid Layouts */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .deity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }

        /* Loading States */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            gap: var(--spacing-md);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--theme-primary, var(--color-primary));
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 1.1rem;
            text-align: center;
        }

        /* Static Content (preserved from original) */
        .static-content {
            margin: 2rem 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }

            .deity-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .hero-section {
                padding: 2rem 1rem;
            }

            .hero-icon-display {
                font-size: 3rem;
            }

            .breadcrumb {
                font-size: var(--font-size-xs);
                padding: var(--spacing-xs) var(--spacing-md);
                top: 50px;
            }
        }
    </style>

    <link rel="stylesheet" href="/css/editable-panels.css">
</head>
<body data-theme="comparative">
    <!-- Theme Picker Container -->
    <div id="theme-picker"></div>
    <div id="theme-picker-container"></div>

    <!-- Header -->
    <header>
        <div class="header-content">
            <h1>üåç Comparative Mythology</h1>
            <div id="user-auth-nav"></div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <nav class="breadcrumb" aria-label="Breadcrumb">
        <a href="../../mythos/index.html">Home</a> ‚Üí
        <span aria-current="page">Comparative Mythology</span>
    </nav>

    <main>
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-icon-display">üåç</div>
            <h2>Comparative Mythology</h2>
            <p class="hero-description">
                Discover the universal patterns that unite world mythologies. From flood myths to creation stories, hero journeys to underworld descents, explore the shared archetypes that reveal humanity's common spiritual heritage.
            </p>
        </div>

        <!-- ============================================
             FIREBASE-LOADED DYNAMIC CONTENT SECTIONS
             These sections load from Firestore
             ============================================ -->

        <!-- Deities Section -->
        <section class="firebase-section">
            <h2 class="section-header">‚ö° Deities</h2>
            <div id="deities-loading" class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading deities from Firebase...</p>
            </div>
            <div id="deities-container" class="content-grid" style="display: none;"></div>
        </section>

        <!-- Heroes Section -->
        <section class="firebase-section">
            <h2 class="section-header">ü¶∏ Heroes & Legendary Mortals</h2>
            <div id="heroes-loading" class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading heroes from Firebase...</p>
            </div>
            <div id="heroes-container" class="content-grid" style="display: none;"></div>
        </section>

        <!-- Creatures Section -->
        <section class="firebase-section">
            <h2 class="section-header">üêâ Creatures & Monsters</h2>
            <div id="creatures-loading" class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading creatures from Firebase...</p>
            </div>
            <div id="creatures-container" class="content-grid" style="display: none;"></div>
        </section>

        <!-- Cosmology Section -->
        <section class="firebase-section">
            <h2 class="section-header">üåå Cosmology & Sacred Places</h2>
            <div id="cosmology-loading" class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading cosmology from Firebase...</p>
            </div>
            <div id="cosmology-container" class="content-grid" style="display: none;"></div>
        </section>

        <!-- Texts Section -->
        <section class="firebase-section">
            <h2 class="section-header">üìö Sacred Texts</h2>
            <div id="texts-loading" class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading texts from Firebase...</p>
            </div>
            <div id="texts-container" class="content-grid" style="display: none;"></div>
        </section>

        <!-- Herbs Section -->
        <section class="firebase-section">
            <h2 class="section-header">üåø Sacred Plants & Herbalism</h2>
            <div id="herbs-loading" class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading herbs from Firebase...</p>
            </div>
            <div id="herbs-container" class="content-grid" style="display: none;"></div>
        </section>

        <!-- Rituals Section -->
        <section class="firebase-section">
            <h2 class="section-header">üîÆ Rituals & Practices</h2>
            <div id="rituals-loading" class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading rituals from Firebase...</p>
            </div>
            <div id="rituals-container" class="content-grid" style="display: none;"></div>
        </section>

        <!-- Symbols Section -->
        <section class="firebase-section">
            <h2 class="section-header">üî± Sacred Symbols</h2>
            <div id="symbols-loading" class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading symbols from Firebase...</p>
            </div>
            <div id="symbols-container" class="content-grid" style="display: none;"></div>
        </section>

        <!-- Concepts Section -->
        <section class="firebase-section">
            <h2 class="section-header">üí≠ Mystical Concepts</h2>
            <div id="concepts-loading" class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading concepts from Firebase...</p>
            </div>
            <div id="concepts-container" class="content-grid" style="display: none;"></div>
        </section>

        <!-- Myths Section -->
        <section class="firebase-section">
            <h2 class="section-header">üìñ Myths & Legends</h2>
            <div id="myths-loading" class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Loading myths from Firebase...</p>
            </div>
            <div id="myths-container" class="content-grid" style="display: none;"></div>
        </section>

        <!-- ============================================
             STATIC CUSTOM CONTENT (PRESERVED)
             Add any mythology-specific static content here
             ============================================ -->
        <div class="static-content">
            <!-- Add custom static content here -->
        </div>

        <!-- Cross-Cultural Parallels Section -->
        <section class="interlink-panel" style="margin-top: var(--spacing-xl, 3rem);">
            <h3 class="interlink-header">
                <span class="interlink-icon">üåç</span>
                Cross-Cultural Parallels
            </h3>
            <p style="margin-bottom: var(--spacing-lg); color: var(--color-text-secondary);">
                Explore how Comparative mythology connects with other world traditions through shared themes and archetypes.
            </p>
            <div class="parallel-grid">
                <!-- Parallel mythology links will be added here -->
            </div>
        </section>

        <!-- Related Traditions -->
        <section style="margin-top: var(--spacing-xl, 3rem);">
            <h2 class="section-header">üîó Related Traditions</h2>
            <div class="glass-card">
                <h3>Explore Other Mythologies</h3>
                <div class="button-grid" style="display: flex; flex-wrap: wrap; gap: var(--spacing-md);">
                    <a class="btn btn-secondary" href="../greek/index.html">Greek</a>
                    <a class="btn btn-secondary" href="../roman/index.html">Roman</a>
                    <a class="btn btn-secondary" href="../norse/index.html">Norse</a>
                    <a class="btn btn-secondary" href="../egyptian/index.html">Egyptian</a>
                    <a class="btn btn-secondary" href="../hindu/index.html">Hindu</a>
                    <a class="btn btn-secondary" href="../buddhist/index.html">Buddhist</a>
                    <a class="btn btn-secondary" href="../celtic/index.html">Celtic</a>
                    <a class="btn btn-secondary" href="../christian/index.html">Christian</a>
                    <a class="btn btn-secondary" href="../islamic/index.html">Islamic</a>
                    <a class="btn btn-secondary" href="../jewish/index.html">Jewish</a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <p>
            <strong>Comparative Mythology</strong> - World Mythos Explorer<br>
            <a href="../../mythos/index.html">Back to World Mythos Home</a> |
            <a href="../../index.html">Main Site</a>
        </p>
    </footer>

    <!-- Auto-inject submission button -->
    <script>
        if (window.SubmissionLink) {
            window.SubmissionLink.autoInject();
        }
    </script>

    <!-- Firebase SDK (CDN) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Firebase Configuration -->
    <script src="../../firebase-config.js"></script>

    <!-- Firebase Content Loader (Module) -->
    <script type="module">
        import { FirebaseContentLoader } from '/js/firebase-content-loader.js';

        // Wait for Firebase to initialize
        window.addEventListener('load', async () => {
            try {
                // Check if Firebase is initialized
                if (!window.firebaseApp || !window.firebaseDb) {
                    console.error('[Index] Firebase not initialized');
                    showGlobalError('Firebase is not configured. Please check firebase-config.js');
                    return;
                }

                console.log('[Index] Initializing Firebase Content Loader for comparative');

                // Create content loader instance
                const loader = new FirebaseContentLoader(window.firebaseApp);
                const mythology = 'comparative'; // e.g., 'greek', 'norse', 'egyptian'

                // Content types to load
                const contentTypes = [
                    { type: 'deities', container: 'deities-container', loading: 'deities-loading' },
                    { type: 'heroes', container: 'heroes-container', loading: 'heroes-loading' },
                    { type: 'creatures', container: 'creatures-container', loading: 'creatures-loading' },
                    { type: 'cosmology', container: 'cosmology-container', loading: 'cosmology-loading' },
                    { type: 'texts', container: 'texts-container', loading: 'texts-loading' },
                    { type: 'herbs', container: 'herbs-container', loading: 'herbs-loading' },
                    { type: 'rituals', container: 'rituals-container', loading: 'rituals-loading' },
                    { type: 'symbols', container: 'symbols-container', loading: 'symbols-loading' },
                    { type: 'concepts', container: 'concepts-container', loading: 'concepts-loading' },
                    { type: 'myths', container: 'myths-container', loading: 'myths-loading' }
                ];

                // Load each content type
                for (const { type, container, loading } of contentTypes) {
                    try {
                        console.log(`[Index] Loading ${type} for ${mythology}...`);

                        // Load content filtered by mythology
                        await loader.loadContent(type, { mythology: mythology });

                        // Hide loading, show container
                        const loadingEl = document.getElementById(loading);
                        const containerEl = document.getElementById(container);

                        if (loadingEl) loadingEl.style.display = 'none';
                        if (containerEl) containerEl.style.display = 'grid';

                        // Render content
                        loader.renderContent(container, type);

                        console.log(`[Index] ‚úì ${type} loaded successfully`);

                    } catch (error) {
                        console.error(`[Index] Error loading ${type}:`, error);

                        // Hide loading, show error
                        const loadingEl = document.getElementById(loading);
                        const containerEl = document.getElementById(container);

                        if (loadingEl) {
                            loadingEl.innerHTML = `
                                <div class="error-container">
                                    <div class="error-title">Failed to load ${type}</div>
                                    <div class="error-message">${error.message}</div>
                                </div>
                            `;
                        }
                    }
                }

                console.log('[Index] All content loaded successfully');

            } catch (error) {
                console.error('[Index] Fatal error:', error);
                showGlobalError('Failed to load content: ' + error.message);
            }
        });

        function showGlobalError(message) {
            document.querySelectorAll('.loading-container').forEach(el => {
                el.innerHTML = `
                    <div class="error-container">
                        <div class="error-title">Error</div>
                        <div class="error-message">${message}</div>
                    </div>
                `;
            });
        }
    </script>

    <!-- Initialize Auth UI -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Google Sign-In button in header
            if (window.GoogleSignInButton) {
                const authNav = document.getElementById('user-auth-nav');
                if (authNav) {
                    window.GoogleSignInButton.injectIntoElement(authNav, {
                        showUserInfo: true,
                        showAvatar: true,
                        compact: true
                    });
                }
            }
        });
    </script>

    <script src="/js/editable-panel-system.js"></script>


    <!-- Initialize Editable Panel System -->
    <script>
        // Wait for Firebase and content to load
        window.addEventListener('load', () => {
            // Give Firebase content loader time to render cards
            setTimeout(() => {
                if (typeof EditablePanelSystem === 'undefined') {
                    console.warn('[EditablePanels] EditablePanelSystem not loaded');
                    return;
                }

                if (!window.firebaseApp) {
                    console.warn('[EditablePanels] Firebase not initialized');
                    return;
                }

                console.log('[EditablePanels] Initializing editable panel system...');

                // Initialize the system
                const editableSystem = new EditablePanelSystem(window.firebaseApp);

                // Store globally for access
                window.editableSystem = editableSystem;

                // Initialize all rendered content cards
                const contentCards = document.querySelectorAll('.content-card[data-id]');

                contentCards.forEach(card => {
                    const documentId = card.getAttribute('data-id');

                    // Determine collection type from parent section
                    let collection = 'deities';
                    let contentType = 'deity';

                    const parentSection = card.closest('.firebase-section');
                    if (parentSection) {
                        const containerId = parentSection.querySelector('[id$="-container"]')?.id;
                        if (containerId) {
                            const type = containerId.replace('-container', '');
                            collection = type;
                            contentType = type.slice(0, -1); // Remove plural 's'
                        }
                    }

                    // Initialize editable panel
                    editableSystem.initEditablePanel(card, {
                        contentType: contentType,
                        documentId: documentId,
                        collection: collection,
                        canEdit: false, // Will be determined by checking user ownership
                        canSubmitAppendment: true
                    });
                });

                console.log(`[EditablePanels] Initialized ${contentCards.length} editable panels`);
            }, 2000); // Wait 2 seconds for content to load
        });
    </script>
</body>
</html>
