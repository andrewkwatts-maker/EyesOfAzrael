/**
 * Accessibility Enhancements
 * WCAG 2.1 AA Compliant Styles
 * Eyes of Azrael - Polished Accessibility System
 */

/* ============================================
   SKIP TO MAIN CONTENT LINK
   ============================================ */
.skip-to-main {
    position: absolute;
    top: -100px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, var(--color-primary, #9370DB) 0%, var(--color-secondary, #ff7eb6) 100%);
    color: white;
    padding: 1rem 2rem;
    text-decoration: none;
    font-weight: 600;
    font-size: 1rem;
    z-index: 100000;
    border-radius: 0 0 12px 12px;
    box-shadow: 0 4px 20px rgba(147, 112, 219, 0.4);
    transition: top 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    white-space: nowrap;
}

.skip-to-main:focus {
    top: 0;
    outline: none;
    box-shadow:
        0 4px 20px rgba(147, 112, 219, 0.4),
        0 0 0 4px rgba(218, 165, 32, 0.5),
        inset 0 0 0 2px #DAA520;
}

.skip-to-main:hover {
    background: linear-gradient(135deg, var(--color-secondary, #ff7eb6) 0%, var(--color-primary, #9370DB) 100%);
}

/* ============================================
   FOCUS INDICATORS - THEMED & VISIBLE
   ============================================ */

/* Base focus reset - use focus-visible for keyboard-only focus */
*:focus {
    outline: none;
}

/* Keyboard focus - highly visible themed indicators */
*:focus-visible {
    outline: 3px solid var(--color-primary, #9370DB);
    outline-offset: 3px;
    box-shadow: 0 0 0 6px rgba(147, 112, 219, 0.25);
    border-radius: 4px;
}

/* Interactive elements - enhanced focus */
button:focus-visible,
a:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
[role="button"]:focus-visible,
[role="link"]:focus-visible,
[tabindex]:focus-visible {
    outline: 3px solid var(--color-primary, #9370DB);
    outline-offset: 3px;
    box-shadow:
        0 0 0 6px rgba(147, 112, 219, 0.25),
        0 0 20px rgba(147, 112, 219, 0.15);
    transition: box-shadow 0.2s ease;
}

/* Primary buttons - gold accent focus */
.btn-primary:focus-visible,
button.btn-primary:focus-visible,
[role="button"].btn-primary:focus-visible {
    outline: 3px solid #DAA520;
    outline-offset: 3px;
    box-shadow:
        0 0 0 6px rgba(218, 165, 32, 0.3),
        0 0 25px rgba(218, 165, 32, 0.2);
}

/* Cards and tiles - subtle glow focus */
.entity-card:focus-visible,
.category-card:focus-visible,
.landing-category-card:focus-visible,
.mythology-card:focus-visible {
    outline: 3px solid var(--color-primary, #9370DB);
    outline-offset: 4px;
    box-shadow:
        0 0 0 6px rgba(147, 112, 219, 0.3),
        0 8px 32px rgba(147, 112, 219, 0.2);
    transform: translateY(-2px);
    transition: all 0.2s ease;
}

/* Navigation links - themed focus */
nav a:focus-visible,
.nav-link:focus-visible,
.header-actions a:focus-visible {
    outline: 2px solid var(--color-primary, #9370DB);
    outline-offset: 4px;
    border-radius: 6px;
}

/* Form inputs - clear focus state */
input:focus-visible,
select:focus-visible,
textarea:focus-visible {
    outline: 2px solid var(--color-primary, #9370DB);
    outline-offset: 0;
    border-color: var(--color-primary, #9370DB);
    box-shadow:
        0 0 0 4px rgba(147, 112, 219, 0.15),
        inset 0 0 0 1px var(--color-primary, #9370DB);
}

/* ============================================
   SCREEN READER UTILITIES
   ============================================ */

/* Visually hidden but accessible to screen readers */
.sr-only,
.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    clip-path: inset(50%);
    white-space: nowrap;
    border: 0;
}

/* Focusable screen reader only content */
.sr-only-focusable:focus,
.sr-only-focusable:focus-within,
.visually-hidden-focusable:focus {
    position: static;
    width: auto;
    height: auto;
    padding: inherit;
    margin: 0;
    overflow: visible;
    clip: auto;
    clip-path: none;
    white-space: normal;
}

/* ============================================
   ARIA-LIVE REGIONS FOR DYNAMIC CONTENT
   ============================================ */

/* Screen reader announcement region - invisible */
.sr-announcer,
#sr-announcer,
[role="status"].sr-announcer {
    position: absolute;
    left: -10000px;
    width: 1px;
    height: 1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
}

/* Route change announcer */
#route-announcer {
    position: absolute;
    left: -10000px;
    width: 1px;
    height: 1px;
    overflow: hidden;
}

/* Live regions for dynamic content updates */
[aria-live="polite"]:not(main):not(section):not(#main-content):not(.view-container):not(.loading-container):not(.entity-grid):not(.results-container) {
    position: absolute;
    left: -10000px;
    width: 1px;
    height: 1px;
    overflow: hidden;
}

[aria-live="assertive"] {
    position: absolute;
    left: -10000px;
    width: 1px;
    height: 1px;
    overflow: hidden;
}

/* Visible live region for toast notifications */
.toast-container[aria-live="polite"],
.notification-area[aria-live="polite"] {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: auto;
    height: auto;
    overflow: visible;
    left: auto;
}

/* Loading state announcements */
.loading-container[role="status"] {
    position: relative;
    left: auto;
    width: auto;
    height: auto;
    overflow: visible;
}

/* ============================================
   COLOR CONTRAST - WCAG AA COMPLIANCE
   ============================================ */

:root {
    /* High contrast text colors - 4.5:1 minimum ratio */
    --text-high-contrast: #ffffff;
    --text-medium-contrast: #e0e0e0;
    --text-low-contrast: #b0b0b0;

    /* Background colors */
    --bg-high-contrast: #000000;
    --bg-medium-contrast: #1a1a2e;

    /* Link colors - WCAG AA compliant (4.5:1 against dark bg) */
    --link-color: #88aaff;
    --link-visited: #bb88ff;
    --link-hover: #aaccff;
    --link-focus: #ffcc88;

    /* Error/Success colors - high contrast */
    --color-error: #ff6b6b;
    --color-error-text: #ff8a8a;
    --color-success: #51cf66;
    --color-success-text: #69db7c;
    --color-warning: #ffd43b;
    --color-warning-text: #ffe066;
}

/* Ensure body text has sufficient contrast */
body {
    color: var(--text-high-contrast, #ffffff);
}

/* Links must be distinguishable */
a {
    color: var(--link-color, #88aaff);
    text-decoration: underline;
    text-underline-offset: 3px;
    text-decoration-thickness: 1px;
}

a:visited {
    color: var(--link-visited, #bb88ff);
}

a:hover {
    color: var(--link-hover, #aaccff);
    text-decoration-thickness: 2px;
}

a:focus-visible {
    color: var(--link-focus, #ffcc88);
    text-decoration-thickness: 2px;
}

/* Ensure disabled states have sufficient contrast indication */
button:disabled,
.btn:disabled,
input:disabled,
select:disabled,
textarea:disabled,
[aria-disabled="true"] {
    opacity: 0.5;
    cursor: not-allowed;
    filter: grayscale(30%);
}

/* Error states with high contrast */
.error,
.error-message,
[aria-invalid="true"] {
    color: var(--color-error-text, #ff8a8a);
}

input[aria-invalid="true"],
select[aria-invalid="true"],
textarea[aria-invalid="true"] {
    border: 2px solid var(--color-error, #ff6b6b);
    background: rgba(255, 107, 107, 0.05);
}

.error-message {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    margin-top: 0.25rem;
}

.error-message::before {
    content: "";
    display: inline-block;
    width: 16px;
    height: 16px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ff6b6b'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z'/%3E%3C/svg%3E") center/contain no-repeat;
    flex-shrink: 0;
}

/* ============================================
   REDUCED MOTION SUPPORT
   ============================================ */

@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }

    /* Disable parallax and floating effects */
    .parallax,
    .float-animation,
    .pulse-animation {
        animation: none !important;
        transform: none !important;
    }

    /* Disable scroll-triggered animations */
    .animate-on-scroll,
    [data-animate] {
        opacity: 1 !important;
        transform: none !important;
    }

    /* Keep essential transitions short but visible */
    .skip-to-main:focus {
        transition-duration: 0.1ms !important;
    }

    /* Disable background shader animations */
    .shader-bg,
    .cosmic-bg,
    [class*="shader-"] {
        animation: none !important;
    }

    /* Simplify loading spinners */
    .spinner-ring,
    .spinner-container * {
        animation: none !important;
    }

    .spinner-container::after {
        content: "Loading...";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
}

/* ============================================
   HIGH CONTRAST MODE SUPPORT
   ============================================ */

@media (prefers-contrast: high) {
    :root {
        --color-primary: #a388ff;
        --color-secondary: #ff88b0;
        --color-bg-primary: #000000;
        --color-bg-secondary: #0a0a0a;
        --color-bg-card: #111111;
        --color-text-primary: #ffffff;
        --color-text-secondary: #cccccc;
        --color-border-primary: #666666;
    }

    /* Increase border visibility */
    *,
    *::before,
    *::after {
        border-color: currentColor !important;
    }

    button,
    .btn,
    input,
    select,
    textarea {
        border: 2px solid currentColor !important;
    }

    /* Increase focus visibility */
    *:focus-visible {
        outline-width: 4px !important;
        outline-offset: 4px !important;
    }

    /* High contrast cards */
    .entity-card,
    .category-card,
    .landing-category-card {
        border: 2px solid var(--color-text-secondary, #cccccc) !important;
    }

    .entity-card:hover,
    .category-card:hover,
    .landing-category-card:hover {
        border-color: var(--color-primary, #a388ff) !important;
    }

    /* Ensure text is highly visible */
    h1, h2, h3, h4, h5, h6 {
        color: #ffffff !important;
    }

    p, span, div {
        color: inherit;
    }

    /* Links must stand out */
    a {
        text-decoration: underline !important;
        text-decoration-thickness: 2px !important;
    }

    /* High contrast buttons */
    .btn-primary {
        background: #ffffff !important;
        color: #000000 !important;
        border: 2px solid #ffffff !important;
    }

    .btn-secondary {
        background: transparent !important;
        color: #ffffff !important;
        border: 2px solid #ffffff !important;
    }
}

/* Forced colors mode (Windows High Contrast) */
@media (forced-colors: active) {
    .skip-to-main {
        border: 2px solid currentColor;
    }

    button,
    .btn,
    a {
        forced-color-adjust: none;
    }

    *:focus-visible {
        outline: 3px solid Highlight !important;
        outline-offset: 2px;
    }

    /* Ensure icons remain visible */
    svg {
        fill: currentColor;
        stroke: currentColor;
    }
}

/* ============================================
   KEYBOARD SHORTCUTS HELP DIALOG
   ============================================ */

.keyboard-shortcuts-dialog {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--color-bg-card, #1a1f3a);
    border: 1px solid var(--color-border-primary, #2a2f4a);
    border-radius: 16px;
    padding: 2rem;
    max-width: 500px;
    width: 90vw;
    max-height: 80vh;
    overflow-y: auto;
    z-index: 100001;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.keyboard-shortcuts-dialog[aria-hidden="true"] {
    display: none;
}

.keyboard-shortcuts-dialog h2 {
    margin: 0 0 1.5rem;
    font-size: 1.5rem;
    color: var(--color-text-primary, #f8f9fa);
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.keyboard-shortcuts-dialog h2::before {
    content: "";
    display: inline-block;
    width: 24px;
    height: 24px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%239370DB'%3E%3Cpath d='M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z'/%3E%3C/svg%3E") center/contain no-repeat;
}

.keyboard-shortcuts-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.keyboard-shortcuts-list li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(147, 112, 219, 0.15);
}

.keyboard-shortcuts-list li:last-child {
    border-bottom: none;
}

.shortcut-key {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.shortcut-key kbd {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    background: rgba(147, 112, 219, 0.15);
    border: 1px solid rgba(147, 112, 219, 0.3);
    border-radius: 6px;
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
    font-size: 0.85rem;
    color: var(--color-primary, #9370DB);
    min-width: 28px;
    text-align: center;
}

.shortcut-key span {
    color: var(--color-text-secondary, #adb5bd);
    font-size: 0.9rem;
}

.shortcut-description {
    color: var(--color-text-secondary, #adb5bd);
    font-size: 0.9rem;
}

.keyboard-shortcuts-dialog .close-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: transparent;
    border: none;
    color: var(--color-text-secondary, #adb5bd);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: all 0.2s ease;
}

.keyboard-shortcuts-dialog .close-btn:hover {
    background: rgba(147, 112, 219, 0.1);
    color: var(--color-text-primary, #f8f9fa);
}

.keyboard-shortcuts-dialog .close-btn:focus-visible {
    outline: 2px solid var(--color-primary, #9370DB);
    outline-offset: 2px;
}

.keyboard-shortcuts-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
    z-index: 100000;
}

.keyboard-shortcuts-overlay[aria-hidden="true"] {
    display: none;
}

/* ============================================
   MODAL TAB ORDER & FOCUS TRAP
   ============================================ */

.modal[aria-modal="true"],
.dialog[aria-modal="true"],
[role="dialog"][aria-modal="true"] {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 99999;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal[aria-hidden="true"],
.dialog[aria-hidden="true"],
[role="dialog"][aria-hidden="true"] {
    display: none;
}

/* Modal backdrop */
.modal-backdrop,
.dialog-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.75);
    backdrop-filter: blur(4px);
    z-index: -1;
}

/* Modal content container */
.modal-content,
.dialog-content {
    position: relative;
    background: var(--color-bg-card, #1a1f3a);
    border: 1px solid var(--color-border-primary, #2a2f4a);
    border-radius: 16px;
    padding: 2rem;
    max-width: 90vw;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

/* Focus trap indicator - first focusable element */
.modal-content > *:first-child:focus-visible,
.dialog-content > *:first-child:focus-visible {
    outline: 3px solid var(--color-primary, #9370DB);
    outline-offset: 3px;
}

/* Close button in modals - always accessible */
.modal-close,
.dialog-close,
[aria-label="Close"],
[aria-label="Close modal"],
[aria-label="Close dialog"] {
    position: absolute;
    top: 1rem;
    right: 1rem;
    min-width: 44px;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: 1px solid transparent;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.modal-close:hover,
.dialog-close:hover {
    background: rgba(147, 112, 219, 0.1);
    border-color: rgba(147, 112, 219, 0.3);
}

.modal-close:focus-visible,
.dialog-close:focus-visible {
    outline: 2px solid var(--color-primary, #9370DB);
    outline-offset: 2px;
    background: rgba(147, 112, 219, 0.1);
}

/* ============================================
   TOUCH TARGET SIZING (44x44 minimum)
   ============================================ */

button,
.btn,
[role="button"],
a:not(.inline-link),
input[type="checkbox"],
input[type="radio"],
select {
    min-height: 44px;
    min-width: 44px;
}

/* Compact buttons for dense UI (requires explicit class) */
.btn-compact,
.btn-sm,
.icon-btn {
    min-height: 36px;
    min-width: 36px;
}

/* Touch devices get larger targets */
@media (pointer: coarse) {
    button,
    .btn,
    [role="button"],
    a:not(.inline-link),
    input[type="checkbox"],
    input[type="radio"],
    select {
        min-height: 48px;
        min-width: 48px;
    }

    /* Increase spacing between touch targets */
    .btn + .btn,
    button + button {
        margin-left: 0.5rem;
    }
}

/* ============================================
   FORM ACCESSIBILITY
   ============================================ */

/* Labels must be visible and associated */
label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--text-high-contrast, #ffffff);
}

/* Required field indicator */
label[data-required="true"]::after,
.required-field label::after {
    content: " *";
    color: var(--color-error, #ff6b6b);
    font-weight: bold;
}

/* Form group structure */
.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Help text for form fields */
.form-help,
.field-description,
[id$="-help"],
[id$="-description"] {
    font-size: 0.875rem;
    color: var(--color-text-secondary, #adb5bd);
    margin-top: 0.25rem;
}

/* ============================================
   BREADCRUMB NAVIGATION
   ============================================ */

nav[aria-label="Breadcrumb"] {
    position: sticky;
    top: 56px;
    z-index: 99;
    background: rgba(var(--color-bg-card-rgb, 26, 31, 58), 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(var(--color-border-primary-rgb, 42, 47, 74), 0.5);
    padding: 0.75rem 0;
    margin: 0;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: all 300ms ease;
}

nav[aria-label="Breadcrumb"].visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

nav[aria-label="Breadcrumb"] ol {
    list-style: none;
    padding: 0 2rem;
    margin: 0;
    max-width: 1400px;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.25rem;
}

nav[aria-label="Breadcrumb"] li {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    min-height: 32px;
}

nav[aria-label="Breadcrumb"] a {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 150ms ease;
}

nav[aria-label="Breadcrumb"] a:hover {
    background: rgba(var(--color-primary-rgb, 139, 127, 255), 0.1);
    color: var(--color-primary, #8b7fff);
    text-decoration: none;
}

nav[aria-label="Breadcrumb"] a:focus-visible {
    outline: 2px solid var(--color-primary, #8b7fff);
    outline-offset: 1px;
}

nav[aria-label="Breadcrumb"] .breadcrumb-separator {
    color: var(--color-text-secondary, #adb5bd);
    padding: 0 0.125rem;
    user-select: none;
    font-size: 1rem;
    aria-hidden: true;
}

nav[aria-label="Breadcrumb"] [aria-current="page"] {
    color: var(--color-text-primary, #f8f9fa);
    padding: 0.25rem 0.5rem;
    font-weight: 600;
}

/* Breadcrumb responsive */
@media (max-width: 1024px) {
    nav[aria-label="Breadcrumb"] ol {
        padding: 0 1.5rem;
    }

    nav[aria-label="Breadcrumb"] .breadcrumb-label {
        max-width: 120px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
}

@media (max-width: 640px) {
    nav[aria-label="Breadcrumb"] {
        top: 60px;
        padding: 0.5rem 0;
    }

    nav[aria-label="Breadcrumb"] ol {
        padding: 0 1rem;
        gap: 0;
    }

    nav[aria-label="Breadcrumb"] a {
        padding: 0.25rem 0.375rem;
        font-size: 0.8125rem;
    }

    nav[aria-label="Breadcrumb"] .breadcrumb-label {
        max-width: 80px;
    }
}

/* ============================================
   TABLE ACCESSIBILITY
   ============================================ */

table {
    border-collapse: collapse;
    width: 100%;
}

caption {
    padding: 1rem;
    font-weight: 600;
    font-size: 1.2rem;
    text-align: left;
    caption-side: top;
}

th {
    text-align: left;
    font-weight: 600;
    background: rgba(147, 112, 219, 0.2);
    padding: 1rem;
}

th[scope="col"] {
    border-bottom: 2px solid var(--color-primary, #9370DB);
}

th[scope="row"] {
    border-right: 2px solid var(--color-primary, #9370DB);
}

td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid rgba(147, 112, 219, 0.2);
}

tr:focus-within {
    background: rgba(147, 112, 219, 0.05);
}

/* ============================================
   TOOLTIP ACCESSIBILITY
   ============================================ */

[aria-describedby] {
    position: relative;
}

.tooltip,
[role="tooltip"] {
    position: absolute;
    background: var(--color-bg-card, #1a1a2e);
    color: var(--color-text-primary, #ffffff);
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.9rem;
    z-index: 10000;
    pointer-events: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    border: 1px solid var(--color-primary, #9370DB);
    max-width: 300px;
}

.tooltip[aria-hidden="true"],
[role="tooltip"][aria-hidden="true"] {
    display: none;
}

/* ============================================
   CUSTOM FORM CONTROLS
   ============================================ */

/* Accessible checkbox */
.custom-checkbox,
.accessible-checkbox {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    min-height: 44px;
}

.custom-checkbox input[type="checkbox"],
.accessible-checkbox input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    width: 24px;
    height: 24px;
}

.custom-checkbox .checkmark,
.accessible-checkbox .checkmark {
    width: 24px;
    height: 24px;
    border: 2px solid var(--color-primary, #9370DB);
    border-radius: 6px;
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

.custom-checkbox input:checked + .checkmark,
.accessible-checkbox input:checked + .checkmark {
    background: var(--color-primary, #9370DB);
    border-color: var(--color-primary, #9370DB);
}

.custom-checkbox input:checked + .checkmark::after,
.accessible-checkbox input:checked + .checkmark::after {
    content: "";
    display: block;
    width: 6px;
    height: 12px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
    margin-top: -2px;
}

.custom-checkbox input:focus-visible + .checkmark,
.accessible-checkbox input:focus-visible + .checkmark {
    outline: 3px solid var(--color-primary, #9370DB);
    outline-offset: 3px;
    box-shadow: 0 0 0 6px rgba(147, 112, 219, 0.2);
}

/* Accessible radio button */
.custom-radio,
.accessible-radio {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    min-height: 44px;
}

.custom-radio input[type="radio"],
.accessible-radio input[type="radio"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    width: 24px;
    height: 24px;
}

.custom-radio .checkmark,
.accessible-radio .checkmark {
    width: 24px;
    height: 24px;
    border: 2px solid var(--color-primary, #9370DB);
    border-radius: 50%;
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

.custom-radio input:checked + .checkmark,
.accessible-radio input:checked + .checkmark {
    border-color: var(--color-primary, #9370DB);
}

.custom-radio input:checked + .checkmark::after,
.accessible-radio input:checked + .checkmark::after {
    content: "";
    width: 12px;
    height: 12px;
    background: var(--color-primary, #9370DB);
    border-radius: 50%;
}

.custom-radio input:focus-visible + .checkmark,
.accessible-radio input:focus-visible + .checkmark {
    outline: 3px solid var(--color-primary, #9370DB);
    outline-offset: 3px;
    box-shadow: 0 0 0 6px rgba(147, 112, 219, 0.2);
}

/* ============================================
   LANDMARK ROLES
   ============================================ */

main,
[role="main"] {
    display: block;
}

[role="navigation"],
[role="banner"],
[role="contentinfo"],
[role="complementary"],
[role="search"] {
    display: block;
}

/* ============================================
   ARIA EXPANDED/COLLAPSED INDICATORS
   ============================================ */

[aria-expanded="false"] .expand-icon::before,
[aria-expanded="false"] .collapse-icon::before {
    content: "";
    display: inline-block;
    width: 0;
    height: 0;
    border-left: 5px solid currentColor;
    border-top: 4px solid transparent;
    border-bottom: 4px solid transparent;
    margin-right: 0.5rem;
    transition: transform 0.2s ease;
}

[aria-expanded="true"] .expand-icon::before,
[aria-expanded="true"] .collapse-icon::before {
    content: "";
    display: inline-block;
    width: 0;
    height: 0;
    border-left: 5px solid currentColor;
    border-top: 4px solid transparent;
    border-bottom: 4px solid transparent;
    margin-right: 0.5rem;
    transform: rotate(90deg);
}

/* ============================================
   RESPONSIVE ACCESSIBILITY
   ============================================ */

@media (max-width: 768px) {
    body {
        font-size: 16px;
    }

    /* Larger touch targets on mobile */
    button,
    .btn,
    input,
    select,
    textarea {
        min-height: 48px;
        font-size: 16px;
    }

    /* Ensure readable line lengths */
    p, li, td {
        max-width: 65ch;
    }
}

/* ============================================
   PRINT ACCESSIBILITY
   ============================================ */

@media print {
    /* Ensure links are visible in print */
    a[href]::after {
        content: " (" attr(href) ")";
        font-size: 0.8em;
        color: #666;
    }

    /* Don't print decorative elements */
    .skip-to-main,
    .keyboard-shortcuts-dialog,
    .modal-backdrop,
    [aria-hidden="true"] {
        display: none !important;
    }

    /* Ensure sufficient contrast for print */
    * {
        color: #000 !important;
        background: #fff !important;
    }
}

/* ============================================
   DARK MODE TEXT ADJUSTMENTS
   ============================================ */

@media (prefers-color-scheme: dark) {
    :root {
        --text-high-contrast: #ffffff;
        --text-medium-contrast: #e0e0e0;
        --text-low-contrast: #b0b0b0;
    }
}

@media (prefers-color-scheme: light) {
    :root {
        --text-high-contrast: #000000;
        --text-medium-contrast: #333333;
        --text-low-contrast: #666666;
        --bg-high-contrast: #ffffff;
        --bg-medium-contrast: #f5f5f5;
        --link-color: #0066cc;
        --link-visited: #6600cc;
        --link-hover: #0044aa;
    }
}

/* ============================================
   ENHANCED FOCUS RING SYSTEM
   ============================================ */

/* Custom focus ring for cards with interactive content */
.entity-card:focus-within,
.category-card:focus-within,
.landing-category-card:focus-within {
    outline: 2px solid var(--color-primary, #9370DB);
    outline-offset: 2px;
}

/* Focus indicator for custom radio/checkbox groups */
[role="radiogroup"]:focus-within,
[role="listbox"]:focus-within,
[role="menu"]:focus-within {
    outline: 2px solid var(--color-primary, #9370DB);
    outline-offset: 4px;
    border-radius: 8px;
}

/* ============================================
   ACCESSIBLE LOADING STATES
   ============================================ */

/* Loading spinner with screen reader text */
.loading-container,
.spinner-container,
[data-loading="true"] {
    position: relative;
}

.loading-container::before,
[data-loading="true"]::before {
    content: 'Loading...';
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Progress indicator accessibility */
[role="progressbar"] {
    position: relative;
}

[role="progressbar"]:not([aria-valuenow]) {
    /* Indeterminate progress */
    animation: progressPulse 2s ease-in-out infinite;
}

@keyframes progressPulse {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
}

/* ============================================
   ENHANCED ERROR STATE ACCESSIBILITY
   ============================================ */

/* Form field error states */
.form-field.has-error input,
.form-field.has-error select,
.form-field.has-error textarea,
input.error,
select.error,
textarea.error {
    border-color: var(--color-error, #ff6b6b) !important;
    box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2);
}

/* Ensure error messages are properly announced */
.form-error[role="alert"],
.error-message[role="alert"] {
    animation: errorShake 0.3s ease-in-out;
}

@keyframes errorShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    75% { transform: translateX(4px); }
}

@media (prefers-reduced-motion: reduce) {
    .form-error[role="alert"],
    .error-message[role="alert"] {
        animation: none;
    }
}

/* ============================================
   ACCESSIBLE TOGGLE SWITCHES
   ============================================ */

.toggle-switch,
[role="switch"] {
    position: relative;
    display: inline-flex;
    align-items: center;
    cursor: pointer;
    min-height: 44px;
    padding: 0.5rem;
}

.toggle-switch input[type="checkbox"],
[role="switch"] input {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}

[role="switch"][aria-checked="true"] .toggle-track,
.toggle-switch input:checked + .toggle-track {
    background: var(--color-primary, #9370DB);
}

[role="switch"]:focus-visible,
.toggle-switch:focus-within {
    outline: 3px solid var(--color-primary, #9370DB);
    outline-offset: 3px;
    border-radius: 20px;
}

/* ============================================
   ACCESSIBLE ACCORDION PATTERNS
   ============================================ */

.accordion-header,
[role="button"][aria-expanded] {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 1rem;
    background: transparent;
    border: none;
    cursor: pointer;
    text-align: left;
    min-height: 44px;
}

.accordion-header:hover,
[role="button"][aria-expanded]:hover {
    background: rgba(var(--color-primary-rgb, 147, 112, 219), 0.05);
}

.accordion-header:focus-visible,
[role="button"][aria-expanded]:focus-visible {
    outline: 2px solid var(--color-primary, #9370DB);
    outline-offset: -2px;
}

/* Accordion expand/collapse indicator */
.accordion-header .expand-icon,
[role="button"][aria-expanded] .expand-icon {
    transition: transform 0.2s ease;
}

[aria-expanded="true"] .expand-icon {
    transform: rotate(180deg);
}

@media (prefers-reduced-motion: reduce) {
    .accordion-header .expand-icon,
    [role="button"][aria-expanded] .expand-icon {
        transition: none;
    }
}

/* ============================================
   ACCESSIBLE TABS PATTERN
   ============================================ */

[role="tablist"] {
    display: flex;
    gap: 0.25rem;
    border-bottom: 2px solid rgba(var(--color-primary-rgb, 147, 112, 219), 0.2);
    padding-bottom: 0;
}

[role="tab"] {
    display: inline-flex;
    align-items: center;
    padding: 0.75rem 1.25rem;
    border: none;
    background: transparent;
    color: var(--color-text-secondary, #adb5bd);
    cursor: pointer;
    font-weight: 500;
    position: relative;
    min-height: 44px;
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
    transition: color 0.2s ease, border-color 0.2s ease;
}

[role="tab"]:hover {
    color: var(--color-text-primary, #f8f9fa);
}

[role="tab"][aria-selected="true"] {
    color: var(--color-primary, #9370DB);
    border-bottom-color: var(--color-primary, #9370DB);
}

[role="tab"]:focus-visible {
    outline: 2px solid var(--color-primary, #9370DB);
    outline-offset: -2px;
    border-radius: 4px 4px 0 0;
}

[role="tabpanel"] {
    padding: 1.5rem 0;
}

[role="tabpanel"][aria-hidden="true"],
[role="tabpanel"]:not(.active) {
    display: none;
}

[role="tabpanel"]:focus-visible {
    outline: 2px solid var(--color-primary, #9370DB);
    outline-offset: 4px;
}

/* ============================================
   ACCESSIBLE DROPDOWN MENUS
   ============================================ */

[role="menu"] {
    position: absolute;
    background: var(--color-bg-card, #1a1f3a);
    border: 1px solid var(--color-border-primary, #2a2f4a);
    border-radius: 12px;
    padding: 0.5rem;
    min-width: 200px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    z-index: 1000;
}

[role="menu"][aria-hidden="true"] {
    display: none;
}

[role="menuitem"],
[role="menuitemradio"],
[role="menuitemcheckbox"] {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    width: 100%;
    padding: 0.75rem 1rem;
    border: none;
    background: transparent;
    color: var(--color-text-primary, #f8f9fa);
    cursor: pointer;
    text-align: left;
    border-radius: 8px;
    min-height: 44px;
    transition: background 0.15s ease;
}

[role="menuitem"]:hover,
[role="menuitemradio"]:hover,
[role="menuitemcheckbox"]:hover {
    background: rgba(var(--color-primary-rgb, 147, 112, 219), 0.1);
}

[role="menuitem"]:focus-visible,
[role="menuitemradio"]:focus-visible,
[role="menuitemcheckbox"]:focus-visible {
    outline: none;
    background: rgba(var(--color-primary-rgb, 147, 112, 219), 0.2);
    box-shadow: inset 0 0 0 2px var(--color-primary, #9370DB);
}

[role="menuitemradio"][aria-checked="true"],
[role="menuitemcheckbox"][aria-checked="true"] {
    background: rgba(var(--color-primary-rgb, 147, 112, 219), 0.15);
}

/* Menu separator */
[role="separator"] {
    height: 1px;
    background: var(--color-border-primary, #2a2f4a);
    margin: 0.5rem 0;
}

/* ============================================
   ACCESSIBLE COMBOBOX/AUTOCOMPLETE
   ============================================ */

[role="combobox"] {
    position: relative;
}

[role="listbox"] {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--color-bg-card, #1a1f3a);
    border: 1px solid var(--color-border-primary, #2a2f4a);
    border-radius: 8px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

[role="listbox"][aria-hidden="true"] {
    display: none;
}

[role="option"] {
    padding: 0.75rem 1rem;
    cursor: pointer;
    min-height: 44px;
    display: flex;
    align-items: center;
}

[role="option"]:hover,
[role="option"][aria-selected="true"] {
    background: rgba(var(--color-primary-rgb, 147, 112, 219), 0.15);
}

[role="option"]:focus-visible,
[role="option"].focused {
    outline: none;
    background: rgba(var(--color-primary-rgb, 147, 112, 219), 0.2);
    box-shadow: inset 0 0 0 2px var(--color-primary, #9370DB);
}

/* ============================================
   ACCESSIBLE NOTIFICATION/TOAST SYSTEM
   ============================================ */

.toast-notification,
[role="alert"] {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    border-radius: 12px;
    background: var(--color-bg-card, #1a1f3a);
    border: 1px solid var(--color-border-primary, #2a2f4a);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    max-width: 400px;
    animation: toastSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes toastSlideIn {
    from {
        opacity: 0;
        transform: translateY(16px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (prefers-reduced-motion: reduce) {
    .toast-notification,
    [role="alert"] {
        animation: none;
    }
}

.toast-notification.success {
    border-left: 4px solid var(--color-success, #51cf66);
}

.toast-notification.error {
    border-left: 4px solid var(--color-error, #ff6b6b);
}

.toast-notification.warning {
    border-left: 4px solid var(--color-warning, #ffd43b);
}

.toast-notification.info {
    border-left: 4px solid var(--color-primary, #9370DB);
}

/* Toast close button */
.toast-notification .toast-close {
    background: transparent;
    border: none;
    color: var(--color-text-secondary, #adb5bd);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    min-width: 28px;
    min-height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: auto;
}

.toast-notification .toast-close:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--color-text-primary, #f8f9fa);
}

.toast-notification .toast-close:focus-visible {
    outline: 2px solid var(--color-primary, #9370DB);
    outline-offset: 2px;
}

/* ============================================
   ACCESSIBLE CARD INTERACTIONS
   ============================================ */

/* Ensure cards are keyboard accessible */
.entity-card,
.category-card,
.landing-category-card,
.mythology-card {
    cursor: pointer;
}

/* Cards should not have nested interactive elements - use overlay pattern */
.entity-card a.card-link-overlay,
.category-card a.card-link-overlay,
.landing-category-card a.card-link-overlay {
    position: absolute;
    inset: 0;
    z-index: 1;
}

/* Secondary actions within cards need higher z-index */
.entity-card .card-actions,
.category-card .card-actions,
.landing-category-card .card-actions {
    position: relative;
    z-index: 2;
}

/* ============================================
   ACCESSIBLE IMAGE HANDLING
   ============================================ */

/* Decorative images */
img[aria-hidden="true"],
img.decorative,
.decorative-image {
    pointer-events: none;
    user-select: none;
}

/* Images with captions */
figure {
    margin: 1.5rem 0;
}

figure figcaption {
    margin-top: 0.75rem;
    font-size: 0.9rem;
    color: var(--color-text-secondary, #adb5bd);
    text-align: center;
}

/* ============================================
   ACCESSIBLE TEXT SELECTION
   ============================================ */

::selection {
    background: rgba(var(--color-primary-rgb, 147, 112, 219), 0.4);
    color: var(--color-text-primary, #ffffff);
}

::-moz-selection {
    background: rgba(var(--color-primary-rgb, 147, 112, 219), 0.4);
    color: var(--color-text-primary, #ffffff);
}

/* ============================================
   ACCESSIBLE SCROLLBARS
   ============================================ */

/* Custom scrollbar for better visibility */
::-webkit-scrollbar {
    width: 12px;
    height: 12px;
}

::-webkit-scrollbar-track {
    background: var(--color-bg-secondary, #151a35);
    border-radius: 6px;
}

::-webkit-scrollbar-thumb {
    background: var(--color-border-primary, #2a2f4a);
    border-radius: 6px;
    border: 3px solid var(--color-bg-secondary, #151a35);
}

::-webkit-scrollbar-thumb:hover {
    background: var(--color-primary, #9370DB);
}

/* Ensure scrollbar is visible in high contrast mode */
@media (prefers-contrast: high) {
    ::-webkit-scrollbar-thumb {
        background: var(--color-text-secondary, #adb5bd);
    }
}

/* ============================================
   SKIP LINK ENHANCEMENTS
   ============================================ */

/* Additional skip links for complex pages */
.skip-links {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 100001;
}

.skip-links a {
    position: absolute;
    top: -100px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--color-primary, #9370DB);
    color: white;
    padding: 0.75rem 1.5rem;
    text-decoration: none;
    font-weight: 600;
    border-radius: 0 0 8px 8px;
    transition: top 0.2s ease;
}

.skip-links a:focus {
    top: 0;
    outline: none;
}

/* ============================================
   LANDMARK REGION VISIBILITY FOR DEBUGGING
   ============================================ */

/* Debug mode - show landmark regions */
body.show-landmarks [role="banner"],
body.show-landmarks [role="navigation"],
body.show-landmarks [role="main"],
body.show-landmarks [role="contentinfo"],
body.show-landmarks [role="complementary"],
body.show-landmarks [role="search"] {
    outline: 2px dashed rgba(var(--color-primary-rgb, 147, 112, 219), 0.5);
    outline-offset: 4px;
}

body.show-landmarks [role="banner"]::before,
body.show-landmarks [role="navigation"]::before,
body.show-landmarks [role="main"]::before,
body.show-landmarks [role="contentinfo"]::before,
body.show-landmarks [role="complementary"]::before,
body.show-landmarks [role="search"]::before {
    content: attr(role);
    position: absolute;
    top: -1.5rem;
    left: 0;
    font-size: 0.75rem;
    background: var(--color-primary, #9370DB);
    color: white;
    padding: 0.125rem 0.5rem;
    border-radius: 4px;
}
