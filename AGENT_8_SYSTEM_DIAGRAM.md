# SYSTEM ARCHITECTURE VISUAL DIAGRAM
**Eyes of Azrael - Complete Initialization Flow**

---

## CURRENT SYSTEM (AS-IS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              BROWSER LOADS PAGE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SCRIPT LOADING PHASE (0-50ms)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  [1] Firebase SDK (CDN) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Global: firebase                        â”‚
â”‚  [2] firebase-config.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Global: firebaseConfig                 â”‚
â”‚  [3] auth-guard-simple.js (MODULE) â–º Auto-executes:                         â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”œâ”€ Checks: typeof firebase !== 'undefined'                             â”‚
â”‚      â”œâ”€ Initializes Firebase #1: firebase.initializeApp(firebaseConfig)     â”‚
â”‚      â”œâ”€ Injects: <div id="auth-overlay">                                    â”‚
â”‚      â”œâ”€ Injects: <div id="auth-loading-screen">                             â”‚
â”‚      â”œâ”€ Sets: body.classList.add('auth-loading')                            â”‚
â”‚      â””â”€ Registers: AUTH LISTENER #1 (onAuthStateChanged)                    â”‚
â”‚                                                                              â”‚
â”‚  [4] auth-manager.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Class defined (not instantiated)      â”‚
â”‚  [5] home-view.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Class defined (not instantiated)      â”‚
â”‚  [6] spa-navigation.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Class defined (not instantiated)      â”‚
â”‚  [7] app-init-simple.js (IIFE) â”€â”€â”€â”€â–º Auto-executes...                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APP INIT PHASE (50-150ms)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  app-init-simple.js IIFE:                                                   â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€ Waits for: DOMContentLoaded                                             â”‚
â”‚  â”œâ”€ Checks: firebase.apps.length === 0 (FALSE - already initialized)        â”‚
â”‚  â”œâ”€ Uses: firebase.app() (existing app)                                     â”‚
â”‚  â”œâ”€ Creates: window.EyesOfAzrael = {}                                       â”‚
â”‚  â”œâ”€ Sets: window.EyesOfAzrael.db = firebase.firestore()                     â”‚
â”‚  â”œâ”€ Sets: window.EyesOfAzrael.firebaseAuth = firebase.auth()                â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€ Instantiates: new AuthManager(app)                                      â”‚
â”‚  â”‚   â””â”€ Registers: AUTH LISTENER #2 (onAuthStateChanged)                    â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€ Instantiates: new SPANavigation(db, auth, renderer)                     â”‚
â”‚  â”‚   â”œâ”€ Calls: waitForAuth()                                                â”‚
â”‚  â”‚   â””â”€ Registers: AUTH LISTENER #3 (onAuthStateChanged)                    â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€ Calls: setupAuthUI(auth)                                                â”‚
â”‚  â”‚   â””â”€ Registers: AUTH LISTENER #4 (onAuthStateChanged)                    â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â””â”€ Hides: Initial loading spinner                                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTH RESOLUTION PHASE (150-300ms)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Firebase Auth Internal State Determined                                    â”‚
â”‚                    â”‚                                                         â”‚
â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                    â–¼             â–¼              â–¼              â–¼            â”‚
â”‚              LISTENER #1    LISTENER #2    LISTENER #3    LISTENER #4       â”‚
â”‚              auth-guard     AuthManager   SPANavigation   setupAuthUI       â”‚
â”‚                  â”‚               â”‚              â”‚              â”‚            â”‚
â”‚                  â”‚               â”‚              â”‚              â”‚            â”‚
â”‚     IF USER AUTHENTICATED:       â”‚              â”‚              â”‚            â”‚
â”‚                  â”‚               â”‚              â”‚              â”‚            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”       â”‚              â”‚              â”‚            â”‚
â”‚     â”‚ handleAuthenticatedâ”‚       â”‚              â”‚              â”‚            â”‚
â”‚     â”‚ (line 88-121)      â”‚       â”‚              â”‚              â”‚            â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚              â”‚              â”‚            â”‚
â”‚     â”‚ â€¢ Hides overlay    â”‚       â”‚              â”‚              â”‚            â”‚
â”‚     â”‚ â€¢ Shows content    â”‚       â”‚              â”‚              â”‚            â”‚
â”‚     â”‚ â€¢ Updates user UI  â”‚       â”‚              â”‚              â”‚            â”‚
â”‚     â”‚ â€¢ setTimeout 1000msâ”‚       â”‚              â”‚              â”‚            â”‚
â”‚     â”‚   â””â”€> dispatch     â”‚       â”‚              â”‚              â”‚            â”‚
â”‚     â”‚       hashchange   â”‚       â”‚              â”‚              â”‚            â”‚
â”‚     â”‚       âš ï¸ TRIGGER #2â”‚       â”‚              â”‚              â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚              â”‚              â”‚            â”‚
â”‚                                  â”‚              â”‚              â”‚            â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”       â”‚              â”‚            â”‚
â”‚                          â”‚ Updates      â”‚       â”‚              â”‚            â”‚
â”‚                          â”‚ currentUser  â”‚       â”‚              â”‚            â”‚
â”‚                          â”‚ & callbacks  â”‚       â”‚              â”‚            â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚              â”‚            â”‚
â”‚                                                 â”‚              â”‚            â”‚
â”‚                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚            â”‚
â”‚                                         â”‚ resolve(user)    â”‚   â”‚            â”‚
â”‚                                         â”‚ initRouter()     â”‚   â”‚            â”‚
â”‚                                         â”‚ â””â”€> handleRoute()â”‚   â”‚            â”‚
â”‚                                         â”‚     âš ï¸ TRIGGER #1â”‚   â”‚            â”‚
â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚            â”‚
â”‚                                                                â”‚            â”‚
â”‚                                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                                                        â”‚ Updates      â”‚     â”‚
â”‚                                                        â”‚ header UI    â”‚     â”‚
â”‚                                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     NAVIGATION PHASE (200-1200ms)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  TRIGGER #1: SPANavigation.initRouter() â†’ handleRoute() [~200ms]            â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€ Checks: this.authReady (true)                                           â”‚
â”‚  â”œâ”€ Checks: firebase.auth().currentUser (exists)                            â”‚
â”‚  â”œâ”€ Calls: renderHome()                                                     â”‚
â”‚  â”‚   â””â”€ new HomeView(db).render(mainContent)                                â”‚
â”‚  â”‚       â”œâ”€ Shows loading spinner                                           â”‚
â”‚  â”‚       â”œâ”€ Queries: db.collection('mythologies').get()                     â”‚
â”‚  â”‚       â””â”€ Updates: mainContent.innerHTML (home page content)              â”‚
â”‚  â”‚           âœ… USER SEES HOME PAGE                                          â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â””â”€ Done                                                                     â”‚
â”‚                                                                              â”‚
â”‚                            ... 1 second delay ...                            â”‚
â”‚                                                                              â”‚
â”‚  TRIGGER #2: auth-guard setTimeout fires [~1200ms] âš ï¸ DUPLICATE             â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€ Dispatches: new HashChangeEvent('hashchange')                           â”‚
â”‚  â”œâ”€ SPANavigation hashchange listener catches it                            â”‚
â”‚  â”œâ”€ Calls: handleRoute() AGAIN                                              â”‚
â”‚  â”‚   â””â”€ renderHome() AGAIN                                                  â”‚
â”‚  â”‚       â”œâ”€ Shows loading spinner AGAIN (content disappears)                â”‚
â”‚  â”‚       â”œâ”€ Queries: db.collection('mythologies').get() AGAIN               â”‚
â”‚  â”‚       â””â”€ Updates: mainContent.innerHTML AGAIN                            â”‚
â”‚  â”‚           ğŸ”´ USER SEES CONTENT FLICKER                                    â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â””â”€ Done                                                                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## STATE STORAGE LOCATIONS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WHERE IS AUTH STATE STORED?                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  [1] auth-guard-simple.js (module-level variables)                          â”‚
â”‚      â”œâ”€ isAuthenticated: boolean                                            â”‚
â”‚      â””â”€ currentUser: object | null                                          â”‚
â”‚                                                                              â”‚
â”‚  [2] AuthManager instance (app-init creates this)                           â”‚
â”‚      â””â”€ this.currentUser: object | null                                     â”‚
â”‚                                                                              â”‚
â”‚  [3] SPANavigation instance (app-init creates this)                         â”‚
â”‚      â””â”€ this.authReady: boolean                                             â”‚
â”‚                                                                              â”‚
â”‚  [4] Firebase Auth internal state                                           â”‚
â”‚      â””â”€ firebase.auth().currentUser: object | null                          â”‚
â”‚                                                                              â”‚
â”‚  [5] Document body classes (DOM)                                            â”‚
â”‚      â”œâ”€ .auth-loading                                                       â”‚
â”‚      â”œâ”€ .authenticated                                                      â”‚
â”‚      â””â”€ .not-authenticated                                                  â”‚
â”‚                                                                              â”‚
â”‚  [6] DOM element display properties                                         â”‚
â”‚      â”œâ”€ #auth-overlay (display: none/flex)                                  â”‚
â”‚      â”œâ”€ #auth-loading-screen (display: none/block)                          â”‚
â”‚      â””â”€ #main-content (display: none/block)                                 â”‚
â”‚                                                                              â”‚
â”‚  âŒ PROBLEM: No single source of truth!                                     â”‚
â”‚  âŒ RISK: States can become inconsistent                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## LISTENER REGISTRATION ORDER

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FIREBASE AUTH LISTENERS (4 TOTAL)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Registration Order (determines callback order):                            â”‚
â”‚                                                                              â”‚
â”‚  [1] auth-guard-simple.js (line 45)                                         â”‚
â”‚      â””â”€ Registered: During script parse (~50ms)                             â”‚
â”‚      â””â”€ Purpose: Show/hide auth overlay                                     â”‚
â”‚      â””â”€ Side Effect: âš ï¸ Triggers hashchange after 1s delay                  â”‚
â”‚                                                                              â”‚
â”‚  [2] AuthManager (line 25)                                                  â”‚
â”‚      â””â”€ Registered: When AuthManager instantiated (~100ms)                  â”‚
â”‚      â””â”€ Purpose: Track current user, notify callbacks                       â”‚
â”‚      â””â”€ Side Effect: None (passive)                                         â”‚
â”‚                                                                              â”‚
â”‚  [3] SPANavigation.waitForAuth() (line 54)                                  â”‚
â”‚      â””â”€ Registered: When SPANavigation instantiated (~120ms)                â”‚
â”‚      â””â”€ Purpose: Wait for auth before initializing router                   â”‚
â”‚      â””â”€ Side Effect: âš ï¸ Calls initRouter() â†’ handleRoute()                  â”‚
â”‚                                                                              â”‚
â”‚  [4] app-init setupAuthUI (line 142)                                        â”‚
â”‚      â””â”€ Registered: During app-init execution (~130ms)                      â”‚
â”‚      â””â”€ Purpose: Update header user info display                            â”‚
â”‚      â””â”€ Side Effect: None (UI update only)                                  â”‚
â”‚                                                                              â”‚
â”‚  When auth state changes, ALL 4 fire in this order!                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DATA FLOW: FIREBASE TO COMPONENTS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HOW COMPONENTS ACCESS FIREBASE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Firebase Singleton Instance                                                â”‚
â”‚           â”‚                                                                  â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚           â–¼                 â–¼                  â–¼                    â–¼       â”‚
â”‚     Direct Global     Window Namespace   Constructor Param   Module Var    â”‚
â”‚                                                                              â”‚
â”‚  firebase.auth()    window.EyesOfAzrael  new HomeView(db)   this.db = ...  â”‚
â”‚  firebase.firestore() .db                                                   â”‚
â”‚                       .firebaseAuth                                         â”‚
â”‚                                                                              â”‚
â”‚  Used by:           Used by:            Used by:            Used by:        â”‚
â”‚  â€¢ auth-guard       â€¢ Some components   â€¢ HomeView          â€¢ Some classes  â”‚
â”‚  â€¢ Some old code                        â€¢ SPANavigation                     â”‚
â”‚                                         â€¢ Search                            â”‚
â”‚                                                                              â”‚
â”‚  âš ï¸ INCONSISTENT: 4 different patterns to access same instance              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## CRITICAL PATH (What MUST Succeed)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CRITICAL PATH TO VISIBLE CONTENT                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. Firebase SDK loads from CDN                                             â”‚
â”‚     â””â”€ SPOF #1: If CDN down â†’ entire app broken                             â”‚
â”‚                                                                              â”‚
â”‚  2. firebase-config.js loads                                                â”‚
â”‚     â””â”€ SPOF #2: If missing â†’ Firebase init fails                            â”‚
â”‚                                                                              â”‚
â”‚  3. Firebase initializes successfully                                       â”‚
â”‚     â””â”€ SPOF #3: If config invalid â†’ auth fails                              â”‚
â”‚                                                                              â”‚
â”‚  4. User authenticates (Google OAuth)                                       â”‚
â”‚     â””â”€ SPOF #4: If auth fails â†’ stuck on login screen                       â”‚
â”‚                                                                              â”‚
â”‚  5. SPANavigation initializes                                               â”‚
â”‚     â””â”€ SPOF #5: If constructor throws â†’ navigation broken                   â”‚
â”‚                                                                              â”‚
â”‚  6. HomeView renders                                                        â”‚
â”‚     â””â”€ Fallback: Uses hardcoded data if Firebase query fails âœ…             â”‚
â”‚                                                                              â”‚
â”‚  7. Content displays to user                                                â”‚
â”‚                                                                              â”‚
â”‚  Any failure in steps 1-5 = blank screen or error                           â”‚
â”‚  Failure in step 6 = gracefully degraded (shows fallback)                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## PROPOSED ARCHITECTURE (FUTURE)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RECOMMENDED FUTURE STATE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  [1] firebase-config.js                                                     â”‚
â”‚      â””â”€ Initialize Firebase ONCE                                            â”‚
â”‚      â””â”€ Export window.EyesOfAzrael.{app, db, auth}                          â”‚
â”‚                                                                              â”‚
â”‚  [2] auth-state-manager.js                                                  â”‚
â”‚      â””â”€ SINGLE onAuthStateChanged listener                                  â”‚
â”‚      â””â”€ Provide subscribe(id, callback) API                                 â”‚
â”‚      â””â”€ Notify all subscribers on state change                              â”‚
â”‚                                                                              â”‚
â”‚  [3] loading-manager.js                                                     â”‚
â”‚      â””â”€ Centralized loading state                                           â”‚
â”‚      â””â”€ Reference counted (show/hide by ID)                                 â”‚
â”‚                                                                              â”‚
â”‚  [4] auth-guard-simple.js                                                   â”‚
â”‚      â””â”€ Subscribe to auth state                                             â”‚
â”‚      â””â”€ Show/hide overlay ONLY                                              â”‚
â”‚      â””â”€ NO navigation triggers                                              â”‚
â”‚      â””â”€ NO Firebase initialization                                          â”‚
â”‚                                                                              â”‚
â”‚  [5] app-init-orchestrator.js                                               â”‚
â”‚      â””â”€ Wait for auth ready event                                           â”‚
â”‚      â””â”€ Instantiate components IN ORDER                                     â”‚
â”‚      â””â”€ Initialize SPANavigation                                            â”‚
â”‚      â””â”€ Trigger initial route ONCE                                          â”‚
â”‚                                                                              â”‚
â”‚  BENEFITS:                                                                   â”‚
â”‚  âœ… Single source of truth (AuthStateManager)                               â”‚
â”‚  âœ… Clear initialization order                                              â”‚
â”‚  âœ… No race conditions                                                      â”‚
â”‚  âœ… No duplicate renders                                                    â”‚
â”‚  âœ… Easier to test and debug                                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## QUICK WIN: THE 5-MINUTE FIX

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ELIMINATE CONTENT FLICKER NOW                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  File: js/auth-guard-simple.js                                              â”‚
â”‚  Lines: 116-120                                                             â”‚
â”‚                                                                              â”‚
â”‚  BEFORE:                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ setTimeout(() => {                                              â”‚        â”‚
â”‚  â”‚     console.log('[EOA Auth Guard] Triggering navigation...');   â”‚        â”‚
â”‚  â”‚     window.dispatchEvent(new HashChangeEvent('hashchange'));    â”‚        â”‚
â”‚  â”‚ }, 1000);                                                        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                              â”‚
â”‚  AFTER:                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ // âŒ REMOVED: SPANavigation handles this already               â”‚        â”‚
â”‚  â”‚ // setTimeout(() => {                                           â”‚        â”‚
â”‚  â”‚ //     console.log('[EOA Auth Guard] Triggering navigation...'); â”‚       â”‚
â”‚  â”‚ //     window.dispatchEvent(new HashChangeEvent('hashchange')); â”‚        â”‚
â”‚  â”‚ // }, 1000);                                                     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                              â”‚
â”‚  RESULT: Home page renders ONCE instead of TWICE                            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**For detailed analysis, see:** `AGENT_8_COMPREHENSIVE_INTEGRATION_TEST_REPORT.md`

**For immediate fix:** `AGENT_8_QUICK_FIX_GUIDE.md`
