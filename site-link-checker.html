<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eyes of Azrael - Site Link Checker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-pending {
            background: #ffd700;
            color: #000;
        }

        .status-running {
            background: #4a90e2;
            color: white;
            animation: pulse 1.5s infinite;
        }

        .status-pass {
            background: #4caf50;
            color: white;
        }

        .status-fail {
            background: #f44336;
            color: white;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .results-container {
            margin-top: 20px;
        }

        .result-item {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-item.pass {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }

        .result-item.fail {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }

        .result-item.warn {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }

        .result-icon {
            font-size: 1.5rem;
        }

        .result-text {
            flex: 1;
        }

        .result-details {
            font-size: 0.9rem;
            color: #666;
            margin-top: 4px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 10px 0;
        }

        .test-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .test-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üëÅÔ∏è Eyes of Azrael - Site Link Checker</h1>
            <p>Automated testing suite for verifying site functionality after migration</p>
        </div>

        <div class="content">
            <div class="test-controls">
                <button class="btn-primary" onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
                <button class="btn-secondary" onclick="clearResults()">üóëÔ∏è Clear Results</button>
                <button class="btn-secondary" onclick="exportResults()">üì• Export Results</button>
            </div>

            <!-- Test 1: Route Patterns -->
            <div class="test-section" id="test-routes">
                <h2>
                    üõ£Ô∏è Route Pattern Tests
                    <span class="status-badge status-pending" id="status-routes">Pending</span>
                </h2>
                <p>Verify all SPA routes are properly configured and accessible</p>
                <button class="btn-secondary" onclick="testRoutes()">Run Test</button>
                <div class="results-container" id="results-routes"></div>
            </div>

            <!-- Test 2: Firebase Content -->
            <div class="test-section" id="test-firebase">
                <h2>
                    üî• Firebase Content Tests
                    <span class="status-badge status-pending" id="status-firebase">Pending</span>
                </h2>
                <p>Verify Firebase collections are accessible and contain data</p>
                <button class="btn-secondary" onclick="testFirebase()">Run Test</button>
                <div class="results-container" id="results-firebase"></div>
            </div>

            <!-- Test 3: Navigation Links -->
            <div class="test-section" id="test-navigation">
                <h2>
                    üîó Navigation Link Tests
                    <span class="status-badge status-pending" id="status-navigation">Pending</span>
                </h2>
                <p>Check all navigation links point to valid routes</p>
                <button class="btn-secondary" onclick="testNavigation()">Run Test</button>
                <div class="results-container" id="results-navigation"></div>
            </div>

            <!-- Test 4: Script Loading -->
            <div class="test-section" id="test-scripts">
                <h2>
                    üìú Script Loading Tests
                    <span class="status-badge status-pending" id="status-scripts">Pending</span>
                </h2>
                <p>Verify all required JavaScript files load successfully</p>
                <button class="btn-secondary" onclick="testScripts()">Run Test</button>
                <div class="results-container" id="results-scripts"></div>
            </div>

            <!-- Test 5: Shader System -->
            <div class="test-section" id="test-shaders">
                <h2>
                    üé® Shader System Tests
                    <span class="status-badge status-pending" id="status-shaders">Pending</span>
                </h2>
                <p>Verify shader backgrounds load and render properly</p>
                <button class="btn-secondary" onclick="testShaders()">Run Test</button>
                <div class="results-container" id="results-shaders"></div>
            </div>

            <!-- Summary Statistics -->
            <div class="test-section">
                <h2>üìä Test Summary</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">Total Tests</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-passed">0</div>
                        <div class="stat-label">Passed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-failed">0</div>
                        <div class="stat-label">Failed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-warnings">0</div>
                        <div class="stat-label">Warnings</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test results storage
        const testResults = {
            routes: [],
            firebase: [],
            navigation: [],
            scripts: [],
            shaders: []
        };

        let testsCompleted = 0;
        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;
        let warnings = 0;

        // Update statistics
        function updateStats() {
            document.getElementById('stat-total').textContent = totalTests;
            document.getElementById('stat-passed').textContent = passedTests;
            document.getElementById('stat-failed').textContent = failedTests;
            document.getElementById('stat-warnings').textContent = warnings;

            const progress = totalTests > 0 ? (testsCompleted / totalTests) * 100 : 0;
            document.getElementById('progress-fill').style.width = progress + '%';
        }

        // Add result to display
        function addResult(testId, type, message, details = '') {
            const container = document.getElementById(`results-${testId}`);
            const resultDiv = document.createElement('div');
            resultDiv.className = `result-item ${type}`;

            const icons = { pass: '‚úÖ', fail: '‚ùå', warn: '‚ö†Ô∏è' };
            const icon = icons[type] || '‚Ä¢';

            resultDiv.innerHTML = `
                <span class="result-icon">${icon}</span>
                <div class="result-text">
                    ${message}
                    ${details ? `<div class="result-details">${details}</div>` : ''}
                </div>
            `;

            container.appendChild(resultDiv);

            // Update counters
            totalTests++;
            testsCompleted++;
            if (type === 'pass') passedTests++;
            if (type === 'fail') failedTests++;
            if (type === 'warn') warnings++;

            updateStats();
        }

        // Set test status
        function setTestStatus(testId, status) {
            const statusBadge = document.getElementById(`status-${testId}`);
            statusBadge.className = `status-badge status-${status}`;
            statusBadge.textContent = status.charAt(0).toUpperCase() + status.slice(1);
        }

        // Test 1: Route Patterns
        function testRoutes() {
            setTestStatus('routes', 'running');
            document.getElementById('results-routes').innerHTML = '';

            const routes = [
                { hash: '#/', name: 'Home' },
                { hash: '#/mythology/greek', name: 'Greek Mythology' },
                { hash: '#/mythology/norse', name: 'Norse Mythology' },
                { hash: '#/mythology/egyptian', name: 'Egyptian Mythology' },
                { hash: '#/search', name: 'Search' },
                { hash: '#/compare', name: 'Compare' },
                { hash: '#/dashboard', name: 'Dashboard' }
            ];

            routes.forEach(route => {
                try {
                    const pattern = route.hash.replace('#/', '');
                    const parts = pattern.split('/');

                    // Check if route matches expected pattern
                    if (parts.length === 0 || parts[0] === '') {
                        addResult('routes', 'pass', `Route "${route.name}" is valid (home route)`);
                    } else if (parts[0] === 'mythology' && parts.length >= 2) {
                        addResult('routes', 'pass', `Route "${route.name}" is valid (mythology route)`);
                    } else if (['search', 'compare', 'dashboard'].includes(parts[0])) {
                        addResult('routes', 'pass', `Route "${route.name}" is valid (special route)`);
                    } else {
                        addResult('routes', 'warn', `Route "${route.name}" pattern may be unusual`, route.hash);
                    }
                } catch (error) {
                    addResult('routes', 'fail', `Route "${route.name}" test failed`, error.message);
                }
            });

            setTestStatus('routes', 'pass');
        }

        // Test 2: Firebase Content
        async function testFirebase() {
            setTestStatus('firebase', 'running');
            document.getElementById('results-firebase').innerHTML = '';

            if (typeof firebase === 'undefined') {
                addResult('firebase', 'fail', 'Firebase SDK not loaded');
                setTestStatus('firebase', 'fail');
                return;
            }

            addResult('firebase', 'pass', 'Firebase SDK loaded successfully');

            // Check if app is initialized
            try {
                const app = firebase.app();
                addResult('firebase', 'pass', 'Firebase app initialized', `Name: ${app.name}`);
            } catch (error) {
                addResult('firebase', 'fail', 'Firebase app not initialized', error.message);
                setTestStatus('firebase', 'fail');
                return;
            }

            // Check Firestore
            try {
                const db = firebase.firestore();
                addResult('firebase', 'pass', 'Firestore instance created');

                // Test collections exist
                const collections = ['deities', 'heroes', 'creatures', 'cosmology', 'mythologies'];
                for (const collection of collections) {
                    try {
                        const snapshot = await db.collection(collection).limit(1).get();
                        if (!snapshot.empty) {
                            addResult('firebase', 'pass', `Collection "${collection}" exists and has data`, `Sample doc ID: ${snapshot.docs[0].id}`);
                        } else {
                            addResult('firebase', 'warn', `Collection "${collection}" exists but is empty`);
                        }
                    } catch (error) {
                        addResult('firebase', 'fail', `Failed to access collection "${collection}"`, error.message);
                    }
                }
            } catch (error) {
                addResult('firebase', 'fail', 'Failed to create Firestore instance', error.message);
            }

            setTestStatus('firebase', 'pass');
        }

        // Test 3: Navigation Links
        function testNavigation() {
            setTestStatus('navigation', 'running');
            document.getElementById('results-navigation').innerHTML = '';

            // Check header navigation
            const navLinks = document.querySelectorAll('.main-nav a[href^="#/"]');
            if (navLinks.length > 0) {
                addResult('navigation', 'pass', `Found ${navLinks.length} navigation links in header`);
                navLinks.forEach(link => {
                    const href = link.getAttribute('href');
                    addResult('navigation', 'pass', `Navigation link: ${link.textContent}`, href);
                });
            } else {
                addResult('navigation', 'warn', 'No navigation links found in header');
            }

            // Check for any static HTML links (should not exist)
            const staticLinks = document.querySelectorAll('a[href$=".html"]');
            if (staticLinks.length > 0) {
                staticLinks.forEach(link => {
                    addResult('navigation', 'fail', 'Found static HTML link (should be hash route)', link.getAttribute('href'));
                });
            } else {
                addResult('navigation', 'pass', 'No static HTML links found (good!)');
            }

            setTestStatus('navigation', 'pass');
        }

        // Test 4: Script Loading
        function testScripts() {
            setTestStatus('scripts', 'running');
            document.getElementById('results-scripts').innerHTML = '';

            const requiredScripts = [
                'firebase-app-compat.js',
                'firebase-firestore-compat.js',
                'firebase-auth-compat.js',
                'firebase-config.js',
                'spa-navigation.js',
                'app-coordinator.js',
                'auth-guard-simple.js',
                'universal-display-renderer.js',
                'home-view.js'
            ];

            const loadedScripts = Array.from(document.querySelectorAll('script[src]'))
                .map(s => s.src);

            requiredScripts.forEach(scriptName => {
                const found = loadedScripts.some(src => src.includes(scriptName));
                if (found) {
                    addResult('scripts', 'pass', `Script loaded: ${scriptName}`);
                } else {
                    addResult('scripts', 'fail', `Script missing: ${scriptName}`);
                }
            });

            // Check for global classes
            const requiredClasses = [
                'SPANavigation',
                'UniversalDisplayRenderer',
                'HomeView',
                'AuthManager'
            ];

            requiredClasses.forEach(className => {
                if (typeof window[className] !== 'undefined') {
                    addResult('scripts', 'pass', `Class available: ${className}`);
                } else {
                    addResult('scripts', 'warn', `Class not found: ${className}`, 'May not have loaded yet');
                }
            });

            setTestStatus('scripts', 'pass');
        }

        // Test 5: Shader System
        function testShaders() {
            setTestStatus('shaders', 'running');
            document.getElementById('results-shaders').innerHTML = '';

            // Check if shader script is loaded
            const shaderScripts = Array.from(document.querySelectorAll('script[src]'))
                .filter(s => s.src.includes('shader'));

            if (shaderScripts.length > 0) {
                shaderScripts.forEach(script => {
                    const scriptName = script.src.split('/').pop();
                    addResult('shaders', 'pass', `Shader script loaded: ${scriptName}`);
                });
            } else {
                addResult('shaders', 'warn', 'No shader scripts found');
            }

            // Check for shader CSS
            const shaderCSS = Array.from(document.querySelectorAll('link[rel="stylesheet"]'))
                .filter(link => link.href.includes('shader'));

            if (shaderCSS.length > 0) {
                shaderCSS.forEach(link => {
                    const cssName = link.href.split('/').pop();
                    addResult('shaders', 'pass', `Shader CSS loaded: ${cssName}`);
                });
            } else {
                addResult('shaders', 'warn', 'No shader CSS files found');
            }

            // Check for WebGL support
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');

            if (gl) {
                addResult('shaders', 'pass', 'WebGL is supported in this browser');
            } else {
                addResult('shaders', 'fail', 'WebGL is not supported in this browser');
            }

            setTestStatus('shaders', 'pass');
        }

        // Run all tests
        async function runAllTests() {
            clearResults();
            testRoutes();
            await testFirebase();
            testNavigation();
            testScripts();
            testShaders();
        }

        // Clear all results
        function clearResults() {
            testsCompleted = 0;
            totalTests = 0;
            passedTests = 0;
            failedTests = 0;
            warnings = 0;

            ['routes', 'firebase', 'navigation', 'scripts', 'shaders'].forEach(testId => {
                document.getElementById(`results-${testId}`).innerHTML = '';
                setTestStatus(testId, 'pending');
            });

            updateStats();
        }

        // Export results
        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                summary: {
                    total: totalTests,
                    passed: passedTests,
                    failed: failedTests,
                    warnings: warnings
                },
                tests: testResults
            };

            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `site-test-results-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>

    <!-- Load Firebase SDK for testing -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
</body>
</html>
